{"mappings":"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","sources":["node_modules/excalibur/build/dist/webpack:/ex/webpack/universalModuleDefinition","node_modules/excalibur/build/dist/webpack:/node_modules/core-js/es/array/sort.js","node_modules/excalibur/build/dist/webpack:/node_modules/core-js/es/object/keys.js","node_modules/excalibur/build/dist/webpack:/node_modules/core-js/internals/a-callable.js","node_modules/excalibur/build/dist/webpack:/node_modules/core-js/internals/an-object.js","node_modules/excalibur/build/dist/webpack:/node_modules/core-js/internals/array-includes.js","node_modules/excalibur/build/dist/webpack:/node_modules/core-js/internals/array-method-is-strict.js","node_modules/excalibur/build/dist/webpack:/node_modules/core-js/internals/array-sort.js","node_modules/excalibur/build/dist/webpack:/node_modules/core-js/internals/classof-raw.js","node_modules/excalibur/build/dist/webpack:/node_modules/core-js/internals/classof.js","node_modules/excalibur/build/dist/webpack:/node_modules/core-js/internals/copy-constructor-properties.js","node_modules/excalibur/build/dist/webpack:/node_modules/core-js/internals/create-non-enumerable-property.js","node_modules/excalibur/build/dist/webpack:/node_modules/core-js/internals/create-property-descriptor.js","node_modules/excalibur/build/dist/webpack:/node_modules/core-js/internals/descriptors.js","node_modules/excalibur/build/dist/webpack:/node_modules/core-js/internals/document-create-element.js","node_modules/excalibur/build/dist/webpack:/node_modules/core-js/internals/engine-ff-version.js","node_modules/excalibur/build/dist/webpack:/node_modules/core-js/internals/engine-is-ie-or-edge.js","node_modules/excalibur/build/dist/webpack:/node_modules/core-js/internals/engine-user-agent.js","node_modules/excalibur/build/dist/webpack:/node_modules/core-js/internals/engine-v8-version.js","node_modules/excalibur/build/dist/webpack:/node_modules/core-js/internals/engine-webkit-version.js","node_modules/excalibur/build/dist/webpack:/node_modules/core-js/internals/entry-unbind.js","node_modules/excalibur/build/dist/webpack:/node_modules/core-js/internals/enum-bug-keys.js","node_modules/excalibur/build/dist/webpack:/node_modules/core-js/internals/export.js","node_modules/excalibur/build/dist/webpack:/node_modules/core-js/internals/fails.js","node_modules/excalibur/build/dist/webpack:/node_modules/core-js/internals/function-bind-context.js","node_modules/excalibur/build/dist/webpack:/node_modules/core-js/internals/function-name.js","node_modules/excalibur/build/dist/webpack:/node_modules/core-js/internals/get-built-in.js","node_modules/excalibur/build/dist/webpack:/node_modules/core-js/internals/get-method.js","node_modules/excalibur/build/dist/webpack:/node_modules/core-js/internals/global.js","node_modules/excalibur/build/dist/webpack:/node_modules/core-js/internals/has.js","node_modules/excalibur/build/dist/webpack:/node_modules/core-js/internals/hidden-keys.js","node_modules/excalibur/build/dist/webpack:/node_modules/core-js/internals/ie8-dom-define.js","node_modules/excalibur/build/dist/webpack:/node_modules/core-js/internals/indexed-object.js","node_modules/excalibur/build/dist/webpack:/node_modules/core-js/internals/inspect-source.js","node_modules/excalibur/build/dist/webpack:/node_modules/core-js/internals/internal-state.js","node_modules/excalibur/build/dist/webpack:/node_modules/core-js/internals/is-callable.js","node_modules/excalibur/build/dist/webpack:/node_modules/core-js/internals/is-forced.js","node_modules/excalibur/build/dist/webpack:/node_modules/core-js/internals/is-object.js","node_modules/excalibur/build/dist/webpack:/node_modules/core-js/internals/is-pure.js","node_modules/excalibur/build/dist/webpack:/node_modules/core-js/internals/is-symbol.js","node_modules/excalibur/build/dist/webpack:/node_modules/core-js/internals/native-symbol.js","node_modules/excalibur/build/dist/webpack:/node_modules/core-js/internals/native-weak-map.js","node_modules/excalibur/build/dist/webpack:/node_modules/core-js/internals/object-define-property.js","node_modules/excalibur/build/dist/webpack:/node_modules/core-js/internals/object-get-own-property-descriptor.js","node_modules/excalibur/build/dist/webpack:/node_modules/core-js/internals/object-get-own-property-names.js","node_modules/excalibur/build/dist/webpack:/node_modules/core-js/internals/object-get-own-property-symbols.js","node_modules/excalibur/build/dist/webpack:/node_modules/core-js/internals/object-keys-internal.js","node_modules/excalibur/build/dist/webpack:/node_modules/core-js/internals/object-keys.js","node_modules/excalibur/build/dist/webpack:/node_modules/core-js/internals/object-property-is-enumerable.js","node_modules/excalibur/build/dist/webpack:/node_modules/core-js/internals/ordinary-to-primitive.js","node_modules/excalibur/build/dist/webpack:/node_modules/core-js/internals/own-keys.js","node_modules/excalibur/build/dist/webpack:/node_modules/core-js/internals/path.js","node_modules/excalibur/build/dist/webpack:/node_modules/core-js/internals/redefine.js","node_modules/excalibur/build/dist/webpack:/node_modules/core-js/internals/require-object-coercible.js","node_modules/excalibur/build/dist/webpack:/node_modules/core-js/internals/set-global.js","node_modules/excalibur/build/dist/webpack:/node_modules/core-js/internals/shared-key.js","node_modules/excalibur/build/dist/webpack:/node_modules/core-js/internals/shared-store.js","node_modules/excalibur/build/dist/webpack:/node_modules/core-js/internals/shared.js","node_modules/excalibur/build/dist/webpack:/node_modules/core-js/internals/to-absolute-index.js","node_modules/excalibur/build/dist/webpack:/node_modules/core-js/internals/to-indexed-object.js","node_modules/excalibur/build/dist/webpack:/node_modules/core-js/internals/to-integer.js","node_modules/excalibur/build/dist/webpack:/node_modules/core-js/internals/to-length.js","node_modules/excalibur/build/dist/webpack:/node_modules/core-js/internals/to-object.js","node_modules/excalibur/build/dist/webpack:/node_modules/core-js/internals/to-primitive.js","node_modules/excalibur/build/dist/webpack:/node_modules/core-js/internals/to-property-key.js","node_modules/excalibur/build/dist/webpack:/node_modules/core-js/internals/to-string-tag-support.js","node_modules/excalibur/build/dist/webpack:/node_modules/core-js/internals/to-string.js","node_modules/excalibur/build/dist/webpack:/node_modules/core-js/internals/try-to-string.js","node_modules/excalibur/build/dist/webpack:/node_modules/core-js/internals/uid.js","node_modules/excalibur/build/dist/webpack:/node_modules/core-js/internals/use-symbol-as-uid.js","node_modules/excalibur/build/dist/webpack:/node_modules/core-js/internals/well-known-symbol.js","node_modules/excalibur/build/dist/webpack:/node_modules/core-js/modules/es.array.sort.js","node_modules/excalibur/build/dist/webpack:/node_modules/core-js/modules/es.object.keys.js","node_modules/excalibur/build/dist/webpack:/ex/Loader.css?0475","node_modules/excalibur/build/dist/webpack:/node_modules/css-loader/dist/runtime/api.js","node_modules/excalibur/build/dist/webpack:/node_modules/css-loader/dist/runtime/sourceMaps.js","node_modules/excalibur/build/dist/webpack:/ex/webpack/bootstrap","node_modules/excalibur/build/dist/webpack:/ex/webpack/runtime/compat get default export","node_modules/excalibur/build/dist/webpack:/ex/webpack/runtime/define property getters","node_modules/excalibur/build/dist/webpack:/ex/webpack/runtime/global","node_modules/excalibur/build/dist/webpack:/ex/webpack/runtime/hasOwnProperty shorthand","node_modules/excalibur/build/dist/webpack:/ex/webpack/runtime/make namespace object","node_modules/excalibur/build/dist/webpack:/ex/Flags.ts","node_modules/excalibur/build/dist/webpack:/ex/Util/Log.ts","node_modules/excalibur/build/dist/webpack:/ex/Collision/Side.ts","node_modules/excalibur/build/dist/webpack:/ex/Polyfill.ts","node_modules/excalibur/build/dist/webpack:/ex/Id.ts","node_modules/excalibur/build/dist/webpack:/ex/Math/Random.ts","node_modules/excalibur/build/dist/webpack:/ex/Util/Util.ts","node_modules/excalibur/build/dist/webpack:/ex/Util/Decorators.ts","node_modules/excalibur/build/dist/webpack:/ex/Math/vector.ts","node_modules/excalibur/build/dist/webpack:/ex/Screen.ts","node_modules/excalibur/build/dist/webpack:/ex/Events.ts","node_modules/excalibur/build/dist/webpack:/ex/Color.ts","node_modules/excalibur/build/dist/webpack:/ex/Collision/BoundingBox.ts","node_modules/excalibur/build/dist/webpack:/ex/Resources/Sound/AudioContext.ts","node_modules/excalibur/build/dist/webpack:/ex/Util/WebAudio.ts","node_modules/excalibur/build/dist/webpack:/ex/EventDispatcher.ts","node_modules/excalibur/build/dist/webpack:/ex/Class.ts","node_modules/excalibur/build/dist/webpack:/ex/Util/DrawUtil.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Graphic.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/webgl-util.ts","node_modules/excalibur/build/dist/webpack:/ex/Util/Watch.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/texture-loader.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Raster.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Canvas.ts","node_modules/excalibur/build/dist/webpack:/ex/Loader.ts","node_modules/excalibur/build/dist/webpack:/ex/Loader.logo.png?607f","node_modules/excalibur/build/dist/webpack:/ex/Util/Detector.ts","node_modules/excalibur/build/dist/webpack:/ex/Resources/Resource.ts","node_modules/excalibur/build/dist/webpack:/ex/Drawing/SpriteEffects.ts","node_modules/excalibur/build/dist/webpack:/ex/Configurable.ts","node_modules/excalibur/build/dist/webpack:/ex/Drawing/Sprite.ts","node_modules/excalibur/build/dist/webpack:/ex/Drawing/Texture.ts","node_modules/excalibur/build/dist/webpack:/ex/Drawing/Animation.ts","node_modules/excalibur/build/dist/webpack:/ex/Math/matrix.ts","node_modules/excalibur/build/dist/webpack:/ex/Util/EasingFunctions.ts","node_modules/excalibur/build/dist/webpack:/ex/Actions/ActionQueue.ts","node_modules/excalibur/build/dist/webpack:/ex/Actions/Action/Repeat.ts","node_modules/excalibur/build/dist/webpack:/ex/Actions/Action/RepeatForever.ts","node_modules/excalibur/build/dist/webpack:/ex/Actions/Action/MoveBy.ts","node_modules/excalibur/build/dist/webpack:/ex/Actions/Action/MoveTo.ts","node_modules/excalibur/build/dist/webpack:/ex/Actions/RotationType.ts","node_modules/excalibur/build/dist/webpack:/ex/Actions/Action/RotateTo.ts","node_modules/excalibur/build/dist/webpack:/ex/Actions/Action/RotateBy.ts","node_modules/excalibur/build/dist/webpack:/ex/EntityComponentSystem/Component.ts","node_modules/excalibur/build/dist/webpack:/ex/EntityComponentSystem/Components/MotionComponent.ts","node_modules/excalibur/build/dist/webpack:/ex/Math/vector-view.ts","node_modules/excalibur/build/dist/webpack:/ex/EntityComponentSystem/Components/TransformComponent.ts","node_modules/excalibur/build/dist/webpack:/ex/Collision/CollisionType.ts","node_modules/excalibur/build/dist/webpack:/ex/Collision/Physics.ts","node_modules/excalibur/build/dist/webpack:/ex/Actions/Action/ScaleTo.ts","node_modules/excalibur/build/dist/webpack:/ex/Actions/Action/ScaleBy.ts","node_modules/excalibur/build/dist/webpack:/ex/Actions/Action/CallMethod.ts","node_modules/excalibur/build/dist/webpack:/ex/Actions/Action/EaseTo.ts","node_modules/excalibur/build/dist/webpack:/ex/Actions/Action/Blink.ts","node_modules/excalibur/build/dist/webpack:/ex/Actions/Action/Fade.ts","node_modules/excalibur/build/dist/webpack:/ex/Actions/Action/Delay.ts","node_modules/excalibur/build/dist/webpack:/ex/Actions/Action/Die.ts","node_modules/excalibur/build/dist/webpack:/ex/Actions/Action/Follow.ts","node_modules/excalibur/build/dist/webpack:/ex/Actions/Action/Meet.ts","node_modules/excalibur/build/dist/webpack:/ex/Actions/ActionContext.ts","node_modules/excalibur/build/dist/webpack:/ex/Collision/Group/CollisionGroup.ts","node_modules/excalibur/build/dist/webpack:/ex/Util/Observable.ts","node_modules/excalibur/build/dist/webpack:/ex/Collision/Detection/Pair.ts","node_modules/excalibur/build/dist/webpack:/ex/Math/projection.ts","node_modules/excalibur/build/dist/webpack:/ex/Collision/Detection/DynamicTree.ts","node_modules/excalibur/build/dist/webpack:/ex/Math/ray.ts","node_modules/excalibur/build/dist/webpack:/ex/Collision/Detection/DynamicTreeCollisionProcessor.ts","node_modules/excalibur/build/dist/webpack:/ex/Collision/Colliders/Collider.ts","node_modules/excalibur/build/dist/webpack:/ex/Collision/Colliders/CompositeCollider.ts","node_modules/excalibur/build/dist/webpack:/ex/Math/line.ts","node_modules/excalibur/build/dist/webpack:/ex/Collision/Colliders/ClosestLineJumpTable.ts","node_modules/excalibur/build/dist/webpack:/ex/Collision/Colliders/CircleCollider.ts","node_modules/excalibur/build/dist/webpack:/ex/Collision/Detection/CollisionContact.ts","node_modules/excalibur/build/dist/webpack:/ex/Collision/Colliders/SeparatingAxis.ts","node_modules/excalibur/build/dist/webpack:/ex/Collision/Colliders/CollisionJumpTable.ts","node_modules/excalibur/build/dist/webpack:/ex/Collision/Colliders/EdgeCollider.ts","node_modules/excalibur/build/dist/webpack:/ex/Collision/Colliders/PolygonCollider.ts","node_modules/excalibur/build/dist/webpack:/ex/Collision/Colliders/Shape.ts","node_modules/excalibur/build/dist/webpack:/ex/Collision/ColliderComponent.ts","node_modules/excalibur/build/dist/webpack:/ex/Collision/BodyComponent.ts","node_modules/excalibur/build/dist/webpack:/ex/Util/CullingBox.ts","node_modules/excalibur/build/dist/webpack:/ex/Traits/OffscreenCulling.ts","node_modules/excalibur/build/dist/webpack:/ex/Traits/CapturePointer.ts","node_modules/excalibur/build/dist/webpack:/ex/EntityComponentSystem/Entity.ts","node_modules/excalibur/build/dist/webpack:/ex/Drawing/CanvasDrawComponent.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/GraphicsComponent.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Rectangle.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Circle.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/FontCommon.ts","node_modules/excalibur/build/dist/webpack:/ex/Actor.ts","node_modules/excalibur/build/dist/webpack:/ex/ScreenElement.ts","node_modules/excalibur/build/dist/webpack:/ex/Timer.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/ImageSource.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Sprite.ts","node_modules/excalibur/build/dist/webpack:/ex/Drawing/SpriteSheet.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/SpriteSheet.ts","node_modules/excalibur/build/dist/webpack:/ex/TileMap.ts","node_modules/excalibur/build/dist/webpack:/ex/Camera.ts","node_modules/excalibur/build/dist/webpack:/ex/Util/Actors.ts","node_modules/excalibur/build/dist/webpack:/ex/Trigger.ts","node_modules/excalibur/build/dist/webpack:/ex/EntityComponentSystem/System.ts","node_modules/excalibur/build/dist/webpack:/ex/EntityComponentSystem/EntityManager.ts","node_modules/excalibur/build/dist/webpack:/ex/EntityComponentSystem/Util.ts","node_modules/excalibur/build/dist/webpack:/ex/EntityComponentSystem/Query.ts","node_modules/excalibur/build/dist/webpack:/ex/EntityComponentSystem/QueryManager.ts","node_modules/excalibur/build/dist/webpack:/ex/EntityComponentSystem/SystemManager.ts","node_modules/excalibur/build/dist/webpack:/ex/EntityComponentSystem/World.ts","node_modules/excalibur/build/dist/webpack:/ex/Collision/Integrator.ts","node_modules/excalibur/build/dist/webpack:/ex/Collision/MotionSystem.ts","node_modules/excalibur/build/dist/webpack:/ex/Collision/Solver/Solver.ts","node_modules/excalibur/build/dist/webpack:/ex/Collision/Solver/ArcadeSolver.ts","node_modules/excalibur/build/dist/webpack:/ex/Collision/Solver/ContactConstraintPoint.ts","node_modules/excalibur/build/dist/webpack:/ex/Collision/Solver/RealisticSolver.ts","node_modules/excalibur/build/dist/webpack:/ex/Collision/CollisionSystem.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/GraphicsDiagnostics.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Animation.ts","node_modules/excalibur/build/dist/webpack:/ex/Particles.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/GraphicsGroup.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/GraphicsSystem.ts","node_modules/excalibur/build/dist/webpack:/ex/Drawing/CanvasDrawingSystem.ts","node_modules/excalibur/build/dist/webpack:/ex/Debug/DebugSystem.ts","node_modules/excalibur/build/dist/webpack:/ex/Input/Keyboard.ts","node_modules/excalibur/build/dist/webpack:/ex/Input/Pointer.ts","node_modules/excalibur/build/dist/webpack:/ex/Input/PointerEvents.ts","node_modules/excalibur/build/dist/webpack:/ex/Input/Gamepad.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/draw-image-command.ts","node_modules/excalibur/build/dist/webpack:/ex/Scene.ts","node_modules/excalibur/build/dist/webpack:/ex/PostProcessing/ColorBlindCorrector.ts","node_modules/excalibur/build/dist/webpack:/ex/Debug/DebugFlags.ts","node_modules/excalibur/build/dist/webpack:/ex/Debug/Debug.ts","node_modules/excalibur/build/dist/webpack:/ex/Math/global-coordinates.ts","node_modules/excalibur/build/dist/webpack:/ex/Input/Pointers.ts","node_modules/excalibur/build/dist/webpack:/ex/Util/Browser.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/state-stack.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/SpriteFont.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/debug-text.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/debug-font.png?1126","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/ExcaliburGraphicsContext2DCanvas.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/transform-stack.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/shader.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/batch.ts","node_modules/excalibur/build/dist/webpack:/ex/Util/Pool.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/renderer.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/line-renderer.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/shaders/line-vertex.glsl?d00f","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/shaders/line-fragment.glsl?0e66","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/image-renderer.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/shaders/image-vertex.glsl?8c14","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/shaders/image-fragment.glsl?bce2","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/point-renderer.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/shaders/point-vertex.glsl?98ff","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/shaders/point-fragment.glsl?befc","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/ExcaliburGraphicsContextWebGL.ts","node_modules/excalibur/build/dist/webpack:/ex/Engine.ts","node_modules/excalibur/build/dist/webpack:/ex/Events/MediaEvents.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Font.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Text.ts","node_modules/excalibur/build/dist/webpack:/ex/Label.ts","node_modules/excalibur/build/dist/webpack:/ex/Collision/Group/CollisionGroupManager.ts","node_modules/excalibur/build/dist/webpack:/ex/Drawing/Polygon.ts","node_modules/excalibur/build/dist/webpack:/ex/Interfaces/AudioImplementation.ts","node_modules/excalibur/build/dist/webpack:/ex/Interfaces/LifecycleEvents.ts","node_modules/excalibur/build/dist/webpack:/ex/Resources/Sound/WebAudioInstance.ts","node_modules/excalibur/build/dist/webpack:/ex/Util/Sound.ts","node_modules/excalibur/build/dist/webpack:/ex/Resources/Sound/Sound.ts","node_modules/excalibur/build/dist/webpack:/ex/Resources/Gif.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Polygon.ts","node_modules/excalibur/build/dist/webpack:/ex/Util/SortedList.ts","node_modules/excalibur/build/dist/webpack:/ex/Promises.ts","node_modules/excalibur/build/dist/webpack:/ex/index.ts"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"ex\"] = factory();\n\telse\n\t\troot[\"ex\"] = factory();\n})(self, function() {\nreturn ","require('../../modules/es.array.sort');\nvar entryUnbind = require('../../internals/entry-unbind');\n\nmodule.exports = entryUnbind('Array', 'sort');\n","require('../../modules/es.object.keys');\nvar path = require('../../internals/path');\n\nmodule.exports = path.Object.keys;\n","var isCallable = require('../internals/is-callable');\nvar tryToString = require('../internals/try-to-string');\n\n// `Assert: IsCallable(argument) is true`\nmodule.exports = function (argument) {\n  if (isCallable(argument)) return argument;\n  throw TypeError(tryToString(argument) + ' is not a function');\n};\n","var isObject = require('../internals/is-object');\n\n// `Assert: Type(argument) is Object`\nmodule.exports = function (argument) {\n  if (isObject(argument)) return argument;\n  throw TypeError(String(argument) + ' is not an object');\n};\n","var toIndexedObject = require('../internals/to-indexed-object');\nvar toLength = require('../internals/to-length');\nvar toAbsoluteIndex = require('../internals/to-absolute-index');\n\n// `Array.prototype.{ indexOf, includes }` methods implementation\nvar createMethod = function (IS_INCLUDES) {\n  return function ($this, el, fromIndex) {\n    var O = toIndexedObject($this);\n    var length = toLength(O.length);\n    var index = toAbsoluteIndex(fromIndex, length);\n    var value;\n    // Array#includes uses SameValueZero equality algorithm\n    // eslint-disable-next-line no-self-compare -- NaN check\n    if (IS_INCLUDES && el != el) while (length > index) {\n      value = O[index++];\n      // eslint-disable-next-line no-self-compare -- NaN check\n      if (value != value) return true;\n    // Array#indexOf ignores holes, Array#includes - not\n    } else for (;length > index; index++) {\n      if ((IS_INCLUDES || index in O) && O[index] === el) return IS_INCLUDES || index || 0;\n    } return !IS_INCLUDES && -1;\n  };\n};\n\nmodule.exports = {\n  // `Array.prototype.includes` method\n  // https://tc39.es/ecma262/#sec-array.prototype.includes\n  includes: createMethod(true),\n  // `Array.prototype.indexOf` method\n  // https://tc39.es/ecma262/#sec-array.prototype.indexof\n  indexOf: createMethod(false)\n};\n","'use strict';\nvar fails = require('../internals/fails');\n\nmodule.exports = function (METHOD_NAME, argument) {\n  var method = [][METHOD_NAME];\n  return !!method && fails(function () {\n    // eslint-disable-next-line no-useless-call,no-throw-literal -- required for testing\n    method.call(null, argument || function () { throw 1; }, 1);\n  });\n};\n","// TODO: use something more complex like timsort?\nvar floor = Math.floor;\n\nvar mergeSort = function (array, comparefn) {\n  var length = array.length;\n  var middle = floor(length / 2);\n  return length < 8 ? insertionSort(array, comparefn) : merge(\n    mergeSort(array.slice(0, middle), comparefn),\n    mergeSort(array.slice(middle), comparefn),\n    comparefn\n  );\n};\n\nvar insertionSort = function (array, comparefn) {\n  var length = array.length;\n  var i = 1;\n  var element, j;\n\n  while (i < length) {\n    j = i;\n    element = array[i];\n    while (j && comparefn(array[j - 1], element) > 0) {\n      array[j] = array[--j];\n    }\n    if (j !== i++) array[j] = element;\n  } return array;\n};\n\nvar merge = function (left, right, comparefn) {\n  var llength = left.length;\n  var rlength = right.length;\n  var lindex = 0;\n  var rindex = 0;\n  var result = [];\n\n  while (lindex < llength || rindex < rlength) {\n    if (lindex < llength && rindex < rlength) {\n      result.push(comparefn(left[lindex], right[rindex]) <= 0 ? left[lindex++] : right[rindex++]);\n    } else {\n      result.push(lindex < llength ? left[lindex++] : right[rindex++]);\n    }\n  } return result;\n};\n\nmodule.exports = mergeSort;\n","var toString = {}.toString;\n\nmodule.exports = function (it) {\n  return toString.call(it).slice(8, -1);\n};\n","var TO_STRING_TAG_SUPPORT = require('../internals/to-string-tag-support');\nvar isCallable = require('../internals/is-callable');\nvar classofRaw = require('../internals/classof-raw');\nvar wellKnownSymbol = require('../internals/well-known-symbol');\n\nvar TO_STRING_TAG = wellKnownSymbol('toStringTag');\n// ES3 wrong here\nvar CORRECT_ARGUMENTS = classofRaw(function () { return arguments; }()) == 'Arguments';\n\n// fallback for IE11 Script Access Denied error\nvar tryGet = function (it, key) {\n  try {\n    return it[key];\n  } catch (error) { /* empty */ }\n};\n\n// getting tag from ES6+ `Object.prototype.toString`\nmodule.exports = TO_STRING_TAG_SUPPORT ? classofRaw : function (it) {\n  var O, tag, result;\n  return it === undefined ? 'Undefined' : it === null ? 'Null'\n    // @@toStringTag case\n    : typeof (tag = tryGet(O = Object(it), TO_STRING_TAG)) == 'string' ? tag\n    // builtinTag case\n    : CORRECT_ARGUMENTS ? classofRaw(O)\n    // ES3 arguments fallback\n    : (result = classofRaw(O)) == 'Object' && isCallable(O.callee) ? 'Arguments' : result;\n};\n","var has = require('../internals/has');\nvar ownKeys = require('../internals/own-keys');\nvar getOwnPropertyDescriptorModule = require('../internals/object-get-own-property-descriptor');\nvar definePropertyModule = require('../internals/object-define-property');\n\nmodule.exports = function (target, source) {\n  var keys = ownKeys(source);\n  var defineProperty = definePropertyModule.f;\n  var getOwnPropertyDescriptor = getOwnPropertyDescriptorModule.f;\n  for (var i = 0; i < keys.length; i++) {\n    var key = keys[i];\n    if (!has(target, key)) defineProperty(target, key, getOwnPropertyDescriptor(source, key));\n  }\n};\n","var DESCRIPTORS = require('../internals/descriptors');\nvar definePropertyModule = require('../internals/object-define-property');\nvar createPropertyDescriptor = require('../internals/create-property-descriptor');\n\nmodule.exports = DESCRIPTORS ? function (object, key, value) {\n  return definePropertyModule.f(object, key, createPropertyDescriptor(1, value));\n} : function (object, key, value) {\n  object[key] = value;\n  return object;\n};\n","module.exports = function (bitmap, value) {\n  return {\n    enumerable: !(bitmap & 1),\n    configurable: !(bitmap & 2),\n    writable: !(bitmap & 4),\n    value: value\n  };\n};\n","var fails = require('../internals/fails');\n\n// Detect IE8's incomplete defineProperty implementation\nmodule.exports = !fails(function () {\n  // eslint-disable-next-line es/no-object-defineproperty -- required for testing\n  return Object.defineProperty({}, 1, { get: function () { return 7; } })[1] != 7;\n});\n","var global = require('../internals/global');\nvar isObject = require('../internals/is-object');\n\nvar document = global.document;\n// typeof document.createElement is 'object' in old IE\nvar EXISTS = isObject(document) && isObject(document.createElement);\n\nmodule.exports = function (it) {\n  return EXISTS ? document.createElement(it) : {};\n};\n","var userAgent = require('../internals/engine-user-agent');\n\nvar firefox = userAgent.match(/firefox\\/(\\d+)/i);\n\nmodule.exports = !!firefox && +firefox[1];\n","var UA = require('../internals/engine-user-agent');\n\nmodule.exports = /MSIE|Trident/.test(UA);\n","var getBuiltIn = require('../internals/get-built-in');\n\nmodule.exports = getBuiltIn('navigator', 'userAgent') || '';\n","var global = require('../internals/global');\nvar userAgent = require('../internals/engine-user-agent');\n\nvar process = global.process;\nvar Deno = global.Deno;\nvar versions = process && process.versions || Deno && Deno.version;\nvar v8 = versions && versions.v8;\nvar match, version;\n\nif (v8) {\n  match = v8.split('.');\n  version = match[0] < 4 ? 1 : match[0] + match[1];\n} else if (userAgent) {\n  match = userAgent.match(/Edge\\/(\\d+)/);\n  if (!match || match[1] >= 74) {\n    match = userAgent.match(/Chrome\\/(\\d+)/);\n    if (match) version = match[1];\n  }\n}\n\nmodule.exports = version && +version;\n","var userAgent = require('../internals/engine-user-agent');\n\nvar webkit = userAgent.match(/AppleWebKit\\/(\\d+)\\./);\n\nmodule.exports = !!webkit && +webkit[1];\n","var global = require('../internals/global');\nvar bind = require('../internals/function-bind-context');\n\nvar call = Function.call;\n\nmodule.exports = function (CONSTRUCTOR, METHOD, length) {\n  return bind(call, global[CONSTRUCTOR].prototype[METHOD], length);\n};\n","// IE8- don't enum bug keys\nmodule.exports = [\n  'constructor',\n  'hasOwnProperty',\n  'isPrototypeOf',\n  'propertyIsEnumerable',\n  'toLocaleString',\n  'toString',\n  'valueOf'\n];\n","var global = require('../internals/global');\nvar getOwnPropertyDescriptor = require('../internals/object-get-own-property-descriptor').f;\nvar createNonEnumerableProperty = require('../internals/create-non-enumerable-property');\nvar redefine = require('../internals/redefine');\nvar setGlobal = require('../internals/set-global');\nvar copyConstructorProperties = require('../internals/copy-constructor-properties');\nvar isForced = require('../internals/is-forced');\n\n/*\n  options.target      - name of the target object\n  options.global      - target is the global object\n  options.stat        - export as static methods of target\n  options.proto       - export as prototype methods of target\n  options.real        - real prototype method for the `pure` version\n  options.forced      - export even if the native feature is available\n  options.bind        - bind methods to the target, required for the `pure` version\n  options.wrap        - wrap constructors to preventing global pollution, required for the `pure` version\n  options.unsafe      - use the simple assignment of property instead of delete + defineProperty\n  options.sham        - add a flag to not completely full polyfills\n  options.enumerable  - export as enumerable property\n  options.noTargetGet - prevent calling a getter on target\n  options.name        - the .name of the function if it does not match the key\n*/\nmodule.exports = function (options, source) {\n  var TARGET = options.target;\n  var GLOBAL = options.global;\n  var STATIC = options.stat;\n  var FORCED, target, key, targetProperty, sourceProperty, descriptor;\n  if (GLOBAL) {\n    target = global;\n  } else if (STATIC) {\n    target = global[TARGET] || setGlobal(TARGET, {});\n  } else {\n    target = (global[TARGET] || {}).prototype;\n  }\n  if (target) for (key in source) {\n    sourceProperty = source[key];\n    if (options.noTargetGet) {\n      descriptor = getOwnPropertyDescriptor(target, key);\n      targetProperty = descriptor && descriptor.value;\n    } else targetProperty = target[key];\n    FORCED = isForced(GLOBAL ? key : TARGET + (STATIC ? '.' : '#') + key, options.forced);\n    // contained in target\n    if (!FORCED && targetProperty !== undefined) {\n      if (typeof sourceProperty === typeof targetProperty) continue;\n      copyConstructorProperties(sourceProperty, targetProperty);\n    }\n    // add a flag to not completely full polyfills\n    if (options.sham || (targetProperty && targetProperty.sham)) {\n      createNonEnumerableProperty(sourceProperty, 'sham', true);\n    }\n    // extend global\n    redefine(target, key, sourceProperty, options);\n  }\n};\n","module.exports = function (exec) {\n  try {\n    return !!exec();\n  } catch (error) {\n    return true;\n  }\n};\n","var aCallable = require('../internals/a-callable');\n\n// optional / simple context binding\nmodule.exports = function (fn, that, length) {\n  aCallable(fn);\n  if (that === undefined) return fn;\n  switch (length) {\n    case 0: return function () {\n      return fn.call(that);\n    };\n    case 1: return function (a) {\n      return fn.call(that, a);\n    };\n    case 2: return function (a, b) {\n      return fn.call(that, a, b);\n    };\n    case 3: return function (a, b, c) {\n      return fn.call(that, a, b, c);\n    };\n  }\n  return function (/* ...args */) {\n    return fn.apply(that, arguments);\n  };\n};\n","var DESCRIPTORS = require('../internals/descriptors');\nvar has = require('../internals/has');\n\nvar FunctionPrototype = Function.prototype;\n// eslint-disable-next-line es/no-object-getownpropertydescriptor -- safe\nvar getDescriptor = DESCRIPTORS && Object.getOwnPropertyDescriptor;\n\nvar EXISTS = has(FunctionPrototype, 'name');\n// additional protection from minified / mangled / dropped function names\nvar PROPER = EXISTS && (function something() { /* empty */ }).name === 'something';\nvar CONFIGURABLE = EXISTS && (!DESCRIPTORS || (DESCRIPTORS && getDescriptor(FunctionPrototype, 'name').configurable));\n\nmodule.exports = {\n  EXISTS: EXISTS,\n  PROPER: PROPER,\n  CONFIGURABLE: CONFIGURABLE\n};\n","var global = require('../internals/global');\nvar isCallable = require('../internals/is-callable');\n\nvar aFunction = function (argument) {\n  return isCallable(argument) ? argument : undefined;\n};\n\nmodule.exports = function (namespace, method) {\n  return arguments.length < 2 ? aFunction(global[namespace]) : global[namespace] && global[namespace][method];\n};\n","var aCallable = require('../internals/a-callable');\n\n// `GetMethod` abstract operation\n// https://tc39.es/ecma262/#sec-getmethod\nmodule.exports = function (V, P) {\n  var func = V[P];\n  return func == null ? undefined : aCallable(func);\n};\n","var check = function (it) {\n  return it && it.Math == Math && it;\n};\n\n// https://github.com/zloirock/core-js/issues/86#issuecomment-115759028\nmodule.exports =\n  // eslint-disable-next-line es/no-global-this -- safe\n  check(typeof globalThis == 'object' && globalThis) ||\n  check(typeof window == 'object' && window) ||\n  // eslint-disable-next-line no-restricted-globals -- safe\n  check(typeof self == 'object' && self) ||\n  check(typeof global == 'object' && global) ||\n  // eslint-disable-next-line no-new-func -- fallback\n  (function () { return this; })() || Function('return this')();\n","var toObject = require('../internals/to-object');\n\nvar hasOwnProperty = {}.hasOwnProperty;\n\nmodule.exports = Object.hasOwn || function hasOwn(it, key) {\n  return hasOwnProperty.call(toObject(it), key);\n};\n","module.exports = {};\n","var DESCRIPTORS = require('../internals/descriptors');\nvar fails = require('../internals/fails');\nvar createElement = require('../internals/document-create-element');\n\n// Thank's IE8 for his funny defineProperty\nmodule.exports = !DESCRIPTORS && !fails(function () {\n  // eslint-disable-next-line es/no-object-defineproperty -- requied for testing\n  return Object.defineProperty(createElement('div'), 'a', {\n    get: function () { return 7; }\n  }).a != 7;\n});\n","var fails = require('../internals/fails');\nvar classof = require('../internals/classof-raw');\n\nvar split = ''.split;\n\n// fallback for non-array-like ES3 and non-enumerable old V8 strings\nmodule.exports = fails(function () {\n  // throws an error in rhino, see https://github.com/mozilla/rhino/issues/346\n  // eslint-disable-next-line no-prototype-builtins -- safe\n  return !Object('z').propertyIsEnumerable(0);\n}) ? function (it) {\n  return classof(it) == 'String' ? split.call(it, '') : Object(it);\n} : Object;\n","var isCallable = require('../internals/is-callable');\nvar store = require('../internals/shared-store');\n\nvar functionToString = Function.toString;\n\n// this helper broken in `core-js@3.4.1-3.4.4`, so we can't use `shared` helper\nif (!isCallable(store.inspectSource)) {\n  store.inspectSource = function (it) {\n    return functionToString.call(it);\n  };\n}\n\nmodule.exports = store.inspectSource;\n","var NATIVE_WEAK_MAP = require('../internals/native-weak-map');\nvar global = require('../internals/global');\nvar isObject = require('../internals/is-object');\nvar createNonEnumerableProperty = require('../internals/create-non-enumerable-property');\nvar objectHas = require('../internals/has');\nvar shared = require('../internals/shared-store');\nvar sharedKey = require('../internals/shared-key');\nvar hiddenKeys = require('../internals/hidden-keys');\n\nvar OBJECT_ALREADY_INITIALIZED = 'Object already initialized';\nvar WeakMap = global.WeakMap;\nvar set, get, has;\n\nvar enforce = function (it) {\n  return has(it) ? get(it) : set(it, {});\n};\n\nvar getterFor = function (TYPE) {\n  return function (it) {\n    var state;\n    if (!isObject(it) || (state = get(it)).type !== TYPE) {\n      throw TypeError('Incompatible receiver, ' + TYPE + ' required');\n    } return state;\n  };\n};\n\nif (NATIVE_WEAK_MAP || shared.state) {\n  var store = shared.state || (shared.state = new WeakMap());\n  var wmget = store.get;\n  var wmhas = store.has;\n  var wmset = store.set;\n  set = function (it, metadata) {\n    if (wmhas.call(store, it)) throw new TypeError(OBJECT_ALREADY_INITIALIZED);\n    metadata.facade = it;\n    wmset.call(store, it, metadata);\n    return metadata;\n  };\n  get = function (it) {\n    return wmget.call(store, it) || {};\n  };\n  has = function (it) {\n    return wmhas.call(store, it);\n  };\n} else {\n  var STATE = sharedKey('state');\n  hiddenKeys[STATE] = true;\n  set = function (it, metadata) {\n    if (objectHas(it, STATE)) throw new TypeError(OBJECT_ALREADY_INITIALIZED);\n    metadata.facade = it;\n    createNonEnumerableProperty(it, STATE, metadata);\n    return metadata;\n  };\n  get = function (it) {\n    return objectHas(it, STATE) ? it[STATE] : {};\n  };\n  has = function (it) {\n    return objectHas(it, STATE);\n  };\n}\n\nmodule.exports = {\n  set: set,\n  get: get,\n  has: has,\n  enforce: enforce,\n  getterFor: getterFor\n};\n","// `IsCallable` abstract operation\n// https://tc39.es/ecma262/#sec-iscallable\nmodule.exports = function (argument) {\n  return typeof argument === 'function';\n};\n","var fails = require('../internals/fails');\nvar isCallable = require('../internals/is-callable');\n\nvar replacement = /#|\\.prototype\\./;\n\nvar isForced = function (feature, detection) {\n  var value = data[normalize(feature)];\n  return value == POLYFILL ? true\n    : value == NATIVE ? false\n    : isCallable(detection) ? fails(detection)\n    : !!detection;\n};\n\nvar normalize = isForced.normalize = function (string) {\n  return String(string).replace(replacement, '.').toLowerCase();\n};\n\nvar data = isForced.data = {};\nvar NATIVE = isForced.NATIVE = 'N';\nvar POLYFILL = isForced.POLYFILL = 'P';\n\nmodule.exports = isForced;\n","var isCallable = require('../internals/is-callable');\n\nmodule.exports = function (it) {\n  return typeof it === 'object' ? it !== null : isCallable(it);\n};\n","module.exports = false;\n","var isCallable = require('../internals/is-callable');\nvar getBuiltIn = require('../internals/get-built-in');\nvar USE_SYMBOL_AS_UID = require('../internals/use-symbol-as-uid');\n\nmodule.exports = USE_SYMBOL_AS_UID ? function (it) {\n  return typeof it == 'symbol';\n} : function (it) {\n  var $Symbol = getBuiltIn('Symbol');\n  return isCallable($Symbol) && Object(it) instanceof $Symbol;\n};\n","/* eslint-disable es/no-symbol -- required for testing */\nvar V8_VERSION = require('../internals/engine-v8-version');\nvar fails = require('../internals/fails');\n\n// eslint-disable-next-line es/no-object-getownpropertysymbols -- required for testing\nmodule.exports = !!Object.getOwnPropertySymbols && !fails(function () {\n  var symbol = Symbol();\n  // Chrome 38 Symbol has incorrect toString conversion\n  // `get-own-property-symbols` polyfill symbols converted to object are not Symbol instances\n  return !String(symbol) || !(Object(symbol) instanceof Symbol) ||\n    // Chrome 38-40 symbols are not inherited from DOM collections prototypes to instances\n    !Symbol.sham && V8_VERSION && V8_VERSION < 41;\n});\n","var global = require('../internals/global');\nvar isCallable = require('../internals/is-callable');\nvar inspectSource = require('../internals/inspect-source');\n\nvar WeakMap = global.WeakMap;\n\nmodule.exports = isCallable(WeakMap) && /native code/.test(inspectSource(WeakMap));\n","var DESCRIPTORS = require('../internals/descriptors');\nvar IE8_DOM_DEFINE = require('../internals/ie8-dom-define');\nvar anObject = require('../internals/an-object');\nvar toPropertyKey = require('../internals/to-property-key');\n\n// eslint-disable-next-line es/no-object-defineproperty -- safe\nvar $defineProperty = Object.defineProperty;\n\n// `Object.defineProperty` method\n// https://tc39.es/ecma262/#sec-object.defineproperty\nexports.f = DESCRIPTORS ? $defineProperty : function defineProperty(O, P, Attributes) {\n  anObject(O);\n  P = toPropertyKey(P);\n  anObject(Attributes);\n  if (IE8_DOM_DEFINE) try {\n    return $defineProperty(O, P, Attributes);\n  } catch (error) { /* empty */ }\n  if ('get' in Attributes || 'set' in Attributes) throw TypeError('Accessors not supported');\n  if ('value' in Attributes) O[P] = Attributes.value;\n  return O;\n};\n","var DESCRIPTORS = require('../internals/descriptors');\nvar propertyIsEnumerableModule = require('../internals/object-property-is-enumerable');\nvar createPropertyDescriptor = require('../internals/create-property-descriptor');\nvar toIndexedObject = require('../internals/to-indexed-object');\nvar toPropertyKey = require('../internals/to-property-key');\nvar has = require('../internals/has');\nvar IE8_DOM_DEFINE = require('../internals/ie8-dom-define');\n\n// eslint-disable-next-line es/no-object-getownpropertydescriptor -- safe\nvar $getOwnPropertyDescriptor = Object.getOwnPropertyDescriptor;\n\n// `Object.getOwnPropertyDescriptor` method\n// https://tc39.es/ecma262/#sec-object.getownpropertydescriptor\nexports.f = DESCRIPTORS ? $getOwnPropertyDescriptor : function getOwnPropertyDescriptor(O, P) {\n  O = toIndexedObject(O);\n  P = toPropertyKey(P);\n  if (IE8_DOM_DEFINE) try {\n    return $getOwnPropertyDescriptor(O, P);\n  } catch (error) { /* empty */ }\n  if (has(O, P)) return createPropertyDescriptor(!propertyIsEnumerableModule.f.call(O, P), O[P]);\n};\n","var internalObjectKeys = require('../internals/object-keys-internal');\nvar enumBugKeys = require('../internals/enum-bug-keys');\n\nvar hiddenKeys = enumBugKeys.concat('length', 'prototype');\n\n// `Object.getOwnPropertyNames` method\n// https://tc39.es/ecma262/#sec-object.getownpropertynames\n// eslint-disable-next-line es/no-object-getownpropertynames -- safe\nexports.f = Object.getOwnPropertyNames || function getOwnPropertyNames(O) {\n  return internalObjectKeys(O, hiddenKeys);\n};\n","// eslint-disable-next-line es/no-object-getownpropertysymbols -- safe\nexports.f = Object.getOwnPropertySymbols;\n","var has = require('../internals/has');\nvar toIndexedObject = require('../internals/to-indexed-object');\nvar indexOf = require('../internals/array-includes').indexOf;\nvar hiddenKeys = require('../internals/hidden-keys');\n\nmodule.exports = function (object, names) {\n  var O = toIndexedObject(object);\n  var i = 0;\n  var result = [];\n  var key;\n  for (key in O) !has(hiddenKeys, key) && has(O, key) && result.push(key);\n  // Don't enum bug & hidden keys\n  while (names.length > i) if (has(O, key = names[i++])) {\n    ~indexOf(result, key) || result.push(key);\n  }\n  return result;\n};\n","var internalObjectKeys = require('../internals/object-keys-internal');\nvar enumBugKeys = require('../internals/enum-bug-keys');\n\n// `Object.keys` method\n// https://tc39.es/ecma262/#sec-object.keys\n// eslint-disable-next-line es/no-object-keys -- safe\nmodule.exports = Object.keys || function keys(O) {\n  return internalObjectKeys(O, enumBugKeys);\n};\n","'use strict';\nvar $propertyIsEnumerable = {}.propertyIsEnumerable;\n// eslint-disable-next-line es/no-object-getownpropertydescriptor -- safe\nvar getOwnPropertyDescriptor = Object.getOwnPropertyDescriptor;\n\n// Nashorn ~ JDK8 bug\nvar NASHORN_BUG = getOwnPropertyDescriptor && !$propertyIsEnumerable.call({ 1: 2 }, 1);\n\n// `Object.prototype.propertyIsEnumerable` method implementation\n// https://tc39.es/ecma262/#sec-object.prototype.propertyisenumerable\nexports.f = NASHORN_BUG ? function propertyIsEnumerable(V) {\n  var descriptor = getOwnPropertyDescriptor(this, V);\n  return !!descriptor && descriptor.enumerable;\n} : $propertyIsEnumerable;\n","var isCallable = require('../internals/is-callable');\nvar isObject = require('../internals/is-object');\n\n// `OrdinaryToPrimitive` abstract operation\n// https://tc39.es/ecma262/#sec-ordinarytoprimitive\nmodule.exports = function (input, pref) {\n  var fn, val;\n  if (pref === 'string' && isCallable(fn = input.toString) && !isObject(val = fn.call(input))) return val;\n  if (isCallable(fn = input.valueOf) && !isObject(val = fn.call(input))) return val;\n  if (pref !== 'string' && isCallable(fn = input.toString) && !isObject(val = fn.call(input))) return val;\n  throw TypeError(\"Can't convert object to primitive value\");\n};\n","var getBuiltIn = require('../internals/get-built-in');\nvar getOwnPropertyNamesModule = require('../internals/object-get-own-property-names');\nvar getOwnPropertySymbolsModule = require('../internals/object-get-own-property-symbols');\nvar anObject = require('../internals/an-object');\n\n// all object keys, includes non-enumerable and symbols\nmodule.exports = getBuiltIn('Reflect', 'ownKeys') || function ownKeys(it) {\n  var keys = getOwnPropertyNamesModule.f(anObject(it));\n  var getOwnPropertySymbols = getOwnPropertySymbolsModule.f;\n  return getOwnPropertySymbols ? keys.concat(getOwnPropertySymbols(it)) : keys;\n};\n","var global = require('../internals/global');\n\nmodule.exports = global;\n","var global = require('../internals/global');\nvar isCallable = require('../internals/is-callable');\nvar has = require('../internals/has');\nvar createNonEnumerableProperty = require('../internals/create-non-enumerable-property');\nvar setGlobal = require('../internals/set-global');\nvar inspectSource = require('../internals/inspect-source');\nvar InternalStateModule = require('../internals/internal-state');\nvar CONFIGURABLE_FUNCTION_NAME = require('../internals/function-name').CONFIGURABLE;\n\nvar getInternalState = InternalStateModule.get;\nvar enforceInternalState = InternalStateModule.enforce;\nvar TEMPLATE = String(String).split('String');\n\n(module.exports = function (O, key, value, options) {\n  var unsafe = options ? !!options.unsafe : false;\n  var simple = options ? !!options.enumerable : false;\n  var noTargetGet = options ? !!options.noTargetGet : false;\n  var name = options && options.name !== undefined ? options.name : key;\n  var state;\n  if (isCallable(value)) {\n    if (String(name).slice(0, 7) === 'Symbol(') {\n      name = '[' + String(name).replace(/^Symbol\\(([^)]*)\\)/, '$1') + ']';\n    }\n    if (!has(value, 'name') || (CONFIGURABLE_FUNCTION_NAME && value.name !== name)) {\n      createNonEnumerableProperty(value, 'name', name);\n    }\n    state = enforceInternalState(value);\n    if (!state.source) {\n      state.source = TEMPLATE.join(typeof name == 'string' ? name : '');\n    }\n  }\n  if (O === global) {\n    if (simple) O[key] = value;\n    else setGlobal(key, value);\n    return;\n  } else if (!unsafe) {\n    delete O[key];\n  } else if (!noTargetGet && O[key]) {\n    simple = true;\n  }\n  if (simple) O[key] = value;\n  else createNonEnumerableProperty(O, key, value);\n// add fake Function#toString for correct work wrapped methods / constructors with methods like LoDash isNative\n})(Function.prototype, 'toString', function toString() {\n  return isCallable(this) && getInternalState(this).source || inspectSource(this);\n});\n","// `RequireObjectCoercible` abstract operation\n// https://tc39.es/ecma262/#sec-requireobjectcoercible\nmodule.exports = function (it) {\n  if (it == undefined) throw TypeError(\"Can't call method on \" + it);\n  return it;\n};\n","var global = require('../internals/global');\n\nmodule.exports = function (key, value) {\n  try {\n    // eslint-disable-next-line es/no-object-defineproperty -- safe\n    Object.defineProperty(global, key, { value: value, configurable: true, writable: true });\n  } catch (error) {\n    global[key] = value;\n  } return value;\n};\n","var shared = require('../internals/shared');\nvar uid = require('../internals/uid');\n\nvar keys = shared('keys');\n\nmodule.exports = function (key) {\n  return keys[key] || (keys[key] = uid(key));\n};\n","var global = require('../internals/global');\nvar setGlobal = require('../internals/set-global');\n\nvar SHARED = '__core-js_shared__';\nvar store = global[SHARED] || setGlobal(SHARED, {});\n\nmodule.exports = store;\n","var IS_PURE = require('../internals/is-pure');\nvar store = require('../internals/shared-store');\n\n(module.exports = function (key, value) {\n  return store[key] || (store[key] = value !== undefined ? value : {});\n})('versions', []).push({\n  version: '3.18.1',\n  mode: IS_PURE ? 'pure' : 'global',\n  copyright: ' 2021 Denis Pushkarev (zloirock.ru)'\n});\n","var toInteger = require('../internals/to-integer');\n\nvar max = Math.max;\nvar min = Math.min;\n\n// Helper for a popular repeating case of the spec:\n// Let integer be ? ToInteger(index).\n// If integer < 0, let result be max((length + integer), 0); else let result be min(integer, length).\nmodule.exports = function (index, length) {\n  var integer = toInteger(index);\n  return integer < 0 ? max(integer + length, 0) : min(integer, length);\n};\n","// toObject with fallback for non-array-like ES3 strings\nvar IndexedObject = require('../internals/indexed-object');\nvar requireObjectCoercible = require('../internals/require-object-coercible');\n\nmodule.exports = function (it) {\n  return IndexedObject(requireObjectCoercible(it));\n};\n","var ceil = Math.ceil;\nvar floor = Math.floor;\n\n// `ToInteger` abstract operation\n// https://tc39.es/ecma262/#sec-tointeger\nmodule.exports = function (argument) {\n  return isNaN(argument = +argument) ? 0 : (argument > 0 ? floor : ceil)(argument);\n};\n","var toInteger = require('../internals/to-integer');\n\nvar min = Math.min;\n\n// `ToLength` abstract operation\n// https://tc39.es/ecma262/#sec-tolength\nmodule.exports = function (argument) {\n  return argument > 0 ? min(toInteger(argument), 0x1FFFFFFFFFFFFF) : 0; // 2 ** 53 - 1 == 9007199254740991\n};\n","var requireObjectCoercible = require('../internals/require-object-coercible');\n\n// `ToObject` abstract operation\n// https://tc39.es/ecma262/#sec-toobject\nmodule.exports = function (argument) {\n  return Object(requireObjectCoercible(argument));\n};\n","var isObject = require('../internals/is-object');\nvar isSymbol = require('../internals/is-symbol');\nvar getMethod = require('../internals/get-method');\nvar ordinaryToPrimitive = require('../internals/ordinary-to-primitive');\nvar wellKnownSymbol = require('../internals/well-known-symbol');\n\nvar TO_PRIMITIVE = wellKnownSymbol('toPrimitive');\n\n// `ToPrimitive` abstract operation\n// https://tc39.es/ecma262/#sec-toprimitive\nmodule.exports = function (input, pref) {\n  if (!isObject(input) || isSymbol(input)) return input;\n  var exoticToPrim = getMethod(input, TO_PRIMITIVE);\n  var result;\n  if (exoticToPrim) {\n    if (pref === undefined) pref = 'default';\n    result = exoticToPrim.call(input, pref);\n    if (!isObject(result) || isSymbol(result)) return result;\n    throw TypeError(\"Can't convert object to primitive value\");\n  }\n  if (pref === undefined) pref = 'number';\n  return ordinaryToPrimitive(input, pref);\n};\n","var toPrimitive = require('../internals/to-primitive');\nvar isSymbol = require('../internals/is-symbol');\n\n// `ToPropertyKey` abstract operation\n// https://tc39.es/ecma262/#sec-topropertykey\nmodule.exports = function (argument) {\n  var key = toPrimitive(argument, 'string');\n  return isSymbol(key) ? key : String(key);\n};\n","var wellKnownSymbol = require('../internals/well-known-symbol');\n\nvar TO_STRING_TAG = wellKnownSymbol('toStringTag');\nvar test = {};\n\ntest[TO_STRING_TAG] = 'z';\n\nmodule.exports = String(test) === '[object z]';\n","var classof = require('../internals/classof');\n\nmodule.exports = function (argument) {\n  if (classof(argument) === 'Symbol') throw TypeError('Cannot convert a Symbol value to a string');\n  return String(argument);\n};\n","module.exports = function (argument) {\n  try {\n    return String(argument);\n  } catch (error) {\n    return 'Object';\n  }\n};\n","var id = 0;\nvar postfix = Math.random();\n\nmodule.exports = function (key) {\n  return 'Symbol(' + String(key === undefined ? '' : key) + ')_' + (++id + postfix).toString(36);\n};\n","/* eslint-disable es/no-symbol -- required for testing */\nvar NATIVE_SYMBOL = require('../internals/native-symbol');\n\nmodule.exports = NATIVE_SYMBOL\n  && !Symbol.sham\n  && typeof Symbol.iterator == 'symbol';\n","var global = require('../internals/global');\nvar shared = require('../internals/shared');\nvar has = require('../internals/has');\nvar uid = require('../internals/uid');\nvar NATIVE_SYMBOL = require('../internals/native-symbol');\nvar USE_SYMBOL_AS_UID = require('../internals/use-symbol-as-uid');\n\nvar WellKnownSymbolsStore = shared('wks');\nvar Symbol = global.Symbol;\nvar createWellKnownSymbol = USE_SYMBOL_AS_UID ? Symbol : Symbol && Symbol.withoutSetter || uid;\n\nmodule.exports = function (name) {\n  if (!has(WellKnownSymbolsStore, name) || !(NATIVE_SYMBOL || typeof WellKnownSymbolsStore[name] == 'string')) {\n    if (NATIVE_SYMBOL && has(Symbol, name)) {\n      WellKnownSymbolsStore[name] = Symbol[name];\n    } else {\n      WellKnownSymbolsStore[name] = createWellKnownSymbol('Symbol.' + name);\n    }\n  } return WellKnownSymbolsStore[name];\n};\n","'use strict';\nvar $ = require('../internals/export');\nvar aCallable = require('../internals/a-callable');\nvar toObject = require('../internals/to-object');\nvar toLength = require('../internals/to-length');\nvar toString = require('../internals/to-string');\nvar fails = require('../internals/fails');\nvar internalSort = require('../internals/array-sort');\nvar arrayMethodIsStrict = require('../internals/array-method-is-strict');\nvar FF = require('../internals/engine-ff-version');\nvar IE_OR_EDGE = require('../internals/engine-is-ie-or-edge');\nvar V8 = require('../internals/engine-v8-version');\nvar WEBKIT = require('../internals/engine-webkit-version');\n\nvar test = [];\nvar nativeSort = test.sort;\n\n// IE8-\nvar FAILS_ON_UNDEFINED = fails(function () {\n  test.sort(undefined);\n});\n// V8 bug\nvar FAILS_ON_NULL = fails(function () {\n  test.sort(null);\n});\n// Old WebKit\nvar STRICT_METHOD = arrayMethodIsStrict('sort');\n\nvar STABLE_SORT = !fails(function () {\n  // feature detection can be too slow, so check engines versions\n  if (V8) return V8 < 70;\n  if (FF && FF > 3) return;\n  if (IE_OR_EDGE) return true;\n  if (WEBKIT) return WEBKIT < 603;\n\n  var result = '';\n  var code, chr, value, index;\n\n  // generate an array with more 512 elements (Chakra and old V8 fails only in this case)\n  for (code = 65; code < 76; code++) {\n    chr = String.fromCharCode(code);\n\n    switch (code) {\n      case 66: case 69: case 70: case 72: value = 3; break;\n      case 68: case 71: value = 4; break;\n      default: value = 2;\n    }\n\n    for (index = 0; index < 47; index++) {\n      test.push({ k: chr + index, v: value });\n    }\n  }\n\n  test.sort(function (a, b) { return b.v - a.v; });\n\n  for (index = 0; index < test.length; index++) {\n    chr = test[index].k.charAt(0);\n    if (result.charAt(result.length - 1) !== chr) result += chr;\n  }\n\n  return result !== 'DGBEFHACIJK';\n});\n\nvar FORCED = FAILS_ON_UNDEFINED || !FAILS_ON_NULL || !STRICT_METHOD || !STABLE_SORT;\n\nvar getSortCompare = function (comparefn) {\n  return function (x, y) {\n    if (y === undefined) return -1;\n    if (x === undefined) return 1;\n    if (comparefn !== undefined) return +comparefn(x, y) || 0;\n    return toString(x) > toString(y) ? 1 : -1;\n  };\n};\n\n// `Array.prototype.sort` method\n// https://tc39.es/ecma262/#sec-array.prototype.sort\n$({ target: 'Array', proto: true, forced: FORCED }, {\n  sort: function sort(comparefn) {\n    if (comparefn !== undefined) aCallable(comparefn);\n\n    var array = toObject(this);\n\n    if (STABLE_SORT) return comparefn === undefined ? nativeSort.call(array) : nativeSort.call(array, comparefn);\n\n    var items = [];\n    var arrayLength = toLength(array.length);\n    var itemsLength, index;\n\n    for (index = 0; index < arrayLength; index++) {\n      if (index in array) items.push(array[index]);\n    }\n\n    items = internalSort(items, getSortCompare(comparefn));\n    itemsLength = items.length;\n    index = 0;\n\n    while (index < itemsLength) array[index] = items[index++];\n    while (index < arrayLength) delete array[index++];\n\n    return array;\n  }\n});\n","var $ = require('../internals/export');\nvar toObject = require('../internals/to-object');\nvar nativeKeys = require('../internals/object-keys');\nvar fails = require('../internals/fails');\n\nvar FAILS_ON_PRIMITIVES = fails(function () { nativeKeys(1); });\n\n// `Object.keys` method\n// https://tc39.es/ecma262/#sec-object.keys\n$({ target: 'Object', stat: true, forced: FAILS_ON_PRIMITIVES }, {\n  keys: function keys(it) {\n    return nativeKeys(toObject(it));\n  }\n});\n","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../node_modules/css-loader/dist/runtime/sourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, \"/* Buttons styles start */\\r\\n\\r\\nbutton#excalibur-play {\\r\\n  display: inline-block;\\r\\n  position: relative;\\r\\n  z-index: 999;\\r\\n  border-radius: 6px;\\r\\n  border: none;\\r\\n  /*border: 3px solid;\\r\\n    border-color: white;\\r\\n    box-shadow: 0 0 10px #ccc;*/\\r\\n  padding: 1rem 1.5rem 1rem 4rem;\\r\\n  margin: 0;\\r\\n  text-decoration: none;\\r\\n  background: #00b233;\\r\\n  color: #ffffff;\\r\\n  font-family: sans-serif;\\r\\n  font-size: 2rem;\\r\\n  line-height: 1;\\r\\n  cursor: pointer;\\r\\n  text-align: center;\\r\\n  transition: background 250ms ease-in-out, transform 150ms ease;\\r\\n  -webkit-appearance: none;\\r\\n  -moz-appearance: none;\\r\\n\\r\\n  -webkit-animation: excalibur-button-fadein 200ms; /* Safari, Chrome and Opera > 12.1 */\\r\\n  -moz-animation: excalibur-button-fadein 200ms; /* Firefox < 16 */\\r\\n  -ms-animation: excalibur-button-fadein 200ms; /* Internet Explorer */\\r\\n  -o-animation: excalibur-button-fadein 200ms; /* Opera < 12.1 */\\r\\n  animation: excalibur-button-fadein 200ms;\\r\\n}\\r\\n\\r\\n/*\\r\\nbutton#excalibur-play {\\r\\n  display: none;\\r\\n}*/\\r\\n\\r\\nbutton#excalibur-play:after {\\r\\n  position: absolute;\\r\\n  content: '';\\r\\n  border: 8px solid;\\r\\n  border-color: transparent transparent transparent white;\\r\\n  left: 35px;\\r\\n  top: 24px;\\r\\n  width: 0;\\r\\n  height: 0;\\r\\n}\\r\\n\\r\\nbutton#excalibur-play:before {\\r\\n  position: absolute;\\r\\n  content: '';\\r\\n  border: 3px solid;\\r\\n  left: 19px;\\r\\n  top: 14px;\\r\\n  border-radius: 20px;\\r\\n  width: 30px;\\r\\n  height: 30px;\\r\\n}\\r\\n\\r\\nbutton#excalibur-play:hover,\\r\\nbutton#excalibur-play:focus {\\r\\n  background: #00982c;\\r\\n}\\r\\n\\r\\nbutton#excalibur-play:focus {\\r\\n  outline: 1px solid #fff;\\r\\n  outline-offset: -4px;\\r\\n}\\r\\n\\r\\nbutton#excalibur-play:active {\\r\\n  transform: scale(0.99);\\r\\n}\\r\\n\\r\\n@keyframes excalibur-button-fadein {\\r\\n  from {\\r\\n    opacity: 0;\\r\\n  }\\r\\n  to {\\r\\n    opacity: 1;\\r\\n  }\\r\\n}\\r\\n\\r\\n/* Firefox < 16 */\\r\\n@-moz-keyframes excalibur-button-fadein {\\r\\n  from {\\r\\n    opacity: 0;\\r\\n  }\\r\\n  to {\\r\\n    opacity: 1;\\r\\n  }\\r\\n}\\r\\n\\r\\n/* Safari, Chrome and Opera > 12.1 */\\r\\n@-webkit-keyframes excalibur-button-fadein {\\r\\n  from {\\r\\n    opacity: 0;\\r\\n  }\\r\\n  to {\\r\\n    opacity: 1;\\r\\n  }\\r\\n}\\r\\n\\r\\n/* Internet Explorer */\\r\\n@-ms-keyframes excalibur-button-fadein {\\r\\n  from {\\r\\n    opacity: 0;\\r\\n  }\\r\\n  to {\\r\\n    opacity: 1;\\r\\n  }\\r\\n}\\r\\n\\r\\n/* Opera < 12.1 */\\r\\n@-o-keyframes excalibur-button-fadein {\\r\\n  from {\\r\\n    opacity: 0;\\r\\n  }\\r\\n  to {\\r\\n    opacity: 1;\\r\\n  }\\r\\n}\\r\\n\", \"\",{\"version\":3,\"sources\":[\"webpack://./Loader.css\"],\"names\":[],\"mappings\":\"AAAA,yBAAyB;;AAEzB;EACE,qBAAqB;EACrB,kBAAkB;EAClB,YAAY;EACZ,kBAAkB;EAClB,YAAY;EACZ;;+BAE6B;EAC7B,8BAA8B;EAC9B,SAAS;EACT,qBAAqB;EACrB,mBAAmB;EACnB,cAAc;EACd,uBAAuB;EACvB,eAAe;EACf,cAAc;EACd,eAAe;EACf,kBAAkB;EAClB,8DAA8D;EAC9D,wBAAwB;EACxB,qBAAqB;;EAErB,gDAAgD,EAAE,oCAAoC;EACtF,6CAA6C,EAAE,iBAAiB;EAChE,4CAA4C,EAAE,sBAAsB;EACpE,2CAA2C,EAAE,iBAAiB;EAC9D,wCAAwC;AAC1C;;AAEA;;;EAGE;;AAEF;EACE,kBAAkB;EAClB,WAAW;EACX,iBAAiB;EACjB,uDAAuD;EACvD,UAAU;EACV,SAAS;EACT,QAAQ;EACR,SAAS;AACX;;AAEA;EACE,kBAAkB;EAClB,WAAW;EACX,iBAAiB;EACjB,UAAU;EACV,SAAS;EACT,mBAAmB;EACnB,WAAW;EACX,YAAY;AACd;;AAEA;;EAEE,mBAAmB;AACrB;;AAEA;EACE,uBAAuB;EACvB,oBAAoB;AACtB;;AAEA;EACE,sBAAsB;AACxB;;AAEA;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,iBAAiB;AACjB;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,oCAAoC;AACpC;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,sBAAsB;AACtB;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,iBAAiB;AACjB;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF\",\"sourcesContent\":[\"/* Buttons styles start */\\r\\n\\r\\nbutton#excalibur-play {\\r\\n  display: inline-block;\\r\\n  position: relative;\\r\\n  z-index: 999;\\r\\n  border-radius: 6px;\\r\\n  border: none;\\r\\n  /*border: 3px solid;\\r\\n    border-color: white;\\r\\n    box-shadow: 0 0 10px #ccc;*/\\r\\n  padding: 1rem 1.5rem 1rem 4rem;\\r\\n  margin: 0;\\r\\n  text-decoration: none;\\r\\n  background: #00b233;\\r\\n  color: #ffffff;\\r\\n  font-family: sans-serif;\\r\\n  font-size: 2rem;\\r\\n  line-height: 1;\\r\\n  cursor: pointer;\\r\\n  text-align: center;\\r\\n  transition: background 250ms ease-in-out, transform 150ms ease;\\r\\n  -webkit-appearance: none;\\r\\n  -moz-appearance: none;\\r\\n\\r\\n  -webkit-animation: excalibur-button-fadein 200ms; /* Safari, Chrome and Opera > 12.1 */\\r\\n  -moz-animation: excalibur-button-fadein 200ms; /* Firefox < 16 */\\r\\n  -ms-animation: excalibur-button-fadein 200ms; /* Internet Explorer */\\r\\n  -o-animation: excalibur-button-fadein 200ms; /* Opera < 12.1 */\\r\\n  animation: excalibur-button-fadein 200ms;\\r\\n}\\r\\n\\r\\n/*\\r\\nbutton#excalibur-play {\\r\\n  display: none;\\r\\n}*/\\r\\n\\r\\nbutton#excalibur-play:after {\\r\\n  position: absolute;\\r\\n  content: '';\\r\\n  border: 8px solid;\\r\\n  border-color: transparent transparent transparent white;\\r\\n  left: 35px;\\r\\n  top: 24px;\\r\\n  width: 0;\\r\\n  height: 0;\\r\\n}\\r\\n\\r\\nbutton#excalibur-play:before {\\r\\n  position: absolute;\\r\\n  content: '';\\r\\n  border: 3px solid;\\r\\n  left: 19px;\\r\\n  top: 14px;\\r\\n  border-radius: 20px;\\r\\n  width: 30px;\\r\\n  height: 30px;\\r\\n}\\r\\n\\r\\nbutton#excalibur-play:hover,\\r\\nbutton#excalibur-play:focus {\\r\\n  background: #00982c;\\r\\n}\\r\\n\\r\\nbutton#excalibur-play:focus {\\r\\n  outline: 1px solid #fff;\\r\\n  outline-offset: -4px;\\r\\n}\\r\\n\\r\\nbutton#excalibur-play:active {\\r\\n  transform: scale(0.99);\\r\\n}\\r\\n\\r\\n@keyframes excalibur-button-fadein {\\r\\n  from {\\r\\n    opacity: 0;\\r\\n  }\\r\\n  to {\\r\\n    opacity: 1;\\r\\n  }\\r\\n}\\r\\n\\r\\n/* Firefox < 16 */\\r\\n@-moz-keyframes excalibur-button-fadein {\\r\\n  from {\\r\\n    opacity: 0;\\r\\n  }\\r\\n  to {\\r\\n    opacity: 1;\\r\\n  }\\r\\n}\\r\\n\\r\\n/* Safari, Chrome and Opera > 12.1 */\\r\\n@-webkit-keyframes excalibur-button-fadein {\\r\\n  from {\\r\\n    opacity: 0;\\r\\n  }\\r\\n  to {\\r\\n    opacity: 1;\\r\\n  }\\r\\n}\\r\\n\\r\\n/* Internet Explorer */\\r\\n@-ms-keyframes excalibur-button-fadein {\\r\\n  from {\\r\\n    opacity: 0;\\r\\n  }\\r\\n  to {\\r\\n    opacity: 1;\\r\\n  }\\r\\n}\\r\\n\\r\\n/* Opera < 12.1 */\\r\\n@-o-keyframes excalibur-button-fadein {\\r\\n  from {\\r\\n    opacity: 0;\\r\\n  }\\r\\n  to {\\r\\n    opacity: 1;\\r\\n  }\\r\\n}\\r\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","\"use strict\";\n\n/*\n  MIT License http://www.opensource.org/licenses/mit-license.php\n  Author Tobias Koppers @sokra\n*/\nmodule.exports = function (cssWithMappingToString) {\n  var list = []; // return the list of modules as css string\n\n  list.toString = function toString() {\n    return this.map(function (item) {\n      var content = \"\";\n      var needLayer = typeof item[5] !== \"undefined\";\n\n      if (item[4]) {\n        content += \"@supports (\".concat(item[4], \") {\");\n      }\n\n      if (item[2]) {\n        content += \"@media \".concat(item[2], \" {\");\n      }\n\n      if (needLayer) {\n        content += \"@layer\".concat(item[5].length > 0 ? \" \".concat(item[5]) : \"\", \" {\");\n      }\n\n      content += cssWithMappingToString(item);\n\n      if (needLayer) {\n        content += \"}\";\n      }\n\n      if (item[2]) {\n        content += \"}\";\n      }\n\n      if (item[4]) {\n        content += \"}\";\n      }\n\n      return content;\n    }).join(\"\");\n  }; // import a list of modules into the list\n\n\n  list.i = function i(modules, media, dedupe, supports, layer) {\n    if (typeof modules === \"string\") {\n      modules = [[null, modules, undefined]];\n    }\n\n    var alreadyImportedModules = {};\n\n    if (dedupe) {\n      for (var _i = 0; _i < this.length; _i++) {\n        var id = this[_i][0];\n\n        if (id != null) {\n          alreadyImportedModules[id] = true;\n        }\n      }\n    }\n\n    for (var _i2 = 0; _i2 < modules.length; _i2++) {\n      var item = [].concat(modules[_i2]);\n\n      if (dedupe && alreadyImportedModules[item[0]]) {\n        continue;\n      }\n\n      if (typeof layer !== \"undefined\") {\n        if (typeof item[5] === \"undefined\") {\n          item[5] = layer;\n        } else {\n          item[1] = \"@layer\".concat(item[5].length > 0 ? \" \".concat(item[5]) : \"\", \" {\").concat(item[1], \"}\");\n          item[5] = layer;\n        }\n      }\n\n      if (media) {\n        if (!item[2]) {\n          item[2] = media;\n        } else {\n          item[1] = \"@media \".concat(item[2], \" {\").concat(item[1], \"}\");\n          item[2] = media;\n        }\n      }\n\n      if (supports) {\n        if (!item[4]) {\n          item[4] = \"\".concat(supports);\n        } else {\n          item[1] = \"@supports (\".concat(item[4], \") {\").concat(item[1], \"}\");\n          item[4] = supports;\n        }\n      }\n\n      list.push(item);\n    }\n  };\n\n  return list;\n};","\"use strict\";\n\nmodule.exports = function (item) {\n  var content = item[1];\n  var cssMapping = item[3];\n\n  if (!cssMapping) {\n    return content;\n  }\n\n  if (typeof btoa === \"function\") {\n    var base64 = btoa(unescape(encodeURIComponent(JSON.stringify(cssMapping))));\n    var data = \"sourceMappingURL=data:application/json;charset=utf-8;base64,\".concat(base64);\n    var sourceMapping = \"/*# \".concat(data, \" */\");\n    var sourceURLs = cssMapping.sources.map(function (source) {\n      return \"/*# sourceURL=\".concat(cssMapping.sourceRoot || \"\").concat(source, \" */\");\n    });\n    return [content].concat(sourceURLs).concat([sourceMapping]).join(\"\\n\");\n  }\n\n  return [content].join(\"\\n\");\n};","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\tid: moduleId,\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","\r\n/**\r\n * Features in preview\r\n */\r\nexport enum Experiments {\r\n  WebGL = 'use-webgl'\r\n}\r\n\r\n/**\r\n * Legacy features that will go away\r\n */\r\nexport enum Legacy {\r\n  Canvas = 'use-canvas-context',\r\n  LegacyDrawing = 'use-legacy-drawing'\r\n}\r\n\r\n/**\r\n * Flags is a feature flag implementation for Excalibur. They can only be operated **before [[Engine]] construction**\r\n * after which they are frozen and are read-only.\r\n *\r\n * Flags are used to enable experimental or preview features in Excalibur.\r\n */\r\nexport class Flags {\r\n  private static _FROZEN = false;\r\n  private static _FLAGS: Record<string, boolean> = {};\r\n\r\n  /**\r\n   * Freeze all flag modifications making them readonly\r\n   */\r\n  public static freeze() {\r\n    Flags._FROZEN = true;\r\n  }\r\n\r\n  /**\r\n   * Resets internal flag state, not meant to be called by users. Only used for testing.\r\n   *\r\n   * Calling this in your game is UNSUPPORTED\r\n   * @internal\r\n   */\r\n  public static _reset() {\r\n    Flags._FROZEN = false;\r\n    Flags._FLAGS = {};\r\n  }\r\n\r\n  /**\r\n   * Turn on webgl support\r\n   */\r\n  public static useWebGL() {\r\n    Flags.enable(Experiments.WebGL);\r\n  }\r\n\r\n  public static useCanvasGraphicsContext() {\r\n    Flags.enable(Legacy.Canvas);\r\n  }\r\n\r\n  /**\r\n   * @deprecated Recommended not to use legacy drawing, going away in v0.26.0\r\n   */\r\n  public static useLegacyDrawing() {\r\n    Flags.enable(Legacy.LegacyDrawing);\r\n  }\r\n\r\n  /**\r\n   * Enable a specific feature flag by name. **Note: can only be set before [[Engine]] constructor time**\r\n   * @param flagName\r\n   */\r\n  public static enable(flagName: string): void {\r\n    if (this._FROZEN) {\r\n      throw Error('Feature flags can only be enabled before Engine constructor time');\r\n    }\r\n    Flags._FLAGS[flagName] = true;\r\n  }\r\n\r\n  /**\r\n   * Disable a specific feature flag by name. **Note: can only be set before [[Engine]] constructor time**\r\n   * @param flagName\r\n   */\r\n  public static disable(flagName: string): void {\r\n    if (this._FROZEN) {\r\n      throw Error('Feature flags can only be disabled before Engine constructor time');\r\n    }\r\n    Flags._FLAGS[flagName] = false;\r\n  }\r\n\r\n  /**\r\n   * Check if a flag is enabled. If the flag is disabled or does not exist `false` is returned\r\n   * @param flagName\r\n   */\r\n  public static isEnabled(flagName: string): boolean {\r\n    return !!Flags._FLAGS[flagName];\r\n  }\r\n\r\n  /**\r\n   * Show a list of currently known flags\r\n   */\r\n  public static show(): string[] {\r\n    return Object.keys(Flags._FLAGS);\r\n  }\r\n}\r\n","/* eslint-disable no-console */\r\n/**\r\n * Logging level that Excalibur will tag\r\n */\r\nexport enum LogLevel {\r\n  Debug,\r\n  Info,\r\n  Warn,\r\n  Error,\r\n  Fatal\r\n}\r\n\r\n/**\r\n * Static singleton that represents the logging facility for Excalibur.\r\n * Excalibur comes built-in with a [[ConsoleAppender]] and [[ScreenAppender]].\r\n * Derive from [[Appender]] to create your own logging appenders.\r\n */\r\nexport class Logger {\r\n  private static _INSTANCE: Logger = null;\r\n  private _appenders: Appender[] = [];\r\n\r\n  constructor() {\r\n    if (Logger._INSTANCE) {\r\n      throw new Error('Logger is a singleton');\r\n    }\r\n    Logger._INSTANCE = this;\r\n    // Default console appender\r\n    Logger._INSTANCE.addAppender(new ConsoleAppender());\r\n    return Logger._INSTANCE;\r\n  }\r\n\r\n  /**\r\n   * Gets or sets the default logging level. Excalibur will only log\r\n   * messages if equal to or above this level. Default: [[LogLevel.Info]]\r\n   */\r\n  public defaultLevel: LogLevel = LogLevel.Info;\r\n\r\n  /**\r\n   * Gets the current static instance of Logger\r\n   */\r\n  public static getInstance(): Logger {\r\n    if (Logger._INSTANCE == null) {\r\n      Logger._INSTANCE = new Logger();\r\n    }\r\n    return Logger._INSTANCE;\r\n  }\r\n\r\n  /**\r\n   * Adds a new [[Appender]] to the list of appenders to write to\r\n   */\r\n  public addAppender(appender: Appender): void {\r\n    this._appenders.push(appender);\r\n  }\r\n\r\n  /**\r\n   * Clears all appenders from the logger\r\n   */\r\n  public clearAppenders(): void {\r\n    this._appenders.length = 0;\r\n  }\r\n\r\n  /**\r\n   * Logs a message at a given LogLevel\r\n   * @param level  The LogLevel`to log the message at\r\n   * @param args   An array of arguments to write to an appender\r\n   */\r\n  private _log(level: LogLevel, args: any[]): void {\r\n    if (level == null) {\r\n      level = this.defaultLevel;\r\n    }\r\n\r\n    const len = this._appenders.length;\r\n\r\n    for (let i = 0; i < len; i++) {\r\n      if (level >= this.defaultLevel) {\r\n        this._appenders[i].log(level, args);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Writes a log message at the [[LogLevel.Debug]] level\r\n   * @param args  Accepts any number of arguments\r\n   */\r\n  public debug(...args: any[]): void {\r\n    this._log(LogLevel.Debug, args);\r\n  }\r\n\r\n  /**\r\n   * Writes a log message at the [[LogLevel.Info]] level\r\n   * @param args  Accepts any number of arguments\r\n   */\r\n  public info(...args: any[]): void {\r\n    this._log(LogLevel.Info, args);\r\n  }\r\n\r\n  /**\r\n   * Writes a log message at the [[LogLevel.Warn]] level\r\n   * @param args  Accepts any number of arguments\r\n   */\r\n  public warn(...args: any[]): void {\r\n    this._log(LogLevel.Warn, args);\r\n  }\r\n\r\n  /**\r\n   * Writes a log message at the [[LogLevel.Error]] level\r\n   * @param args  Accepts any number of arguments\r\n   */\r\n  public error(...args: any[]): void {\r\n    this._log(LogLevel.Error, args);\r\n  }\r\n\r\n  /**\r\n   * Writes a log message at the [[LogLevel.Fatal]] level\r\n   * @param args  Accepts any number of arguments\r\n   */\r\n  public fatal(...args: any[]): void {\r\n    this._log(LogLevel.Fatal, args);\r\n  }\r\n}\r\n\r\n/**\r\n * Contract for any log appender (such as console/screen)\r\n */\r\nexport interface Appender {\r\n  /**\r\n   * Logs a message at the given [[LogLevel]]\r\n   * @param level  Level to log at\r\n   * @param args   Arguments to log\r\n   */\r\n  log(level: LogLevel, args: any[]): void;\r\n}\r\n\r\n/**\r\n * Console appender for browsers (i.e. `console.log`)\r\n */\r\nexport class ConsoleAppender implements Appender {\r\n  /**\r\n   * Logs a message at the given [[LogLevel]]\r\n   * @param level  Level to log at\r\n   * @param args   Arguments to log\r\n   */\r\n  public log(level: LogLevel, args: any[]): void {\r\n    // Check for console support\r\n    if (!console && !console.log && console.warn && console.error) {\r\n      // todo maybe do something better than nothing\r\n      return;\r\n    }\r\n\r\n    // Create a new console args array\r\n    const consoleArgs: any[] = [];\r\n    consoleArgs.unshift.apply(consoleArgs, args);\r\n    consoleArgs.unshift('[' + LogLevel[level] + '] : ');\r\n\r\n    if (level < LogLevel.Warn) {\r\n      // Call .log for Debug/Info\r\n      if (console.log.apply) {\r\n        // this is required on some older browsers that don't support apply on console.log :(\r\n        console.log.apply(console, consoleArgs);\r\n      } else {\r\n        console.log(consoleArgs.join(' '));\r\n      }\r\n    } else if (level < LogLevel.Error) {\r\n      // Call .warn for Warn\r\n      if (console.warn.apply) {\r\n        console.warn.apply(console, consoleArgs);\r\n      } else {\r\n        console.warn(consoleArgs.join(' '));\r\n      }\r\n    } else {\r\n      // Call .error for Error/Fatal\r\n      if (console.error.apply) {\r\n        console.error.apply(console, consoleArgs);\r\n      } else {\r\n        console.error(consoleArgs.join(' '));\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * On-screen (canvas) appender\r\n */\r\nexport class ScreenAppender implements Appender {\r\n  // @todo Clean this up\r\n\r\n  private _messages: string[] = [];\r\n  private _canvas: HTMLCanvasElement;\r\n  private _ctx: CanvasRenderingContext2D;\r\n\r\n  /**\r\n   * @param width   Width of the screen appender in pixels\r\n   * @param height  Height of the screen appender in pixels\r\n   */\r\n  constructor(width?: number, height?: number) {\r\n    this._canvas = <HTMLCanvasElement>document.createElement('canvas');\r\n    this._canvas.width = width || window.innerWidth;\r\n    this._canvas.height = height || window.innerHeight;\r\n    this._canvas.style.position = 'absolute';\r\n    // eslint-disable-next-line\r\n    this._ctx = <CanvasRenderingContext2D>this._canvas.getContext('2d'); // eslint-disable-line\r\n    document.body.appendChild(this._canvas);\r\n  }\r\n\r\n  /**\r\n   * Logs a message at the given [[LogLevel]]\r\n   * @param level  Level to log at\r\n   * @param args   Arguments to log\r\n   */\r\n  public log(level: LogLevel, args: any[]): void {\r\n    const message = args.join(',');\r\n\r\n    this._ctx.clearRect(0, 0, this._canvas.width, this._canvas.height);\r\n\r\n    this._messages.unshift('[' + LogLevel[level] + '] : ' + message);\r\n\r\n    let pos = 10;\r\n    let opacity = 1.0;\r\n    for (let i = 0; i < this._messages.length; i++) {\r\n      this._ctx.fillStyle = 'rgba(255,255,255,' + opacity.toFixed(2) + ')';\r\n      this._ctx.fillText(this._messages[i], 200, pos);\r\n      pos += 10;\r\n      opacity = opacity > 0 ? opacity - 0.05 : 0;\r\n    }\r\n  }\r\n}\r\n","import { Vector } from '../Math/vector';\r\n\r\n/**\r\n * An enum that describes the sides of an axis aligned box for collision\r\n */\r\nexport enum Side {\r\n  None = 'None',\r\n  Top = 'Top',\r\n  Bottom = 'Bottom',\r\n  Left = 'Left',\r\n  Right = 'Right'\r\n}\r\n\r\nexport module Side {\r\n  /**\r\n   * Returns the opposite side from the current\r\n   */\r\n  export function getOpposite(side: Side): Side {\r\n    if (side === Side.Top) {\r\n      return Side.Bottom;\r\n    }\r\n    if (side === Side.Bottom) {\r\n      return Side.Top;\r\n    }\r\n    if (side === Side.Left) {\r\n      return Side.Right;\r\n    }\r\n    if (side === Side.Right) {\r\n      return Side.Left;\r\n    }\r\n\r\n    return Side.None;\r\n  }\r\n\r\n  /**\r\n   * Given a vector, return the Side most in that direction (via dot product)\r\n   */\r\n  export function fromDirection(direction: Vector): Side {\r\n    const directions = [Vector.Left, Vector.Right, Vector.Up, Vector.Down];\r\n    const directionEnum = [Side.Left, Side.Right, Side.Top, Side.Bottom];\r\n\r\n    let max = -Number.MAX_VALUE;\r\n    let maxIndex = -1;\r\n    for (let i = 0; i < directions.length; i++) {\r\n      if (directions[i].dot(direction) > max) {\r\n        max = directions[i].dot(direction);\r\n        maxIndex = i;\r\n      }\r\n    }\r\n    return directionEnum[maxIndex];\r\n  }\r\n}\r\n","import 'core-js/es/array/sort';\r\nimport 'core-js/es/object/keys';\r\n\r\n/**\r\n * Polyfill adding function\r\n */\r\nexport function polyfill() {\r\n  /* istanbul ignore next */\r\n  if (typeof window === 'undefined') {\r\n    window = <any>{\r\n      audioContext: function () {\r\n        return;\r\n      }\r\n    };\r\n  }\r\n  /* istanbul ignore next */\r\n  if (typeof window !== 'undefined' && !window.requestAnimationFrame) {\r\n    (<any>window).requestAnimationFrame =\r\n      (<any>window).webkitRequestAnimationFrame ||\r\n      (<any>window).mozRequestAnimationFrame ||\r\n      function (callback: Function) {\r\n        window.setInterval(callback, 1000 / 60);\r\n      };\r\n  }\r\n  /* istanbul ignore next */\r\n  if (typeof window !== 'undefined' && !window.cancelAnimationFrame) {\r\n    (<any>window).cancelAnimationFrame =\r\n      (<any>window).webkitCancelAnimationFrame ||\r\n      (<any>window).mozCancelAnimationFrame ||\r\n      function () {\r\n        return;\r\n      };\r\n  }\r\n  /* istanbul ignore next */\r\n  if (typeof window !== 'undefined' && !(<any>window).AudioContext) {\r\n    if ((<any>window).webkitAudioContext) {\r\n      const ctx = (<any>window).webkitAudioContext;\r\n      const replaceMe = ctx.prototype.decodeAudioData;\r\n      (<any>window).webkitAudioContext.prototype.decodeAudioData = function (arrayBuffer: ArrayBuffer) {\r\n        return new Promise((resolve, reject) => {\r\n          replaceMe.call(this, arrayBuffer, resolve, reject);\r\n        });\r\n      };\r\n    }\r\n\r\n    (<any>window).AudioContext =\r\n      (<any>window).AudioContext ||\r\n      (<any>window).webkitAudioContext ||\r\n      (<any>window).mozAudioContext ||\r\n      (<any>window).msAudioContext ||\r\n      (<any>window).oAudioContext;\r\n  }\r\n\r\n  /* istanbul ignore next */\r\n  if (typeof window !== 'undefined' && !(<any>window).devicePixelRatio) {\r\n    (<any>window).devicePixelRatio = window.devicePixelRatio || 1;\r\n  }\r\n}\r\n","export type Id<T extends string> = {\r\n  type: T,\r\n  value: number\r\n};\r\n\r\n/**\r\n *\r\n */\r\nexport function createId<T extends string>(type: T, value: number): Id<T> {\r\n  return { type, value };\r\n};\r\n","/**\r\n * @module\r\n * Pseudo-Random Utility\r\n *\r\n * A pseudo-random utility to add seeded random support for help in\r\n * generating things like terrain or reproducible randomness. Uses the\r\n * [Mersenne Twister](https://en.wikipedia.org/wiki/Mersenne_Twister) algorithm.\r\n */\r\n\r\n/**\r\n * 32-bit mask\r\n */\r\nconst BITMASK32: number = 0xffffffff;\r\n\r\n/**\r\n * Pseudo-random number generator following the Mersenne_Twister algorithm. Given a seed this generator will produce the same sequence\r\n * of numbers each time it is called.\r\n * See https://en.wikipedia.org/wiki/Mersenne_Twister for more details.\r\n * Uses the MT19937-32 (2002) implementation documented here http://www.math.sci.hiroshima-u.ac.jp/~m-mat/MT/MT2002/emt19937ar.html\r\n *\r\n * Api inspired by http://chancejs.com/# https://github.com/chancejs/chancejs\r\n */\r\nexport class Random {\r\n  // Separation point of one one word, the number of bits in the lower bitmask 0 <= r <= w-1\r\n  private _lowerMask: number = 0x7fffffff; // 31 bits same as _r\r\n  private _upperMask: number = 0x80000000; // 34 high bits\r\n\r\n  // Word size, 64 bits\r\n  private _w: number = 32;\r\n\r\n  // Degree of recurrence\r\n  private _n: number = 624;\r\n\r\n  // Middle word, an offset used in the recurrence defining the series x, 1<=m<n\r\n  private _m: number = 397;\r\n  // coefficients of teh rational normal form twist matrix\r\n  private _a: number = 0x9908b0df;\r\n\r\n  // tempering bit shifts and masks\r\n  private _u: number = 11;\r\n  private _s: number = 7;\r\n  private _b: number = 0x9d2c5680;\r\n  private _t: number = 15;\r\n  private _c: number = 0xefc60000;\r\n  private _l: number = 18;\r\n  private _f: number = 1812433253;\r\n\r\n  private _mt: number[];\r\n\r\n  private _index: number;\r\n\r\n  /**\r\n   * If no seed is specified, the Date.now() is used\r\n   */\r\n  constructor(public seed?: number) {\r\n    this._mt = new Array<number>(this._n);\r\n    // need to mask to support higher bit machines\r\n    this._mt[0] = (seed || Date.now()) >>> 0;\r\n\r\n    for (let i = 1; i < this._n; i++) {\r\n      const s = this._mt[i - 1] ^ (this._mt[i - 1] >>> (this._w - 2));\r\n      // numbers are bigger than the JS max safe int, add in 16-bit chunks to prevent IEEE rounding errors on high bits\r\n      this._mt[i] = (((this._f * ((s & 0xffff0000) >>> 16)) << 16) + this._f * (s & 0xffff) + i) >>> 0;\r\n    }\r\n    this._index = this._n;\r\n  }\r\n\r\n  /**\r\n   * Apply the twist\r\n   */\r\n  private _twist(): void {\r\n    const mag01 = [0x0, this._a];\r\n    let y = 0,\r\n      i = 0;\r\n    for (; i < this._n - this._m; i++) {\r\n      y = (this._mt[i] & this._upperMask) | (this._mt[i + 1] & this._lowerMask);\r\n      this._mt[i] = this._mt[i + this._m] ^ (y >>> 1) ^ (mag01[y & 0x1] & BITMASK32);\r\n    }\r\n    for (; i < this._n - 1; i++) {\r\n      y = (this._mt[i] & this._upperMask) | (this._mt[i + 1] & this._lowerMask);\r\n      this._mt[i] = this._mt[i + (this._m - this._n)] ^ (y >>> 1) ^ (mag01[y & 0x1] & BITMASK32);\r\n    }\r\n    y = (this._mt[this._n - 1] & this._upperMask) | (this._mt[0] & this._lowerMask);\r\n    this._mt[this._n - 1] = this._mt[this._m - 1] ^ (y >>> 1) ^ (mag01[y & 0x1] & BITMASK32);\r\n\r\n    this._index = 0;\r\n  }\r\n\r\n  /**\r\n   * Return next 32 bit integer number in sequence\r\n   */\r\n  public nextInt(): number {\r\n    if (this._index >= this._n) {\r\n      this._twist();\r\n    }\r\n\r\n    let y = this._mt[this._index++];\r\n\r\n    y ^= y >>> this._u;\r\n    y ^= (y << this._s) & this._b;\r\n    y ^= (y << this._t) & this._c;\r\n    y ^= y >>> this._l;\r\n\r\n    return y >>> 0;\r\n  }\r\n\r\n  /**\r\n   * Return a random floating point number between [0, 1)\r\n   */\r\n  public next(): number {\r\n    return this.nextInt() * (1.0 / 4294967296.0); // divided by 2^32\r\n  }\r\n\r\n  /**\r\n   * Return a random floating point in range [min, max) min is included, max is not included\r\n   */\r\n  public floating(min: number, max: number): number {\r\n    return (max - min) * this.next() + min;\r\n  }\r\n\r\n  /**\r\n   * Return a random integer in range [min, max] min is included, max is included.\r\n   * Implemented with rejection sampling, see https://medium.com/@betable/tifu-by-using-math-random-f1c308c4fd9d#.i13tdiu5a\r\n   */\r\n  public integer(min: number, max: number): number {\r\n    return Math.floor((max - min + 1) * this.next() + min);\r\n  }\r\n\r\n  /**\r\n   * Returns true or false randomly with 50/50 odds by default.\r\n   * By default the likelihood of returning a true is .5 (50%).\r\n   * @param likelihood takes values between [0, 1]\r\n   */\r\n  public bool(likelihood: number = 0.5): boolean {\r\n    return this.next() <= likelihood;\r\n  }\r\n\r\n  /**\r\n   * Returns one element from an array at random\r\n   */\r\n  public pickOne<T>(array: Array<T>): T {\r\n    return array[this.integer(0, array.length - 1)];\r\n  }\r\n\r\n  /**\r\n   * Returns a new array random picking elements from the original\r\n   * @param array Original array to pick from\r\n   * @param numPicks can be any positive number\r\n   * @param allowDuplicates indicates whether the returned set is allowed duplicates (it does not mean there will always be duplicates\r\n   * just that it is possible)\r\n   */\r\n  public pickSet<T>(array: Array<T>, numPicks: number, allowDuplicates: boolean = false): Array<T> {\r\n    if (allowDuplicates) {\r\n      return this._pickSetWithDuplicates(array, numPicks);\r\n    } else {\r\n      return this._pickSetWithoutDuplicates(array, numPicks);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns a new array randomly picking elements in the original (not reused)\r\n   * @param array Array to pick elements out of\r\n   * @param numPicks must be less than or equal to the number of elements in the array.\r\n   */\r\n  private _pickSetWithoutDuplicates<T>(array: Array<T>, numPicks: number): Array<T> {\r\n    if (numPicks > array.length || numPicks < 0) {\r\n      throw new Error('Invalid number of elements to pick, must pick a value 0 < n <= length');\r\n    }\r\n    if (numPicks === array.length) {\r\n      return array;\r\n    }\r\n\r\n    const result: Array<T> = new Array<T>(numPicks);\r\n    let currentPick = 0;\r\n    const tempArray = array.slice(0);\r\n    while (currentPick < numPicks) {\r\n      const index = this.integer(0, tempArray.length - 1);\r\n      result[currentPick++] = tempArray[index];\r\n      tempArray.splice(index, 1);\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Returns a new array random picking elements from the original allowing duplicates\r\n   * @param array Array to pick elements out of\r\n   * @param numPicks can be any positive number\r\n   */\r\n  private _pickSetWithDuplicates<T>(array: Array<T>, numPicks: number): Array<T> {\r\n    // Typescript numbers are all floating point, so do we add check for int? (or floor the input?)\r\n    if (numPicks < 0) {\r\n      throw new Error('Invalid number of elements to pick, must pick a value 0 <= n < MAX_INT');\r\n    }\r\n    const result = new Array<T>(numPicks);\r\n    for (let i = 0; i < numPicks; i++) {\r\n      result[i] = this.pickOne(array);\r\n    }\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Returns a new array that has its elements shuffled. Using the Fisher/Yates method\r\n   * https://en.wikipedia.org/wiki/Fisher%E2%80%93Yates_shuffle\r\n   */\r\n  public shuffle<T>(array: Array<T>): Array<T> {\r\n    const tempArray = array.slice(0);\r\n    let swap: T = null;\r\n    for (let i = 0; i < tempArray.length - 2; i++) {\r\n      const randomIndex = this.integer(i, tempArray.length - 1);\r\n      swap = tempArray[i];\r\n      tempArray[i] = tempArray[randomIndex];\r\n      tempArray[randomIndex] = swap;\r\n    }\r\n\r\n    return tempArray;\r\n  }\r\n\r\n  /**\r\n   * Generate a list of random integer numbers\r\n   * @param length the length of the final array\r\n   * @param min the minimum integer number to generate inclusive\r\n   * @param max the maximum integer number to generate inclusive\r\n   */\r\n  public range(length: number, min: number, max: number): Array<number> {\r\n    const result: Array<number> = new Array(length);\r\n    for (let i = 0; i < length; i++) {\r\n      result[i] = this.integer(min, max);\r\n    }\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Returns the result of a d4 dice roll\r\n   */\r\n  public d4() {\r\n    return this.integer(1, 4);\r\n  }\r\n\r\n  /**\r\n   * Returns the result of a d6 dice roll\r\n   */\r\n  public d6() {\r\n    return this.integer(1, 6);\r\n  }\r\n\r\n  /**\r\n   * Returns the result of a d8 dice roll\r\n   */\r\n  public d8() {\r\n    return this.integer(1, 8);\r\n  }\r\n\r\n  /**\r\n   * Returns the result of a d10 dice roll\r\n   */\r\n  public d10() {\r\n    return this.integer(1, 10);\r\n  }\r\n\r\n  /**\r\n   * Returns the result of a d12 dice roll\r\n   */\r\n  public d12() {\r\n    return this.integer(1, 12);\r\n  }\r\n\r\n  /**\r\n   * Returns the result of a d20 dice roll\r\n   */\r\n  public d20() {\r\n    return this.integer(1, 20);\r\n  }\r\n}\r\n","import { Vector } from '../Math/vector';\r\nimport { Random } from '../Math/Random';\r\nimport { Side } from '../Collision/Side';\r\n\r\n/**\r\n * Two PI constant\r\n */\r\nexport const TwoPI: number = Math.PI * 2;\r\n\r\n/**\r\n * Merges one or more objects into a single target object\r\n *\r\n * @param deep Whether or not to do a deep clone\r\n * @param target The target object to attach properties on\r\n * @param objects The objects whose properties to merge\r\n * @returns Merged object with properties from other objects\r\n */\r\nexport function extend(deep: boolean, target: any, ...objects: any[]): any;\r\n\r\n/**\r\n * Merges one or more objects into a single target object\r\n *\r\n * @param target The target object to attach properties on\r\n * @param object2 The second object whose properties to merge\r\n * @returns Merged object with properties from other objects\r\n */\r\nexport function extend<T1, T2>(target: T1, object2: T2): T1 & T2;\r\n\r\n/**\r\n * Merges one or more objects into a single target object\r\n *\r\n * @param target The target object to attach properties on\r\n * @param object2 The second object whose properties to merge\r\n * @param object3 The third object whose properties to merge\r\n * @returns Merged object with properties from other objects\r\n */\r\nexport function extend<T1, T2, T3>(target: T1, object2: T2, object3: T3): T1 & T2 & T3;\r\n\r\n/**\r\n * Merges one or more objects into a single target object\r\n *\r\n * @param target The target object to attach properties on\r\n * @param objects The objects whose properties to merge\r\n * @returns Merged object with properties from other objects\r\n */\r\nexport function extend(target: any, ...objects: any[]): any;\r\n\r\n/**\r\n * Merges one or more objects into a single target object\r\n *\r\n * @returns Merged object with properties from other objects\r\n * @credit https://gomakethings.com/vanilla-javascript-version-of-jquery-extend/\r\n */\r\nexport function extend() {\r\n  const extended: { [key: string]: any } = {};\r\n  let deep = false;\r\n  let i = 0;\r\n  const length = arguments.length;\r\n\r\n  // Check if a deep merge\r\n  if (Object.prototype.toString.call(arguments[0]) === '[object Boolean]') {\r\n    deep = arguments[0];\r\n    i++;\r\n  }\r\n\r\n  // Merge the object into the extended object\r\n  const assignExists = typeof (<any>Object).assign === 'function';\r\n  let merge = null;\r\n  if (!assignExists) {\r\n    merge = function (obj: any) {\r\n      for (const prop in obj) {\r\n        if (Object.prototype.hasOwnProperty.call(obj, prop)) {\r\n          // If deep merge and property is an object, merge properties\r\n          if (deep && Object.prototype.toString.call(obj[prop]) === '[object Object]') {\r\n            extended[prop] = extend(true, extended[prop], obj[prop]);\r\n          } else {\r\n            extended[prop] = obj[prop];\r\n          }\r\n        }\r\n      }\r\n    };\r\n  } else {\r\n    merge = (<any>Object).assign;\r\n  }\r\n\r\n  // Loop through each object and conduct a merge\r\n  for (; i < length; i++) {\r\n    const obj = arguments[i];\r\n    if (!assignExists) {\r\n      merge(obj);\r\n    } else {\r\n      merge(extended, obj);\r\n    }\r\n  }\r\n\r\n  return extended;\r\n}\r\n\r\n/**\r\n * Encode a string in base64\r\n * @deprecated This will be removed in v0.26.0\r\n */\r\nexport function base64Encode(inputStr: string) {\r\n  const b64 = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';\r\n  let outputStr = '';\r\n  let i = 0;\r\n\r\n  while (i < inputStr.length) {\r\n    //all three \"& 0xff\" added below are there to fix a known bug\r\n    //with bytes returned by xhr.responseText\r\n    const byte1 = inputStr.charCodeAt(i++) & 0xff;\r\n    const byte2 = inputStr.charCodeAt(i++) & 0xff;\r\n    const byte3 = inputStr.charCodeAt(i++) & 0xff;\r\n\r\n    const enc1 = byte1 >> 2;\r\n    const enc2 = ((byte1 & 3) << 4) | (byte2 >> 4);\r\n\r\n    let enc3, enc4;\r\n    if (isNaN(byte2)) {\r\n      enc3 = enc4 = 64;\r\n    } else {\r\n      enc3 = ((byte2 & 15) << 2) | (byte3 >> 6);\r\n      if (isNaN(byte3)) {\r\n        enc4 = 64;\r\n      } else {\r\n        enc4 = byte3 & 63;\r\n      }\r\n    }\r\n\r\n    outputStr += b64.charAt(enc1) + b64.charAt(enc2) + b64.charAt(enc3) + b64.charAt(enc4);\r\n  }\r\n\r\n  return outputStr;\r\n}\r\n\r\n/**\r\n * Sugar that will use `nullishVal` if it's not null or undefined. Simulates the `??` operator\r\n * @param nullishVal\r\n * @param defaultVal\r\n */\r\nexport function nullish<T>(nullishVal: T | undefined | null, defaultVal: T): T {\r\n  return nullishVal !== null && nullishVal !== undefined ? nullishVal : defaultVal;\r\n}\r\n\r\n/**\r\n * Clamps a value between a min and max inclusive\r\n */\r\nexport function clamp(val: number, min: number, max: number) {\r\n  return Math.min(Math.max(min, val), max);\r\n}\r\n\r\n/**\r\n * Find a random floating point number in range\r\n */\r\nexport function randomInRange(min: number, max: number, random: Random = new Random()): number {\r\n  return random ? random.floating(min, max) : min + Math.random() * (max - min);\r\n}\r\n\r\n/**\r\n * Find a random integer in a range\r\n */\r\nexport function randomIntInRange(min: number, max: number, random: Random = new Random()): number {\r\n  return random ? random.integer(min, max) : Math.round(randomInRange(min, max));\r\n}\r\n\r\n/**\r\n * Convert an angle to be the equivalent in the range [0, 2PI]\r\n */\r\nexport function canonicalizeAngle(angle: number): number {\r\n  let tmpAngle = angle;\r\n  if (angle > TwoPI) {\r\n    while (tmpAngle > TwoPI) {\r\n      tmpAngle -= TwoPI;\r\n    }\r\n  }\r\n\r\n  if (angle < 0) {\r\n    while (tmpAngle < 0) {\r\n      tmpAngle += TwoPI;\r\n    }\r\n  }\r\n  return tmpAngle;\r\n}\r\n\r\n/**\r\n * Convert radians to degrees\r\n */\r\nexport function toDegrees(radians: number): number {\r\n  return (180 / Math.PI) * radians;\r\n}\r\n\r\n/**\r\n * Convert degrees to radians\r\n */\r\nexport function toRadians(degrees: number): number {\r\n  return (degrees / 180) * Math.PI;\r\n}\r\n\r\n/**\r\n * Find the screen position of an HTML element\r\n */\r\nexport function getPosition(el: HTMLElement): Vector {\r\n  let oLeft: number = 0,\r\n    oTop: number = 0;\r\n\r\n  const calcOffsetLeft = (parent: HTMLElement) => {\r\n    oLeft += parent.offsetLeft;\r\n\r\n    if (parent.offsetParent) {\r\n      calcOffsetLeft(<HTMLElement>parent.offsetParent);\r\n    }\r\n  };\r\n  const calcOffsetTop = (parent: HTMLElement) => {\r\n    oTop += parent.offsetTop;\r\n    if (parent.offsetParent) {\r\n      calcOffsetTop(<HTMLElement>parent.offsetParent);\r\n    }\r\n  };\r\n\r\n  calcOffsetLeft(el);\r\n  calcOffsetTop(el);\r\n\r\n  return new Vector(oLeft, oTop);\r\n}\r\n\r\n/**\r\n * Add an item to an array list if it doesn't already exist. Returns true if added, false if not and already exists in the array.\r\n * @deprecated Will be removed in v0.26.0\r\n */\r\nexport function addItemToArray<T>(item: T, array: T[]): boolean {\r\n  if (array.indexOf(item) === -1) {\r\n    array.push(item);\r\n    return true;\r\n  }\r\n  return false;\r\n}\r\n\r\n/**\r\n * Remove an item from an list\r\n * @deprecated Will be removed in v0.26.0\r\n */\r\nexport function removeItemFromArray<T>(item: T, array: T[]): boolean {\r\n  let index = -1;\r\n  if ((index = array.indexOf(item)) > -1) {\r\n    array.splice(index, 1);\r\n    return true;\r\n  }\r\n\r\n  return false;\r\n}\r\n\r\n/**\r\n * See if an array contains something\r\n */\r\nexport function contains(array: Array<any>, obj: any): boolean {\r\n  for (let i = 0; i < array.length; i++) {\r\n    if (array[i] === obj) {\r\n      return true;\r\n    }\r\n  }\r\n  return false;\r\n}\r\n\r\n/**\r\n * Get the opposit side\r\n * TODO: Move to Side type\r\n * @deprecated Will be removed in v0.26.0\r\n */\r\nexport function getOppositeSide(side: Side) {\r\n  if (side === Side.Top) {\r\n    return Side.Bottom;\r\n  }\r\n  if (side === Side.Bottom) {\r\n    return Side.Top;\r\n  }\r\n  if (side === Side.Left) {\r\n    return Side.Right;\r\n  }\r\n  if (side === Side.Right) {\r\n    return Side.Left;\r\n  }\r\n\r\n  return Side.None;\r\n}\r\n\r\n/**\r\n * Returns the side in the direction of the vector supplied\r\n * @param direction Vector to check\r\n * @deprecated\r\n * TODO: Move to Side type\r\n */\r\nexport function getSideFromDirection(direction: Vector) {\r\n  const directions = [Vector.Left, Vector.Right, Vector.Up, Vector.Down];\r\n  const directionEnum = [Side.Left, Side.Right, Side.Top, Side.Bottom];\r\n\r\n  let max = -Number.MAX_VALUE;\r\n  let maxIndex = -1;\r\n  for (let i = 0; i < directions.length; i++) {\r\n    if (directions[i].dot(direction) > max) {\r\n      max = directions[i].dot(direction);\r\n      maxIndex = i;\r\n    }\r\n  }\r\n  return directionEnum[maxIndex];\r\n}\r\n\r\n/**\r\n * Excalibur's dynamically resizing collection\r\n * @deprecated Will be removed v0.26.0\r\n */\r\nexport class Collection<T> {\r\n  /**\r\n   * Default collection size\r\n   */\r\n  public static DefaultSize = 200;\r\n  private _internalArray: T[] = null;\r\n  private _endPointer: number = 0;\r\n\r\n  /**\r\n   * @param initialSize  Initial size of the internal backing array\r\n   */\r\n  constructor(initialSize: number = Collection.DefaultSize) {\r\n    this._internalArray = new Array<T>(initialSize);\r\n  }\r\n\r\n  private _resize() {\r\n    const newSize = this._internalArray.length * 2;\r\n    const newArray = new Array<T>(newSize);\r\n    const count = this.count();\r\n    for (let i = 0; i < count; i++) {\r\n      newArray[i] = this._internalArray[i];\r\n    }\r\n\r\n    delete this._internalArray;\r\n    this._internalArray = newArray;\r\n  }\r\n\r\n  /**\r\n   * Push elements to the end of the collection\r\n   */\r\n  public push(element: T): T {\r\n    if (this._endPointer === this._internalArray.length) {\r\n      this._resize();\r\n    }\r\n    return (this._internalArray[this._endPointer++] = element);\r\n  }\r\n\r\n  /**\r\n   * Removes elements from the end of the collection\r\n   */\r\n  public pop(): T {\r\n    this._endPointer = this._endPointer - 1 < 0 ? 0 : this._endPointer - 1;\r\n    return this._internalArray[this._endPointer];\r\n  }\r\n\r\n  /**\r\n   * Returns the count of the collection\r\n   */\r\n  public count(): number {\r\n    return this._endPointer;\r\n  }\r\n\r\n  /**\r\n   * Empties the collection\r\n   */\r\n  public clear() {\r\n    this._endPointer = 0;\r\n  }\r\n\r\n  /**\r\n   * Returns the size of the internal backing array\r\n   */\r\n  public internalSize(): number {\r\n    return this._internalArray.length;\r\n  }\r\n\r\n  /**\r\n   * Returns an element at a specific index\r\n   * @param index  Index of element to retrieve\r\n   */\r\n  public elementAt(index: number): T {\r\n    if (index >= this.count()) {\r\n      //Logger.getInstance().error('Invalid parameter: ' + index);\r\n      throw new Error('Invalid index ' + index);\r\n    }\r\n    return this._internalArray[index];\r\n  }\r\n\r\n  /**\r\n   * Inserts an element at a specific index\r\n   * @param index  Index to insert the element\r\n   * @param value  Element to insert\r\n   */\r\n  public insert(index: number, value: T): T {\r\n    if (index >= this.count()) {\r\n      this._resize();\r\n    }\r\n    return (this._internalArray[index] = value);\r\n  }\r\n\r\n  /**\r\n   * Removes an element at a specific index\r\n   * @param index  Index of element to remove\r\n   */\r\n  public remove(index: number): T {\r\n    const count = this.count();\r\n    if (count === 0) {\r\n      //Logger.getInstance().error('Invalid parameter: ' + index);\r\n      throw new Error('Invalid parameter ' + index);\r\n    }\r\n    // O(n) Shift\r\n    const removed = this._internalArray[index];\r\n    for (let i = index; i < count; i++) {\r\n      this._internalArray[i] = this._internalArray[i + 1];\r\n    }\r\n    this._endPointer--;\r\n    return removed;\r\n  }\r\n\r\n  /**\r\n   * Removes an element by reference\r\n   * @param element  Element to retrieve\r\n   */\r\n  public removeElement(element: T) {\r\n    const index = this._internalArray.indexOf(element);\r\n    this.remove(index);\r\n  }\r\n\r\n  /**\r\n   * Returns a array representing the collection\r\n   */\r\n  public toArray(): T[] {\r\n    return this._internalArray.slice(0, this._endPointer);\r\n  }\r\n\r\n  /**\r\n   * Iterate over every element in the collection\r\n   * @param func  Callback to call for each element passing a reference to the element and its index, returned values are ignored\r\n   */\r\n  public forEach(func: (element: T, index: number) => any) {\r\n    let i = 0;\r\n    const count = this.count();\r\n    for (i; i < count; i++) {\r\n      func.call(this, this._internalArray[i], i);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Mutate every element in the collection\r\n   * @param func  Callback to call for each element passing a reference to the element and its index, any values returned mutate\r\n   * the collection\r\n   */\r\n  public map(func: (element: T, index: number) => any) {\r\n    const count = this.count();\r\n    for (let i = 0; i < count; i++) {\r\n      this._internalArray[i] = func.call(this, this._internalArray[i], i);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Used for exhaustive checks at compile time\r\n */\r\nexport function fail(message: never): never {\r\n  throw new Error(message);\r\n}\r\n\r\n/**\r\n * Generate a range of numbers\r\n * For example: range(0, 5) -> [0, 1, 2, 3, 4, 5]\r\n * @param from inclusive\r\n * @param to inclusive\r\n */\r\nexport const range = (from: number, to: number) => Array.from(new Array(to - from + 1), (_x, i) => i + from);\r\n\r\n/**\r\n * Create a promise that resolves after a certain number of milliseconds\r\n * @param milliseconds\r\n */\r\nexport function delay(milliseconds: number): Promise<void> {\r\n  return new Promise((resolve) => {\r\n    setTimeout(() => {\r\n      resolve();\r\n    }, milliseconds);\r\n  });\r\n}\r\n","import { Flags } from '../Flags';\r\nimport { Logger } from './Log';\r\nimport { extend } from './Util';\r\n\r\n/**\r\n * Obsolete decorator options\r\n */\r\nexport interface ObsoleteOptions {\r\n  // Optionally specify a custom message\r\n  message?: string;\r\n  // Optionally indicate that an alternate method to the obsolete one exists\r\n  alternateMethod?: string;\r\n  // Optional show stack trace, by default off\r\n  showStackTrace?: boolean;\r\n}\r\n\r\nexport const maxMessages = 5;\r\nconst obsoleteMessage: { [messageCount: string]: number } = {};\r\nexport const resetObsoleteCounter = () => {\r\n  for (const message in obsoleteMessage) {\r\n    obsoleteMessage[message] = 0;\r\n  }\r\n};\r\n\r\nconst logMessage = (message: string, options: ObsoleteOptions) => {\r\n  const suppressObsoleteMessages = Flags.isEnabled('suppress-obsolete-message');\r\n  if (obsoleteMessage[message] < maxMessages && !suppressObsoleteMessages) {\r\n    Logger.getInstance().warn(message);\r\n\r\n    // tslint:disable-next-line: no-console\r\n    if (console.trace && options.showStackTrace) {\r\n      // tslint:disable-next-line: no-console\r\n      console.trace();\r\n    }\r\n  }\r\n  obsoleteMessage[message]++;\r\n};\r\n\r\n/**\r\n * Obsolete decorator for marking Excalibur methods obsolete, you can optionally specify a custom message and/or alternate replacement\r\n * method do the deprecated one. Inspired by https://github.com/jayphelps/core-decorators.js\r\n */\r\nexport function obsolete(options?: ObsoleteOptions): any {\r\n  options = extend(\r\n    {},\r\n    {\r\n      message: 'This feature will be removed in future versions of Excalibur.',\r\n      alternateMethod: null,\r\n      showStackTrack: false\r\n    },\r\n    options\r\n  );\r\n\r\n  return function (target: any, property: string, descriptor: PropertyDescriptor): any {\r\n    if (\r\n      descriptor &&\r\n      !(typeof descriptor.value === 'function' || typeof descriptor.get === 'function' || typeof descriptor.set === 'function')\r\n    ) {\r\n      throw new SyntaxError('Only classes/functions/getters/setters can be marked as obsolete');\r\n    }\r\n    const methodSignature = `${target.name || ''}${target.name && property ? '.' : ''}${property ? property : ''}`;\r\n\r\n    const message =\r\n      `${methodSignature} is marked obsolete: ${options.message}` +\r\n      (options.alternateMethod ? ` Use ${options.alternateMethod} instead` : '');\r\n\r\n    if (!obsoleteMessage[message]) {\r\n      obsoleteMessage[message] = 0;\r\n    }\r\n\r\n    // If descriptor is null it is a class\r\n    const method = descriptor ? { ...descriptor } : target;\r\n    if (!descriptor) {\r\n      // with es2015 classes we need to change our decoration tactic\r\n      class DecoratedClass extends method {\r\n        constructor(...args: any) {\r\n          logMessage(message, options);\r\n          super(...args);\r\n        }\r\n      }\r\n      return DecoratedClass;\r\n    }\r\n\r\n    if (descriptor && descriptor.value) {\r\n      method.value = function (this: any) {\r\n        logMessage(message, options);\r\n        return descriptor.value.apply(this, arguments);\r\n      };\r\n      return method;\r\n    }\r\n\r\n    if (descriptor && descriptor.get) {\r\n      method.get = function (this: any) {\r\n        logMessage(message, options);\r\n        return descriptor.get.apply(this, arguments);\r\n      };\r\n    }\r\n\r\n    if (descriptor && descriptor.set) {\r\n      method.set = function (this: any) {\r\n        logMessage(message, options);\r\n        return descriptor.set.apply(this, arguments);\r\n      };\r\n    }\r\n    return method;\r\n  };\r\n}\r\n","import { Clonable } from '../Interfaces/Clonable';\r\nimport { obsolete } from '../Util/Decorators';\r\n\r\n/**\r\n * A 2D vector on a plane.\r\n */\r\n\r\nexport class Vector implements Clonable<Vector> {\r\n  /**\r\n   * A (0, 0) vector\r\n   */\r\n  public static get Zero() {\r\n    return new Vector(0, 0);\r\n  }\r\n\r\n  /**\r\n   * A (1, 1) vector\r\n   */\r\n  public static get One() {\r\n    return new Vector(1, 1);\r\n  }\r\n\r\n  /**\r\n   * A (0.5, 0.5) vector\r\n   */\r\n  public static get Half() {\r\n    return new Vector(0.5, 0.5);\r\n  }\r\n\r\n  /**\r\n   * A unit vector pointing up (0, -1)\r\n   */\r\n  public static get Up() {\r\n    return new Vector(0, -1);\r\n  }\r\n\r\n  /**\r\n   * A unit vector pointing down (0, 1)\r\n   */\r\n  public static get Down() {\r\n    return new Vector(0, 1);\r\n  }\r\n\r\n  /**\r\n   * A unit vector pointing left (-1, 0)\r\n   */\r\n  public static get Left() {\r\n    return new Vector(-1, 0);\r\n  }\r\n  /**\r\n   * A unit vector pointing right (1, 0)\r\n   */\r\n  public static get Right() {\r\n    return new Vector(1, 0);\r\n  }\r\n\r\n  /**\r\n   * Returns a vector of unit length in the direction of the specified angle in Radians.\r\n   * @param angle The angle to generate the vector\r\n   */\r\n  public static fromAngle(angle: number) {\r\n    return new Vector(Math.cos(angle), Math.sin(angle));\r\n  }\r\n\r\n  /**\r\n   * Checks if vector is not null, undefined, or if any of its components are NaN or Infinity.\r\n   */\r\n  public static isValid(vec: Vector) {\r\n    if (vec === null || vec === undefined) {\r\n      return false;\r\n    }\r\n    if (isNaN(vec.x) || isNaN(vec.y)) {\r\n      return false;\r\n    }\r\n\r\n    if (vec.x === Infinity || vec.y === Infinity || vec.x === -Infinity || vec.y === -Infinity) {\r\n      return false;\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Calculates distance between two Vectors\r\n   * @param vec1\r\n   * @param vec2\r\n   */\r\n  public static distance(vec1: Vector, vec2: Vector) {\r\n    return Math.sqrt(Math.pow(vec1.x - vec2.x, 2) + Math.pow(vec1.y - vec2.y, 2));\r\n  }\r\n\r\n  /**\r\n   * @param x  X component of the Vector\r\n   * @param y  Y component of the Vector\r\n   */\r\n  constructor(x: number, y: number) {\r\n    this._x = x;\r\n    this._y = y;\r\n  }\r\n\r\n  protected _x = 0;\r\n  /**\r\n   * Get the x component of the vector\r\n   */\r\n  public get x(): number {\r\n    return this._x;\r\n  }\r\n\r\n  /**\r\n   * Set the x component, THIS MUTATES the current vector. It is usually better to create a new vector.\r\n   * @warning **Be very careful setting components on shared vectors, mutating shared vectors can cause hard to find bugs**\r\n   */\r\n  public set x(val: number) {\r\n    this._x = val;\r\n  }\r\n\r\n  protected _y = 0;\r\n  /**\r\n   * Get the y component of the vector\r\n   */\r\n  public get y(): number {\r\n    return this._y;\r\n  }\r\n\r\n  /**\r\n   * Set the y component, THIS MUTATES the current vector. It is usually better to create a new vector.\r\n   * @warning **Be very careful setting components on shared vectors, mutating shared vectors can cause hard to find bugs**\r\n   */\r\n  public set y(val: number) {\r\n    this._y = val;\r\n  }\r\n\r\n  /**\r\n   * Sets the x and y components at once, THIS MUTATES the current vector. It is usually better to create a new vector.\r\n   *\r\n   * @warning **Be very careful using this, mutating vectors can cause hard to find bugs**\r\n   */\r\n  setTo(x: number, y: number) {\r\n    (this.x as number) = x;\r\n    (this.y as number) = y;\r\n  }\r\n\r\n  /**\r\n   * Compares this point against another and tests for equality\r\n   * @param vector The other point to compare to\r\n   * @param tolerance Amount of euclidean distance off we are willing to tolerate\r\n   */\r\n  public equals(vector: Vector, tolerance: number = 0.001): boolean {\r\n    return Math.abs(this.x - vector.x) <= tolerance && Math.abs(this.y - vector.y) <= tolerance;\r\n  }\r\n\r\n  /**\r\n   * The distance to another vector. If no other Vector is specified, this will return the [[magnitude]].\r\n   * @param v  The other vector. Leave blank to use origin vector.\r\n   */\r\n  public distance(v?: Vector): number {\r\n    if (!v) {\r\n      v = Vector.Zero;\r\n    }\r\n    return Math.sqrt(Math.pow(this.x - v.x, 2) + Math.pow(this.y - v.y, 2));\r\n  }\r\n\r\n  public squareDistance(v?: Vector): number {\r\n    if (!v) {\r\n      v = Vector.Zero;\r\n    }\r\n    return Math.pow(this.x - v.x, 2) + Math.pow(this.y - v.y, 2);\r\n  }\r\n\r\n  /**\r\n   * The magnitude (size) of the Vector\r\n   * @deprecated magnitude will be removed in favour of '.size' in version 0.25.0\r\n   */\r\n  @obsolete({ message: 'will be removed in favour of `.size` in version 0.25.0' })\r\n  public magnitude(): number {\r\n    return this.distance();\r\n  }\r\n\r\n  /**\r\n   * The size (magnitude) of the Vector\r\n   */\r\n  public get size(): number {\r\n    return this.distance();\r\n  }\r\n\r\n  /**\r\n   * Setting the size mutates the current vector\r\n   *\r\n   * @warning Can be used to set the size of the vector, **be very careful using this, mutating vectors can cause hard to find bugs**\r\n   */\r\n  public set size(newLength: number) {\r\n    const v = this.normalize().scale(newLength);\r\n    this.setTo(v.x, v.y);\r\n  }\r\n\r\n  /**\r\n   * Normalizes a vector to have a magnitude of 1.\r\n   */\r\n  public normalize(): Vector {\r\n    const d = this.distance();\r\n    if (d > 0) {\r\n      return new Vector(this.x / d, this.y / d);\r\n    } else {\r\n      return new Vector(0, 1);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns the average (midpoint) between the current point and the specified\r\n   */\r\n  public average(vec: Vector): Vector {\r\n    return this.add(vec).scale(0.5);\r\n  }\r\n\r\n  /**\r\n   * Scales a vector's by a factor of size\r\n   * @param size  The factor to scale the magnitude by\r\n   */\r\n  public scale(scale: Vector): Vector;\r\n  public scale(size: number): Vector;\r\n  public scale(sizeOrScale: number | Vector): Vector {\r\n    if (sizeOrScale instanceof Vector) {\r\n      return new Vector(this.x * sizeOrScale.x, this.y * sizeOrScale.y);\r\n    } else {\r\n      return new Vector(this.x * sizeOrScale, this.y * sizeOrScale);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Adds one vector to another\r\n   * @param v The vector to add\r\n   */\r\n  public add(v: Vector): Vector {\r\n    return new Vector(this.x + v.x, this.y + v.y);\r\n  }\r\n\r\n  /**\r\n   * Subtracts a vector from another, if you subtract vector `B.sub(A)` the resulting vector points from A -> B\r\n   * @param v The vector to subtract\r\n   */\r\n  public sub(v: Vector): Vector {\r\n    return new Vector(this.x - v.x, this.y - v.y);\r\n  }\r\n\r\n  /**\r\n   * Adds one vector to this one modifying the original\r\n   * @param v The vector to add\r\n   * @warning Be very careful using this, mutating vectors can cause hard to find bugs\r\n   */\r\n  public addEqual(v: Vector): Vector {\r\n    this.setTo(this.x + v.x, this.y + v.y);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Subtracts a vector from this one modifying the original\r\n   * @param v The vector to subtract\r\n   * @warning Be very careful using this, mutating vectors can cause hard to find bugs\r\n   */\r\n  public subEqual(v: Vector): Vector {\r\n    this.setTo(this.x - v.x, this.y - v.y);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Scales this vector by a factor of size and modifies the original\r\n   * @warning Be very careful using this, mutating vectors can cause hard to find bugs\r\n   */\r\n  public scaleEqual(size: number): Vector {\r\n    this.setTo(this.x * size, this.y * size);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Performs a dot product with another vector\r\n   * @param v  The vector to dot\r\n   */\r\n  public dot(v: Vector): number {\r\n    return this.x * v.x + this.y * v.y;\r\n  }\r\n\r\n  /**\r\n   * Performs a 2D cross product with scalar. 2D cross products with a scalar return a vector.\r\n   * @param v  The scalar to cross\r\n   */\r\n  public cross(v: number): Vector;\r\n  /**\r\n   * Performs a 2D cross product with another vector. 2D cross products return a scalar value not a vector.\r\n   * @param v  The vector to cross\r\n   */\r\n  public cross(v: Vector): number;\r\n  public cross(v: any): any {\r\n    if (v instanceof Vector) {\r\n      return this.x * v.y - this.y * v.x;\r\n    } else if (typeof v === 'number') {\r\n      return new Vector(v * this.y, -v * this.x);\r\n    }\r\n  }\r\n\r\n  static cross(num: number, vec: Vector): Vector {\r\n    return new Vector(-num * vec.y, num * vec.x);\r\n  }\r\n\r\n  /**\r\n   * Returns the perpendicular vector to this one\r\n   */\r\n  public perpendicular(): Vector {\r\n    return new Vector(this.y, -this.x);\r\n  }\r\n\r\n  /**\r\n   * Returns the normal vector to this one, same as the perpendicular of length 1\r\n   */\r\n  public normal(): Vector {\r\n    return this.perpendicular().normalize();\r\n  }\r\n\r\n  /**\r\n   * Negate the current vector\r\n   */\r\n  public negate(): Vector {\r\n    return this.scale(-1);\r\n  }\r\n\r\n  /**\r\n   * Returns the angle of this vector.\r\n   */\r\n  public toAngle(): number {\r\n    return Math.atan2(this.y, this.x);\r\n  }\r\n\r\n  /**\r\n   * Rotates the current vector around a point by a certain number of\r\n   * degrees in radians\r\n   */\r\n  public rotate(angle: number, anchor?: Vector): Vector {\r\n    if (!anchor) {\r\n      anchor = new Vector(0, 0);\r\n    }\r\n    const sinAngle = Math.sin(angle);\r\n    const cosAngle = Math.cos(angle);\r\n    const x = cosAngle * (this.x - anchor.x) - sinAngle * (this.y - anchor.y) + anchor.x;\r\n    const y = sinAngle * (this.x - anchor.x) + cosAngle * (this.y - anchor.y) + anchor.y;\r\n    return new Vector(x, y);\r\n  }\r\n\r\n  /**\r\n   * Creates new vector that has the same values as the previous.\r\n   */\r\n  public clone(): Vector {\r\n    return new Vector(this.x, this.y);\r\n  }\r\n\r\n  /**\r\n   * Returns a string representation of the vector.\r\n   */\r\n  public toString(fixed?: number): string {\r\n    if (fixed) {\r\n      return `(${this.x.toFixed(fixed)}, ${this.y.toFixed(fixed)})`;\r\n    }\r\n    return `(${this.x}, ${this.y})`;\r\n  }\r\n}\r\n\r\n/**\r\n * Shorthand for creating new Vectors - returns a new Vector instance with the\r\n * provided X and Y components.\r\n *\r\n * @param x  X component of the Vector\r\n * @param y  Y component of the Vector\r\n */\r\nexport function vec(x: number, y: number): Vector {\r\n  return new Vector(x, y);\r\n}\r\n","import { Vector, vec } from './Math/vector';\r\nimport { Logger } from './Util/Log';\r\nimport { Camera } from './Camera';\r\nimport { BrowserEvents } from './Util/Browser';\r\nimport { BoundingBox } from './Collision/Index';\r\nimport { ExcaliburGraphicsContext } from './Graphics/Context/ExcaliburGraphicsContext';\r\nimport { getPosition } from './Util/Util';\r\n\r\n/**\r\n * Enum representing the different display modes available to Excalibur.\r\n */\r\nexport enum DisplayMode {\r\n  /**\r\n   * Default, use a specified resolution for the game. Like 800x600 pixels for example.\r\n   */\r\n  Fixed = 'Fixed',\r\n\r\n  /**\r\n   * Fit to screen using as much space as possible while maintaining aspect ratio and resolution.\r\n   * This is not the same as [[Screen.goFullScreen]] but behaves in a similar way maintaining aspect ratio.\r\n   *\r\n   * You may want to center your game here is an example\r\n   * ```html\r\n   * <!-- html -->\r\n   * <body>\r\n   * <main>\r\n   *   <canvas id=\"game\"></canvas>\r\n   * </main>\r\n   * </body>\r\n   * ```\r\n   *\r\n   * ```css\r\n   * // css\r\n   * main {\r\n   *   display: flex;\r\n   *   align-items: center;\r\n   *   justify-content: center;\r\n   *   height: 100%;\r\n   *   width: 100%;\r\n   * }\r\n   * ```\r\n   *\r\n   */\r\n  FitScreen = 'FitScreen',\r\n\r\n  /**\r\n   * Fill the entire screen's css width/height for the game resolution dynamically. This means the resolution of the game will\r\n   * change dynamically as the window is resized. This is not the same as [[Screen.goFullScreen]]\r\n   */\r\n  FillScreen = 'FillScreen',\r\n\r\n  /**\r\n   * Fit to parent element width/height using as much space as possible while maintaining aspect ratio and resolution.\r\n   */\r\n  FitContainer = 'FitContainer',\r\n\r\n  /**\r\n   * Use the parent DOM container's css width/height for the game resolution dynamically\r\n   */\r\n  FillContainer = 'FillContainer',\r\n\r\n  /**\r\n   * Allow the game to be positioned with the [[EngineOptions.position]] option\r\n   * @deprecated Use CSS to position the game canvas, will be removed in v0.26.0\r\n   */\r\n  Position = 'Position'\r\n}\r\n\r\n/**\r\n * Convenience class for quick resolutions\r\n * Mostly sourced from https://emulation.gametechwiki.com/index.php/Resolution\r\n */\r\nexport class Resolution {\r\n  /* istanbul ignore next */\r\n  public static get SVGA(): ScreenDimension {\r\n    return { width: 800, height: 600 };\r\n  }\r\n\r\n  /* istanbul ignore next */\r\n  public static get Standard(): ScreenDimension {\r\n    return { width: 1920, height: 1080 };\r\n  }\r\n\r\n  /* istanbul ignore next */\r\n  public static get Atari2600(): ScreenDimension {\r\n    return { width: 160, height: 192 };\r\n  }\r\n\r\n  /* istanbul ignore next */\r\n  public static get GameBoy(): ScreenDimension {\r\n    return { width: 160, height: 144 };\r\n  }\r\n\r\n  /* istanbul ignore next */\r\n  public static get GameBoyAdvance(): ScreenDimension {\r\n    return { width: 240, height: 160 };\r\n  }\r\n\r\n  /* istanbul ignore next */\r\n  public static get NintendoDS(): ScreenDimension {\r\n    return { width: 256, height: 192 };\r\n  }\r\n\r\n  /* istanbul ignore next */\r\n  public static get NES(): ScreenDimension {\r\n    return { width: 256, height: 224 };\r\n  }\r\n\r\n  /* istanbul ignore next */\r\n  public static get SNES(): ScreenDimension {\r\n    return { width: 256, height: 244 };\r\n  }\r\n}\r\n\r\n/**\r\n * Interface describing the absolute CSS position of the game window. For use when [[DisplayMode.Position]]\r\n * is specified and when the user wants to define exact pixel spacing of the window.\r\n * When a number is given, the value is interpreted as pixels\r\n */\r\nexport interface AbsolutePosition {\r\n  top?: number | string;\r\n  left?: number | string;\r\n  right?: number | string;\r\n  bottom?: number | string;\r\n}\r\n\r\nexport type CanvasPosition = string | AbsolutePosition;\r\n\r\nexport interface ScreenDimension {\r\n  width: number;\r\n  height: number;\r\n}\r\n\r\nexport interface ScreenOptions {\r\n  /**\r\n   * Canvas element to build a screen on\r\n   */\r\n  canvas: HTMLCanvasElement;\r\n  /**\r\n   * Graphics context for the screen\r\n   */\r\n  context: ExcaliburGraphicsContext;\r\n\r\n  /**\r\n   * Browser abstraction\r\n   */\r\n  browser: BrowserEvents;\r\n  /**\r\n   * Optionally set antialiasing, defaults to true. If set to true, images will be smoothed\r\n   */\r\n  antialiasing?: boolean;\r\n  /**\r\n   * Optionally override the pixel ratio to use for the screen, otherwise calculated automatically from the browser\r\n   */\r\n  pixelRatio?: number;\r\n  /**\r\n   * Optionally specify the actual pixel resolution in width/height pixels (also known as logical resolution), by default the\r\n   * resolution will be the same as the viewport. Resolution will be overridden by [[DisplayMode.FillContainer]] and\r\n   * [[DisplayMode.FillScreen]].\r\n   */\r\n  resolution?: ScreenDimension;\r\n  /**\r\n   * Visual viewport size in css pixel, if resolution is not specified it will be the same as the viewport\r\n   */\r\n  viewport: ScreenDimension;\r\n  /**\r\n   * Set the display mode of the screen, by default DisplayMode.Fixed.\r\n   */\r\n  displayMode?: DisplayMode;\r\n  /**\r\n   * Specify how the game window is to be positioned when the [[DisplayMode.Position]] is chosen. This option MUST be specified\r\n   * if the DisplayMode is set as [[DisplayMode.Position]]. The position can be either a string or an [[AbsolutePosition]].\r\n   * String must be in the format of css style background-position. The vertical position must precede the horizontal position in strings.\r\n   *\r\n   * Valid String examples: \"top left\", \"top\", \"bottom\", \"middle\", \"middle center\", \"bottom right\"\r\n   * Valid [[AbsolutePosition]] examples: `{top: 5, right: 10%}`, `{bottom: 49em, left: 10px}`, `{left: 10, bottom: 40}`\r\n   */\r\n  position?: CanvasPosition;\r\n}\r\n\r\n/**\r\n * The Screen handles all aspects of interacting with the screen for Excalibur.\r\n */\r\nexport class Screen {\r\n  private _canvas: HTMLCanvasElement;\r\n  private _ctx: ExcaliburGraphicsContext;\r\n  private _antialiasing: boolean = true;\r\n  private _browser: BrowserEvents;\r\n  private _camera: Camera;\r\n  private _resolution: ScreenDimension;\r\n  private _resolutionStack: ScreenDimension[] = [];\r\n  private _viewport: ScreenDimension;\r\n  private _viewportStack: ScreenDimension[] = [];\r\n  private _pixelRatioOverride: number | null = null;\r\n  private _position: CanvasPosition;\r\n  private _displayMode: DisplayMode;\r\n  private _isFullScreen = false;\r\n  private _mediaQueryList: MediaQueryList;\r\n  private _isDisposed = false;\r\n  private _logger = Logger.getInstance();\r\n  private _resizeObserver: ResizeObserver;\r\n\r\n  constructor(options: ScreenOptions) {\r\n    this.viewport = options.viewport;\r\n    this.resolution = options.resolution ?? { ...this.viewport };\r\n    this._displayMode = options.displayMode ?? DisplayMode.Fixed;\r\n    this._canvas = options.canvas;\r\n    this._ctx = options.context;\r\n    this._antialiasing = options.antialiasing ?? this._antialiasing;\r\n    this._browser = options.browser;\r\n    this._position = options.position;\r\n    this._pixelRatioOverride = options.pixelRatio;\r\n    this._applyDisplayMode();\r\n\r\n    this._mediaQueryList = this._browser.window.nativeComponent.matchMedia(`(resolution: ${window.devicePixelRatio}dppx)`);\r\n    this._mediaQueryList.addEventListener('change', this._pixelRatioChangeHandler);\r\n\r\n    this._canvas.addEventListener('fullscreenchange', this._fullscreenChangeHandler);\r\n  }\r\n\r\n  public dispose(): void {\r\n    if (!this._isDisposed) {\r\n      // Clean up handlers\r\n      this._isDisposed = true;\r\n      this._browser.window.off('resize', this._resizeHandler);\r\n      if (this._resizeObserver) {\r\n        this._resizeObserver.disconnect();\r\n      }\r\n      this.parent.removeEventListener('resize', this._resizeHandler);\r\n      this._mediaQueryList.removeEventListener('change', this._pixelRatioChangeHandler);\r\n      this._canvas.removeEventListener('fullscreenchange', this._fullscreenChangeHandler);\r\n    }\r\n  }\r\n\r\n  private _fullscreenChangeHandler = () => {\r\n    this._isFullScreen = !this._isFullScreen;\r\n    this._logger.debug('Fullscreen Change', this._isFullScreen);\r\n  };\r\n\r\n  private _pixelRatioChangeHandler = () => {\r\n    this._logger.debug('Pixel Ratio Change', window.devicePixelRatio);\r\n    this._devicePixelRatio = this._calculateDevicePixelRatio();\r\n    this.applyResolutionAndViewport();\r\n  };\r\n\r\n  private _resizeHandler = () => {\r\n    const parent = this.parent;\r\n    this._logger.debug('View port resized');\r\n    this._setResolutionAndViewportByDisplayMode(parent);\r\n    this.applyResolutionAndViewport();\r\n  };\r\n\r\n  private _calculateDevicePixelRatio() {\r\n    if (window.devicePixelRatio < 1) {\r\n      return 1;\r\n    }\r\n\r\n    const devicePixelRatio = window.devicePixelRatio || 1;\r\n\r\n    return devicePixelRatio;\r\n  }\r\n\r\n  // Asking the window.devicePixelRatio is expensive we do it once\r\n  private _devicePixelRatio = this._calculateDevicePixelRatio();\r\n\r\n  public get pixelRatio(): number {\r\n    if (this._pixelRatioOverride) {\r\n      return this._pixelRatioOverride;\r\n    }\r\n\r\n    return this._devicePixelRatio;\r\n  }\r\n\r\n  public get isHiDpi() {\r\n    return this.pixelRatio !== 1;\r\n  }\r\n\r\n  public get displayMode(): DisplayMode {\r\n    return this._displayMode;\r\n  }\r\n\r\n  public get canvas(): HTMLCanvasElement {\r\n    return this._canvas;\r\n  }\r\n\r\n  public get parent(): HTMLElement | Window {\r\n    return <HTMLElement | Window>(\r\n      (this.displayMode === DisplayMode.FillContainer || this.displayMode === DisplayMode.FitContainer\r\n        ? this.canvas.parentElement || document.body\r\n        : window)\r\n    );\r\n  }\r\n\r\n  public get resolution(): ScreenDimension {\r\n    return this._resolution;\r\n  }\r\n\r\n  public set resolution(resolution: ScreenDimension) {\r\n    this._resolution = resolution;\r\n  }\r\n\r\n  public get viewport(): ScreenDimension {\r\n    if (this._viewport) {\r\n      return this._viewport;\r\n    }\r\n    return this._resolution;\r\n  }\r\n\r\n  public set viewport(viewport: ScreenDimension) {\r\n    this._viewport = viewport;\r\n  }\r\n\r\n  public get aspectRatio() {\r\n    return this._resolution.width / this._resolution.height;\r\n  }\r\n\r\n  public get scaledWidth() {\r\n    return this._resolution.width * this.pixelRatio;\r\n  }\r\n\r\n  public get scaledHeight() {\r\n    return this._resolution.height * this.pixelRatio;\r\n  }\r\n\r\n  public setCurrentCamera(camera: Camera) {\r\n    this._camera = camera;\r\n  }\r\n\r\n  public pushResolutionAndViewport() {\r\n    this._resolutionStack.push(this.resolution);\r\n    this._viewportStack.push(this.viewport);\r\n\r\n    this.resolution = { ...this.resolution };\r\n    this.viewport = { ...this.viewport };\r\n  }\r\n\r\n  public popResolutionAndViewport() {\r\n    this.resolution = this._resolutionStack.pop();\r\n    this.viewport = this._viewportStack.pop();\r\n  }\r\n\r\n  public applyResolutionAndViewport() {\r\n    this._canvas.width = this.scaledWidth;\r\n    this._canvas.height = this.scaledHeight;\r\n\r\n    if (this._antialiasing) {\r\n      this._canvas.style.imageRendering = 'auto';\r\n    } else {\r\n      this._canvas.style.imageRendering = 'pixelated';\r\n      // Fall back to 'crisp-edges' if 'pixelated' is not supported\r\n      // Currently for firefox https://developer.mozilla.org/en-US/docs/Web/CSS/image-rendering\r\n      if (this._canvas.style.imageRendering === '') {\r\n        this._canvas.style.imageRendering = 'crisp-edges';\r\n      }\r\n    }\r\n    this._canvas.style.width = this.viewport.width + 'px';\r\n    this._canvas.style.height = this.viewport.height + 'px';\r\n\r\n    // After messing with the canvas width/height the graphics context is invalidated and needs to have some properties reset\r\n    this._ctx.updateViewport();\r\n    this._ctx.resetTransform();\r\n    this._ctx.scale(this.pixelRatio, this.pixelRatio);\r\n    this._ctx.smoothing = this._antialiasing;\r\n  }\r\n\r\n  public get antialiasing() {\r\n    return this._antialiasing;\r\n  }\r\n\r\n  public set antialiasing(isSmooth: boolean) {\r\n    this._antialiasing = isSmooth;\r\n    this._ctx.smoothing = this._antialiasing;\r\n  }\r\n\r\n  /**\r\n   * Returns true if excalibur is fullscreened using the browser fullscreen api\r\n   */\r\n  public get isFullScreen() {\r\n    return this._isFullScreen;\r\n  }\r\n\r\n  /**\r\n   * Requests to go fullscreen using the browser fullscreen api, requires user interaction to be successful.\r\n   * For example, wire this to a user click handler.\r\n   */\r\n  public goFullScreen(): Promise<void> {\r\n    return this._canvas.requestFullscreen();\r\n  }\r\n\r\n  /**\r\n   * Requests to exit fullscreen using the browser fullscreen api\r\n   */\r\n  public exitFullScreen(): Promise<void> {\r\n    return document.exitFullscreen();\r\n  }\r\n\r\n  /**\r\n   * Takes a coordinate in normal html page space, for example from a pointer move event, and translates it to\r\n   * Excalibur screen space.\r\n   *\r\n   * Excalibur screen space starts at the top left (0, 0) corner of the viewport, and extends to the\r\n   * bottom right corner (resolutionX, resolutionY)\r\n   * @param point\r\n   */\r\n  public pageToScreenCoordinates(point: Vector): Vector {\r\n    let newX = point.x;\r\n    let newY = point.y;\r\n\r\n    if (!this._isFullScreen) {\r\n      newX -= getPosition(this._canvas).x;\r\n      newY -= getPosition(this._canvas).y;\r\n    }\r\n\r\n    // if fullscreen api on it centers with black bars\r\n    // we need to adjust the screen to world coordinates in this case\r\n    if (this._isFullScreen) {\r\n      if (window.innerWidth / this.aspectRatio < window.innerHeight) {\r\n        const screenHeight = window.innerWidth / this.aspectRatio;\r\n        const screenMarginY = (window.innerHeight - screenHeight) / 2;\r\n        newY = ((newY - screenMarginY) / screenHeight) * this.viewport.height;\r\n        newX = (newX / window.innerWidth) * this.viewport.width;\r\n      } else {\r\n        const screenWidth = window.innerHeight * this.aspectRatio;\r\n        const screenMarginX = (window.innerWidth - screenWidth) / 2;\r\n        newX = ((newX - screenMarginX) / screenWidth) * this.viewport.width;\r\n        newY = (newY / window.innerHeight) * this.viewport.height;\r\n      }\r\n    }\r\n\r\n    newX = (newX / this.viewport.width) * this.resolution.width;\r\n    newY = (newY / this.viewport.height) * this.resolution.height;\r\n\r\n    return new Vector(newX, newY);\r\n  }\r\n\r\n  /**\r\n   * Takes a coordinate in Excalibur screen space, and translates it to normal html page space. For example,\r\n   * this is where html elements might live if you want to position them relative to Excalibur.\r\n   *\r\n   * Excalibur screen space starts at the top left (0, 0) corner of the viewport, and extends to the\r\n   * bottom right corner (resolutionX, resolutionY)\r\n   * @param point\r\n   */\r\n  public screenToPageCoordinates(point: Vector): Vector {\r\n    let newX = point.x;\r\n    let newY = point.y;\r\n\r\n    newX = (newX / this.resolution.width) * this.viewport.width;\r\n    newY = (newY / this.resolution.height) * this.viewport.height;\r\n\r\n    if (this._isFullScreen) {\r\n      if (window.innerWidth / this.aspectRatio < window.innerHeight) {\r\n        const screenHeight = window.innerWidth / this.aspectRatio;\r\n        const screenMarginY = (window.innerHeight - screenHeight) / 2;\r\n        newY = (newY / this.viewport.height) * screenHeight + screenMarginY;\r\n        newX = (newX / this.viewport.width) * window.innerWidth;\r\n      } else {\r\n        const screenWidth = window.innerHeight * this.aspectRatio;\r\n        const screenMarginX = (window.innerWidth - screenWidth) / 2;\r\n        newX = (newX / this.viewport.width) * screenWidth + screenMarginX;\r\n        newY = (newY / this.viewport.height) * window.innerHeight;\r\n      }\r\n    }\r\n\r\n    if (!this._isFullScreen) {\r\n      newX += getPosition(this._canvas).x;\r\n      newY += getPosition(this._canvas).y;\r\n    }\r\n\r\n    return new Vector(newX, newY);\r\n  }\r\n\r\n  /**\r\n   * Takes a coordinate in Excalibur screen space, and translates it to Excalibur world space.\r\n   *\r\n   * World space is where [[Entity|entities]] in Excalibur live by default [[CoordPlane.World]]\r\n   * and extends infinitely out relative from the [[Camera]].\r\n   * @param point  Screen coordinate to convert\r\n   */\r\n  public screenToWorldCoordinates(point: Vector): Vector {\r\n    let newX = point.x;\r\n    let newY = point.y;\r\n\r\n    // transform back to world space\r\n    newX = (newX / this.resolution.width) * this.drawWidth;\r\n    newY = (newY / this.resolution.height) * this.drawHeight;\r\n\r\n    // transform based on zoom\r\n    newX = newX - this.halfDrawWidth;\r\n    newY = newY - this.halfDrawHeight;\r\n\r\n    // shift by camera focus\r\n    newX += this._camera?.x ?? 0;\r\n    newY += this._camera?.y ?? 0;\r\n\r\n    return new Vector(newX, newY);\r\n  }\r\n\r\n  /**\r\n   * Takes a coordinate in Excalibur world space, and translates it to Excalibur screen space.\r\n   *\r\n   * Screen space is where [[ScreenElement|screen elements]] and [[Entity|entities]] with [[CoordPlane.Screen]] live.\r\n   * @param point  World coordinate to convert\r\n   */\r\n  public worldToScreenCoordinates(point: Vector): Vector {\r\n    let screenX = point.x;\r\n    let screenY = point.y;\r\n\r\n    // shift by camera focus\r\n    screenX -= this._camera?.x ?? 0;\r\n    screenY -= this._camera?.y ?? 0;\r\n\r\n    // transform back on zoom\r\n    screenX = screenX + this.halfDrawWidth;\r\n    screenY = screenY + this.halfDrawHeight;\r\n\r\n    // transform back to screen space\r\n    screenX = (screenX / this.drawWidth) * this.resolution.width;\r\n    screenY = (screenY / this.drawHeight) * this.resolution.height;\r\n\r\n    return new Vector(screenX, screenY);\r\n  }\r\n\r\n  public pageToWorldCoordinates(point: Vector): Vector {\r\n    const screen = this.pageToScreenCoordinates(point);\r\n    return this.screenToWorldCoordinates(screen);\r\n  }\r\n\r\n  public worldToPageCoordinates(point: Vector): Vector {\r\n    const screen = this.worldToScreenCoordinates(point);\r\n    return this.screenToPageCoordinates(screen);\r\n  }\r\n\r\n  /**\r\n   * Returns a BoundingBox of the top left corner of the screen\r\n   * and the bottom right corner of the screen.\r\n   *\r\n   * World bounds are in world coordinates, useful for culling objects offscreen\r\n   */\r\n  public getWorldBounds(): BoundingBox {\r\n    const left = this.screenToWorldCoordinates(Vector.Zero).x;\r\n    const top = this.screenToWorldCoordinates(Vector.Zero).y;\r\n    const right = left + this.drawWidth;\r\n    const bottom = top + this.drawHeight;\r\n\r\n    return new BoundingBox(left, top, right, bottom);\r\n  }\r\n\r\n  /**\r\n   * The width of the game canvas in pixels (physical width component of the\r\n   * resolution of the canvas element)\r\n   */\r\n  public get canvasWidth(): number {\r\n    return this.canvas.width;\r\n  }\r\n\r\n  /**\r\n   * Returns half width of the game canvas in pixels (half physical width component)\r\n   */\r\n  public get halfCanvasWidth(): number {\r\n    return this.canvas.width / 2;\r\n  }\r\n\r\n  /**\r\n   * The height of the game canvas in pixels, (physical height component of\r\n   * the resolution of the canvas element)\r\n   */\r\n  public get canvasHeight(): number {\r\n    return this.canvas.height;\r\n  }\r\n\r\n  /**\r\n   * Returns half height of the game canvas in pixels (half physical height component)\r\n   */\r\n  public get halfCanvasHeight(): number {\r\n    return this.canvas.height / 2;\r\n  }\r\n\r\n  /**\r\n   * Returns the width of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\r\n   */\r\n  public get drawWidth(): number {\r\n    if (this._camera) {\r\n      return this.scaledWidth / this._camera.zoom / this.pixelRatio;\r\n    }\r\n    return this.scaledWidth / this.pixelRatio;\r\n  }\r\n\r\n  /**\r\n   * Returns half the width of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\r\n   */\r\n  public get halfDrawWidth(): number {\r\n    return this.drawWidth / 2;\r\n  }\r\n\r\n  /**\r\n   * Returns the height of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\r\n   */\r\n  public get drawHeight(): number {\r\n    if (this._camera) {\r\n      return this.scaledHeight / this._camera.zoom / this.pixelRatio;\r\n    }\r\n    return this.scaledHeight / this.pixelRatio;\r\n  }\r\n\r\n  /**\r\n   * Returns half the height of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\r\n   */\r\n  public get halfDrawHeight(): number {\r\n    return this.drawHeight / 2;\r\n  }\r\n\r\n  /**\r\n   * Returns screen center coordinates including zoom and device pixel ratio.\r\n   */\r\n  public get center(): Vector {\r\n    return vec(this.halfDrawWidth, this.halfDrawHeight);\r\n  }\r\n\r\n  private _computeFit() {\r\n    document.body.style.margin = '0px';\r\n    document.body.style.overflow = 'hidden';\r\n    const aspect = this.aspectRatio;\r\n    let adjustedWidth = 0;\r\n    let adjustedHeight = 0;\r\n    if (window.innerWidth / aspect < window.innerHeight) {\r\n      adjustedWidth = window.innerWidth;\r\n      adjustedHeight = window.innerWidth / aspect;\r\n    } else {\r\n      adjustedWidth = window.innerHeight * aspect;\r\n      adjustedHeight = window.innerHeight;\r\n    }\r\n\r\n    this.viewport = {\r\n      width: adjustedWidth,\r\n      height: adjustedHeight\r\n    };\r\n  }\r\n\r\n  private _computeFitContainer() {\r\n    const aspect = this.aspectRatio;\r\n    let adjustedWidth = 0;\r\n    let adjustedHeight = 0;\r\n    const parent = this.canvas.parentElement;\r\n    if (parent.clientWidth / aspect < parent.clientHeight) {\r\n      adjustedWidth = parent.clientWidth;\r\n      adjustedHeight = parent.clientWidth / aspect;\r\n    } else {\r\n      adjustedWidth = parent.clientHeight * aspect;\r\n      adjustedHeight = parent.clientHeight;\r\n    }\r\n\r\n    this.viewport = {\r\n      width: adjustedWidth,\r\n      height: adjustedHeight\r\n    };\r\n  }\r\n\r\n  private _applyDisplayMode() {\r\n    if (this.displayMode === DisplayMode.Position) {\r\n      this._initializeDisplayModePosition(this._position);\r\n    } else {\r\n      this._setResolutionAndViewportByDisplayMode(this.parent);\r\n\r\n      // watch resizing\r\n      if (this.parent instanceof Window) {\r\n        this._browser.window.on('resize', this._resizeHandler);\r\n      } else {\r\n        this._resizeObserver = new ResizeObserver(() => {\r\n          this._resizeHandler();\r\n        });\r\n        this._resizeObserver.observe(this.parent);\r\n      }\r\n      this.parent.addEventListener('resize', this._resizeHandler);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Sets the resoultion and viewport based on the selected display mode.\r\n   */\r\n  private _setResolutionAndViewportByDisplayMode(parent: HTMLElement | Window) {\r\n    if (this.displayMode === DisplayMode.FillContainer) {\r\n      this.resolution = {\r\n        width: (<HTMLElement>parent).clientWidth,\r\n        height: (<HTMLElement>parent).clientHeight\r\n      };\r\n\r\n      this.viewport = this.resolution;\r\n    }\r\n\r\n    if (this.displayMode === DisplayMode.FillScreen) {\r\n      document.body.style.margin = '0px';\r\n      document.body.style.overflow = 'hidden';\r\n      this.resolution = {\r\n        width: (<Window>parent).innerWidth,\r\n        height: (<Window>parent).innerHeight\r\n      };\r\n\r\n      this.viewport = this.resolution;\r\n    }\r\n\r\n    if (this.displayMode === DisplayMode.FitScreen) {\r\n      this._computeFit();\r\n    }\r\n\r\n    if (this.displayMode === DisplayMode.FitContainer) {\r\n      this._computeFitContainer();\r\n    }\r\n  }\r\n\r\n  private _initializeDisplayModePosition(position: CanvasPosition) {\r\n    if (!position) {\r\n      throw new Error('DisplayMode of Position was selected but no position option was given');\r\n    } else {\r\n      this.canvas.style.display = 'block';\r\n      this.canvas.style.position = 'absolute';\r\n\r\n      if (typeof position === 'string') {\r\n        const specifiedPosition = position.split(' ');\r\n\r\n        switch (specifiedPosition[0]) {\r\n          case 'top':\r\n            this.canvas.style.top = '0px';\r\n            break;\r\n          case 'bottom':\r\n            this.canvas.style.bottom = '0px';\r\n            break;\r\n          case 'middle':\r\n            this.canvas.style.top = '50%';\r\n            const offsetY = -this.halfDrawHeight;\r\n            this.canvas.style.marginTop = offsetY.toString();\r\n            break;\r\n          default:\r\n            throw new Error('Invalid Position Given');\r\n        }\r\n\r\n        if (specifiedPosition[1]) {\r\n          switch (specifiedPosition[1]) {\r\n            case 'left':\r\n              this.canvas.style.left = '0px';\r\n              break;\r\n            case 'right':\r\n              this.canvas.style.right = '0px';\r\n              break;\r\n            case 'center':\r\n              this.canvas.style.left = '50%';\r\n              const offsetX = -this.halfDrawWidth;\r\n              this.canvas.style.marginLeft = offsetX.toString();\r\n              break;\r\n            default:\r\n              throw new Error('Invalid Position Given');\r\n          }\r\n        }\r\n      } else {\r\n        if (position.top) {\r\n          typeof position.top === 'number'\r\n            ? (this.canvas.style.top = position.top.toString() + 'px')\r\n            : (this.canvas.style.top = position.top);\r\n        }\r\n        if (position.right) {\r\n          typeof position.right === 'number'\r\n            ? (this.canvas.style.right = position.right.toString() + 'px')\r\n            : (this.canvas.style.right = position.right);\r\n        }\r\n        if (position.bottom) {\r\n          typeof position.bottom === 'number'\r\n            ? (this.canvas.style.bottom = position.bottom.toString() + 'px')\r\n            : (this.canvas.style.bottom = position.bottom);\r\n        }\r\n        if (position.left) {\r\n          typeof position.left === 'number'\r\n            ? (this.canvas.style.left = position.left.toString() + 'px')\r\n            : (this.canvas.style.left = position.left);\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { Scene } from './Scene';\nimport { Vector } from './Math/vector';\nimport { Actor } from './Actor';\nimport { Trigger } from './Trigger';\nimport { FrameStats } from './Debug';\nimport { Engine } from './Engine';\nimport { TileMap } from './TileMap';\nimport { Side } from './Collision/Side';\nimport * as Input from './Input/Index';\nimport { CollisionContact } from './Collision/Detection/CollisionContact';\nimport { Collider } from './Collision/Colliders/Collider';\nimport { Entity } from './EntityComponentSystem/Entity';\nimport { OnInitialize, OnPreUpdate, OnPostUpdate } from './Interfaces/LifecycleEvents';\nimport { BodyComponent } from './Collision/BodyComponent';\n\nexport enum EventTypes {\n  Kill = 'kill',\n  PreKill = 'prekill',\n  PostKill = 'postkill',\n\n  PreDraw = 'predraw',\n  PostDraw = 'postdraw',\n\n  PreDebugDraw = 'predebugdraw',\n  PostDebugDraw = 'postdebugdraw',\n\n  PreUpdate = 'preupdate',\n  PostUpdate = 'postupdate',\n\n  PreFrame = 'preframe',\n  PostFrame = 'postframe',\n\n  PreCollision = 'precollision',\n  CollisionStart = 'collisionstart',\n  CollisionEnd = 'collisionend',\n  PostCollision = 'postcollision',\n\n  Initialize = 'initialize',\n  Activate = 'activate',\n  Deactivate = 'deactivate',\n\n  ExitViewport = 'exitviewport',\n  EnterViewport = 'enterviewport',\n\n  ExitTrigger = 'exit',\n  EnterTrigger = 'enter',\n\n  Connect = 'connect',\n  Disconnect = 'disconnect',\n  Button = 'button',\n  Axis = 'axis',\n\n  Subscribe = 'subscribe',\n  Unsubscribe = 'unsubscribe',\n\n  Visible = 'visible',\n  Hidden = 'hidden',\n  Start = 'start',\n  Stop = 'stop',\n\n  PointerUp = 'pointerup',\n  PointerDown = 'pointerdown',\n  PointerMove = 'pointermove',\n  PointerEnter = 'pointerenter',\n  PointerLeave = 'pointerleave',\n  PointerCancel = 'pointercancel',\n  PointerWheel = 'pointerwheel',\n\n  Up = 'up',\n  Down = 'down',\n  Move = 'move',\n  Enter = 'enter',\n  Leave = 'leave',\n  Cancel = 'cancel',\n  Wheel = 'wheel',\n\n  Press = 'press',\n  Release = 'release',\n  Hold = 'hold',\n\n  PointerDragStart = 'pointerdragstart',\n  PointerDragEnd = 'pointerdragend',\n  PointerDragEnter = 'pointerdragenter',\n  PointerDragLeave = 'pointerdragleave',\n  PointerDragMove = 'pointerdragmove'\n}\n\n/* istanbul ignore next */\n/* compiler only: these are internal to lib */\nexport type kill = 'kill';\nexport type prekill = 'prekill';\nexport type postkill = 'postkill';\n\nexport type predraw = 'predraw';\nexport type postdraw = 'postdraw';\n\nexport type predebugdraw = 'predebugdraw';\nexport type postdebugdraw = 'postdebugdraw';\n\nexport type preupdate = 'preupdate';\nexport type postupdate = 'postupdate';\n\nexport type preframe = 'preframe';\nexport type postframe = 'postframe';\n\nexport type precollision = 'precollision';\nexport type collisionstart = 'collisionstart';\nexport type collisionend = 'collisionend';\nexport type postcollision = 'postcollision';\n\nexport type initialize = 'initialize';\nexport type activate = 'activate';\nexport type deactivate = 'deactivate';\n\nexport type exitviewport = 'exitviewport';\nexport type enterviewport = 'enterviewport';\n\nexport type exittrigger = 'exit';\nexport type entertrigger = 'enter';\n\nexport type connect = 'connect';\nexport type disconnect = 'disconnect';\nexport type button = 'button';\nexport type axis = 'axis';\n\nexport type subscribe = 'subscribe';\nexport type unsubscribe = 'unsubscribe';\n\nexport type visible = 'visible';\nexport type hidden = 'hidden';\nexport type start = 'start';\nexport type stop = 'stop';\n\nexport type pointerup = 'pointerup';\nexport type pointerdown = 'pointerdown';\nexport type pointermove = 'pointermove';\nexport type pointerenter = 'pointerenter';\nexport type pointerleave = 'pointerleave';\nexport type pointercancel = 'pointercancel';\nexport type pointerwheel = 'pointerwheel';\n\nexport type up = 'up';\nexport type down = 'down';\nexport type move = 'move';\nexport type enter = 'enter';\nexport type leave = 'leave';\nexport type cancel = 'cancel';\nexport type wheel = 'wheel';\n\nexport type press = 'press';\nexport type release = 'release';\nexport type hold = 'hold';\n\nexport type pointerdragstart = 'pointerdragstart';\nexport type pointerdragend = 'pointerdragend';\nexport type pointerdragenter = 'pointerdragenter';\nexport type pointerdragleave = 'pointerdragleave';\nexport type pointerdragmove = 'pointerdragmove';\n\n/**\n * Base event type in Excalibur that all other event types derive from. Not all event types are thrown on all Excalibur game objects,\n * some events are unique to a type, others are not.\n *\n */\nexport class GameEvent<T, U = T> {\n  /**\n   * Target object for this event.\n   */\n  public target: T;\n\n  /**\n   * Other target object for this event\n   */\n  public other: U | null;\n\n  /**\n   * If set to false, prevents event from propagating to other actors. If true it will be propagated\n   * to all actors that apply.\n   */\n  public get bubbles(): boolean {\n    return this._bubbles;\n  }\n\n  public set bubbles(value: boolean) {\n    this._bubbles = value;\n  }\n\n  private _bubbles: boolean = true;\n  /**\n   * Prevents event from bubbling\n   */\n  public stopPropagation() {\n    this.bubbles = false;\n  }\n}\n\n/**\n * The 'kill' event is emitted on actors when it is killed. The target is the actor that was killed.\n */\nexport class KillEvent extends GameEvent<Actor> {\n  constructor(public target: Actor) {\n    super();\n  }\n}\n\n/**\n * The 'prekill' event is emitted directly before an actor is killed.\n */\nexport class PreKillEvent extends GameEvent<Actor> {\n  constructor(public target: Actor) {\n    super();\n  }\n}\n\n/**\n * The 'postkill' event is emitted directly after the actor is killed.\n */\nexport class PostKillEvent extends GameEvent<Actor> {\n  constructor(public target: Actor) {\n    super();\n  }\n}\n\n/**\n * The 'start' event is emitted on engine when has started and is ready for interaction.\n */\nexport class GameStartEvent extends GameEvent<Engine> {\n  constructor(public target: Engine) {\n    super();\n  }\n}\n\n/**\n * The 'stop' event is emitted on engine when has been stopped and will no longer take input, update or draw.\n */\nexport class GameStopEvent extends GameEvent<Engine> {\n  constructor(public target: Engine) {\n    super();\n  }\n}\n\n/**\n * The 'predraw' event is emitted on actors, scenes, and engine before drawing starts. Actors' predraw happens inside their graphics\n * transform so that all drawing takes place with the actor as the origin.\n *\n */\nexport class PreDrawEvent extends GameEvent<Entity | Scene | Engine | TileMap> {\n  constructor(public ctx: CanvasRenderingContext2D, public delta: number, public target: Entity | Scene | Engine | TileMap) {\n    super();\n  }\n}\n\n/**\n * The 'postdraw' event is emitted on actors, scenes, and engine after drawing finishes. Actors' postdraw happens inside their graphics\n * transform so that all drawing takes place with the actor as the origin.\n *\n */\nexport class PostDrawEvent extends GameEvent<Entity | Scene | Engine | TileMap> {\n  constructor(public ctx: CanvasRenderingContext2D, public delta: number, public target: Entity | Scene | Engine | TileMap) {\n    super();\n  }\n}\n\n/**\n * The 'predebugdraw' event is emitted on actors, scenes, and engine before debug drawing starts.\n */\nexport class PreDebugDrawEvent extends GameEvent<Entity | Actor | Scene | Engine> {\n  constructor(public ctx: CanvasRenderingContext2D, public target: Entity | Actor | Scene | Engine) {\n    super();\n  }\n}\n\n/**\n * The 'postdebugdraw' event is emitted on actors, scenes, and engine after debug drawing starts.\n */\nexport class PostDebugDrawEvent extends GameEvent<Entity | Actor | Scene | Engine> {\n  constructor(public ctx: CanvasRenderingContext2D, public target: Entity | Actor | Scene | Engine) {\n    super();\n  }\n}\n\n/**\n * The 'preupdate' event is emitted on actors, scenes, camera, and engine before the update starts.\n */\nexport class PreUpdateEvent<T extends OnPreUpdate = Entity> extends GameEvent<T> {\n  constructor(public engine: Engine, public delta: number, public target: T) {\n    super();\n  }\n}\n\n/**\n * The 'postupdate' event is emitted on actors, scenes, camera, and engine after the update ends.\n */\nexport class PostUpdateEvent<T extends OnPostUpdate = Entity> extends GameEvent<T> {\n  constructor(public engine: Engine, public delta: number, public target: T) {\n    super();\n  }\n}\n\n/**\n * The 'preframe' event is emitted on the engine, before the frame begins.\n */\nexport class PreFrameEvent extends GameEvent<Engine> {\n  constructor(public engine: Engine, public prevStats: FrameStats) {\n    super();\n    this.target = engine;\n  }\n}\n\n/**\n * The 'postframe' event is emitted on the engine, after a frame ends.\n */\nexport class PostFrameEvent extends GameEvent<Engine> {\n  constructor(public engine: Engine, public stats: FrameStats) {\n    super();\n    this.target = engine;\n  }\n}\n\n/**\n * Event received when a gamepad is connected to Excalibur. [[Gamepads]] receives this event.\n */\nexport class GamepadConnectEvent extends GameEvent<Input.Gamepad> {\n  constructor(public index: number, public gamepad: Input.Gamepad) {\n    super();\n    this.target = gamepad;\n  }\n}\n\n/**\n * Event received when a gamepad is disconnected from Excalibur. [[Gamepads]] receives this event.\n */\nexport class GamepadDisconnectEvent extends GameEvent<Input.Gamepad> {\n  constructor(public index: number, public gamepad: Input.Gamepad) {\n    super();\n    this.target = gamepad;\n  }\n}\n\n/**\n * Gamepad button event. See [[Gamepads]] for information on responding to controller input. [[Gamepad]] instances receive this event;\n */\nexport class GamepadButtonEvent extends GameEvent<Input.Gamepad> {\n  /**\n   * @param button  The Gamepad button\n   * @param value   A numeric value between 0 and 1\n   */\n  constructor(public button: Input.Buttons, public value: number, public target: Input.Gamepad) {\n    super();\n  }\n}\n\n/**\n * Gamepad axis event. See [[Gamepads]] for information on responding to controller input. [[Gamepad]] instances receive this event;\n */\nexport class GamepadAxisEvent extends GameEvent<Input.Gamepad> {\n  /**\n   * @param axis  The Gamepad axis\n   * @param value A numeric value between -1 and 1\n   */\n  constructor(public axis: Input.Axes, public value: number, public target: Input.Gamepad) {\n    super();\n  }\n}\n\n/**\n * Subscribe event thrown when handlers for events other than subscribe are added. Meta event that is received by\n * [[EventDispatcher|event dispatchers]].\n */\nexport class SubscribeEvent<T> extends GameEvent<T> {\n  constructor(public topic: string, public handler: (event: GameEvent<T>) => void) {\n    super();\n  }\n}\n\n/**\n * Unsubscribe event thrown when handlers for events other than unsubscribe are removed. Meta event that is received by\n * [[EventDispatcher|event dispatchers]].\n */\nexport class UnsubscribeEvent<T> extends GameEvent<T> {\n  constructor(public topic: string, public handler: (event: GameEvent<T>) => void) {\n    super();\n  }\n}\n\n/**\n * Event received by the [[Engine]] when the browser window is visible on a screen.\n */\nexport class VisibleEvent extends GameEvent<Engine> {\n  constructor(public target: Engine) {\n    super();\n  }\n}\n\n/**\n * Event received by the [[Engine]] when the browser window is hidden from all screens.\n */\nexport class HiddenEvent extends GameEvent<Engine> {\n  constructor(public target: Engine) {\n    super();\n  }\n}\n\n/**\n * Event thrown on an [[Actor|actor]] when a collision will occur this frame if it resolves\n */\nexport class PreCollisionEvent<T extends BodyComponent | Collider | Entity = Actor> extends GameEvent<T> {\n  /**\n   * @param actor         The actor the event was thrown on\n   * @param other         The actor that will collided with the current actor\n   * @param side          The side that will be collided with the current actor\n   * @param intersection  Intersection vector\n   */\n  constructor(actor: T, public other: T, public side: Side, public intersection: Vector) {\n    super();\n    this.target = actor;\n  }\n}\n\n/**\n * Event thrown on an [[Actor|actor]] when a collision has been resolved (body reacted) this frame\n */\nexport class PostCollisionEvent<T extends Collider | Entity = Actor> extends GameEvent<T> {\n  /**\n   * @param actor         The actor the event was thrown on\n   * @param other         The actor that did collide with the current actor\n   * @param side          The side that did collide with the current actor\n   * @param intersection  Intersection vector\n   */\n  constructor(actor: T, public other: T, public side: Side, public intersection: Vector) {\n    super();\n    this.target = actor;\n  }\n\n  public get actor() {\n    return this.target;\n  }\n\n  public set actor(actor: T) {\n    this.target = actor;\n  }\n}\n\nexport class ContactStartEvent<T> {\n  constructor(public target: T, public other: T, public contact: CollisionContact) {}\n}\n\nexport class ContactEndEvent<T> {\n  constructor(public target: T, public other: T) {}\n}\n\nexport class CollisionPreSolveEvent<T> {\n  constructor(public target: T, public other: T, public side: Side, public intersection: Vector, public contact: CollisionContact) {}\n}\n\nexport class CollisionPostSolveEvent<T> {\n  constructor(public target: T, public other: T, public side: Side, public intersection: Vector, public contact: CollisionContact) {}\n}\n\n/**\n * Event thrown the first time an [[Actor|actor]] collides with another, after an actor is in contact normal collision events are fired.\n */\nexport class CollisionStartEvent<T extends BodyComponent | Collider | Entity = Actor> extends GameEvent<T> {\n  /**\n   *\n   * @param actor\n   * @param other\n   * @param contact\n   */\n  constructor(actor: T, public other: T, public contact: CollisionContact) {\n    super();\n    this.target = actor;\n  }\n\n  public get actor() {\n    return this.target;\n  }\n\n  public set actor(actor: T) {\n    this.target = actor;\n  }\n}\n\n/**\n * Event thrown when the [[Actor|actor]] is no longer colliding with another\n */\nexport class CollisionEndEvent<T extends BodyComponent | Collider | Entity = Actor> extends GameEvent<T> {\n  /**\n   *\n   */\n  constructor(actor: T, public other: T) {\n    super();\n    this.target = actor;\n  }\n\n  public get actor() {\n    return this.target;\n  }\n\n  public set actor(actor: T) {\n    this.target = actor;\n  }\n}\n\n/**\n * Event thrown on an [[Actor]] and a [[Scene]] only once before the first update call\n */\nexport class InitializeEvent<T extends OnInitialize = Entity> extends GameEvent<T> {\n  /**\n   * @param engine  The reference to the current engine\n   */\n  constructor(public engine: Engine, public target: T) {\n    super();\n  }\n}\n\n/**\n * Event thrown on a [[Scene]] on activation\n */\nexport class ActivateEvent extends GameEvent<Scene> {\n  /**\n   * @param oldScene  The reference to the old scene\n   */\n  constructor(public oldScene: Scene, public target: Scene) {\n    super();\n  }\n}\n\n/**\n * Event thrown on a [[Scene]] on deactivation\n */\nexport class DeactivateEvent extends GameEvent<Scene> {\n  /**\n   * @param newScene  The reference to the new scene\n   */\n  constructor(public newScene: Scene, public target: Scene) {\n    super();\n  }\n}\n\n/**\n * Event thrown on an [[Actor]] when it completely leaves the screen.\n */\nexport class ExitViewPortEvent extends GameEvent<Entity> {\n  constructor(public target: Entity) {\n    super();\n  }\n}\n\n/**\n * Event thrown on an [[Actor]] when it completely leaves the screen.\n */\nexport class EnterViewPortEvent extends GameEvent<Entity> {\n  constructor(public target: Entity) {\n    super();\n  }\n}\n\nexport class EnterTriggerEvent extends GameEvent<Actor> {\n  constructor(public target: Trigger, public actor: Actor) {\n    super();\n  }\n}\n\nexport class ExitTriggerEvent extends GameEvent<Actor> {\n  constructor(public target: Trigger, public actor: Actor) {\n    super();\n  }\n}\n","import { obsolete } from './Util/Decorators';\r\n\r\n/**\r\n * Provides standard colors (e.g. [[Color.Black]])\r\n * but you can also create custom colors using RGB, HSL, or Hex. Also provides\r\n * useful color operations like [[Color.lighten]], [[Color.darken]], and more.\r\n */\r\nexport class Color {\r\n  /**\r\n   * Red channel\r\n   */\r\n  public r: number;\r\n  /**\r\n   * Green channel\r\n   */\r\n  public g: number;\r\n  /**\r\n   * Blue channel\r\n   */\r\n  public b: number;\r\n  /**\r\n   * Alpha channel (between 0 and 1)\r\n   */\r\n  public a: number;\r\n\r\n  /**\r\n   * Hue\r\n   */\r\n  public h: number;\r\n  /**\r\n   * Saturation\r\n   */\r\n  public s: number;\r\n  /**\r\n   * Lightness\r\n   */\r\n  public l: number;\r\n\r\n  /**\r\n   * Creates a new instance of Color from an r, g, b, a\r\n   *\r\n   * @param r  The red component of color (0-255)\r\n   * @param g  The green component of color (0-255)\r\n   * @param b  The blue component of color (0-255)\r\n   * @param a  The alpha component of color (0-1.0)\r\n   */\r\n  constructor(r: number, g: number, b: number, a?: number) {\r\n    this.r = r;\r\n    this.g = g;\r\n    this.b = b;\r\n    this.a = a != null ? a : 1;\r\n  }\r\n\r\n  /**\r\n   * Creates a new instance of Color from an r, g, b, a\r\n   *\r\n   * @param r  The red component of color (0-255)\r\n   * @param g  The green component of color (0-255)\r\n   * @param b  The blue component of color (0-255)\r\n   * @param a  The alpha component of color (0-1.0)\r\n   */\r\n  public static fromRGB(r: number, g: number, b: number, a?: number): Color {\r\n    return new Color(r, g, b, a);\r\n  }\r\n\r\n  /**\r\n   * Creates a new instance of Color from a rgb string\r\n   *\r\n   * @param string  CSS color string of the form rgba(255, 255, 255, 1) or rgb(255, 255, 255)\r\n   */\r\n  public static fromRGBString(string: string): Color {\r\n    const rgbaRegEx: RegExp = /^rgba?\\((\\d+),\\s*(\\d+),\\s*(\\d+)(?:,\\s*(\\d+(?:\\.\\d+)?))?\\)/i;\r\n    let match = null;\r\n    if ((match = string.match(rgbaRegEx))) {\r\n      const r = parseInt(match[1], 10);\r\n      const g = parseInt(match[2], 10);\r\n      const b = parseInt(match[3], 10);\r\n      let a = 1;\r\n      if (match[4]) {\r\n        a = parseFloat(match[4]);\r\n      }\r\n      return new Color(r, g, b, a);\r\n    } else {\r\n      throw new Error('Invalid rgb/a string: ' + string);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Creates a new instance of Color from a hex string\r\n   *\r\n   * @param hex  CSS color string of the form #ffffff, the alpha component is optional\r\n   */\r\n  public static fromHex(hex: string): Color {\r\n    const hexRegEx: RegExp = /^#?([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})?$/i;\r\n    let match = null;\r\n    if ((match = hex.match(hexRegEx))) {\r\n      const r = parseInt(match[1], 16);\r\n      const g = parseInt(match[2], 16);\r\n      const b = parseInt(match[3], 16);\r\n      let a = 1;\r\n      if (match[4]) {\r\n        a = parseInt(match[4], 16) / 255;\r\n      }\r\n      return new Color(r, g, b, a);\r\n    } else {\r\n      throw new Error('Invalid hex string: ' + hex);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Creates a new instance of Color from hsla values\r\n   *\r\n   * @param h  Hue is represented [0-1]\r\n   * @param s  Saturation is represented [0-1]\r\n   * @param l  Luminance is represented [0-1]\r\n   * @param a  Alpha is represented [0-1]\r\n   */\r\n  public static fromHSL(h: number, s: number, l: number, a: number = 1.0): Color {\r\n    const temp = new HSLColor(h, s, l, a);\r\n    return temp.toRGBA();\r\n  }\r\n\r\n  /**\r\n   * Lightens the current color by a specified amount\r\n   *\r\n   * @param factor  The amount to lighten by [0-1]\r\n   */\r\n  public lighten(factor: number = 0.1): Color {\r\n    const temp = HSLColor.fromRGBA(this.r, this.g, this.b, this.a);\r\n    temp.l += (1 - temp.l) * factor;\r\n    return temp.toRGBA();\r\n  }\r\n\r\n  /**\r\n   * Darkens the current color by a specified amount\r\n   *\r\n   * @param factor  The amount to darken by [0-1]\r\n   */\r\n  public darken(factor: number = 0.1): Color {\r\n    const temp = HSLColor.fromRGBA(this.r, this.g, this.b, this.a);\r\n    temp.l -= temp.l * factor;\r\n    return temp.toRGBA();\r\n  }\r\n\r\n  /**\r\n   * Saturates the current color by a specified amount\r\n   *\r\n   * @param factor  The amount to saturate by [0-1]\r\n   */\r\n  public saturate(factor: number = 0.1): Color {\r\n    const temp = HSLColor.fromRGBA(this.r, this.g, this.b, this.a);\r\n    temp.s += temp.s * factor;\r\n    return temp.toRGBA();\r\n  }\r\n\r\n  /**\r\n   * Desaturates the current color by a specified amount\r\n   *\r\n   * @param factor  The amount to desaturate by [0-1]\r\n   */\r\n  public desaturate(factor: number = 0.1): Color {\r\n    const temp = HSLColor.fromRGBA(this.r, this.g, this.b, this.a);\r\n    temp.s -= temp.s * factor;\r\n    return temp.toRGBA();\r\n  }\r\n\r\n  /**\r\n   * Multiplies a color by another, results in a darker color\r\n   *\r\n   * @param color  The other color\r\n   */\r\n  public multiply(color: Color): Color {\r\n    const newR = (((color.r / 255) * this.r) / 255) * 255;\r\n    const newG = (((color.g / 255) * this.g) / 255) * 255;\r\n    const newB = (((color.b / 255) * this.b) / 255) * 255;\r\n    const newA = color.a * this.a;\r\n    return new Color(newR, newG, newB, newA);\r\n  }\r\n\r\n  /**\r\n   * Multiplies a color by another, results in a darker color\r\n   * @param color\r\n   * @deprecated Alias for incorrect spelling used in older versions, use multiply instead, will be removed in v0.25.0\r\n   */\r\n  @obsolete({ message: 'Alias for incorrect spelling used in older versions, use multiply instead, will be removed in v0.25.0' })\r\n  public mulitiply(color: Color): Color {\r\n    return this.multiply(color);\r\n  }\r\n\r\n  /**\r\n   * Screens a color by another, results in a lighter color\r\n   *\r\n   * @param color  The other color\r\n   */\r\n  public screen(color: Color): Color {\r\n    const color1 = color.invert();\r\n    const color2 = color.invert();\r\n    return color1.multiply(color2).invert();\r\n  }\r\n\r\n  /**\r\n   * Inverts the current color\r\n   */\r\n  public invert(): Color {\r\n    return new Color(255 - this.r, 255 - this.g, 255 - this.b, 1.0 - this.a);\r\n  }\r\n\r\n  /**\r\n   * Averages the current color with another\r\n   *\r\n   * @param color  The other color\r\n   */\r\n  public average(color: Color): Color {\r\n    const newR = (color.r + this.r) / 2;\r\n    const newG = (color.g + this.g) / 2;\r\n    const newB = (color.b + this.b) / 2;\r\n    const newA = (color.a + this.a) / 2;\r\n    return new Color(newR, newG, newB, newA);\r\n  }\r\n\r\n  public equal(color: Color): boolean {\r\n    return this.toString() === color.toString();\r\n  }\r\n\r\n  /**\r\n   * Returns a CSS string representation of a color.\r\n   *\r\n   * @param format Color representation, accepts: rgb, hsl, or hex\r\n   */\r\n  public toString(format: 'rgb' | 'hsl' | 'hex' = 'rgb') {\r\n    switch (format) {\r\n      case 'rgb':\r\n        return this.toRGBA();\r\n      case 'hsl':\r\n        return this.toHSLA();\r\n      case 'hex':\r\n        return this.toHex();\r\n      default:\r\n        throw new Error('Invalid Color format');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns Hex Value of a color component\r\n   * @param c color component\r\n   * @see https://stackoverflow.com/questions/5623838/rgb-to-hex-and-hex-to-rgb\r\n   */\r\n  private _componentToHex(c: number) {\r\n    const hex = c.toString(16);\r\n    return hex.length === 1 ? '0' + hex : hex;\r\n  }\r\n\r\n  /**\r\n   * Return Hex representation of a color.\r\n   */\r\n  public toHex() {\r\n    return '#' + this._componentToHex(this.r) + this._componentToHex(this.g) + this._componentToHex(this.b);\r\n  }\r\n\r\n  /**\r\n   * Return RGBA representation of a color.\r\n   */\r\n  public toRGBA() {\r\n    const result = String(this.r.toFixed(0)) + ', ' + String(this.g.toFixed(0)) + ', ' + String(this.b.toFixed(0));\r\n    if (this.a !== undefined || this.a !== null) {\r\n      return 'rgba(' + result + ', ' + String(this.a) + ')';\r\n    }\r\n    return 'rgb(' + result + ')';\r\n  }\r\n\r\n  /**\r\n   * Return HSLA representation of a color.\r\n   */\r\n  public toHSLA() {\r\n    return HSLColor.fromRGBA(this.r, this.g, this.b, this.a).toString();\r\n  }\r\n\r\n  /**\r\n   * Returns a CSS string representation of a color.\r\n   */\r\n  public fillStyle() {\r\n    return this.toString();\r\n  }\r\n\r\n  /**\r\n   * Returns a clone of the current color.\r\n   */\r\n  public clone(): Color {\r\n    return new Color(this.r, this.g, this.b, this.a);\r\n  }\r\n\r\n  /**\r\n   * Black (#000000)\r\n   */\r\n  public static get Black(): Color {\r\n    return Color.fromHex('#000000');\r\n  }\r\n\r\n  /**\r\n   * White (#FFFFFF)\r\n   */\r\n  public static get White(): Color {\r\n    return Color.fromHex('#FFFFFF');\r\n  }\r\n\r\n  /**\r\n   * Gray (#808080)\r\n   */\r\n  public static get Gray(): Color {\r\n    return Color.fromHex('#808080');\r\n  }\r\n\r\n  /**\r\n   * Light gray (#D3D3D3)\r\n   */\r\n  public static get LightGray(): Color {\r\n    return Color.fromHex('#D3D3D3');\r\n  }\r\n\r\n  /**\r\n   * Dark gray (#A9A9A9)\r\n   */\r\n  public static get DarkGray(): Color {\r\n    return Color.fromHex('#A9A9A9');\r\n  }\r\n\r\n  /**\r\n   * Yellow (#FFFF00)\r\n   */\r\n  public static get Yellow(): Color {\r\n    return Color.fromHex('#FFFF00');\r\n  }\r\n\r\n  /**\r\n   * Orange (#FFA500)\r\n   */\r\n  public static get Orange(): Color {\r\n    return Color.fromHex('#FFA500');\r\n  }\r\n\r\n  /**\r\n   * Red (#FF0000)\r\n   */\r\n  public static get Red(): Color {\r\n    return Color.fromHex('#FF0000');\r\n  }\r\n\r\n  /**\r\n   * Vermilion (#FF5B31)\r\n   */\r\n  public static get Vermilion(): Color {\r\n    return Color.fromHex('#FF5B31');\r\n  }\r\n\r\n  /**\r\n   * Vermilion (#FF5B31)\r\n   * @deprecated Alias for incorrect spelling used in older versions, use multiply instead, will be removed in v0.25.0\r\n   */\r\n  @obsolete({\r\n    message: 'Alias for incorrect spelling used in older versions',\r\n    alternateMethod: 'Vermilion'\r\n  })\r\n  public static get Vermillion(): Color {\r\n    return Color.Vermilion;\r\n  }\r\n\r\n  /**\r\n   * Rose (#FF007F)\r\n   */\r\n  public static get Rose(): Color {\r\n    return Color.fromHex('#FF007F');\r\n  }\r\n\r\n  /**\r\n   * Magenta (#FF00FF)\r\n   */\r\n  public static get Magenta(): Color {\r\n    return Color.fromHex('#FF00FF');\r\n  }\r\n\r\n  /**\r\n   * Violet (#7F00FF)\r\n   */\r\n  public static get Violet(): Color {\r\n    return Color.fromHex('#7F00FF');\r\n  }\r\n\r\n  /**\r\n   * Blue (#0000FF)\r\n   */\r\n  public static get Blue(): Color {\r\n    return Color.fromHex('#0000FF');\r\n  }\r\n\r\n  /**\r\n   * Azure (#007FFF)\r\n   */\r\n  public static get Azure(): Color {\r\n    return Color.fromHex('#007FFF');\r\n  }\r\n\r\n  /**\r\n   * Cyan (#00FFFF)\r\n   */\r\n  public static get Cyan(): Color {\r\n    return Color.fromHex('#00FFFF');\r\n  }\r\n\r\n  /**\r\n   * Viridian (#59978F)\r\n   */\r\n  public static get Viridian(): Color {\r\n    return Color.fromHex('#59978F');\r\n  }\r\n\r\n  /**\r\n   * Green (#00FF00)\r\n   */\r\n  public static get Green(): Color {\r\n    return Color.fromHex('#00FF00');\r\n  }\r\n\r\n  /**\r\n   * Chartreuse (#7FFF00)\r\n   */\r\n  public static get Chartreuse(): Color {\r\n    return Color.fromHex('#7FFF00');\r\n  }\r\n\r\n  /**\r\n   * Transparent (#FFFFFF00)\r\n   */\r\n  public static get Transparent(): Color {\r\n    return Color.fromHex('#FFFFFF00');\r\n  }\r\n\r\n  /**\r\n   * ExcaliburBlue (#176BAA)\r\n   */\r\n  public static get ExcaliburBlue(): Color {\r\n    return Color.fromHex('#176BAA');\r\n  }\r\n}\r\n\r\n/**\r\n * Internal HSL Color representation\r\n *\r\n * http://en.wikipedia.org/wiki/HSL_and_HSV\r\n * http://axonflux.com/handy-rgb-to-hsl-and-rgb-to-hsv-color-model-c\r\n */\r\nclass HSLColor {\r\n  constructor(public h: number, public s: number, public l: number, public a: number) {}\r\n\r\n  public static hue2rgb(p: number, q: number, t: number): number {\r\n    if (t < 0) {\r\n      t += 1;\r\n    }\r\n    if (t > 1) {\r\n      t -= 1;\r\n    }\r\n    if (t < 1 / 6) {\r\n      return p + (q - p) * 6 * t;\r\n    }\r\n    if (t < 1 / 2) {\r\n      return q;\r\n    }\r\n    if (t < 2 / 3) {\r\n      return p + (q - p) * (2 / 3 - t) * 6;\r\n    }\r\n    return p;\r\n  }\r\n\r\n  public static fromRGBA(r: number, g: number, b: number, a: number): HSLColor {\r\n    r /= 255;\r\n    g /= 255;\r\n    b /= 255;\r\n    const max = Math.max(r, g, b),\r\n      min = Math.min(r, g, b);\r\n    let h, s;\r\n    const l = (max + min) / 2;\r\n\r\n    if (max === min) {\r\n      h = s = 0; // achromatic\r\n    } else {\r\n      const d = max - min;\r\n      s = l > 0.5 ? d / (2 - max - min) : d / (max + min);\r\n      switch (max) {\r\n        case r:\r\n          h = (g - b) / d + (g < b ? 6 : 0);\r\n          break;\r\n        case g:\r\n          h = (b - r) / d + 2;\r\n          break;\r\n        case b:\r\n          h = (r - g) / d + 4;\r\n          break;\r\n      }\r\n      h /= 6;\r\n    }\r\n\r\n    return new HSLColor(h, s, l, a);\r\n  }\r\n\r\n  public toRGBA(): Color {\r\n    let r: number, g: number, b: number;\r\n\r\n    if (this.s === 0) {\r\n      r = g = b = this.l; // achromatic\r\n    } else {\r\n      const q = this.l < 0.5 ? this.l * (1 + this.s) : this.l + this.s - this.l * this.s;\r\n      const p = 2 * this.l - q;\r\n      r = HSLColor.hue2rgb(p, q, this.h + 1 / 3);\r\n      g = HSLColor.hue2rgb(p, q, this.h);\r\n      b = HSLColor.hue2rgb(p, q, this.h - 1 / 3);\r\n    }\r\n\r\n    return new Color(r * 255, g * 255, b * 255, this.a);\r\n  }\r\n\r\n  public toString(): string {\r\n    const h = this.h.toFixed(0),\r\n      s = this.s.toFixed(0),\r\n      l = this.l.toFixed(0),\r\n      a = this.a.toFixed(0);\r\n    return `hsla(${h}, ${s}, ${l}, ${a})`;\r\n  }\r\n}\r\n","import { Vector } from '../Math/vector';\nimport { Ray } from '../Math/ray';\nimport { Color } from '../Color';\nimport { Side } from './Side';\nimport { ExcaliburGraphicsContext } from '../Graphics/Context/ExcaliburGraphicsContext';\nimport { Matrix } from '../Math/matrix';\n\nexport interface BoundingBoxOptions {\n  left: number;\n  right: number;\n  top: number;\n  bottom: number;\n}\n\n/**\n * Axis Aligned collision primitive for Excalibur.\n */\nexport class BoundingBox {\n  public top: number;\n  public right: number;\n  public bottom: number;\n  public left: number;\n\n  /**\n   * Constructor allows passing of either an object with all coordinate components,\n   * or the coordinate components passed separately.\n   * @param leftOrOptions    Either x coordinate of the left edge or an options object\n   * containing the four coordinate components.\n   * @param top     y coordinate of the top edge\n   * @param right   x coordinate of the right edge\n   * @param bottom  y coordinate of the bottom edge\n   */\n  constructor(leftOrOptions: number | BoundingBoxOptions = 0, top: number = 0, right: number = 0, bottom: number = 0) {\n    if (typeof leftOrOptions === 'object') {\n      this.left = leftOrOptions.left;\n      this.top = leftOrOptions.top;\n      this.right = leftOrOptions.right;\n      this.bottom = leftOrOptions.bottom;\n    } else if (typeof leftOrOptions === 'number') {\n      this.left = leftOrOptions;\n      this.top = top;\n      this.right = right;\n      this.bottom = bottom;\n    }\n  }\n\n  /**\n   * Given bounding box A & B, returns the side relative to A when intersection is performed.\n   * @param intersection Intersection vector between 2 bounding boxes\n   */\n  public static getSideFromIntersection(intersection: Vector): Side {\n    if (!intersection) {\n      return Side.None;\n    }\n    if (intersection) {\n      if (Math.abs(intersection.x) > Math.abs(intersection.y)) {\n        if (intersection.x < 0) {\n          return Side.Right;\n        }\n        return Side.Left;\n      } else {\n        if (intersection.y < 0) {\n          return Side.Bottom;\n        }\n        return Side.Top;\n      }\n    }\n    return Side.None;\n  }\n\n  public static fromPoints(points: Vector[]): BoundingBox {\n    let minX = Infinity;\n    let minY = Infinity;\n    let maxX = -Infinity;\n    let maxY = -Infinity;\n    for (let i = 0; i < points.length; i++) {\n      if (points[i].x < minX) {\n        minX = points[i].x;\n      }\n      if (points[i].x > maxX) {\n        maxX = points[i].x;\n      }\n      if (points[i].y < minY) {\n        minY = points[i].y;\n      }\n      if (points[i].y > maxY) {\n        maxY = points[i].y;\n      }\n    }\n    return new BoundingBox(minX, minY, maxX, maxY);\n  }\n\n  public static fromDimension(width: number, height: number, anchor: Vector = Vector.Half, pos: Vector = Vector.Zero) {\n    return new BoundingBox(\n      -width * anchor.x + pos.x,\n      -height * anchor.y + pos.y,\n      width - width * anchor.x + pos.x,\n      height - height * anchor.y + pos.y\n    );\n  }\n\n  /**\n   * Returns the calculated width of the bounding box\n   */\n  public get width() {\n    return this.right - this.left;\n  }\n\n  /**\n   * Returns the calculated height of the bounding box\n   */\n  public get height() {\n    return this.bottom - this.top;\n  }\n\n  /**\n   * Return whether the bounding box has zero dimensions in height,width or both\n   */\n  public hasZeroDimensions() {\n    return this.width === 0 || this.height === 0;\n  }\n\n  /**\n   * Returns the center of the bounding box\n   */\n  public get center(): Vector {\n    return new Vector((this.left + this.right) / 2, (this.top + this.bottom) / 2);\n  }\n\n  public translate(pos: Vector): BoundingBox {\n    return new BoundingBox(this.left + pos.x, this.top + pos.y, this.right + pos.x, this.bottom + pos.y);\n  }\n\n  /**\n   * Rotates a bounding box by and angle and around a point, if no point is specified (0, 0) is used by default. The resulting bounding\n   * box is also axis-align. This is useful when a new axis-aligned bounding box is needed for rotated geometry.\n   */\n  public rotate(angle: number, point: Vector = Vector.Zero): BoundingBox {\n    const points = this.getPoints().map((p) => p.rotate(angle, point));\n    return BoundingBox.fromPoints(points);\n  }\n\n  public scale(scale: Vector, point: Vector = Vector.Zero): BoundingBox {\n    const shifted = this.translate(point);\n    return new BoundingBox(shifted.left * scale.x, shifted.top * scale.y, shifted.right * scale.x, shifted.bottom * scale.y);\n  }\n\n  public transform(matrix: Matrix) {\n    const points = this.getPoints().map((p) => matrix.multv(p));\n    return BoundingBox.fromPoints(points);\n  }\n\n  /**\n   * Returns the perimeter of the bounding box\n   */\n  public getPerimeter(): number {\n    const wx = this.width;\n    const wy = this.height;\n    return 2 * (wx + wy);\n  }\n\n  public getPoints(): Vector[] {\n    const results = [];\n    results.push(new Vector(this.left, this.top));\n    results.push(new Vector(this.right, this.top));\n    results.push(new Vector(this.right, this.bottom));\n    results.push(new Vector(this.left, this.bottom));\n    return results;\n  }\n\n  /**\n   * Determines whether a ray intersects with a bounding box\n   */\n  public rayCast(ray: Ray, farClipDistance = Infinity): boolean {\n    // algorithm from https://tavianator.com/fast-branchless-raybounding-box-intersections/\n    let tmin = -Infinity;\n    let tmax = +Infinity;\n\n    const xinv = ray.dir.x === 0 ? Number.MAX_VALUE : 1 / ray.dir.x;\n    const yinv = ray.dir.y === 0 ? Number.MAX_VALUE : 1 / ray.dir.y;\n\n    const tx1 = (this.left - ray.pos.x) * xinv;\n    const tx2 = (this.right - ray.pos.x) * xinv;\n    tmin = Math.min(tx1, tx2);\n    tmax = Math.max(tx1, tx2);\n\n    const ty1 = (this.top - ray.pos.y) * yinv;\n    const ty2 = (this.bottom - ray.pos.y) * yinv;\n    tmin = Math.max(tmin, Math.min(ty1, ty2));\n    tmax = Math.min(tmax, Math.max(ty1, ty2));\n\n    return tmax >= Math.max(0, tmin) && tmin < farClipDistance;\n  }\n\n  public rayCastTime(ray: Ray, farClipDistance = Infinity): number {\n    // algorithm from https://tavianator.com/fast-branchless-raybounding-box-intersections/\n    let tmin = -Infinity;\n    let tmax = +Infinity;\n\n    const xinv = ray.dir.x === 0 ? Number.MAX_VALUE : 1 / ray.dir.x;\n    const yinv = ray.dir.y === 0 ? Number.MAX_VALUE : 1 / ray.dir.y;\n\n    const tx1 = (this.left - ray.pos.x) * xinv;\n    const tx2 = (this.right - ray.pos.x) * xinv;\n    tmin = Math.min(tx1, tx2);\n    tmax = Math.max(tx1, tx2);\n\n    const ty1 = (this.top - ray.pos.y) * yinv;\n    const ty2 = (this.bottom - ray.pos.y) * yinv;\n    tmin = Math.max(tmin, Math.min(ty1, ty2));\n    tmax = Math.min(tmax, Math.max(ty1, ty2));\n\n    if (tmax >= Math.max(0, tmin) && tmin < farClipDistance) {\n      return tmin;\n    }\n    return -1;\n  }\n\n  /**\n   * Tests whether a point is contained within the bounding box\n   * @param p  The point to test\n   */\n  public contains(p: Vector): boolean;\n\n  /**\n   * Tests whether another bounding box is totally contained in this one\n   * @param bb  The bounding box to test\n   */\n  public contains(bb: BoundingBox): boolean;\n  public contains(val: any): boolean {\n    if (val instanceof Vector) {\n      return this.left <= val.x && this.top <= val.y && this.bottom >= val.y && this.right >= val.x;\n    } else if (val instanceof BoundingBox) {\n      if (this.left < val.left && this.top < val.top && val.bottom < this.bottom && val.right < this.right) {\n        return true;\n      }\n      return false;\n    }\n    return false;\n  }\n\n  /**\n   * Combines this bounding box and another together returning a new bounding box\n   * @param other  The bounding box to combine\n   */\n  public combine(other: BoundingBox): BoundingBox {\n    const compositeBB = new BoundingBox(\n      Math.min(this.left, other.left),\n      Math.min(this.top, other.top),\n      Math.max(this.right, other.right),\n      Math.max(this.bottom, other.bottom)\n    );\n    return compositeBB;\n  }\n\n  public get dimensions(): Vector {\n    return new Vector(this.width, this.height);\n  }\n\n  /**\n   * Test wether this bounding box intersects with another returning\n   * the intersection vector that can be used to resolve the collision. If there\n   * is no intersection null is returned.\n   *\n   * @param other  Other [[BoundingBox]] to test intersection with\n   * @returns A Vector in the direction of the current BoundingBox, this <- other\n   */\n  public intersect(other: BoundingBox): Vector {\n    const totalBoundingBox = this.combine(other);\n\n    // If the total bounding box is less than or equal the sum of the 2 bounds then there is collision\n    if (\n      totalBoundingBox.width < other.width + this.width &&\n      totalBoundingBox.height < other.height + this.height &&\n      !totalBoundingBox.dimensions.equals(other.dimensions) &&\n      !totalBoundingBox.dimensions.equals(this.dimensions)\n    ) {\n      // collision\n      let overlapX = 0;\n      // right edge is between the other's left and right edge\n      /**\n       *     +-this-+\n       *     |      |\n       *     |    +-other-+\n       *     +----|-+     |\n       *          |       |\n       *          +-------+\n       *         <---\n       *          ^ overlap\n       */\n      if (this.right >= other.left && this.right <= other.right) {\n        overlapX = other.left - this.right;\n        // right edge is past the other's right edge\n        /**\n         *     +-other-+\n         *     |       |\n         *     |    +-this-+\n         *     +----|--+   |\n         *          |      |\n         *          +------+\n         *          --->\n         *          ^ overlap\n         */\n      } else {\n        overlapX = other.right - this.left;\n      }\n\n      let overlapY = 0;\n      // top edge is between the other's top and bottom edge\n      /**\n       *     +-other-+\n       *     |       |\n       *     |    +-this-+   | <- overlap\n       *     +----|--+   |   |\n       *          |      |  \\ /\n       *          +------+   '\n       */\n      if (this.top <= other.bottom && this.top >= other.top) {\n        overlapY = other.bottom - this.top;\n        // top edge is above the other top edge\n        /**\n         *     +-this-+         .\n         *     |      |        / \\\n         *     |    +-other-+   | <- overlap\n         *     +----|-+     |   |\n         *          |       |\n         *          +-------+\n         */\n      } else {\n        overlapY = other.top - this.bottom;\n      }\n\n      if (Math.abs(overlapX) < Math.abs(overlapY)) {\n        return new Vector(overlapX, 0);\n      } else {\n        return new Vector(0, overlapY);\n      }\n      // Case of total containment of one bounding box by another\n    } else if (totalBoundingBox.dimensions.equals(other.dimensions) || totalBoundingBox.dimensions.equals(this.dimensions)) {\n      let overlapX = 0;\n      // this is wider than the other\n      if (this.width - other.width >= 0) {\n        // This right edge is closest to the others right edge\n        if (this.right - other.right <= other.left - this.left) {\n          overlapX = other.left - this.right;\n          // This left edge is closest to the others left edge\n        } else {\n          overlapX = other.right - this.left;\n        }\n        // other is wider than this\n      } else {\n        // This right edge is closest to the others right edge\n        if (other.right - this.right <= this.left - other.left) {\n          overlapX = this.left - other.right;\n          // This left edge is closest to the others left edge\n        } else {\n          overlapX = this.right - other.left;\n        }\n      }\n\n      let overlapY = 0;\n      // this is taller than other\n      if (this.height - other.height >= 0) {\n        // The bottom edge is closest to the others bottom edge\n        if (this.bottom - other.bottom <= other.top - this.top) {\n          overlapY = other.top - this.bottom;\n        } else {\n          overlapY = other.bottom - this.top;\n        }\n        // other is taller than this\n      } else {\n        // The bottom edge is closest to the others bottom edge\n        if (other.bottom - this.bottom <= this.top - other.top) {\n          overlapY = this.top - other.bottom;\n        } else {\n          overlapY = this.bottom - other.top;\n        }\n      }\n\n      if (Math.abs(overlapX) < Math.abs(overlapY)) {\n        return new Vector(overlapX, 0);\n      } else {\n        return new Vector(0, overlapY);\n      }\n    } else {\n      return null;\n    }\n  }\n\n  /**\n   * Test whether the bounding box has intersected with another bounding box, returns the side of the current bb that intersected.\n   * @param bb The other actor to test\n   */\n  public intersectWithSide(bb: BoundingBox): Side {\n    const intersect = this.intersect(bb);\n    return BoundingBox.getSideFromIntersection(intersect);\n  }\n\n  /* istanbul ignore next */\n  public debugDraw(ctx: CanvasRenderingContext2D, color: Color = Color.Yellow) {\n    ctx.strokeStyle = color.toString();\n    ctx.strokeRect(this.left, this.top, this.width, this.height);\n  }\n\n  /**\n   * Draw a debug bounding box\n   * @param ex\n   * @param color\n   */\n  public draw(ex: ExcaliburGraphicsContext, color: Color = Color.Yellow) {\n    ex.debug.drawRect(this.left, this.top, this.width, this.height, { color });\n  }\n}\n","/**\r\n * Internal class used to build instances of AudioContext\r\n */\r\n/* istanbul ignore next */\r\nexport class AudioContextFactory {\r\n  private static _INSTANCE: AudioContext = null;\r\n\r\n  public static create(): AudioContext {\r\n    if (!this._INSTANCE) {\r\n      if ((<any>window).AudioContext || (<any>window).webkitAudioContext) {\r\n        this._INSTANCE = new AudioContext();\r\n      }\r\n    }\r\n\r\n    return this._INSTANCE;\r\n  }\r\n}\r\n","import { AudioContextFactory } from '../Resources/Sound/AudioContext';\r\nimport { Logger } from './Log';\r\n\r\nexport interface LegacyWebAudioSource {\r\n  playbackState: string;\r\n  PLAYING_STATE: 'playing';\r\n  FINISHED_STATE: 'finished';\r\n}\r\n\r\n/**\r\n * Patch for detecting legacy web audio in browsers\r\n * @internal\r\n * @param source\r\n */\r\nfunction isLegacyWebAudioSource(source: any): source is LegacyWebAudioSource {\r\n  return !!source.playbackState;\r\n}\r\n\r\nexport class WebAudio {\r\n  private static _UNLOCKED: boolean = false;\r\n\r\n  /**\r\n   * Play an empty sound to unlock Safari WebAudio context. Call this function\r\n   * right after a user interaction event.\r\n   * @source https://paulbakaus.com/tutorials/html5/web-audio-on-ios/\r\n   */\r\n  static unlock(): Promise<boolean> {\r\n    const promise = new Promise<boolean>((resolve, reject) => {\r\n      if (WebAudio._UNLOCKED || !AudioContextFactory.create()) {\r\n        return resolve(true);\r\n      }\r\n      const unlockTimeoutTimer = setTimeout(() => {\r\n        Logger.getInstance().warn('Excalibur was unable to unlock the audio context, audio probably will not play in this browser.');\r\n        resolve(false);\r\n      }, 200);\r\n\r\n      const audioContext = AudioContextFactory.create();\r\n      audioContext.resume().then(\r\n        () => {\r\n          // create empty buffer and play it\r\n          const buffer = audioContext.createBuffer(1, 1, 22050);\r\n          const source = audioContext.createBufferSource();\r\n          let ended = false;\r\n\r\n          source.buffer = buffer;\r\n          source.connect(audioContext.destination);\r\n          source.onended = () => (ended = true);\r\n\r\n          source.start(0);\r\n\r\n          // by checking the play state after some time, we know if we're really unlocked\r\n          setTimeout(() => {\r\n            if (isLegacyWebAudioSource(source)) {\r\n              if (source.playbackState === source.PLAYING_STATE || source.playbackState === source.FINISHED_STATE) {\r\n                WebAudio._UNLOCKED = true;\r\n              }\r\n            } else {\r\n              if (audioContext.currentTime > 0 || ended) {\r\n                WebAudio._UNLOCKED = true;\r\n              }\r\n            }\r\n          }, 0);\r\n\r\n          clearTimeout(unlockTimeoutTimer);\r\n          resolve(true);\r\n        },\r\n        () => {\r\n          reject();\r\n        }\r\n      );\r\n    });\r\n\r\n\r\n    return promise;\r\n  }\r\n\r\n  static isUnlocked() {\r\n    return this._UNLOCKED;\r\n  }\r\n}\r\n","import { GameEvent, SubscribeEvent, UnsubscribeEvent } from './Events';\r\nimport { Eventable } from './Interfaces/Evented';\r\n\r\nexport class EventDispatcher<T = any> implements Eventable {\r\n  private _handlers: { [key: string]: { (event: GameEvent<T>): void }[] } = {};\r\n  private _wiredEventDispatchers: Eventable[] = [];\r\n\r\n  private _target: T;\r\n\r\n  /**\r\n   * @param target  The object that will be the recipient of events from this event dispatcher\r\n   */\r\n  constructor(target: T) {\r\n    this._target = target;\r\n  }\r\n\r\n  /**\r\n   * Clears any existing handlers or wired event dispatchers on this event dispatcher\r\n   */\r\n  public clear() {\r\n    this._handlers = {};\r\n    this._wiredEventDispatchers = [];\r\n  }\r\n\r\n  /**\r\n   * Emits an event for target\r\n   * @param eventName  The name of the event to publish\r\n   * @param event      Optionally pass an event data object to the handler\r\n   */\r\n  public emit(eventName: string, event: GameEvent<T>) {\r\n    if (!eventName) {\r\n      // key not mapped\r\n      return;\r\n    }\r\n    eventName = eventName.toLowerCase();\r\n    const target = this._target;\r\n    if (!event) {\r\n      event = new GameEvent();\r\n    }\r\n    try {\r\n      if (!event.target) {\r\n        event.target = target;\r\n      }\r\n    } catch {\r\n      // pass\r\n    }\r\n    let i: number, len: number;\r\n\r\n    if (this._handlers[eventName]) {\r\n      i = 0;\r\n      len = this._handlers[eventName].length;\r\n\r\n      for (i; i < len; i++) {\r\n        this._handlers[eventName][i].call(target, event);\r\n      }\r\n    }\r\n\r\n    i = 0;\r\n    len = this._wiredEventDispatchers.length;\r\n\r\n    for (i; i < len; i++) {\r\n      this._wiredEventDispatchers[i].emit(eventName, event);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Subscribe an event handler to a particular event name, multiple handlers per event name are allowed.\r\n   * @param eventName  The name of the event to subscribe to\r\n   * @param handler    The handler callback to fire on this event\r\n   */\r\n  public on(eventName: string, handler: (event: GameEvent<T>) => void) {\r\n    eventName = eventName.toLowerCase();\r\n    if (!this._handlers[eventName]) {\r\n      this._handlers[eventName] = [];\r\n    }\r\n    this._handlers[eventName].push(handler);\r\n\r\n    // meta event handlers\r\n    if (eventName !== 'unsubscribe' && eventName !== 'subscribe') {\r\n      this.emit('subscribe', new SubscribeEvent(eventName, handler));\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Unsubscribe an event handler(s) from an event. If a specific handler\r\n   * is specified for an event, only that handler will be unsubscribed.\r\n   * Otherwise all handlers will be unsubscribed for that event.\r\n   *\r\n   * @param eventName  The name of the event to unsubscribe\r\n   * @param handler    Optionally the specific handler to unsubscribe\r\n   */\r\n  public off(eventName: string, handler?: (event: GameEvent<T>) => void) {\r\n    eventName = eventName.toLowerCase();\r\n    const eventHandlers = this._handlers[eventName];\r\n\r\n    if (eventHandlers) {\r\n      // if no explicit handler is give with the event name clear all handlers\r\n      if (!handler) {\r\n        this._handlers[eventName].length = 0;\r\n      } else {\r\n        const index = eventHandlers.indexOf(handler);\r\n        this._handlers[eventName].splice(index, 1);\r\n      }\r\n    }\r\n    // meta event handlers\r\n    if (eventName !== 'unsubscribe' && eventName !== 'subscribe') {\r\n      this.emit('unsubscribe', new UnsubscribeEvent(eventName, handler));\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Once listens to an event one time, then unsubscribes from that event\r\n   *\r\n   * @param eventName The name of the event to subscribe to once\r\n   * @param handler   The handler of the event that will be auto unsubscribed\r\n   */\r\n  public once(eventName: string, handler: (event: GameEvent<T>) => void) {\r\n    const metaHandler = (event: GameEvent<T>) => {\r\n      const ev = event || new GameEvent();\r\n      try {\r\n        ev.target = ev.target || this._target;\r\n      } catch {\r\n        // pass\r\n      }\r\n\r\n      this.off(eventName, handler);\r\n      handler.call(ev.target, ev);\r\n    };\r\n\r\n    this.on(eventName, metaHandler);\r\n  }\r\n\r\n  /**\r\n   * Wires this event dispatcher to also receive events from another\r\n   */\r\n  public wire(eventDispatcher: EventDispatcher): void {\r\n    eventDispatcher._wiredEventDispatchers.push(this);\r\n  }\r\n\r\n  /**\r\n   * Unwires this event dispatcher from another\r\n   */\r\n  public unwire(eventDispatcher: EventDispatcher): void {\r\n    const index = eventDispatcher._wiredEventDispatchers.indexOf(this);\r\n    if (index > -1) {\r\n      eventDispatcher._wiredEventDispatchers.splice(index, 1);\r\n    }\r\n  }\r\n}\r\n","import { GameEvent } from './Events';\r\nimport { EventDispatcher } from './EventDispatcher';\r\nimport { Eventable } from './Interfaces/Evented';\r\n\r\n/**\r\n * Excalibur base class that provides basic functionality such as [[EventDispatcher]]\r\n * and extending abilities for vanilla Javascript projects\r\n */\r\nexport class Class implements Eventable {\r\n  /**\r\n   * Direct access to the game object event dispatcher.\r\n   */\r\n  public eventDispatcher: EventDispatcher;\r\n\r\n  constructor() {\r\n    this.eventDispatcher = new EventDispatcher(this);\r\n  }\r\n\r\n  /**\r\n   * Alias for `addEventListener`. You can listen for a variety of\r\n   * events off of the engine; see the events section below for a complete list.\r\n   * @param eventName  Name of the event to listen for\r\n   * @param handler    Event handler for the thrown event\r\n   */\r\n  public on(eventName: string, handler: (event: GameEvent<any>) => void) {\r\n    this.eventDispatcher.on(eventName, handler);\r\n  }\r\n\r\n  /**\r\n   * Alias for `removeEventListener`. If only the eventName is specified\r\n   * it will remove all handlers registered for that specific event. If the eventName\r\n   * and the handler instance are specified only that handler will be removed.\r\n   *\r\n   * @param eventName  Name of the event to listen for\r\n   * @param handler    Event handler for the thrown event\r\n   */\r\n  public off(eventName: string, handler?: (event: GameEvent<any>) => void) {\r\n    this.eventDispatcher.off(eventName, handler);\r\n  }\r\n\r\n  /**\r\n   * Emits a new event\r\n   * @param eventName   Name of the event to emit\r\n   * @param eventObject Data associated with this event\r\n   */\r\n  public emit(eventName: string, eventObject: GameEvent<any>) {\r\n    this.eventDispatcher.emit(eventName, eventObject);\r\n  }\r\n\r\n  /**\r\n   * Once listens to an event one time, then unsubscribes from that event\r\n   *\r\n   * @param eventName The name of the event to subscribe to once\r\n   * @param handler   The handler of the event that will be auto unsubscribed\r\n   */\r\n  public once(eventName: string, handler: (event: GameEvent<any>) => void) {\r\n    this.eventDispatcher.once(eventName, handler);\r\n  }\r\n}\r\n","import { Color } from '../Color';\nimport { Vector } from '../Math/vector';\n\n/**\n * A canvas linecap style. \"butt\" is the default flush style, \"round\" is a semi-circle cap with a radius half the width of\n * the line, and \"square\" is a rectangle that is an equal width and half height cap.\n */\nexport type LineCapStyle = 'butt' | 'round' | 'square';\n\n/* istanbul ignore next */\n/**\n * Draw a line on canvas context\n *\n * @param ctx The canvas context\n * @param color The color of the line\n * @param x1 The start x coordinate\n * @param y1 The start y coordinate\n * @param x2 The ending x coordinate\n * @param y2 The ending y coordinate\n * @param thickness The line thickness\n * @param cap The [[LineCapStyle]] (butt, round, or square)\n */\nexport function line(\n  ctx: CanvasRenderingContext2D,\n  color: Color = Color.Red,\n  x1: number,\n  y1: number,\n  x2: number,\n  y2: number,\n  thickness: number = 1,\n  cap: LineCapStyle = 'butt'\n) {\n  ctx.beginPath();\n  ctx.lineWidth = thickness;\n  ctx.lineCap = cap;\n  ctx.strokeStyle = color.toString();\n  ctx.moveTo(x1, y1);\n  ctx.lineTo(x2, y2);\n  ctx.closePath();\n  ctx.stroke();\n}\n\n/* istanbul ignore next */\n/**\n * Draw the vector as a point onto the canvas.\n */\nexport function point(ctx: CanvasRenderingContext2D, color: Color = Color.Red, point: Vector): void {\n  ctx.beginPath();\n  ctx.strokeStyle = color.toString();\n  ctx.arc(point.x, point.y, 5, 0, Math.PI * 2);\n  ctx.closePath();\n  ctx.stroke();\n}\n\n/**\n * Draw the vector as a line onto the canvas starting a origin point.\n */\n/* istanbul ignore next */\n/**\n *\n */\nexport function vector(ctx: CanvasRenderingContext2D, color: Color, origin: Vector, vector: Vector, scale: number = 1.0): void {\n  const c = color ? color.toString() : 'blue';\n  const v = vector.scale(scale);\n  ctx.beginPath();\n  ctx.strokeStyle = c;\n  ctx.moveTo(origin.x, origin.y);\n  ctx.lineTo(origin.x + v.x, origin.y + v.y);\n  ctx.closePath();\n  ctx.stroke();\n}\n\n/**\n * Represents border radius values\n */\nexport interface BorderRadius {\n  /**\n   * Top-left\n   */\n  tl: number;\n  /**\n   * Top-right\n   */\n  tr: number;\n  /**\n   * Bottom-right\n   */\n  br: number;\n  /**\n   * Bottom-left\n   */\n  bl: number;\n}\n\n/**\n * Draw a round rectangle on a canvas context\n *\n * @param ctx The canvas context\n * @param x The top-left x coordinate\n * @param y The top-left y coordinate\n * @param width The width of the rectangle\n * @param height The height of the rectangle\n * @param radius The border radius of the rectangle\n * @param stroke The [[Color]] to stroke rectangle with\n * @param fill The [[Color]] to fill rectangle with\n */\nexport function roundRect(\n  ctx: CanvasRenderingContext2D,\n  x: number,\n  y: number,\n  width: number,\n  height: number,\n  radius: number | BorderRadius = 5,\n  stroke: Color = Color.White,\n  fill: Color = null\n) {\n  let br: BorderRadius;\n\n  if (typeof radius === 'number') {\n    br = { tl: radius, tr: radius, br: radius, bl: radius };\n  } else {\n    const defaultRadius: BorderRadius = { tl: 0, tr: 0, br: 0, bl: 0 };\n\n    for (const prop in defaultRadius) {\n      if (defaultRadius.hasOwnProperty(prop)) {\n        const side = <keyof BorderRadius>prop;\n        br[side] = radius[side] || defaultRadius[side];\n      }\n    }\n  }\n\n  ctx.beginPath();\n  ctx.moveTo(x + br.tl, y);\n  ctx.lineTo(x + width - br.tr, y);\n  ctx.quadraticCurveTo(x + width, y, x + width, y + br.tr);\n  ctx.lineTo(x + width, y + height - br.br);\n  ctx.quadraticCurveTo(x + width, y + height, x + width - br.br, y + height);\n  ctx.lineTo(x + br.bl, y + height);\n  ctx.quadraticCurveTo(x, y + height, x, y + height - br.bl);\n  ctx.lineTo(x, y + br.tl);\n  ctx.quadraticCurveTo(x, y, x + br.tl, y);\n  ctx.closePath();\n\n  if (fill) {\n    ctx.fillStyle = fill.toString();\n    ctx.fill();\n  }\n\n  if (stroke) {\n    ctx.strokeStyle = stroke.toString();\n    ctx.stroke();\n  }\n}\n\n/**\n *\n */\nexport function circle(\n  ctx: CanvasRenderingContext2D,\n  x: number,\n  y: number,\n  radius: number,\n  stroke: Color = Color.White,\n  fill: Color = null\n) {\n  ctx.beginPath();\n  ctx.arc(x, y, radius, 0, Math.PI * 2);\n  ctx.closePath();\n\n  if (fill) {\n    ctx.fillStyle = fill.toString();\n    ctx.fill();\n  }\n\n  if (stroke) {\n    ctx.strokeStyle = stroke.toString();\n    ctx.stroke();\n  }\n}\n","import { Vector, vec } from '../Math/vector';\nimport { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\nimport { BoundingBox } from '../Collision/BoundingBox';\n\nexport interface GraphicOptions {\n  /**\n   * The width of the graphic\n   */\n  width?: number;\n  /**\n   * The height of the graphic\n   */\n  height?: number;\n  /**\n   * SHould the graphic be flipped horizontally\n   */\n  flipHorizontal?: boolean;\n  /**\n   * Should the graphic be flipped vertically\n   */\n  flipVertical?: boolean;\n  /**\n   * The rotation of the graphic\n   */\n  rotation?: number;\n  /**\n   * The scale of the graphic\n   */\n  scale?: Vector;\n  /**\n   * The opacity of the graphic\n   */\n  opacity?: number;\n  /**\n   * The origin of the drawing in pixels to use when applying transforms, by default it will be the center of the image\n   */\n  origin?: Vector;\n}\n\n/**\n * A Graphic is the base Excalibur primitive for something that can be drawn to the [[ExcaliburGraphicsContext]].\n * [[Sprite]], [[Animation]], [[GraphicsGroup]], [[Canvas]], [[Rectangle]], [[Circle]], and [[Polygon]] all derive from the\n * [[Graphic]] abstract class.\n *\n * Implementors of a Graphic must override the abstract [[Graphic._drawImage]] method to render an image to the graphics context. Graphic\n * handles all the position, rotation, and scale transformations in [[Graphic._preDraw]] and [[Graphic._postDraw]]\n */\nexport abstract class Graphic {\n  private static _ID: number = 0;\n  readonly id = Graphic._ID++;\n\n  /**\n   * Gets or sets wether to show debug information about the graphic\n   */\n  public showDebug: boolean = false;\n\n  /**\n   * Gets or sets the flipHorizontal, which will flip the graphic horizontally (across the y axis)\n   */\n  public flipHorizontal: boolean = false;\n\n  /**\n   * Gets or sets the flipVertical, which will flip the graphic vertically (across the x axis)\n   */\n  public flipVertical: boolean = false;\n\n  /**\n   * Gets or sets the rotation of the graphic\n   */\n  public rotation: number = 0;\n\n  /**\n   * Gets or sets the opacity of the graphic, 0 is transparent, 1 is solid (opaque).\n   */\n  public opacity: number = 1;\n\n  /**\n   * Gets or sets the scale of the graphic, this affects the width and\n   */\n  public scale = Vector.One;\n\n  /**\n   * Gets or sets the origin of the graphic, if not set the center of the graphic is the origin\n   */\n  public origin: Vector | null = null;\n\n  constructor(options?: GraphicOptions) {\n    if (options) {\n      this.origin = options.origin ?? this.origin;\n      this.flipHorizontal = options.flipHorizontal ?? this.flipHorizontal;\n      this.flipVertical = options.flipVertical ?? this.flipVertical;\n      this.rotation = options.rotation ?? this.rotation;\n      this.opacity = options.opacity ?? this.opacity;\n      this.scale = options.scale ?? this.scale;\n    }\n  }\n\n  public cloneGraphicOptions(): GraphicOptions {\n    return {\n      origin: this.origin ? this.origin.clone() : null,\n      flipHorizontal: this.flipHorizontal,\n      flipVertical: this.flipVertical,\n      rotation: this.rotation,\n      opacity: this.opacity,\n      scale: this.scale ? this.scale.clone() : null\n    };\n  }\n\n  private _width: number = 0;\n\n  /**\n   * Gets or sets the width of the graphic (always positive)\n   */\n  public get width() {\n    return Math.abs(this._width * this.scale.x);\n  }\n\n  private _height: number = 0;\n\n  /**\n   * Gets or sets the height of the graphic (always positive)\n   */\n  public get height() {\n    return Math.abs(this._height * this.scale.y);\n  }\n\n  public set width(value: number) {\n    this._width = value;\n  }\n\n  public set height(value: number) {\n    this._height = value;\n  }\n\n  /**\n   * Gets a copy of the bounds in pixels occupied by the graphic on the the screen. This includes scale.\n   */\n  public get localBounds(): BoundingBox {\n    return BoundingBox.fromDimension(this.width, this.height, Vector.Zero);\n  }\n\n  /**\n   * Draw the whole graphic to the context including transform\n   * @param ex The excalibur graphics context\n   * @param x\n   * @param y\n   */\n  public draw(ex: ExcaliburGraphicsContext, x: number, y: number): void {\n    this._preDraw(ex, x, y);\n    this._drawImage(ex, 0, 0);\n    this._postDraw(ex);\n  }\n\n  /**\n   * Meant to be overriden by the graphic implementation to draw the underlying image (HTMLCanvasElement or HTMLImageElement)\n   * to the graphics context without transform. Transformations like position, rotation, and scale are handled by [[Graphic._preDraw]]\n   * and [[Graphic._postDraw]]\n   * @param ex The excalibur graphics context\n   * @param x\n   * @param y\n   */\n  protected abstract _drawImage(ex: ExcaliburGraphicsContext, x: number, y: number): void;\n\n  /**\n   * Apply affine transformations to the graphics context to manipulate the graphic before [[Graphic._drawImage]]\n   * @param ex\n   * @param x\n   * @param y\n   */\n  protected _preDraw(ex: ExcaliburGraphicsContext, x: number, y: number): void {\n    ex.save();\n    ex.translate(x, y);\n    ex.scale(Math.abs(this.scale.x), Math.abs(this.scale.y));\n    this._rotate(ex);\n    this._flip(ex);\n    // it is important to multiply alphas so graphics respect the current context\n    ex.opacity = ex.opacity * this.opacity;\n  }\n\n  protected _rotate(ex: ExcaliburGraphicsContext) {\n    const scaleDirX = this.scale.x > 0 ? 1 : -1;\n    const scaleDirY = this.scale.y > 0 ? 1 : -1;\n    const origin = this.origin ?? vec(this.width / 2, this.height / 2);\n    ex.translate(origin.x, origin.y);\n    ex.rotate(this.rotation);\n    // This is for handling direction changes 1 or -1, that way we don't have mismatched translates()\n    ex.scale(scaleDirX, scaleDirY);\n    ex.translate(-origin.x, -origin.y);\n  }\n\n  protected _flip(ex: ExcaliburGraphicsContext) {\n    if (this.flipHorizontal) {\n      ex.translate(this.width / this.scale.x, 0);\n      ex.scale(-1, 1);\n    }\n\n    if (this.flipVertical) {\n      ex.translate(0, this.height / this.scale.y);\n      ex.scale(1, -1);\n    }\n  }\n\n  /**\n   * Apply any addtional work after [[Graphic._drawImage]] and restore the context state.\n   * @param ex\n   */\n  protected _postDraw(ex: ExcaliburGraphicsContext): void {\n    if (this.showDebug) {\n      ex.debug.drawRect(0, 0, this.width, this.height);\n    }\n    ex.restore();\n  }\n\n  /**\n   * Returns a new instance of the graphic that has the same properties\n   */\n  abstract clone(): Graphic;\n}\n","/**\r\n * Checks if the current number is a power of two\r\n */\r\nexport function isPowerOfTwo(x: number): boolean {\r\n  return (x & (x - 1)) === 0;\r\n}\r\n\r\n/**\r\n * Returns the next highest power of two\r\n */\r\nexport function nextHighestPowerOfTwo(x: number): number {\r\n  --x;\r\n  for (let i = 1; i < 32; i <<= 1) {\r\n    x = x | (x >> i);\r\n  }\r\n  return x + 1;\r\n}\r\n\r\n/**\r\n * Returns the input number if a power of two, otherwise the next highest power of two\r\n */\r\nexport function ensurePowerOfTwo(x: number): number {\r\n  if (!isPowerOfTwo(x)) {\r\n    return nextHighestPowerOfTwo(x);\r\n  }\r\n  return x;\r\n}\r\n","/**\r\n * Watch an object with a proxy, only fires if property value is different\r\n */\r\nexport function watch<T extends object>(type: T, change: (type: T) => any): T {\r\n  if (!type) {\r\n    return type;\r\n  }\r\n  if ((type as any).__isProxy === undefined) {\r\n    // expando hack to mark a proxy\r\n    return new Proxy(type, {\r\n      set: (obj, prop, value) => {\r\n        // The default behavior to store the value\r\n        if ((obj as any)[prop] !== value) {\r\n          (obj as any)[prop] = value;\r\n          // Avoid watching private junk\r\n          if (typeof prop === 'string') {\r\n            if (prop[0] !== '_') {\r\n              change(obj);\r\n            }\r\n          }\r\n        }\r\n        // Indicate success\r\n        return true;\r\n      },\r\n      get: (obj, prop) => {\r\n        if (prop !== '__isProxy') {\r\n          return (obj as any)[prop];\r\n        }\r\n        return true;\r\n      }\r\n    });\r\n  }\r\n  return type;\r\n}\r\n\r\n/**\r\n * Watch an object with a proxy, fires change on any property value change\r\n */\r\nexport function watchAny<T extends object>(type: T, change: (type: T) => any): T {\r\n  if (!type) {\r\n    return type;\r\n  }\r\n  if ((type as any).__isProxy === undefined) {\r\n    // expando hack to mark a proxy\r\n    return new Proxy(type, {\r\n      set: (obj, prop, value) => {\r\n        // The default behavior to store the value\r\n        (obj as any)[prop] = value;\r\n        // Avoid watching private junk\r\n        if (typeof prop === 'string') {\r\n          if (prop[0] !== '_') {\r\n            change(obj);\r\n          }\r\n        }\r\n\r\n        // Indicate success\r\n        return true;\r\n      },\r\n      get: (obj, prop) => {\r\n        if (prop !== '__isProxy') {\r\n          return (obj as any)[prop];\r\n        }\r\n        return true;\r\n      }\r\n    });\r\n  }\r\n  return type;\r\n}\r\n","import { HTMLImageSource } from './ExcaliburGraphicsContext';\r\nimport { ensurePowerOfTwo, isPowerOfTwo } from './webgl-util';\r\n\r\n/**\r\n * Manages loading image sources into webgl textures, a unique id is associated with all sources\r\n */\r\nexport class TextureLoader {\r\n  private static _POT_CANVAS = document.createElement('canvas');\r\n  private static _POT_CTX = TextureLoader._POT_CANVAS.getContext('2d');\r\n\r\n  private static _GL: WebGLRenderingContext;\r\n\r\n  private static _TEXTURE_MAP = new Map<HTMLImageSource, WebGLTexture>();\r\n\r\n  public static registerContext(context: WebGLRenderingContext): void {\r\n    TextureLoader._GL = context;\r\n  }\r\n\r\n  /**\r\n   * Get the WebGL Texture from a source image\r\n   * @param image\r\n   */\r\n  public static get(image: HTMLImageSource): WebGLTexture {\r\n    return TextureLoader._TEXTURE_MAP.get(image);\r\n  }\r\n\r\n  /**\r\n   * Returns whether a source image has been loaded as a texture\r\n   * @param image\r\n   */\r\n  public static has(image: HTMLImageSource): boolean {\r\n    return TextureLoader._TEXTURE_MAP.has(image);\r\n  }\r\n\r\n  /**\r\n   * Loads a graphic into webgl and returns it's texture info, a webgl context must be previously registered\r\n   * @param image Source graphic\r\n   * @param forceUpdate Optionally force a texture to be reloaded, useful if the source graphic has changed\r\n   */\r\n  public static load(image: HTMLImageSource, forceUpdate = false): WebGLTexture {\r\n    // Ignore loading if webgl is not registered\r\n    const gl = TextureLoader._GL;\r\n    if (!gl) {\r\n      return null;\r\n    }\r\n\r\n    let tex: WebGLTexture = null;\r\n    // If reuse the texture if it's from the same source\r\n    if (TextureLoader.has(image)) {\r\n      tex = TextureLoader.get(image);\r\n    }\r\n\r\n    // Update existing webgl texture and return early\r\n    if (tex) {\r\n      if (forceUpdate) {\r\n        gl.bindTexture(gl.TEXTURE_2D, tex);\r\n        const source = TextureLoader.toPowerOfTwoImage(image);\r\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, source);\r\n      }\r\n      return tex;\r\n    }\r\n\r\n    // No texture exists create a new one\r\n    tex = gl.createTexture();\r\n    const source = TextureLoader.toPowerOfTwoImage(image);\r\n\r\n    gl.bindTexture(gl.TEXTURE_2D, tex);\r\n\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n\r\n    // NEAREST for pixels\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\r\n\r\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, source);\r\n\r\n    TextureLoader._TEXTURE_MAP.set(image, tex);\r\n    return tex;\r\n  }\r\n\r\n  /**\r\n   * Converts source images into power of two images, WebGL only supports POT images\r\n   * https://www.khronos.org/webgl/wiki/WebGL_and_OpenGL_Differences#Non-Power_of_Two_Texture_Support\r\n   * @param image\r\n   */\r\n  public static toPowerOfTwoImage(image: HTMLImageSource): HTMLImageSource {\r\n    const potCanvas = TextureLoader._POT_CANVAS;\r\n    const potCtx = TextureLoader._POT_CTX;\r\n    if (!isPowerOfTwo(image.width) || !isPowerOfTwo(image.height)) {\r\n      // Scale up the texture to the next highest power of two dimensions.\r\n\r\n      potCanvas.width = ensurePowerOfTwo(image.width);\r\n      potCanvas.height = ensurePowerOfTwo(image.height);\r\n      potCtx.imageSmoothingEnabled = false;\r\n      potCtx.clearRect(0, 0, potCanvas.width, potCanvas.height);\r\n      potCtx.drawImage(image, 0, 0, image.width, image.height);\r\n      image = potCanvas;\r\n    }\r\n    return image;\r\n  }\r\n}\r\n","import { Graphic, GraphicOptions } from './Graphic';\nimport { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\nimport { Color } from '../Color';\nimport { ensurePowerOfTwo } from './Context/webgl-util';\nimport { Vector } from '../Math/vector';\nimport { BoundingBox } from '../Collision/BoundingBox';\nimport { watch } from '../Util/Watch';\nimport { TextureLoader } from './Context/texture-loader';\n\nexport interface RasterOptions {\n  smoothing?: boolean;\n  color?: Color;\n  strokeColor?: Color;\n  lineWidth?: number;\n  lineDash?: number[];\n  padding?: number;\n}\n\n/**\n * A Raster is a Graphic that needs to be first painted to a HTMLCanvasElement before it can be drawn to the\n * [[ExcaliburGraphicsContext]]. This is useful for generating custom images using the 2D canvas api.\n *\n * Implementors must implemenet the [[Raster.execute]] method to rasterize their drawing.\n */\nexport abstract class Raster extends Graphic {\n  public _bitmap: HTMLCanvasElement;\n  protected _ctx: CanvasRenderingContext2D;\n  private _dirty: boolean = true;\n\n  constructor(options?: GraphicOptions & RasterOptions) {\n    super(options);\n    if (options) {\n      this.color = options.color ?? Color.Black;\n      this.strokeColor = options?.strokeColor;\n      this.smoothing = options.smoothing ?? this.smoothing;\n      this.lineWidth = options.lineWidth ?? this.lineWidth;\n      this.lineDash = options.lineDash ?? this.lineDash;\n      this.padding = options.padding ?? this.padding;\n    }\n\n    this._bitmap = document.createElement('canvas');\n    // get the default canvas width/height as a fallback\n    const bitmapWidth = options?.width ?? this._bitmap.width;\n    const bitmapHeight = options?.height ?? this._bitmap.height;\n    // Rasters use power of two images as an optimization for webgl\n    this.width = ensurePowerOfTwo(bitmapWidth);\n    this.height = ensurePowerOfTwo(bitmapHeight);\n    const maybeCtx = this._bitmap.getContext('2d');\n    if (!maybeCtx) {\n      /* istanbul ignore next */\n      throw new Error('Browser does not support 2d canvas drawing, cannot create Raster graphic');\n    } else {\n      this._ctx = maybeCtx;\n    }\n  }\n\n  public cloneRasterOptions(): RasterOptions {\n    return {\n      color: this.color ? this.color.clone() : null,\n      strokeColor: this.strokeColor ? this.strokeColor.clone() : null,\n      smoothing: this.smoothing,\n      lineWidth: this.lineWidth,\n      lineDash: this.lineDash,\n      padding: this.padding\n    };\n  }\n\n  /**\n   * Gets whether the graphic is dirty, this means there are changes that haven't been re-rasterized\n   */\n  public get dirty() {\n    return this._dirty;\n  }\n\n  /**\n   * Flags the graphic as dirty, meaning it must be re-rasterized before draw.\n   * This should be called any time the graphics state changes such that it affects the outputed drawing\n   */\n  public flagDirty() {\n    this._dirty = true;\n  }\n\n  private _originalWidth: number;\n  /**\n   * Gets or sets the current width of the Raster graphic. Setting the width will cause the raster\n   * to be flagged dirty causing a re-raster on the next draw.\n   *\n   * Any `padding`s set will be factored into the width\n   */\n  public get width() {\n    return this._getTotalWidth();\n  }\n  public set width(value: number) {\n    this._bitmap.width = value;\n    this._originalWidth = value;\n    this.flagDirty();\n  }\n\n  private _originalHeight: number;\n  /**\n   * Gets or sets the current height of the Raster graphic. Setting the height will cause the raster\n   * to be flagged dirty causing a re-raster on the next draw.\n   *\n   * Any `padding` set will be factored into the height\n   */\n  public get height() {\n    return this._getTotalHeight();\n  }\n\n  public set height(value: number) {\n    this._bitmap.height = value;\n    this._originalHeight = value;\n    this.flagDirty();\n  }\n\n  private _getTotalWidth() {\n    return (this._originalWidth ?? this._bitmap.width) + this.padding * 2;\n  }\n\n  private _getTotalHeight() {\n    return (this._originalHeight ?? this._bitmap.height) + this.padding * 2;\n  }\n\n  /**\n   * Returns the local bounds of the Raster including the padding\n   */\n  public get localBounds() {\n    return BoundingBox.fromDimension(this._getTotalWidth() * this.scale.x, this._getTotalHeight() * this.scale.y, Vector.Zero);\n  }\n\n  private _smoothing: boolean = false;\n  /**\n   * Gets or sets the smoothing (anti-aliasing of the graphic). Setting the height will cause the raster\n   * to be flagged dirty causing a re-raster on the next draw.\n   */\n  public get smoothing() {\n    return this._smoothing;\n  }\n  public set smoothing(value: boolean) {\n    this._smoothing = value;\n    this.flagDirty();\n  }\n\n  private _color: Color = watch(Color.Black, () => this.flagDirty());\n  /**\n   * Gets or sets the fillStyle of the Raster graphic. Setting the fillStyle will cause the raster to be\n   * flagged dirty causing a re-raster on the next draw.\n   */\n  public get color() {\n    return this._color;\n  }\n  public set color(value) {\n    if (!this._color?.equal(value)) {\n      this.flagDirty();\n    }\n    this._color = watch(value, () => this.flagDirty());\n  }\n\n  private _strokeColor: Color;\n  /**\n   * Gets or sets the strokeStyle of the Raster graphic. Setting the strokeStyle will cause the raster to be\n   * flagged dirty causing a re-raster on the next draw.\n   */\n  public get strokeColor() {\n    return this._strokeColor;\n  }\n  public set strokeColor(value) {\n    if (!this._strokeColor?.equal(value)) {\n      this.flagDirty();\n    }\n    this._strokeColor = watch(value, () => this.flagDirty());\n  }\n\n  private _lineWidth: number = 1;\n  /**\n   * Gets or sets the line width of the Raster graphic. Setting the lineWidth will cause the raster to be\n   * flagged dirty causing a re-raster on the next draw.\n   */\n  public get lineWidth() {\n    return this._lineWidth;\n  }\n  public set lineWidth(value) {\n    this._lineWidth = value;\n    this.flagDirty();\n  }\n\n  private _lineDash: number[] = [];\n  public get lineDash() {\n    return this._lineDash;\n  }\n\n  public set lineDash(value) {\n    this._lineDash = value;\n    this.flagDirty();\n  }\n\n  private _padding: number = 0;\n  public get padding() {\n    return this._padding;\n  }\n\n  public set padding(value: number) {\n    this._padding = value;\n    this.flagDirty();\n  }\n\n  /**\n   * Rasterize the graphic to a bitmap making it usuable as in excalibur. Rasterize is called automatically if\n   * the graphic is [[Raster.dirty]] on the next [[Graphic.draw]] call\n   */\n  public rasterize(): void {\n    this._dirty = false;\n    this._ctx.clearRect(0, 0, this._getTotalWidth(), this._getTotalHeight());\n    this._ctx.save();\n    this._applyRasterProperites(this._ctx);\n    this.execute(this._ctx);\n    this._ctx.restore();\n    // The webgl texture needs to be updated if it exists after a raster cycle\n    TextureLoader.load(this._bitmap, true);\n  }\n\n  protected _applyRasterProperites(ctx: CanvasRenderingContext2D) {\n    this._bitmap.width = this._getTotalWidth();\n    this._bitmap.height = this._getTotalHeight();\n    ctx.translate(this.padding, this.padding);\n    ctx.imageSmoothingEnabled = this.smoothing;\n    ctx.lineWidth = this.lineWidth;\n    ctx.setLineDash(this.lineDash ?? ctx.getLineDash());\n    ctx.strokeStyle = this.strokeColor?.toString();\n    ctx.fillStyle = this.color?.toString();\n  }\n\n  protected _drawImage(ex: ExcaliburGraphicsContext, x: number, y: number) {\n    if (this._dirty) {\n      this.rasterize();\n    }\n\n    ex.drawImage(this._bitmap, x, y);\n  }\n\n  /**\n   * Executes drawing implemenation of the graphic, this is where the specific drawing code for the graphic\n   * should be implemented. Once `rasterize()` the graphic can be drawn to the [[ExcaliburGraphicsContext]] via `draw(...)`\n   * @param ctx Canvas to draw the graphic to\n   */\n  abstract execute(ctx: CanvasRenderingContext2D): void;\n}\n","import { GraphicOptions } from './Graphic';\r\nimport { Raster, RasterOptions } from './Raster';\r\n\r\nexport interface CanvasOptions {\r\n  draw?: (ctx: CanvasRenderingContext2D) => void;\r\n  cache?: boolean;\r\n}\r\n\r\n/**\r\n * A canvas [[Graphic]] to provide an adapter between the 2D Canvas API and the [[ExcaliburGraphicsContext]].\r\n *\r\n * The [[Canvas]] works by re-rastering a draw handler to a HTMLCanvasElement for every draw which is then passed\r\n * to the [[ExcaliburGraphicsContext]] implementation as a rendered image.\r\n *\r\n * **Low performance API**\r\n */\r\nexport class Canvas extends Raster {\r\n  /**\r\n   * Return the 2D graphics context of this canvas\r\n   */\r\n  public get ctx() {\r\n    return this._ctx;\r\n  }\r\n\r\n  constructor(private _options: GraphicOptions & RasterOptions & CanvasOptions) {\r\n    super(_options);\r\n  }\r\n\r\n  public clone(): Canvas {\r\n    return new Canvas({\r\n      ...this._options,\r\n      ...this.cloneGraphicOptions(),\r\n      ...this.cloneRasterOptions()\r\n    });\r\n  }\r\n\r\n  execute(ctx: CanvasRenderingContext2D): void {\r\n    if (this._options?.draw) {\r\n      this._options?.draw(ctx);\r\n    }\r\n    if (!this._options.cache) {\r\n      this.flagDirty();\r\n    }\r\n  }\r\n}\r\n","import { Color } from './Color';\nimport { WebAudio } from './Util/WebAudio';\nimport { Engine } from './Engine';\nimport { Loadable } from './Interfaces/Loadable';\nimport { Class } from './Class';\nimport * as DrawUtil from './Util/DrawUtil';\n\nimport logoImg from './Loader.logo.png';\nimport loaderCss from './Loader.css';\nimport { Canvas } from './Graphics/Canvas';\nimport { Vector } from './Math/vector';\nimport { clamp, delay } from './Util/Util';\n\n/**\n * Pre-loading assets\n *\n * The loader provides a mechanism to preload multiple resources at\n * one time. The loader must be passed to the engine in order to\n * trigger the loading progress bar.\n *\n * The [[Loader]] itself implements [[Loadable]] so you can load loaders.\n *\n * ## Example: Pre-loading resources for a game\n *\n * ```js\n * // create a loader\n * var loader = new ex.Loader();\n *\n * // create a resource dictionary (best practice is to keep a separate file)\n * var resources = {\n *   TextureGround: new ex.Texture(\"/images/textures/ground.png\"),\n *   SoundDeath: new ex.Sound(\"/sound/death.wav\", \"/sound/death.mp3\")\n * };\n *\n * // loop through dictionary and add to loader\n * for (var loadable in resources) {\n *   if (resources.hasOwnProperty(loadable)) {\n *     loader.addResource(resources[loadable]);\n *   }\n * }\n *\n * // start game\n * game.start(loader).then(function () {\n *   console.log(\"Game started!\");\n * });\n * ```\n *\n * ## Customize the Loader\n *\n * The loader can be customized to show different, text, logo, background color, and button.\n *\n * ```typescript\n * const loader = new ex.Loader([playerTexture]);\n *\n * // The loaders button text can simply modified using this\n * loader.playButtonText = 'Start the best game ever';\n *\n * // The logo can be changed by inserting a base64 image string here\n *\n * loader.logo = 'data:image/png;base64,iVBORw...';\n * loader.logoWidth = 15;\n * loader.logoHeight = 14;\n *\n * // The background color can be changed like so by supplying a valid CSS color string\n *\n * loader.backgroundColor = 'red'\n * loader.backgroundColor = '#176BAA'\n *\n * // To build a completely new button\n * loader.startButtonFactory = () => {\n *     let myButton = document.createElement('button');\n *     myButton.textContent = 'The best button';\n *     return myButton;\n * };\n *\n * engine.start(loader).then(() => {});\n * ```\n */\nexport class Loader extends Class implements Loadable<Loadable<any>[]> {\n  public canvas: Canvas = new Canvas({\n    smoothing: true,\n    draw: this.draw.bind(this)\n  });\n  private _resourceList: Loadable<any>[] = [];\n  private _index = 0;\n\n  private _playButtonShown: boolean = false;\n  private _resourceCount: number = 0;\n  private _numLoaded: number = 0;\n  private _progressCounts: { [key: string]: number } = {};\n  private _totalCounts: { [key: string]: number } = {};\n  private _engine: Engine;\n\n  // logo drawing stuff\n\n  // base64 string encoding of the excalibur logo (logo-white.png)\n  public logo = logoImg;\n  public logoWidth = 468;\n  public logoHeight = 118;\n  /**\n   * Positions the top left corner of the logo image\n   * If not set, the loader automatically positions the logo\n   */\n  public logoPosition: Vector | null;\n  /**\n   * Positions the top left corner of the play button.\n   * If not set, the loader automatically positions the play button\n   */\n  public playButtonPosition: Vector | null;\n  /**\n   * Positions the top left corner of the loading bar\n   * If not set, the loader automatically positions the loading bar\n   */\n  public loadingBarPosition: Vector | null;\n\n  /**\n   * Gets or sets the color of the loading bar, default is [[Color.White]]\n   */\n  public loadingBarColor: Color = Color.White;\n\n  /**\n   * Gets or sets the background color of the loader as a hex string\n   */\n  public backgroundColor: string = '#176BAA';\n\n  protected _imageElement: HTMLImageElement;\n  protected get _image() {\n    if (!this._imageElement) {\n      this._imageElement = new Image();\n      this._imageElement.src = this.logo;\n    }\n\n    return this._imageElement;\n  }\n\n  public suppressPlayButton: boolean = false;\n  public get playButtonRootElement(): HTMLElement | null {\n    return this._playButtonRootElement;\n  }\n  public get playButtonElement(): HTMLButtonElement | null {\n    return this._playButtonElement;\n  }\n  protected _playButtonRootElement: HTMLElement;\n  protected _playButtonElement: HTMLButtonElement;\n  protected _styleBlock: HTMLStyleElement;\n  /** Loads the css from Loader.css */\n  protected _playButtonStyles: string = loaderCss.toString();\n  protected get _playButton() {\n    const existingRoot = document.getElementById('excalibur-play-root');\n    if (existingRoot) {\n      this._playButtonRootElement = existingRoot;\n    }\n    if (!this._playButtonRootElement) {\n      this._playButtonRootElement = document.createElement('div');\n      this._playButtonRootElement.id = 'excalibur-play-root';\n      this._playButtonRootElement.style.position = 'absolute';\n      document.body.appendChild(this._playButtonRootElement);\n    }\n    if (!this._styleBlock) {\n      this._styleBlock = document.createElement('style');\n      this._styleBlock.textContent = this._playButtonStyles;\n      document.head.appendChild(this._styleBlock);\n    }\n    if (!this._playButtonElement) {\n      this._playButtonElement = this.startButtonFactory();\n      this._playButtonRootElement.appendChild(this._playButtonElement);\n    }\n    return this._playButtonElement;\n  }\n\n  /**\n   * Get/set play button text\n   */\n  public playButtonText: string = 'Play game';\n\n  /**\n   * Return a html button element for excalibur to use as a play button\n   */\n  public startButtonFactory = () => {\n    let buttonElement: HTMLButtonElement = document.getElementById('excalibur-play') as HTMLButtonElement;\n    if (!buttonElement) {\n      buttonElement = document.createElement('button');\n    }\n\n    buttonElement.id = 'excalibur-play';\n    buttonElement.textContent = this.playButtonText;\n    buttonElement.style.display = 'none';\n    return buttonElement;\n  };\n\n  /**\n   * @param loadables  Optionally provide the list of resources you want to load at constructor time\n   */\n  constructor(loadables?: Loadable<any>[]) {\n    super();\n\n    if (loadables) {\n      this.addResources(loadables);\n    }\n  }\n\n  public wireEngine(engine: Engine) {\n    this._engine = engine;\n    this.canvas.width = this._engine.canvas.width;\n    this.canvas.height = this._engine.canvas.height;\n  }\n\n  /**\n   * Add a resource to the loader to load\n   * @param loadable  Resource to add\n   */\n  public addResource(loadable: Loadable<any>) {\n    const key = this._index++;\n    this._resourceList.push(loadable);\n    this._progressCounts[key] = 0;\n    this._totalCounts[key] = 1;\n    this._resourceCount++;\n  }\n\n  /**\n   * Add a list of resources to the loader to load\n   * @param loadables  The list of resources to load\n   */\n  public addResources(loadables: Loadable<any>[]) {\n    let i = 0;\n    const len = loadables.length;\n\n    for (i; i < len; i++) {\n      this.addResource(loadables[i]);\n    }\n  }\n\n  /**\n   * Returns true if the loader has completely loaded all resources\n   */\n  public isLoaded() {\n    return this._numLoaded === this._resourceCount;\n  }\n\n  /**\n   * Shows the play button and returns a promise that resolves when clicked\n   */\n  public showPlayButton(): Promise<void> {\n    if (this.suppressPlayButton) {\n      return Promise.resolve();\n    } else {\n      this._playButtonShown = true;\n      this._playButton.style.display = 'block';\n      document.body.addEventListener('keyup', (evt: KeyboardEvent) => {\n        if (evt.key === 'Enter') {\n          this._playButton.click();\n        }\n      });\n      const promise = new Promise<void>((resolve) => {\n        const startButtonHandler = (e: Event) => {\n          // We want to stop propogation to keep bubbling to the engine pointer handlers\n          e.stopPropagation();\n          resolve();\n        };\n        this._playButton.addEventListener('click', startButtonHandler);\n        this._playButton.addEventListener('touchend', startButtonHandler);\n        this._playButton.addEventListener('pointerup', startButtonHandler);\n      });\n\n      return promise;\n    }\n  }\n\n  public hidePlayButton() {\n    this._playButtonShown = false;\n    this._playButton.style.display = 'none';\n  }\n\n  /**\n   * Clean up generated elements for the loader\n   */\n  public dispose() {\n    if (this._playButtonRootElement.parentElement) {\n      this._playButtonRootElement.removeChild(this._playButtonElement);\n      document.body.removeChild(this._playButtonRootElement);\n      document.head.removeChild(this._styleBlock);\n      this._playButtonRootElement = null;\n      this._playButtonElement = null;\n      this._styleBlock = null;\n    }\n  }\n\n  update(_engine: Engine, _delta: number): void {\n    // override me\n  }\n\n  data: Loadable<any>[];\n\n  /**\n   * Begin loading all of the supplied resources, returning a promise\n   * that resolves when loading of all is complete\n   */\n  public async load(): Promise<Loadable<any>[]> {\n    await Promise.all(\n      this._resourceList.map((r) =>\n        r.load().finally(() => {\n          // capture progress\n          this._numLoaded++;\n        })\n      )\n    );\n\n    // short delay in showing the button for aesthetics\n    await delay(200);\n    await this.showPlayButton();\n    // Unlock browser AudioContext in after user gesture\n    // See: https://github.com/excaliburjs/Excalibur/issues/262\n    // See: https://github.com/excaliburjs/Excalibur/issues/1031\n    await WebAudio.unlock();\n    this.hidePlayButton();\n\n    return (this.data = this._resourceList);\n  }\n\n  public markResourceComplete(): void {\n    this._numLoaded++;\n  }\n\n  /**\n   * Returns the progess of the loader as a number between [0, 1] inclusive.\n   */\n  public get progress(): number {\n    return this._resourceCount > 0 ? clamp(this._numLoaded, 0, this._resourceCount) / this._resourceCount : 1;\n  }\n\n  /**\n   * Loader draw function. Draws the default Excalibur loading screen.\n   * Override `logo`, `logoWidth`, `logoHeight` and `backgroundColor` properties\n   * to customize the drawing, or just override entire method.\n   */\n  public draw(ctx: CanvasRenderingContext2D) {\n    const canvasHeight = this._engine.canvasHeight / this._engine.pixelRatio;\n    const canvasWidth = this._engine.canvasWidth / this._engine.pixelRatio;\n\n    if (this._playButtonRootElement) {\n      const left = this._engine.canvas.offsetLeft;\n      const top = this._engine.canvas.offsetTop;\n      const buttonWidth = this._playButton.clientWidth;\n      const buttonHeight = this._playButton.clientHeight;\n      if (this.playButtonPosition) {\n        this._playButtonRootElement.style.left = `${this.playButtonPosition.x}px`;\n        this._playButtonRootElement.style.top = `${this.playButtonPosition.y}px`;\n      } else {\n        this._playButtonRootElement.style.left = `${left + canvasWidth / 2 - buttonWidth / 2}px`;\n        this._playButtonRootElement.style.top = `${top + canvasHeight / 2 - buttonHeight / 2 + 100}px`;\n      }\n    }\n\n    ctx.fillStyle = this.backgroundColor;\n    ctx.fillRect(0, 0, canvasWidth, canvasHeight);\n\n    let logoY = canvasHeight / 2;\n    const width = Math.min(this.logoWidth, canvasWidth * 0.75);\n    let logoX = canvasWidth / 2 - width / 2;\n\n    if (this.logoPosition) {\n      logoX = this.logoPosition.x;\n      logoY = this.logoPosition.y;\n    }\n\n    const imageHeight = Math.floor(width * (this.logoHeight / this.logoWidth)); // OG height/width factor\n    const oldAntialias = this._engine.getAntialiasing();\n    this._engine.setAntialiasing(true);\n    if (!this.logoPosition) {\n      ctx.drawImage(this._image, 0, 0, this.logoWidth, this.logoHeight, logoX, logoY - imageHeight - 20, width, imageHeight);\n    } else {\n      ctx.drawImage(this._image, 0, 0, this.logoWidth, this.logoHeight, logoX, logoY, width, imageHeight);\n    }\n\n    // loading box\n    if (!this.suppressPlayButton && this._playButtonShown) {\n      this._engine.setAntialiasing(oldAntialias);\n      return;\n    }\n\n    let loadingX = logoX;\n    let loadingY = logoY;\n    if (this.loadingBarPosition) {\n      loadingX = this.loadingBarPosition.x;\n      loadingY = this.loadingBarPosition.y;\n    }\n\n    ctx.lineWidth = 2;\n    DrawUtil.roundRect(ctx, loadingX, loadingY, width, 20, 10, this.loadingBarColor);\n    const progress = width * this.progress;\n    const margin = 5;\n    const progressWidth = progress - margin * 2;\n    const height = 20 - margin * 2;\n    DrawUtil.roundRect(\n      ctx,\n      loadingX + margin,\n      loadingY + margin,\n      progressWidth > 10 ? progressWidth : 10,\n      height,\n      5,\n      null,\n      this.loadingBarColor\n    );\n    this._engine.setAntialiasing(oldAntialias);\n  }\n}\n","export default \"data:image/png;base64,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\"","import { Logger } from './Log';\r\n/**\r\n * This is the list of features that will be used to log the supported\r\n * features to the console when Detector.logBrowserFeatures() is called.\r\n */\r\n\r\nconst REPORTED_FEATURES: { [key: string]: string } = {\r\n  webgl: 'WebGL',\r\n  webaudio: 'WebAudio',\r\n  gamepadapi: 'Gamepad API'\r\n};\r\n\r\n/**\r\n * Interface for detected browser features matrix\r\n */\r\nexport interface DetectedFeatures {\r\n  readonly canvas: boolean;\r\n  readonly arraybuffer: boolean;\r\n  readonly dataurl: boolean;\r\n  readonly objecturl: boolean;\r\n  readonly rgba: boolean;\r\n  readonly webaudio: boolean;\r\n  readonly webgl: boolean;\r\n  readonly gamepadapi: boolean;\r\n}\r\n\r\ninterface CriticalTests {\r\n  canvasSupport(): boolean;\r\n  arrayBufferSupport(): boolean;\r\n  dataUrlSupport(): boolean;\r\n  objectUrlSupport(): boolean;\r\n  rgbaSupport(): boolean;\r\n}\r\n\r\ninterface WarningTests {\r\n  webAudioSupport(): boolean;\r\n  webglSupport(): boolean;\r\n}\r\n\r\n/**\r\n * Excalibur internal feature detection helper class\r\n */\r\nexport class Detector {\r\n  private _features: DetectedFeatures = null;\r\n\r\n  public failedTests: string[] = [];\r\n\r\n  public constructor() {\r\n    this._features = this._loadBrowserFeatures();\r\n  }\r\n\r\n  /**\r\n   * Returns a map of currently supported browser features. This method\r\n   * treats the features as a singleton and will only calculate feature\r\n   * support if it has not previously been done.\r\n   */\r\n  public getBrowserFeatures(): DetectedFeatures {\r\n    if (this._features === null) {\r\n      this._features = this._loadBrowserFeatures();\r\n    }\r\n    return this._features;\r\n  }\r\n\r\n  /**\r\n   * Report on non-critical browser support for debugging purposes.\r\n   * Use native browser console colors for visibility.\r\n   */\r\n  public logBrowserFeatures(): void {\r\n    let msg = '%cSUPPORTED BROWSER FEATURES\\n==========================%c\\n';\r\n    const args = ['font-weight: bold; color: navy', 'font-weight: normal; color: inherit'];\r\n\r\n    const supported: any = this.getBrowserFeatures();\r\n    for (const feature of Object.keys(REPORTED_FEATURES)) {\r\n      if (supported[feature]) {\r\n        msg += '(%c\\u2713%c)'; // ()\r\n        args.push('font-weight: bold; color: green');\r\n        args.push('font-weight: normal; color: inherit');\r\n      } else {\r\n        msg += '(%c\\u2717%c)'; // ()\r\n        args.push('font-weight: bold; color: red');\r\n        args.push('font-weight: normal; color: inherit');\r\n      }\r\n\r\n      msg += ' ' + REPORTED_FEATURES[feature] + '\\n';\r\n    }\r\n\r\n    args.unshift(msg);\r\n    // eslint-disable-next-line no-console\r\n    console.log.apply(console, args);\r\n  }\r\n\r\n  /**\r\n   * Executes several IIFE's to get a constant reference to supported\r\n   * features within the current execution context.\r\n   */\r\n  private _loadBrowserFeatures(): DetectedFeatures {\r\n    return {\r\n      // IIFE to check canvas support\r\n      canvas: (() => {\r\n        return this._criticalTests.canvasSupport();\r\n      })(),\r\n\r\n      // IIFE to check arraybuffer support\r\n      arraybuffer: (() => {\r\n        return this._criticalTests.arrayBufferSupport();\r\n      })(),\r\n\r\n      // IIFE to check dataurl support\r\n      dataurl: (() => {\r\n        return this._criticalTests.dataUrlSupport();\r\n      })(),\r\n\r\n      // IIFE to check objecturl support\r\n      objecturl: (() => {\r\n        return this._criticalTests.objectUrlSupport();\r\n      })(),\r\n\r\n      // IIFE to check rgba support\r\n      rgba: (() => {\r\n        return this._criticalTests.rgbaSupport();\r\n      })(),\r\n\r\n      // IIFE to check webaudio support\r\n      webaudio: (() => {\r\n        return this._warningTest.webAudioSupport();\r\n      })(),\r\n\r\n      // IIFE to check webgl support\r\n      webgl: (() => {\r\n        return this._warningTest.webglSupport();\r\n      })(),\r\n\r\n      // IIFE to check gamepadapi support\r\n      gamepadapi: (() => {\r\n        return !!(<any>navigator).getGamepads;\r\n      })()\r\n    };\r\n  }\r\n\r\n  // critical browser features required for ex to run\r\n  private _criticalTests: CriticalTests = {\r\n    // Test canvas/2d context support\r\n    canvasSupport: function() {\r\n      const elem = document.createElement('canvas');\r\n      return !!(elem.getContext && elem.getContext('2d'));\r\n    },\r\n\r\n    // Test array buffer support ex uses for downloading binary data\r\n    arrayBufferSupport: function() {\r\n      const xhr = new XMLHttpRequest();\r\n      xhr.open('GET', '/');\r\n      try {\r\n        xhr.responseType = 'arraybuffer';\r\n      } catch (e) {\r\n        return false;\r\n      }\r\n      return xhr.responseType === 'arraybuffer';\r\n    },\r\n\r\n    // Test data urls ex uses for sprites\r\n    dataUrlSupport: function() {\r\n      const canvas = document.createElement('canvas');\r\n      return canvas.toDataURL('image/png').indexOf('data:image/png') === 0;\r\n    },\r\n\r\n    // Test object url support for loading\r\n    objectUrlSupport: function() {\r\n      return 'URL' in window && 'revokeObjectURL' in URL && 'createObjectURL' in URL;\r\n    },\r\n\r\n    // RGBA support for colors\r\n    rgbaSupport: function() {\r\n      const style = document.createElement('a').style;\r\n      style.cssText = 'background-color:rgba(150,255,150,.5)';\r\n      return ('' + style.backgroundColor).indexOf('rgba') > -1;\r\n    }\r\n  };\r\n\r\n  // warnings excalibur performance will be degraded\r\n  private _warningTest: WarningTests = {\r\n    webAudioSupport: function() {\r\n      return !!(\r\n        (<any>window).AudioContext ||\r\n        (<any>window).webkitAudioContext ||\r\n        (<any>window).mozAudioContext ||\r\n        (<any>window).msAudioContext ||\r\n        (<any>window).oAudioContext\r\n      );\r\n    },\r\n    webglSupport: function() {\r\n      const elem = document.createElement('canvas');\r\n      return !!(elem.getContext && elem.getContext('webgl'));\r\n    }\r\n  };\r\n\r\n  public test(): boolean {\r\n    // Critical test will for ex not to run\r\n    let failedCritical = false;\r\n    for (const test in this._criticalTests) {\r\n      if (!this._criticalTests[<keyof CriticalTests>test].call(this)) {\r\n        this.failedTests.push(test);\r\n        Logger.getInstance().error('Critical browser feature missing, Excalibur requires:', test);\r\n        failedCritical = true;\r\n      }\r\n    }\r\n    if (failedCritical) {\r\n      return false;\r\n    }\r\n\r\n    // Warning tests do not for ex to return false to compatibility\r\n    for (const warning in this._warningTest) {\r\n      if (!this._warningTest[<keyof WarningTests>warning]()) {\r\n        Logger.getInstance().warn('Warning browser feature missing, Excalibur will have reduced performance:', warning);\r\n      }\r\n    }\r\n\r\n    return true;\r\n  }\r\n}\r\n","import { Loadable } from '../Interfaces/Loadable';\r\nimport { Logger } from '../Util/Log';\r\nimport { EventDispatcher } from '../EventDispatcher';\r\n\r\n/**\r\n * The [[Resource]] type allows games built in Excalibur to load generic resources.\r\n * For any type of remote resource it is recommended to use [[Resource]] for preloading.\r\n */\r\nexport class Resource<T> implements Loadable<T> {\r\n  public data: T = null;\r\n  public logger: Logger = Logger.getInstance();\r\n  public events: EventDispatcher = new EventDispatcher(this);\r\n\r\n  /**\r\n   * @param path          Path to the remote resource\r\n   * @param responseType  The type to expect as a response: \"\" | \"arraybuffer\" | \"blob\" | \"document\" | \"json\" | \"text\";\r\n   * @param bustCache     Whether or not to cache-bust requests\r\n   */\r\n  constructor(\r\n    public path: string,\r\n    public responseType: '' | 'arraybuffer' | 'blob' | 'document' | 'json' | 'text',\r\n    public bustCache: boolean = true\r\n  ) {}\r\n\r\n  /**\r\n   * Returns true if the Resource is completely loaded and is ready\r\n   * to be drawn.\r\n   */\r\n  public isLoaded(): boolean {\r\n    return this.data !== null;\r\n  }\r\n\r\n\r\n  private _cacheBust(uri: string): string {\r\n    const query: RegExp = /\\?\\w*=\\w*/;\r\n    if (query.test(uri)) {\r\n      uri += '&__=' + Date.now();\r\n    } else {\r\n      uri += '?__=' + Date.now();\r\n    }\r\n    return uri;\r\n  }\r\n  /**\r\n   * Begin loading the resource and returns a promise to be resolved on completion\r\n   */\r\n  public load(): Promise<T> {\r\n    return new Promise((resolve, reject) => {\r\n      // Exit early if we already have data\r\n      if (this.data !== null) {\r\n        this.logger.debug('Already have data for resource', this.path);\r\n        this.events.emit('complete', this.data as any);\r\n        resolve(this.data);\r\n        return;\r\n      }\r\n\r\n      const request = new XMLHttpRequest();\r\n      request.open('GET', this.bustCache ? this._cacheBust(this.path) : this.path, true);\r\n      request.responseType = this.responseType;\r\n      request.addEventListener('loadstart', (e) => this.events.emit('loadstart', e as any));\r\n      request.addEventListener('progress', (e) => this.events.emit('progress', e as any));\r\n      request.addEventListener('error', (e) => this.events.emit('error', e as any));\r\n      request.addEventListener('load', (e) => this.events.emit('load', e as any));\r\n      request.addEventListener('load', () => {\r\n        // XHR on file:// success status is 0, such as with PhantomJS\r\n        if (request.status !== 0 && request.status !== 200) {\r\n          this.logger.error('Failed to load resource ', this.path, ' server responded with error code', request.status);\r\n          this.events.emit('error', request.response);\r\n          reject(request.response);\r\n          return;\r\n        }\r\n\r\n        this.data = request.response;\r\n        this.events.emit('complete', this.data as any);\r\n        this.logger.debug('Completed loading resource', this.path);\r\n        resolve(this.data);\r\n      });\r\n      request.send();\r\n    });\r\n  }\r\n}\r\n","/**\r\n * @module\r\n * @deprecated\r\n * These effects can be applied to any bitmap image but are mainly used\r\n * for [[Sprite]] effects or [[Animation]] effects.\r\n */\r\n\r\n/**\r\n * @typedoc\r\n */\r\n\r\nimport { obsolete } from '../Util/Decorators';\r\nimport { Color } from '../Color';\r\n\r\n/**\r\n * The interface that all sprite effects must implement\r\n * @deprecated SpriteEffect will be removed in v0.26.0\r\n */\r\nexport interface SpriteEffect {\r\n  /**\r\n   * Should update individual pixels values\r\n   * @param x          The pixel's x coordinate\r\n   * @param y          The pixel's y coordinate\r\n   * @param imageData  The sprite's raw pixel data\r\n   */\r\n  updatePixel(x: number, y: number, imageData: ImageData): void;\r\n}\r\n\r\n/**\r\n * Applies the \"Grayscale\" effect to a sprite, removing color information.\r\n * @deprecated [[Grayscale]] will be removed in v0.26.0\r\n */\r\n@obsolete({\r\n  message: 'Grayscale will be removed in v0.26.0'\r\n})\r\nexport class Grayscale implements SpriteEffect {\r\n  updatePixel(x: number, y: number, imageData: ImageData): void {\r\n    const firstPixel = (x + y * imageData.width) * 4;\r\n    const pixel = imageData.data;\r\n    const avg = (pixel[firstPixel + 0] + pixel[firstPixel + 1] + pixel[firstPixel + 2]) / 3;\r\n    pixel[firstPixel + 0] = avg;\r\n    pixel[firstPixel + 1] = avg;\r\n    pixel[firstPixel + 2] = avg;\r\n  }\r\n}\r\n\r\n/**\r\n * Applies the \"Invert\" effect to a sprite, inverting the pixel colors.\r\n * @deprecated [[Invert]] will be removed in v0.26.0\r\n */\r\n@obsolete({\r\n  message: 'Invert will be removed in v0.26.0'\r\n})\r\nexport class Invert implements SpriteEffect {\r\n  updatePixel(x: number, y: number, imageData: ImageData): void {\r\n    const firstPixel = (x + y * imageData.width) * 4;\r\n    const pixel = imageData.data;\r\n    pixel[firstPixel + 0] = 255 - pixel[firstPixel + 0];\r\n    pixel[firstPixel + 1] = 255 - pixel[firstPixel + 1];\r\n    pixel[firstPixel + 2] = 255 - pixel[firstPixel + 2];\r\n  }\r\n}\r\n\r\n/**\r\n * Applies the \"Opacity\" effect to a sprite, setting the alpha of all pixels to a given value.\r\n * @deprecated [[Opacity]] will be removed in v0.26.0\r\n */\r\n@obsolete({\r\n  message: 'Opacity will be removed in v0.26.0'\r\n})\r\nexport class Opacity implements SpriteEffect {\r\n  /**\r\n   * @param opacity  The new opacity of the sprite from 0-1.0\r\n   */\r\n  constructor(public opacity: number) {}\r\n  updatePixel(x: number, y: number, imageData: ImageData): void {\r\n    const firstPixel = (x + y * imageData.width) * 4;\r\n    const pixel = imageData.data;\r\n    if (pixel[firstPixel + 3] !== 0) {\r\n      pixel[firstPixel + 3] = Math.round(this.opacity * pixel[firstPixel + 3]);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Applies the \"Colorize\" effect to a sprite, changing the color channels of all the pixels to an\r\n * average of the original color and the provided color\r\n * @deprecated [[Colorize]] will be removed in v0.26.0\r\n */\r\n@obsolete({\r\n  message: 'Colorize will be removed in v0.26.0'\r\n})\r\nexport class Colorize implements SpriteEffect {\r\n  /**\r\n   * @param color  The color to apply to the sprite\r\n   */\r\n  constructor(public color: Color) {}\r\n  updatePixel(x: number, y: number, imageData: ImageData): void {\r\n    const firstPixel = (x + y * imageData.width) * 4;\r\n    const pixel = imageData.data;\r\n    if (pixel[firstPixel + 3] !== 0) {\r\n      pixel[firstPixel + 0] = (pixel[firstPixel + 0] + this.color.r) / 2;\r\n      pixel[firstPixel + 1] = (pixel[firstPixel + 1] + this.color.g) / 2;\r\n      pixel[firstPixel + 2] = (pixel[firstPixel + 2] + this.color.b) / 2;\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Applies the \"Lighten\" effect to a sprite, changes the lightness of the color according to HSL\r\n * @deprecated [[Lighten]] will be removed in v0.26.0\r\n */\r\n@obsolete({\r\n  message: 'Lighten will be removed in v0.26.0'\r\n})\r\nexport class Lighten implements SpriteEffect {\r\n  /**\r\n   * @param factor  The factor of the effect between 0-1\r\n   */\r\n  constructor(public factor: number = 0.1) {}\r\n  updatePixel(x: number, y: number, imageData: ImageData): void {\r\n    const firstPixel = (x + y * imageData.width) * 4;\r\n    const pixel = imageData.data;\r\n    const color = Color.fromRGB(pixel[firstPixel + 0], pixel[firstPixel + 1], pixel[firstPixel + 2], pixel[firstPixel + 3]).lighten(\r\n      this.factor\r\n    );\r\n    pixel[firstPixel + 0] = color.r;\r\n    pixel[firstPixel + 1] = color.g;\r\n    pixel[firstPixel + 2] = color.b;\r\n    pixel[firstPixel + 3] = color.a;\r\n  }\r\n}\r\n\r\n/**\r\n * Applies the \"Darken\" effect to a sprite, changes the darkness of the color according to HSL\r\n * @deprecated [[Darken]] will be removed in v0.26.0\r\n */\r\n@obsolete({\r\n  message: 'Darken will be removed v0.26.0'\r\n})\r\nexport class Darken implements SpriteEffect {\r\n  /**\r\n   * @param factor  The factor of the effect between 0-1\r\n   */\r\n  constructor(public factor: number = 0.1) {}\r\n  updatePixel(x: number, y: number, imageData: ImageData): void {\r\n    const firstPixel = (x + y * imageData.width) * 4;\r\n    const pixel = imageData.data;\r\n    const color = Color.fromRGB(pixel[firstPixel + 0], pixel[firstPixel + 1], pixel[firstPixel + 2], pixel[firstPixel + 3]).darken(\r\n      this.factor\r\n    );\r\n    pixel[firstPixel + 0] = color.r;\r\n    pixel[firstPixel + 1] = color.g;\r\n    pixel[firstPixel + 2] = color.b;\r\n    pixel[firstPixel + 3] = color.a;\r\n  }\r\n}\r\n\r\n/**\r\n * Applies the \"Saturate\" effect to a sprite, saturates the color according to HSL\r\n * @deprecated [[Saturate]] will be removed in v0.26.0\r\n */\r\n@obsolete({\r\n  message: 'Saturate will be removed in v0.26.0'\r\n})\r\nexport class Saturate implements SpriteEffect {\r\n  /**\r\n   * @param factor  The factor of the effect between 0-1\r\n   */\r\n  constructor(public factor: number = 0.1) {}\r\n  updatePixel(x: number, y: number, imageData: ImageData): void {\r\n    const firstPixel = (x + y * imageData.width) * 4;\r\n    const pixel = imageData.data;\r\n    const color = Color.fromRGB(pixel[firstPixel + 0], pixel[firstPixel + 1], pixel[firstPixel + 2], pixel[firstPixel + 3]).saturate(\r\n      this.factor\r\n    );\r\n    pixel[firstPixel + 0] = color.r;\r\n    pixel[firstPixel + 1] = color.g;\r\n    pixel[firstPixel + 2] = color.b;\r\n    pixel[firstPixel + 3] = color.a;\r\n  }\r\n}\r\n\r\n/**\r\n * Applies the \"Desaturate\" effect to a sprite, desaturates the color according to HSL\r\n * @deprecated [[Desaturate]] will be removed in v0.26.0\r\n */\r\n@obsolete({\r\n  message: 'Desaturate will be removed in v0.26.0'\r\n})\r\nexport class Desaturate implements SpriteEffect {\r\n  /**\r\n   * @param factor  The factor of the effect between 0-1\r\n   */\r\n  constructor(public factor: number = 0.1) {}\r\n  updatePixel(x: number, y: number, imageData: ImageData): void {\r\n    const firstPixel = (x + y * imageData.width) * 4;\r\n    const pixel = imageData.data;\r\n    const color = Color.fromRGB(pixel[firstPixel + 0], pixel[firstPixel + 1], pixel[firstPixel + 2], pixel[firstPixel + 3]).desaturate(\r\n      this.factor\r\n    );\r\n    pixel[firstPixel + 0] = color.r;\r\n    pixel[firstPixel + 1] = color.g;\r\n    pixel[firstPixel + 2] = color.b;\r\n    pixel[firstPixel + 3] = color.a;\r\n  }\r\n}\r\n\r\n/**\r\n * Applies the \"Fill\" effect to a sprite, changing the color channels of all non-transparent pixels to match\r\n * a given color\r\n * @deprecated [[Fill]] will be removed in v0.26.0\r\n */\r\n@obsolete({\r\n  message: 'Fill will be removed in v0.26.0'\r\n})\r\nexport class Fill implements SpriteEffect {\r\n  /**\r\n   * @param color  The color to apply to the sprite\r\n   */\r\n  constructor(public color: Color) {}\r\n  updatePixel(x: number, y: number, imageData: ImageData): void {\r\n    const firstPixel = (x + y * imageData.width) * 4;\r\n    const pixel = imageData.data;\r\n    if (pixel[firstPixel + 3] !== 0) {\r\n      pixel[firstPixel + 0] = this.color.r;\r\n      pixel[firstPixel + 1] = this.color.g;\r\n      pixel[firstPixel + 2] = this.color.b;\r\n    }\r\n  }\r\n}\r\n","export type Constructor<T> = {\r\n  new (...args: any[]): T;\r\n};\r\n/**\r\n * Configurable helper extends base type and makes all properties available as option bag arguments\r\n * @internal\r\n * @param base\r\n */\r\nexport function Configurable<T extends Constructor<{}>>(base: T): T {\r\n  return class extends base {\r\n    public assign(props: Partial<T>) {\r\n      //set the value of every property that was passed in,\r\n      //if the constructor previously set this value, it will be overridden here\r\n      for (const k in props) {\r\n        // eslint-disable-next-line\r\n        if (typeof (<any>this)[k] !== 'function') {\r\n          // eslint-disable-next-line\r\n          (<any>this)[k] = (<any>props)[k];\r\n        }\r\n      }\r\n    }\r\n\r\n    constructor(...args: any[]) {\r\n      super(...args);\r\n      //get the number of arguments that aren't undefined. TS passes a value to all parameters\r\n      //of whatever ctor is the implementation, so args.length doesn't work here.\r\n      const size = args.filter(function(value) {\r\n        return value !== undefined;\r\n      }).length;\r\n      if (size === 1 && args[0] && typeof args[0] === 'object' && !(args[0] instanceof Array)) {\r\n        this.assign(args[0]);\r\n      }\r\n    }\r\n  };\r\n}\r\n","import * as Effects from './SpriteEffects';\r\nimport { Color } from '../Color';\r\n\r\nimport { Drawable, DrawOptions } from '../Interfaces/Drawable';\r\nimport { Texture } from './Texture';\r\nimport { Vector } from '../Math/vector';\r\nimport { Logger } from '../Util/Log';\r\nimport { clamp } from '../Util/Util';\r\nimport { Configurable } from '../Configurable';\r\nimport { obsolete } from '../Util/Decorators';\r\n\r\n/**\r\n * @hidden\r\n * @deprecated Use [[Sprite]]\r\n */\r\nexport class SpriteImpl implements Drawable {\r\n  public texture: Texture;\r\n\r\n  public x: number = 0;\r\n  public y: number = 0;\r\n\r\n  public get drawWidth(): number {\r\n    return Math.abs(this.width * this.scale.x);\r\n  }\r\n\r\n  public get drawHeight(): number {\r\n    return Math.abs(this.height * this.scale.y);\r\n  }\r\n\r\n  public rotation: number = 0.0;\r\n  public anchor: Vector = Vector.Half;\r\n  public offset: Vector = Vector.Zero;\r\n  public scale: Vector = Vector.One;\r\n  /**\r\n   * Default: false, should the sprite be drawn around the anchor or from the top left.\r\n   * Sprite rotations/scaling still happen around the anchor regardless of this setting.\r\n   */\r\n  public drawAroundAnchor = false;\r\n\r\n  public logger: Logger = Logger.getInstance();\r\n\r\n  /**\r\n   * Draws the sprite flipped vertically\r\n   */\r\n  public flipVertical: boolean = false;\r\n\r\n  /**\r\n   * Draws the sprite flipped horizontally\r\n   */\r\n  public flipHorizontal: boolean = false;\r\n\r\n  public effects: Effects.SpriteEffect[] = [];\r\n\r\n  public width: number = 0;\r\n  public height: number = 0;\r\n\r\n  private _spriteCanvas: HTMLCanvasElement = null;\r\n  private _spriteCtx: CanvasRenderingContext2D = null;\r\n  private _pixelData: ImageData = null;\r\n  private _pixelsLoaded: boolean = false;\r\n  private _dirtyEffect: boolean = true;\r\n\r\n  /**\r\n   * @param imageOrConfig  The backing image texture to build the Sprite, or Sprite option bag\r\n   * @param x      The x position of the sprite\r\n   * @param y      The y position of the sprite\r\n   * @param width  The width of the sprite in pixels\r\n   * @param height The height of the sprite in pixels\r\n   */\r\n  constructor(imageOrConfig: Texture | SpriteArgs, x: number, y: number, width: number, height: number) {\r\n    let image = imageOrConfig;\r\n    if (imageOrConfig && !(imageOrConfig instanceof Texture)) {\r\n      x = imageOrConfig.x | 0;\r\n      y = imageOrConfig.y | 0;\r\n      width = imageOrConfig.width | 0;\r\n      height = imageOrConfig.height | 0;\r\n      image = imageOrConfig.image;\r\n      if (!image) {\r\n        const message = 'An image texture is required to construct a sprite';\r\n        throw new Error(message);\r\n      }\r\n    }\r\n\r\n    this.x = x || 0;\r\n    this.y = y || 0;\r\n\r\n    this.texture = image as Texture;\r\n    this._spriteCanvas = document.createElement('canvas');\r\n    this._spriteCanvas.width = width;\r\n    this._spriteCanvas.height = height;\r\n    this._spriteCtx = this._spriteCanvas.getContext('2d');\r\n    this._initPixelsFromTexture();\r\n\r\n    this.width = width;\r\n    this.height = height;\r\n  }\r\n\r\n  private async _initPixelsFromTexture() {\r\n    try {\r\n      const image = await this.texture.loaded;\r\n      this.width = this.width || image.naturalWidth;\r\n      this.height = this.height || image.naturalHeight;\r\n      this._spriteCanvas.width = this._spriteCanvas.width || image.naturalWidth;\r\n      this._spriteCanvas.height = this._spriteCanvas.height || image.naturalHeight;\r\n      this._loadPixels();\r\n      this._dirtyEffect = true;\r\n    } catch (e) {\r\n      this.logger.error('Error loading texture ', this.texture.path, e);\r\n    }\r\n  }\r\n\r\n  private _loadPixels() {\r\n    if (this.texture.isLoaded() && !this._pixelsLoaded) {\r\n      const naturalWidth = this.texture.image.naturalWidth || 0;\r\n      const naturalHeight = this.texture.image.naturalHeight || 0;\r\n\r\n      if (this.width > naturalWidth) {\r\n        this.logger.warn(`The sprite width ${this.width} exceeds the width \r\n                              ${naturalWidth} of the backing texture ${this.texture.path}`);\r\n      }\r\n\r\n      if (this.width <= 0 || naturalWidth <= 0) {\r\n        throw new Error(`The width of a sprite cannot be 0 or negative, sprite width: ${this.width}, original width: ${naturalWidth}`);\r\n      }\r\n\r\n      if (this.height > naturalHeight) {\r\n        this.logger.warn(`The sprite height ${this.height} exceeds the height \r\n                              ${naturalHeight} of the backing texture ${this.texture.path}`);\r\n      }\r\n\r\n      if (this.height <= 0 || naturalHeight <= 0) {\r\n        throw new Error(`The height of a sprite cannot be 0 or negative, sprite height: ${this.height}, original height: ${naturalHeight}`);\r\n      }\r\n\r\n      this._flushTexture();\r\n\r\n      this._pixelsLoaded = true;\r\n    }\r\n  }\r\n\r\n  private _flushTexture() {\r\n    const naturalWidth = this.texture.image.naturalWidth || 0;\r\n    const naturalHeight = this.texture.image.naturalHeight || 0;\r\n\r\n    this._spriteCtx.clearRect(0, 0, this.width, this.height);\r\n    this._spriteCtx.drawImage(\r\n      this.texture.image,\r\n      clamp(this.x, 0, naturalWidth),\r\n      clamp(this.y, 0, naturalHeight),\r\n      clamp(this.width, 0, naturalWidth),\r\n      clamp(this.height, 0, naturalHeight),\r\n      0,\r\n      0,\r\n      this.width,\r\n      this.height\r\n    );\r\n  }\r\n\r\n  private _opacity: number = 1;\r\n  /**\r\n   * Applies the [[Opacity]] effect to a sprite, setting the alpha of all pixels to a given value\r\n   */\r\n  public opacity(value: number) {\r\n    this._opacity = value;\r\n  }\r\n\r\n  /**\r\n   * Applies the [[Grayscale]] effect to a sprite, removing color information.\r\n   */\r\n  public grayscale() {\r\n    this.addEffect(new Effects.Grayscale());\r\n  }\r\n\r\n  /**\r\n   * Applies the [[Invert]] effect to a sprite, inverting the pixel colors.\r\n   */\r\n  public invert() {\r\n    this.addEffect(new Effects.Invert());\r\n  }\r\n\r\n  /**\r\n   * Applies the [[Fill]] effect to a sprite, changing the color channels of all non-transparent pixels to match a given color\r\n   */\r\n  public fill(color: Color) {\r\n    this.addEffect(new Effects.Fill(color));\r\n  }\r\n\r\n  /**\r\n   * Applies the [[Colorize]] effect to a sprite, changing the color channels of all pixels to be the average of the original color\r\n   * and the provided color.\r\n   */\r\n  public colorize(color: Color) {\r\n    this.addEffect(new Effects.Colorize(color));\r\n  }\r\n\r\n  /**\r\n   * Applies the [[Lighten]] effect to a sprite, changes the lightness of the color according to HSL\r\n   */\r\n  public lighten(factor: number = 0.1) {\r\n    this.addEffect(new Effects.Lighten(factor));\r\n  }\r\n\r\n  /**\r\n   * Applies the [[Darken]] effect to a sprite, changes the darkness of the color according to HSL\r\n   */\r\n  public darken(factor: number = 0.1) {\r\n    this.addEffect(new Effects.Darken(factor));\r\n  }\r\n\r\n  /**\r\n   * Applies the [[Saturate]] effect to a sprite, saturates the color according to HSL\r\n   */\r\n  public saturate(factor: number = 0.1) {\r\n    this.addEffect(new Effects.Saturate(factor));\r\n  }\r\n\r\n  /**\r\n   * Applies the [[Desaturate]] effect to a sprite, desaturates the color according to HSL\r\n   */\r\n  public desaturate(factor: number = 0.1) {\r\n    this.addEffect(new Effects.Desaturate(factor));\r\n  }\r\n\r\n  /**\r\n   * Adds a new [[SpriteEffect]] to this drawing.\r\n   * @param effect  Effect to add to the this drawing\r\n   */\r\n  public addEffect(effect: Effects.SpriteEffect) {\r\n    this.effects.push(effect);\r\n    // We must check if the texture and the backing sprite pixels are loaded as well before\r\n    // an effect can be applied\r\n    if (!this.texture.isLoaded() || !this._pixelsLoaded) {\r\n      this._dirtyEffect = true;\r\n    } else {\r\n      this._applyEffects();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Removes a [[SpriteEffect]] from this sprite.\r\n   * @param effect  Effect to remove from this sprite\r\n   */\r\n  public removeEffect(effect: Effects.SpriteEffect): void;\r\n\r\n  /**\r\n   * Removes an effect given the index from this sprite.\r\n   * @param index  Index of the effect to remove from this sprite\r\n   */\r\n  public removeEffect(index: number): void;\r\n  public removeEffect(param: any) {\r\n    let indexToRemove = -1;\r\n    if (typeof param === 'number') {\r\n      indexToRemove = param;\r\n    } else {\r\n      indexToRemove = this.effects.indexOf(param);\r\n    }\r\n\r\n    // bounds check\r\n    if (indexToRemove < 0 || indexToRemove >= this.effects.length) {\r\n      return;\r\n    }\r\n\r\n    this.effects.splice(indexToRemove, 1);\r\n\r\n    // We must check if the texture and the backing sprite pixels are loaded as well before\r\n    // an effect can be applied\r\n    if (!this.texture.isLoaded() || !this._pixelsLoaded) {\r\n      this._dirtyEffect = true;\r\n    } else {\r\n      this._applyEffects();\r\n    }\r\n  }\r\n\r\n  private _applyEffects() {\r\n    this._flushTexture();\r\n\r\n    if (this.effects.length > 0) {\r\n      this._pixelData = this._spriteCtx.getImageData(0, 0, this.width, this.height);\r\n\r\n      const len = this.effects.length;\r\n      for (let i = 0; i < len; i++) {\r\n        for (let y = 0; y < this.height; y++) {\r\n          for (let x = 0; x < this.width; x++) {\r\n            this.effects[i].updatePixel(x, y, this._pixelData);\r\n          }\r\n        }\r\n      }\r\n      this._spriteCtx.clearRect(0, 0, this.width, this.height);\r\n      this._spriteCtx.putImageData(this._pixelData, 0, 0);\r\n    }\r\n\r\n    this._dirtyEffect = false;\r\n  }\r\n\r\n  /**\r\n   * Clears all effects from the drawing and return it to its original state.\r\n   */\r\n  public clearEffects() {\r\n    this.effects.length = 0;\r\n    this._applyEffects();\r\n  }\r\n\r\n  /**\r\n   * Resets the internal state of the drawing (if any)\r\n   */\r\n  public reset() {\r\n    // do nothing\r\n  }\r\n\r\n  public debugDraw(ctx: CanvasRenderingContext2D, x: number, y: number) {\r\n    ctx.save();\r\n    ctx.translate(x, y);\r\n    ctx.rotate(this.rotation);\r\n    const xpoint = this.drawWidth * this.anchor.x;\r\n    const ypoint = this.drawHeight * this.anchor.y;\r\n\r\n    ctx.strokeStyle = Color.Black.toString();\r\n    ctx.strokeRect(-xpoint, -ypoint, this.drawWidth, this.drawHeight);\r\n    ctx.restore();\r\n  }\r\n\r\n  /**\r\n   * Draws the sprite appropriately to the 2D rendering context, at an x and y coordinate.\r\n   * @param ctx  The 2D rendering context\r\n   * @param x    The x coordinate of where to draw\r\n   * @param y    The y coordinate of where to draw\r\n   */\r\n  public draw(ctx: CanvasRenderingContext2D, x: number, y: number): void;\r\n  /**\r\n   * Draws the sprite with custom options to override internals without mutating them.\r\n   * @param options\r\n   */\r\n  public draw(options: DrawOptions): void;\r\n  public draw(ctxOrOptions: CanvasRenderingContext2D | DrawOptions, x?: number, y?: number): void {\r\n    if (ctxOrOptions instanceof CanvasRenderingContext2D) {\r\n      this._drawWithOptions({ ctx: ctxOrOptions, x, y });\r\n    } else {\r\n      this._drawWithOptions(ctxOrOptions);\r\n    }\r\n  }\r\n\r\n  private _drawWithOptions(options: DrawOptions) {\r\n    const { ctx, x, y, rotation, drawWidth, drawHeight, anchor, offset, opacity, flipHorizontal, flipVertical } = {\r\n      ...options,\r\n      rotation: options.rotation ?? this.rotation,\r\n      drawWidth: options.drawWidth ?? this.width,\r\n      drawHeight: options.drawHeight ?? this.height,\r\n      flipHorizontal: options.flipHorizontal ?? this.flipHorizontal,\r\n      flipVertical: options.flipVertical ?? this.flipVertical,\r\n      anchor: options.anchor ?? this.anchor,\r\n      offset: options.offset ?? this.offset,\r\n      opacity: (options.opacity ?? 1) * (this._opacity ?? 1)\r\n    };\r\n\r\n    if (this._dirtyEffect) {\r\n      this._applyEffects();\r\n    }\r\n    // calculating current dimensions\r\n    const anchorX = drawWidth * anchor.x + offset.x;\r\n    const anchorY = drawHeight * anchor.y + offset.y;\r\n    const scaleDirX = this.scale.x > 0 ? 1 : -1;\r\n    const scaleDirY = this.scale.y > 0 ? 1 : -1;\r\n\r\n    ctx.save();\r\n    // Move the draw point of origin\r\n    ctx.translate(x, y);\r\n\r\n    // Rotate and scale around anchor point\r\n    // This requires a bit of explaination, scale coordinates first positive flipping or rotating\r\n    ctx.scale(Math.abs(this.scale.x), Math.abs(this.scale.y));\r\n\r\n    if (this.drawAroundAnchor) {\r\n      // In the case where you want the anchor to match with the point of draw\r\n      // Otherwise sprites are always drawn from top-left\r\n      ctx.translate(-anchorX, -anchorY);\r\n    }\r\n\r\n    ctx.translate(anchorX, anchorY);\r\n    ctx.rotate(rotation);\r\n    // This is for handling direction changes 1 or -1, that way we don't have mismatched translates()\r\n    ctx.scale(scaleDirX, scaleDirY);\r\n    ctx.translate(-anchorX, -anchorY);\r\n\r\n    if (flipHorizontal) {\r\n      ctx.translate(drawWidth, 0);\r\n      ctx.scale(-1, 1);\r\n    }\r\n\r\n    if (flipVertical) {\r\n      ctx.translate(0, drawHeight);\r\n      ctx.scale(1, -1);\r\n    }\r\n    const oldAlpha = ctx.globalAlpha;\r\n    ctx.globalAlpha = opacity;\r\n    // Context is already rotated and scaled\r\n    ctx.drawImage(\r\n      this._spriteCanvas,\r\n      0,\r\n      0,\r\n      this.width,\r\n      this.height, // source\r\n      0,\r\n      0,\r\n      this.width,\r\n      this.height\r\n    ); // dest\r\n    ctx.globalAlpha = oldAlpha;\r\n    ctx.restore();\r\n  }\r\n\r\n  /**\r\n   * Produces a copy of the current sprite\r\n   */\r\n  public clone(): SpriteImpl {\r\n    const result = new Sprite(this.texture, this.x, this.y, this.width, this.height);\r\n    result.anchor = this.anchor.clone();\r\n    result.scale = this.scale.clone();\r\n    result.rotation = this.rotation;\r\n    result.flipHorizontal = this.flipHorizontal;\r\n    result.flipVertical = this.flipVertical;\r\n\r\n    const len = this.effects.length;\r\n    for (let i = 0; i < len; i++) {\r\n      result.addEffect(this.effects[i]);\r\n    }\r\n    return result;\r\n  }\r\n}\r\n\r\n/**\r\n * @deprecated Use [[Sprite]]\r\n */\r\nexport interface SpriteArgs extends Partial<SpriteImpl> {\r\n  image?: Texture;\r\n  x?: number;\r\n  width?: number;\r\n  height?: number;\r\n  rotation?: number;\r\n  anchor?: Vector;\r\n  scale?: Vector;\r\n  flipVertical?: boolean;\r\n  flipHorizontal?: boolean;\r\n}\r\n\r\n/**\r\n * A [[LegacyDrawing.Sprite]] is one of the main drawing primitives. It is responsible for drawing\r\n * images or parts of images from a [[LegacyDrawing.Texture]] resource to the screen.\r\n * @deprecated Use [[Sprite]]\r\n */\r\n@obsolete({\r\n  message: 'Label.clearTextShadow will be removed in v0.26.0',\r\n  alternateMethod: 'Use Label.font.shadow'\r\n})\r\nexport class Sprite extends Configurable(SpriteImpl) {\r\n  constructor(config: SpriteArgs);\r\n  constructor(image: Texture, x: number, y: number, width: number, height: number);\r\n  constructor(imageOrConfig: Texture | SpriteArgs, x?: number, y?: number, width?: number, height?: number) {\r\n    super(imageOrConfig, x, y, width, height);\r\n  }\r\n}\r\n","import { Resource } from '../Resources/Resource';\r\nimport { Sprite } from './Sprite';\r\nimport { Loadable } from '../Interfaces/Index';\r\n/**\r\n * The [[Texture]] object allows games built in Excalibur to load image resources.\r\n * [[Texture]] is an [[Loadable]] which means it can be passed to a [[Loader]]\r\n * to pre-load before starting a level or game.\r\n * @deprecated\r\n */\r\nexport class Texture implements Loadable<HTMLImageElement> {\r\n  private _resource: Resource<Blob>;\r\n  /**\r\n   * The width of the texture in pixels\r\n   */\r\n  public width: number;\r\n\r\n  /**\r\n   * The height of the texture in pixels\r\n   */\r\n  public height: number;\r\n\r\n  private _sprite: Sprite = null;\r\n\r\n  /**\r\n   * Populated once loading is complete\r\n   */\r\n  public data: HTMLImageElement;\r\n  public get image() {\r\n    return this.data;\r\n  }\r\n\r\n  private _loadedResolve: (image: HTMLImageElement) => any;\r\n  public loaded = new Promise<HTMLImageElement>(resolve => {\r\n    this._loadedResolve = resolve;\r\n  });\r\n\r\n  /**\r\n   * @param path       Path to the image resource or a base64 string representing an image \"data:image/png;base64,iVB...\"\r\n   * @param bustCache  Optionally load texture with cache busting\r\n   */\r\n  constructor(public path: string, public bustCache = true) {\r\n    this._resource = new Resource(path, 'blob', bustCache);\r\n    this._sprite = new Sprite(this, 0, 0, 0, 0);\r\n  }\r\n\r\n  /**\r\n   * Returns true if the Texture is completely loaded and is ready\r\n   * to be drawn.\r\n   */\r\n  public isLoaded(): boolean {\r\n    return !!this.data;\r\n  }\r\n\r\n  /**\r\n   * Begins loading the texture and returns a promise to be resolved on completion\r\n   */\r\n  public async load(): Promise<HTMLImageElement> {\r\n    try {\r\n      // Load base64 or blob if needed\r\n      let url: string;\r\n      if (!this.path.includes('data:image/')) {\r\n        const blob = await this._resource.load();\r\n        url = URL.createObjectURL(blob);\r\n      } else {\r\n        url = this.path;\r\n      }\r\n\r\n      // Decode the image\r\n      const image = new Image();\r\n      image.src = url;\r\n      await image.decode();\r\n\r\n      // Set results\r\n      this.data = image;\r\n      this.width = this._sprite.width = image.naturalWidth;\r\n      this.height = this._sprite.height = image.naturalHeight;\r\n      this._sprite = new Sprite(this, 0, 0, this.width, this.height);\r\n    } catch {\r\n      await Promise.reject('Error loading texture');\r\n    }\r\n    // todo emit complete\r\n    this._loadedResolve(this.data);\r\n    return this.data;\r\n  }\r\n\r\n  public asSprite(): Sprite {\r\n    return this._sprite;\r\n  }\r\n}\r\n","import { Sprite } from './Sprite';\r\nimport * as Effects from './SpriteEffects';\r\nimport { Color } from '../Color';\r\n\r\nimport { Drawable, DrawOptions } from '../Interfaces/Drawable';\r\nimport { Vector } from '../Math/vector';\r\nimport { Engine } from '../Engine';\r\nimport * as Util from '../Util/Util';\r\nimport { Configurable } from '../Configurable';\r\nimport { obsolete } from '../Util/Decorators';\r\n\r\n/**\r\n * @deprecated Use [[HasTick]]\r\n */\r\nexport interface HasTick {\r\n  /**\r\n   *\r\n   * @param elapsedMilliseconds The amount of real world time in milliseconds that has elapsed that must be updated in the animation\r\n   */\r\n  tick(elapsedMilliseconds: number, idempotencyToken?: number): void;\r\n}\r\n\r\n/**\r\n * @hidden\r\n * @deprecated Use [[Animation]]\r\n */\r\nexport class AnimationImpl implements Drawable, HasTick {\r\n  /**\r\n   * The sprite frames to play, in order. See [[SpriteSheet.getAnimationForAll]] to quickly\r\n   * generate an [[Animation]].\r\n   */\r\n  public sprites: Sprite[] = [];\r\n\r\n  /**\r\n   * Duration to show each frame (in milliseconds)\r\n   */\r\n  public speed: number;\r\n\r\n  /**\r\n   * Current frame index being shown\r\n   */\r\n  public currentFrame: number = 0;\r\n\r\n  private _timeLeftInFrame: number = 0;\r\n  private _idempotencyToken: number = -1;\r\n\r\n  public anchor: Vector = Vector.Zero;\r\n  public rotation: number = 0.0;\r\n  public scale: Vector = Vector.One;\r\n\r\n  /**\r\n   * Indicates whether the animation should loop after it is completed\r\n   */\r\n  public loop: boolean = true;\r\n\r\n  /**\r\n   * Indicates the frame index the animation should freeze on for a non-looping\r\n   * animation. By default it is the last frame.\r\n   */\r\n  public freezeFrame: number = -1;\r\n\r\n  private _engine: Engine;\r\n\r\n  /**\r\n   * Flip each frame vertically. Sets [[Sprite.flipVertical]].\r\n   */\r\n  public flipVertical: boolean = false;\r\n\r\n  /**\r\n   * Flip each frame horizontally. Sets [[Sprite.flipHorizontal]].\r\n   */\r\n  public flipHorizontal: boolean = false;\r\n\r\n  public drawWidth: number = 0;\r\n  public drawHeight: number = 0;\r\n  public width: number = 0;\r\n  public height: number = 0;\r\n\r\n  private _opacity = 1;\r\n\r\n  /**\r\n   * Typically you will use a [[SpriteSheet]] to generate an [[Animation]].\r\n   *\r\n   * @param engineOrConfig  Reference to the current game engine\r\n   * @param sprites  An array of sprites to create the frames for the animation\r\n   * @param speed   The number in milliseconds to display each frame in the animation\r\n   * @param loop    Indicates whether the animation should loop after it is completed\r\n   */\r\n  constructor(engineOrConfig: Engine | AnimationArgs, sprites: Sprite[], speed: number, loop?: boolean) {\r\n    let engine = engineOrConfig;\r\n    if (engineOrConfig && !(engineOrConfig instanceof Engine)) {\r\n      const config = engineOrConfig;\r\n      engine = config.engine;\r\n      sprites = config.sprites;\r\n      speed = config.speed;\r\n      loop = config.loop;\r\n    }\r\n\r\n    this.sprites = sprites;\r\n    this.speed = speed;\r\n    this._engine = <Engine>engine;\r\n    this._timeLeftInFrame = this.speed;\r\n\r\n    if (loop != null) {\r\n      this.loop = loop;\r\n    }\r\n\r\n    if (sprites && sprites[0]) {\r\n      this.drawHeight = sprites[0] ? sprites[0].drawHeight : 0;\r\n      this.drawWidth = sprites[0] ? sprites[0].drawWidth : 0;\r\n\r\n      this.width = sprites[0] ? sprites[0].width : 0;\r\n      this.height = sprites[0] ? sprites[0].height : 0;\r\n\r\n      this.freezeFrame = sprites.length - 1;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Applies the opacity effect to a sprite, setting the alpha of all pixels to a given value\r\n   */\r\n  public opacity(value: number) {\r\n    this._opacity = value;\r\n  }\r\n\r\n  /**\r\n   * Applies the grayscale effect to a sprite, removing color information.\r\n   */\r\n  public grayscale() {\r\n    this.addEffect(new Effects.Grayscale());\r\n  }\r\n\r\n  /**\r\n   * Applies the invert effect to a sprite, inverting the pixel colors.\r\n   */\r\n  public invert() {\r\n    this.addEffect(new Effects.Invert());\r\n  }\r\n\r\n  /**\r\n   * Applies the fill effect to a sprite, changing the color channels of all non-transparent pixels to match a given color\r\n   */\r\n  public fill(color: Color) {\r\n    this.addEffect(new Effects.Fill(color));\r\n  }\r\n\r\n  /**\r\n   * Applies the colorize effect to a sprite, changing the color channels of all pixels to be the average of the original color and the\r\n   * provided color.\r\n   */\r\n  public colorize(color: Color) {\r\n    this.addEffect(new Effects.Colorize(color));\r\n  }\r\n\r\n  /**\r\n   * Applies the lighten effect to a sprite, changes the lightness of the color according to hsl\r\n   */\r\n  public lighten(factor: number = 0.1) {\r\n    this.addEffect(new Effects.Lighten(factor));\r\n  }\r\n\r\n  /**\r\n   * Applies the darken effect to a sprite, changes the darkness of the color according to hsl\r\n   */\r\n  public darken(factor: number = 0.1) {\r\n    this.addEffect(new Effects.Darken(factor));\r\n  }\r\n\r\n  /**\r\n   * Applies the saturate effect to a sprite, saturates the color according to hsl\r\n   */\r\n  public saturate(factor: number = 0.1) {\r\n    this.addEffect(new Effects.Saturate(factor));\r\n  }\r\n\r\n  /**\r\n   * Applies the desaturate effect to a sprite, desaturates the color according to hsl\r\n   */\r\n  public desaturate(factor: number = 0.1) {\r\n    this.addEffect(new Effects.Desaturate(factor));\r\n  }\r\n\r\n  /**\r\n   * Add a [[SpriteEffect]] manually\r\n   */\r\n  public addEffect(effect: Effects.SpriteEffect) {\r\n    for (const i in this.sprites) {\r\n      this.sprites[i].addEffect(effect);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Removes an [[SpriteEffect]] from this animation.\r\n   * @param effect Effect to remove from this animation\r\n   */\r\n  public removeEffect(effect: Effects.SpriteEffect): void;\r\n\r\n  /**\r\n   * Removes an effect given the index from this animation.\r\n   * @param index  Index of the effect to remove from this animation\r\n   */\r\n  public removeEffect(index: number): void;\r\n  public removeEffect(param: any) {\r\n    for (const i in this.sprites) {\r\n      this.sprites[i].removeEffect(param);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clear all sprite effects\r\n   */\r\n  public clearEffects() {\r\n    for (const i in this.sprites) {\r\n      this.sprites[i].clearEffects();\r\n    }\r\n  }\r\n\r\n  private _setAnchor(point: Vector) {\r\n    //if (!this.anchor.equals(point)) {\r\n    for (const i in this.sprites) {\r\n      this.sprites[i].anchor.setTo(point.x, point.y);\r\n    }\r\n    //}\r\n  }\r\n\r\n  private _setRotation(radians: number) {\r\n    //if (this.rotation !== radians) {\r\n    for (const i in this.sprites) {\r\n      this.sprites[i].rotation = radians;\r\n    }\r\n    //}\r\n  }\r\n\r\n  private _setScale(scale: Vector) {\r\n    //if (!this.scale.equals(scale)) {\r\n    for (const i in this.sprites) {\r\n      this.sprites[i].scale = scale;\r\n    }\r\n    //}\r\n  }\r\n\r\n  /**\r\n   * Resets the animation to first frame.\r\n   */\r\n  public reset() {\r\n    this.currentFrame = 0;\r\n  }\r\n\r\n  /**\r\n   * Indicates whether the animation is complete, animations that loop are never complete.\r\n   */\r\n  public isDone() {\r\n    return !this.loop && this.currentFrame >= this.sprites.length;\r\n  }\r\n\r\n  /**\r\n   * Not meant to be called by game developers. Ticks the animation forward internally and\r\n   * calculates whether to change to the frame.\r\n   * @internal\r\n   */\r\n  public tick(elapsed: number, idempotencyToken?: number) {\r\n    if (this._idempotencyToken === idempotencyToken) {\r\n      return;\r\n    }\r\n    this._idempotencyToken = idempotencyToken;\r\n    this._timeLeftInFrame -= elapsed;\r\n    if (this._timeLeftInFrame <= 0) {\r\n      this.currentFrame = this.loop ? (this.currentFrame + 1) % this.sprites.length : this.currentFrame + 1;\r\n      this._timeLeftInFrame = this.speed;\r\n    }\r\n\r\n    this._updateValues();\r\n    const current = this.sprites[this.currentFrame];\r\n    if (current) {\r\n      this.width = current.width;\r\n      this.height = current.height;\r\n      this.drawWidth = current.drawWidth;\r\n      this.drawHeight = current.drawHeight;\r\n    }\r\n  }\r\n\r\n  private _updateValues(): void {\r\n    this._setAnchor(this.anchor);\r\n    this._setRotation(this.rotation);\r\n    this._setScale(this.scale);\r\n  }\r\n\r\n  /**\r\n   * Skips ahead a specified number of frames in the animation\r\n   * @param frames  Frames to skip ahead\r\n   */\r\n  public skip(frames: number) {\r\n    this.currentFrame = (this.currentFrame + frames) % this.sprites.length;\r\n  }\r\n\r\n  /**\r\n   * Draws the animation appropriately to the 2D rendering context, at an x and y coordinate.\r\n   * @param ctx  The 2D rendering context\r\n   * @param x    The x coordinate of where to draw\r\n   * @param y    The y coordinate of where to draw\r\n   */\r\n  public draw(ctx: CanvasRenderingContext2D, x: number, y: number): void;\r\n  /**\r\n   * Draws the animation with custom options to override internals without mutating them.\r\n   * @param options\r\n   */\r\n  public draw(options: DrawOptions): void;\r\n  public draw(ctxOrOptions: CanvasRenderingContext2D | DrawOptions, x?: number, y?: number) {\r\n    if (ctxOrOptions instanceof CanvasRenderingContext2D) {\r\n      this._drawWithOptions({ ctx: ctxOrOptions, x, y });\r\n    } else {\r\n      this._drawWithOptions(ctxOrOptions);\r\n    }\r\n  }\r\n\r\n  private _drawWithOptions(options: DrawOptions) {\r\n    const animOptions = {\r\n      ...options,\r\n      rotation: options.rotation ?? this.rotation,\r\n      drawWidth: options.drawWidth ?? this.drawWidth,\r\n      drawHeight: options.drawHeight ?? this.drawHeight,\r\n      flipHorizontal: options.flipHorizontal ?? this.flipHorizontal,\r\n      flipVertical: options.flipVertical ?? this.flipVertical,\r\n      anchor: options.anchor ?? this.anchor,\r\n      opacity: (options.opacity ?? 1) * (this._opacity ?? 1)\r\n    };\r\n\r\n    this._updateValues();\r\n    let currSprite: Sprite;\r\n    if (this.currentFrame < this.sprites.length) {\r\n      currSprite = this.sprites[this.currentFrame];\r\n      currSprite.draw(animOptions);\r\n    }\r\n\r\n    if (this.freezeFrame !== -1 && this.currentFrame >= this.sprites.length) {\r\n      currSprite = this.sprites[Util.clamp(this.freezeFrame, 0, this.sprites.length - 1)];\r\n      currSprite.draw(animOptions);\r\n    }\r\n\r\n    // add the calculated width\r\n    if (currSprite) {\r\n      this.drawWidth = currSprite.drawWidth;\r\n      this.drawHeight = currSprite.drawHeight;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Plays an animation at an arbitrary location in the game.\r\n   * @param x  The x position in the game to play\r\n   * @param y  The y position in the game to play\r\n   */\r\n  public play(x: number, y: number) {\r\n    this.reset();\r\n    this._engine.playAnimation(this, x, y);\r\n  }\r\n}\r\n\r\n/**\r\n * @deprecated Use [[Animation]]\r\n */\r\nexport interface AnimationArgs extends Partial<AnimationImpl> {\r\n  engine: Engine;\r\n  sprites: Sprite[];\r\n  speed: number;\r\n  loop?: boolean;\r\n  anchor?: Vector;\r\n  rotation?: number;\r\n  scale?: Vector;\r\n  flipVertical?: boolean;\r\n  flipHorizontal?: boolean;\r\n  width?: number;\r\n  height?: number;\r\n}\r\n\r\n/**\r\n * Animations allow you to display a series of images one after another,\r\n * creating the illusion of change. Generally these images will come from a [[SpriteSheet]] source.\r\n * @deprecated Use [[Animation]]\r\n */\r\n@obsolete({\r\n  message: 'Animation will be removed in v0.26.0',\r\n  alternateMethod: 'Use Graphics.Animation'\r\n})\r\nexport class Animation extends Configurable(AnimationImpl) {\r\n  constructor(config: AnimationArgs);\r\n  constructor(engine: Engine, images: Sprite[], speed: number, loop?: boolean);\r\n  constructor(engineOrConfig: Engine | AnimationArgs, images?: Sprite[], speed?: number, loop?: boolean) {\r\n    super(engineOrConfig, images, speed, loop);\r\n  }\r\n}\r\n","import { vec } from '..';\nimport { Vector } from './vector';\nimport { canonicalizeAngle } from '../Util/Util';\n\nexport enum MatrixLocations {\n  X = 12,\n  Y = 13\n}\n\nconst sign = (val: number) => {\n  if (val === 0) {\n    return 0;\n  }\n  return val < 0 ? -1 : 1;\n};\n\n// const multMatch = (a: number, b: number) => {\n//   if (sign(a) < 0 && sign(b) < 0) {\n//     return -Math.abs(a * b);\n//   }\n//   return a * b;\n// }\n\n// const epsilon = (val: number) => {\n//   if (val * val < .0001) {\n//     return 0;\n//   }\n//   return val;\n// }\n\n/**\n * Excalibur Matrix helper for 4x4 matrices\n *\n * Useful for webgl 4x4 matrices\n */\nexport class Matrix {\n  /**\n   *  4x4 matrix in column major order\n   *\n   * |         |         |          |          |\n   * | ------- | ------- | -------- |          |\n   * | data[0] | data[4] | data[8]  | data[12] |\n   * | data[1] | data[5] | data[9]  | data[13] |\n   * | data[2] | data[6] | data[10] | data[14] |\n   * | data[3] | data[7] | data[11] | data[15] |\n   *\n   */\n  public data: Float32Array = new Float32Array(16);\n\n  /**\n   * Creates an orthographic (flat non-perspective) projection\n   * https://en.wikipedia.org/wiki/Orthographic_projection\n   * @param left\n   * @param right\n   * @param bottom\n   * @param top\n   * @param near\n   * @param far\n   */\n  public static ortho(left: number, right: number, bottom: number, top: number, near: number, far: number): Matrix {\n    const mat = new Matrix();\n    mat.data[0] = 2 / (right - left);\n    mat.data[1] = 0;\n    mat.data[2] = 0;\n    mat.data[3] = 0;\n\n    mat.data[4] = 0;\n    mat.data[5] = 2 / (top - bottom);\n    mat.data[6] = 0;\n    mat.data[7] = 0;\n\n    mat.data[8] = 0;\n    mat.data[9] = 0;\n    mat.data[10] = -2 / (far - near);\n    mat.data[11] = 0;\n\n    mat.data[12] = -(right + left) / (right - left);\n    mat.data[13] = -(top + bottom) / (top - bottom);\n    mat.data[14] = -(far + near) / (far - near);\n    mat.data[15] = 1;\n    return mat;\n  }\n\n  /**\n   * Creates a new Matrix with the same data as the current 4x4\n   */\n  public clone(): Matrix {\n    const mat = new Matrix();\n    mat.data[0] = this.data[0];\n    mat.data[1] = this.data[1];\n    mat.data[2] = this.data[2];\n    mat.data[3] = this.data[3];\n\n    mat.data[4] = this.data[4];\n    mat.data[5] = this.data[5];\n    mat.data[6] = this.data[6];\n    mat.data[7] = this.data[7];\n\n    mat.data[8] = this.data[8];\n    mat.data[9] = this.data[9];\n    mat.data[10] = this.data[10];\n    mat.data[11] = this.data[11];\n\n    mat.data[12] = this.data[12];\n    mat.data[13] = this.data[13];\n    mat.data[14] = this.data[14];\n    mat.data[15] = this.data[15];\n    return mat;\n  }\n\n  /**\n   * Creates a new identity matrix (a matrix that when applied does nothing)\n   */\n  public static identity(): Matrix {\n    const mat = new Matrix();\n    mat.data[0] = 1;\n    mat.data[1] = 0;\n    mat.data[2] = 0;\n    mat.data[3] = 0;\n\n    mat.data[4] = 0;\n    mat.data[5] = 1;\n    mat.data[6] = 0;\n    mat.data[7] = 0;\n\n    mat.data[8] = 0;\n    mat.data[9] = 0;\n    mat.data[10] = 1;\n    mat.data[11] = 0;\n\n    mat.data[12] = 0;\n    mat.data[13] = 0;\n    mat.data[14] = 0;\n    mat.data[15] = 1;\n    return mat;\n  }\n\n  /**\n   * Creates a brand new translation matrix at the specified 3d point\n   * @param x\n   * @param y\n   */\n  public static translation(x: number, y: number): Matrix {\n    const mat = Matrix.identity();\n    mat.data[12] = x;\n    mat.data[13] = y;\n    return mat;\n  }\n\n  /**\n   * Creates a brand new scaling matrix with the specified scaling factor\n   * @param sx\n   * @param sy\n   */\n  public static scale(sx: number, sy: number): Matrix {\n    const mat = Matrix.identity();\n    mat.data[0] = sx;\n    mat.data[5] = sy;\n    mat.data[10] = 1;\n    mat.data[15] = 1;\n    return mat;\n  }\n\n  /**\n   * Creates a brand new rotation matrix with the specified angle\n   * @param angleRadians\n   */\n  public static rotation(angleRadians: number): Matrix {\n    const mat = Matrix.identity();\n    mat.data[0] = Math.cos(angleRadians);\n    mat.data[4] = -Math.sin(angleRadians);\n    mat.data[1] = Math.sin(angleRadians);\n    mat.data[5] = Math.cos(angleRadians);\n    return mat;\n  }\n\n  /**\n   * Multiplies the current matrix by a vector and returns the resulting vector\n   * @param other\n   */\n  multv(other: [number, number]): [number, number];\n  multv(other: Vector): Vector;\n  multv(other: [number, number] | Vector): [number, number] | Vector {\n    const z = 0;\n    if (other instanceof Vector) {\n      return new Vector(\n        other.x * this.data[0] + other.y * this.data[4] + z * this.data[6] + 1 * this.data[12],\n        other.x * this.data[1] + other.y * this.data[5] + z * this.data[9] + 1 * this.data[13]\n      );\n    } else {\n      const dest: [number, number] = [\n        other[0] * this.data[0] + other[1] * this.data[4] + z * this.data[6] + 1 * this.data[12],\n\n        other[0] * this.data[1] + other[1] * this.data[5] + z * this.data[9] + 1 * this.data[13]\n      ];\n      return dest;\n    }\n  }\n\n  /**\n   * Multiplies the current matrix by another and returns the resulting matrix\n   * @param other\n   */\n  multm(other: Matrix): Matrix {\n    const dest = new Matrix();\n    const a11 = this.data[0];\n    const a21 = this.data[1];\n    const a31 = this.data[2];\n    const a41 = this.data[3];\n\n    const a12 = this.data[4];\n    const a22 = this.data[5];\n    const a32 = this.data[6];\n    const a42 = this.data[7];\n\n    const a13 = this.data[8];\n    const a23 = this.data[9];\n    const a33 = this.data[10];\n    const a43 = this.data[11];\n\n    const a14 = this.data[12];\n    const a24 = this.data[13];\n    const a34 = this.data[14];\n    const a44 = this.data[15];\n\n    const b11 = other.data[0];\n    const b21 = other.data[1];\n    const b31 = other.data[2];\n    const b41 = other.data[3];\n\n    const b12 = other.data[4];\n    const b22 = other.data[5];\n    const b32 = other.data[6];\n    const b42 = other.data[7];\n\n    const b13 = other.data[8];\n    const b23 = other.data[9];\n    const b33 = other.data[10];\n    const b43 = other.data[11];\n\n    const b14 = other.data[12];\n    const b24 = other.data[13];\n    const b34 = other.data[14];\n    const b44 = other.data[15];\n\n    dest.data[0] = a11 * b11 + a12 * b21 + a13 * b31 + a14 * b41;\n    dest.data[1] = a21 * b11 + a22 * b21 + a23 * b31 + a24 * b41;\n    dest.data[2] = a31 * b11 + a32 * b21 + a33 * b31 + a34 * b41;\n    dest.data[3] = a41 * b11 + a42 * b21 + a43 * b31 + a44 * b41;\n\n    dest.data[4] = a11 * b12 + a12 * b22 + a13 * b32 + a14 * b42;\n    dest.data[5] = a21 * b12 + a22 * b22 + a23 * b32 + a24 * b42;\n    dest.data[6] = a31 * b12 + a32 * b22 + a33 * b32 + a34 * b42;\n    dest.data[7] = a41 * b12 + a42 * b22 + a43 * b32 + a44 * b42;\n\n    dest.data[8] = a11 * b13 + a12 * b23 + a13 * b33 + a14 * b43;\n    dest.data[9] = a21 * b13 + a22 * b23 + a23 * b33 + a24 * b43;\n    dest.data[10] = a31 * b13 + a32 * b23 + a33 * b33 + a34 * b43;\n    dest.data[11] = a41 * b13 + a42 * b23 + a43 * b33 + a44 * b43;\n\n    dest.data[12] = a11 * b14 + a12 * b24 + a13 * b34 + a14 * b44;\n    dest.data[13] = a21 * b14 + a22 * b24 + a23 * b34 + a24 * b44;\n    dest.data[14] = a31 * b14 + a32 * b24 + a33 * b34 + a34 * b44;\n    dest.data[15] = a41 * b14 + a42 * b24 + a43 * b34 + a44 * b44;\n\n    const s = this.getScale();\n    dest._scaleSignX = sign(s.x) * sign(dest._scaleSignX);\n    dest._scaleSignY = sign(s.y) * sign(dest._scaleSignY);\n\n    return dest;\n  }\n\n  /**\n   * Applies translation to the current matrix mutating it\n   * @param x\n   * @param y\n   */\n  translate(x: number, y: number) {\n    const a11 = this.data[0];\n    const a21 = this.data[1];\n    const a31 = this.data[2];\n    const a41 = this.data[3];\n\n    const a12 = this.data[4];\n    const a22 = this.data[5];\n    const a32 = this.data[6];\n    const a42 = this.data[7];\n\n    const a13 = this.data[8];\n    const a23 = this.data[9];\n    const a33 = this.data[10];\n    const a43 = this.data[11];\n\n    const a14 = this.data[12];\n    const a24 = this.data[13];\n    const a34 = this.data[14];\n    const a44 = this.data[15];\n\n    // Doesn't change z\n    const z = 0;\n    const w = 1;\n    this.data[12] = a11 * x + a12 * y + a13 * z + a14 * w;\n    this.data[13] = a21 * x + a22 * y + a23 * z + a24 * w;\n    this.data[14] = a31 * x + a32 * y + a33 * z + a34 * w;\n    this.data[15] = a41 * x + a42 * y + a43 * z + a44 * w;\n\n    return this;\n  }\n\n  public setPosition(x: number, y: number) {\n    this.data[12] = x;\n    this.data[13] = y;\n  }\n\n  public getPosition(): Vector {\n    return vec(this.data[12], this.data[13]);\n  }\n\n  /**\n   * Applies rotation to the current matrix mutating it\n   * @param angle in Radians\n   */\n  rotate(angle: number) {\n    const a11 = this.data[0];\n    const a21 = this.data[1];\n    const a31 = this.data[2];\n    const a41 = this.data[3];\n\n    const a12 = this.data[4];\n    const a22 = this.data[5];\n    const a32 = this.data[6];\n    const a42 = this.data[7];\n\n    const sine = Math.sin(angle);\n    const cosine = Math.cos(angle);\n\n    this.data[0] = cosine * a11 + sine * a12;\n    this.data[1] = cosine * a21 + sine * a22;\n    this.data[2] = cosine * a31 + sine * a32;\n    this.data[3] = cosine * a41 + sine * a42;\n\n    this.data[4] = cosine * a12 - sine * a11;\n    this.data[5] = cosine * a22 - sine * a21;\n    this.data[6] = cosine * a32 - sine * a31;\n    this.data[7] = cosine * a42 - sine * a41;\n\n    return this;\n  }\n\n  /**\n   * Applies scaling to the current matrix mutating it\n   * @param x\n   * @param y\n   */\n  scale(x: number, y: number) {\n    const a11 = this.data[0];\n    const a21 = this.data[1];\n    const a31 = this.data[2];\n    const a41 = this.data[3];\n\n    const a12 = this.data[4];\n    const a22 = this.data[5];\n    const a32 = this.data[6];\n    const a42 = this.data[7];\n\n    this.data[0] = a11 * x;\n    this.data[1] = a21 * x;\n    this.data[2] = a31 * x;\n    this.data[3] = a41 * x;\n\n    this.data[4] = a12 * y;\n    this.data[5] = a22 * y;\n    this.data[6] = a32 * y;\n    this.data[7] = a42 * y;\n\n    return this;\n  }\n\n  public setRotation(angle: number) {\n    const currentScale = this.getScale();\n    const sine = Math.sin(angle);\n    const cosine = Math.cos(angle);\n\n    this.data[0] = cosine * currentScale.x;\n    this.data[1] = sine * currentScale.y;\n    this.data[4] = -sine * currentScale.x;\n    this.data[5] = cosine * currentScale.y;\n  }\n\n  public getRotation(): number {\n    const angle = Math.atan2(this.data[1] / this.getScaleY(), this.data[0] / this.getScaleX());\n    return canonicalizeAngle(angle);\n  }\n\n  public getScaleX(): number {\n    // absolute scale of the matrix (we lose sign so need to add it back)\n    const xscale = vec(this.data[0], this.data[4]).size;\n    return this._scaleSignX * xscale;\n  }\n\n  public getScaleY(): number {\n    // absolute scale of the matrix (we lose sign so need to add it back)\n    const yscale = vec(this.data[1], this.data[5]).size;\n    return this._scaleSignY * yscale;\n  }\n\n  /**\n   * Get the scale of the matrix\n   */\n  public getScale(): Vector {\n    return vec(this.getScaleX(), this.getScaleY());\n  }\n\n  private _scaleSignX = 1;\n  public setScaleX(val: number) {\n    this._scaleSignX = sign(val);\n    // negative scale acts like a 180 rotation, so flip\n    const xscale = vec(this.data[0] * this._scaleSignX, this.data[4] * this._scaleSignX).normalize();\n    this.data[0] = xscale.x * val;\n    this.data[4] = xscale.y * val;\n  }\n\n  private _scaleSignY = 1;\n  public setScaleY(val: number) {\n    this._scaleSignY = sign(val);\n    // negative scale acts like a 180 rotation, so flip\n    const yscale = vec(this.data[1] * this._scaleSignY, this.data[5] * this._scaleSignY).normalize();\n    this.data[1] = yscale.x * val;\n    this.data[5] = yscale.y * val;\n  }\n\n  public setScale(scale: Vector) {\n    this.setScaleX(scale.x);\n    this.setScaleY(scale.y);\n  }\n\n  /**\n   * Determinant of the upper left 2x2 matrix\n   */\n  public getBasisDeterminant() {\n    return this.data[0] * this.data[5] - this.data[1] * this.data[4];\n  }\n\n  public getAffineInverse(): Matrix {\n    // See http://negativeprobability.blogspot.com/2011/11/affine-transformations-and-their.html\n    // See https://www.mathsisfun.com/algebra/matrix-inverse.html\n    // Since we are actually only doing 2D transformations we can use this hack\n    // We don't actually use the 3rd or 4th dimension\n\n    const det = this.getBasisDeterminant();\n    const inverseDet = 1 / det; // todo zero check\n    const a = this.data[0];\n    const b = this.data[4];\n    const c = this.data[1];\n    const d = this.data[5];\n\n    const m = Matrix.identity();\n    // inverts rotation and scale\n    m.data[0] = d * inverseDet;\n    m.data[1] = -c * inverseDet;\n    m.data[4] = -b * inverseDet;\n    m.data[5] = a * inverseDet;\n\n    const tx = this.data[12];\n    const ty = this.data[13];\n    // invert translation\n    // transform translation into the matrix basis created by rot/scale\n    m.data[12] = -(tx * m.data[0] + ty * m.data[4]);\n    m.data[13] = -(tx * m.data[1] + ty * m.data[5]);\n\n    return m;\n  }\n\n  public isIdentity(): boolean {\n    return (\n      this.data[0] === 1 &&\n      this.data[1] === 0 &&\n      this.data[2] === 0 &&\n      this.data[3] === 0 &&\n      this.data[4] === 0 &&\n      this.data[5] === 1 &&\n      this.data[6] === 0 &&\n      this.data[7] === 0 &&\n      this.data[8] === 0 &&\n      this.data[9] === 0 &&\n      this.data[10] === 1 &&\n      this.data[11] === 0 &&\n      this.data[12] === 0 &&\n      this.data[13] === 0 &&\n      this.data[14] === 0 &&\n      this.data[15] === 1\n    );\n  }\n\n  public toString() {\n    return `\n[${this.data[0]} ${this.data[4]} ${this.data[8]} ${this.data[12]}]\n[${this.data[1]} ${this.data[5]} ${this.data[9]} ${this.data[13]}]\n[${this.data[2]} ${this.data[6]} ${this.data[10]} ${this.data[14]}]\n[${this.data[3]} ${this.data[7]} ${this.data[11]} ${this.data[15]}]\n`;\n  }\n}\n","import { Vector } from '../Math/vector';\nimport { obsolete } from '../Util/Decorators';\n\n/**\n * A definition of an EasingFunction. See [[EasingFunctions]].\n */\n// tslint:disable-next-line\nexport interface EasingFunction {\n  (currentTime: number, startValue: number, endValue: number, duration: number): number;\n}\n\n/**\n * Standard easing functions for motion in Excalibur, defined on a domain of [0, duration] and a range from [+startValue,+endValue]\n * Given a time, the function will return a value from positive startValue to positive endValue.\n *\n * ```js\n * function Linear (t) {\n *    return t * t;\n * }\n *\n * // accelerating from zero velocity\n * function EaseInQuad (t) {\n *    return t * t;\n * }\n *\n * // decelerating to zero velocity\n * function EaseOutQuad (t) {\n *    return t * (2 - t);\n * }\n *\n * // acceleration until halfway, then deceleration\n * function EaseInOutQuad (t) {\n *    return t < .5 ? 2 * t * t : -1 + (4 - 2 * t) * t;\n * }\n *\n * // accelerating from zero velocity\n * function EaseInCubic (t) {\n *    return t * t * t;\n * }\n *\n * // decelerating to zero velocity\n * function EaseOutCubic (t) {\n *    return (--t) * t * t + 1;\n * }\n *\n * // acceleration until halfway, then deceleration\n * function EaseInOutCubic (t) {\n *    return t < .5 ? 4 * t * t * t : (t - 1) * (2 * t - 2) * (2 * t - 2) + 1;\n * }\n * ```\n */\nexport class EasingFunctions {\n  public static CreateReversibleEasingFunction(easing: EasingFunction) {\n    return (time: number, start: number, end: number, duration: number) => {\n      if (end < start) {\n        return start - (easing(time, end, start, duration) - end);\n      } else {\n        return easing(time, start, end, duration);\n      }\n    };\n  }\n\n  @obsolete({\n    message: 'Alias for incorrect spelling used in older versions, will be removed in v0.25.0',\n    alternateMethod: 'CreateReversibleEasingFunction'\n  })\n  public static CreateReversableEasingFunction(easing: EasingFunction) {\n    return EasingFunctions.CreateReversibleEasingFunction(easing);\n  }\n\n  public static CreateVectorEasingFunction(easing: EasingFunction) {\n    return (time: number, start: Vector, end: Vector, duration: number) => {\n      return new Vector(easing(time, start.x, end.x, duration), easing(time, start.y, end.y, duration));\n    };\n  }\n\n  public static Linear: EasingFunction = EasingFunctions.CreateReversibleEasingFunction(\n    (currentTime: number, startValue: number, endValue: number, duration: number) => {\n      endValue = endValue - startValue;\n      return (endValue * currentTime) / duration + startValue;\n    }\n  );\n\n  public static EaseInQuad = EasingFunctions.CreateReversibleEasingFunction(\n    (currentTime: number, startValue: number, endValue: number, duration: number) => {\n      endValue = endValue - startValue;\n      currentTime /= duration;\n\n      return endValue * currentTime * currentTime + startValue;\n    }\n  );\n\n  public static EaseOutQuad: EasingFunction = EasingFunctions.CreateReversibleEasingFunction(\n    (currentTime: number, startValue: number, endValue: number, duration: number) => {\n      endValue = endValue - startValue;\n      currentTime /= duration;\n      return -endValue * currentTime * (currentTime - 2) + startValue;\n    }\n  );\n\n  public static EaseInOutQuad: EasingFunction = EasingFunctions.CreateReversibleEasingFunction(\n    (currentTime: number, startValue: number, endValue: number, duration: number) => {\n      endValue = endValue - startValue;\n      currentTime /= duration / 2;\n\n      if (currentTime < 1) {\n        return (endValue / 2) * currentTime * currentTime + startValue;\n      }\n      currentTime--;\n\n      return (-endValue / 2) * (currentTime * (currentTime - 2) - 1) + startValue;\n    }\n  );\n\n  public static EaseInCubic: EasingFunction = EasingFunctions.CreateReversibleEasingFunction(\n    (currentTime: number, startValue: number, endValue: number, duration: number) => {\n      endValue = endValue - startValue;\n      currentTime /= duration;\n      return endValue * currentTime * currentTime * currentTime + startValue;\n    }\n  );\n\n  public static EaseOutCubic: EasingFunction = EasingFunctions.CreateReversibleEasingFunction(\n    (currentTime: number, startValue: number, endValue: number, duration: number) => {\n      endValue = endValue - startValue;\n      currentTime /= duration;\n      currentTime--;\n      return endValue * (currentTime * currentTime * currentTime + 1) + startValue;\n    }\n  );\n\n  public static EaseInOutCubic: EasingFunction = EasingFunctions.CreateReversibleEasingFunction(\n    (currentTime: number, startValue: number, endValue: number, duration: number) => {\n      endValue = endValue - startValue;\n      currentTime /= duration / 2;\n      if (currentTime < 1) {\n        return (endValue / 2) * currentTime * currentTime * currentTime + startValue;\n      }\n      currentTime -= 2;\n      return (endValue / 2) * (currentTime * currentTime * currentTime + 2) + startValue;\n    }\n  );\n}\n","import { Actor } from '../Actor';\r\nimport { Action } from './Action';\r\n\r\n/**\r\n * Action Queues represent an ordered sequence of actions\r\n *\r\n * Action queues are part of the [[ActionContext|Action API]] and\r\n * store the list of actions to be executed for an [[Actor]].\r\n *\r\n * Actors implement [[Actor.actions]] which can be manipulated by\r\n * advanced users to adjust the actions currently being executed in the\r\n * queue.\r\n */\r\nexport class ActionQueue {\r\n  private _actor: Actor;\r\n  private _actions: Action[] = [];\r\n  private _currentAction: Action;\r\n  private _completedActions: Action[] = [];\r\n  constructor(actor: Actor) {\r\n    this._actor = actor;\r\n  }\r\n\r\n  /**\r\n   * Add an action to the sequence\r\n   * @param action\r\n   */\r\n  public add(action: Action) {\r\n    this._actions.push(action);\r\n  }\r\n\r\n  /**\r\n   * Remove an action by reference from the sequence\r\n   * @param action\r\n   */\r\n  public remove(action: Action) {\r\n    const index = this._actions.indexOf(action);\r\n    this._actions.splice(index, 1);\r\n  }\r\n\r\n  /**\r\n   * Removes all actions from this sequence\r\n   */\r\n  public clearActions(): void {\r\n    this._actions.length = 0;\r\n    this._completedActions.length = 0;\r\n    if (this._currentAction) {\r\n      this._currentAction.stop();\r\n    }\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @returns The total list of actions in this sequence complete or not\r\n   */\r\n  public getActions(): Action[] {\r\n    return this._actions.concat(this._completedActions);\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @returns `true` if there are more actions to process in the sequence\r\n   */\r\n  public hasNext(): boolean {\r\n    return this._actions.length > 0;\r\n  }\r\n\r\n  /**\r\n   * @returns `true` if the current sequence of actions is done\r\n   */\r\n  public isComplete(): boolean {\r\n    return this._actions.length === 0;\r\n  }\r\n\r\n  /**\r\n   * Resets the sequence of actions, this is used to restart a sequence from the beginning\r\n   */\r\n  public reset(): void {\r\n    this._actions = this.getActions();\r\n\r\n    const len = this._actions.length;\r\n    for (let i = 0; i < len; i++) {\r\n      this._actions[i].reset();\r\n    }\r\n    this._completedActions = [];\r\n  }\r\n\r\n  /**\r\n   * Update the queue which updates actions and handles completing actions\r\n   * @param elapsedMs\r\n   */\r\n  public update(elapsedMs: number) {\r\n    if (this._actions.length > 0) {\r\n      this._currentAction = this._actions[0];\r\n      this._currentAction.update(elapsedMs);\r\n\r\n      if (this._currentAction.isComplete(this._actor)) {\r\n        this._completedActions.push(this._actions.shift());\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { Actor } from '../../Actor';\r\nimport { Action } from '../Action';\r\nimport { ActionContext } from '../ActionContext';\r\nimport { ActionQueue } from '../ActionQueue';\r\n\r\nexport class Repeat implements Action {\r\n  private _actionQueue: ActionQueue;\r\n  private _repeat: number;\r\n  private _originalRepeat: number;\r\n  private _stopped: boolean = false;\r\n  private _repeatContext: ActionContext;\r\n  private _repeatBuilder: (repeatContext: ActionContext) => any;\r\n  constructor(actor: Actor, repeatBuilder: (repeatContext: ActionContext) => any, repeat: number) {\r\n    this._repeatBuilder = repeatBuilder;\r\n    this._repeatContext = new ActionContext(actor);\r\n    this._actionQueue = this._repeatContext.getQueue();\r\n\r\n    this._repeat = repeat;\r\n    this._originalRepeat = repeat;\r\n\r\n    this._repeatBuilder(this._repeatContext);\r\n    this._repeat--; // current execution is the first repeat\r\n  }\r\n\r\n  public update(delta: number): void {\r\n    if (this._actionQueue.isComplete()) {\r\n      this._actionQueue.clearActions();\r\n      this._repeatBuilder(this._repeatContext);\r\n      this._repeat--;\r\n    }\r\n    this._actionQueue.update(delta);\r\n  }\r\n\r\n  public isComplete(): boolean {\r\n    return this._stopped || (this._repeat <= 0 && this._actionQueue.isComplete());\r\n  }\r\n\r\n  public stop(): void {\r\n    this._stopped = true;\r\n  }\r\n\r\n  public reset(): void {\r\n    this._repeat = this._originalRepeat;\r\n  }\r\n}\r\n","import { Actor } from '../../Actor';\r\nimport { Action } from '../Action';\r\nimport { ActionContext } from '../ActionContext';\r\nimport { ActionQueue } from '../ActionQueue';\r\n\r\n/**\r\n * RepeatForever Action implementation, it is recommended you use the fluent action\r\n * context API.\r\n *\r\n *\r\n */\r\nexport class RepeatForever implements Action {\r\n  private _actionQueue: ActionQueue;\r\n  private _stopped: boolean = false;\r\n  private _repeatContext: ActionContext;\r\n  private _repeatBuilder: (repeatContext: ActionContext) => any;\r\n  constructor(actor: Actor, repeatBuilder: (repeatContext: ActionContext) => any) {\r\n    this._repeatBuilder = repeatBuilder;\r\n    this._repeatContext = new ActionContext(actor);\r\n    this._actionQueue = this._repeatContext.getQueue();\r\n\r\n    this._repeatBuilder(this._repeatContext);\r\n  }\r\n\r\n  public update(delta: number): void {\r\n    if (this._stopped) {\r\n      return;\r\n    }\r\n\r\n    if (this._actionQueue.isComplete()) {\r\n      this._actionQueue.clearActions();\r\n      this._repeatBuilder(this._repeatContext);\r\n    }\r\n\r\n    this._actionQueue.update(delta);\r\n  }\r\n\r\n  public isComplete(): boolean {\r\n    return this._stopped;\r\n  }\r\n\r\n  public stop(): void {\r\n    this._stopped = true;\r\n    this._actionQueue.clearActions();\r\n  }\r\n\r\n  public reset(): void {\r\n    return;\r\n  }\r\n}\r\n","import { Actor } from '../../Actor';\nimport { Vector, vec } from '../../Math/vector';\nimport { Logger } from '../../Util/Log';\nimport { Action } from '../Action';\n\nexport class MoveBy implements Action {\n  private _actor: Actor;\n  public x: number;\n  public y: number;\n  private _distance: number;\n  private _speed: number;\n\n  private _start: Vector;\n  private _offset: Vector;\n  private _end: Vector;\n  private _dir: Vector;\n  private _started = false;\n  private _stopped = false;\n\n  constructor(actor: Actor, offsetX: number, offsetY: number, speed: number) {\n    this._actor = actor;\n    this._speed = speed;\n    this._offset = new Vector(offsetX, offsetY);\n    if (speed <= 0) {\n      Logger.getInstance().error('Attempted to moveBy with speed less than or equal to zero : ' + speed);\n      throw new Error('Speed must be greater than 0 pixels per second');\n    }\n  }\n\n  public update(_delta: number) {\n    if (!this._started) {\n      this._started = true;\n      this._start = new Vector(this._actor.pos.x, this._actor.pos.y);\n      this._end = this._start.add(this._offset);\n      this._distance = this._offset.size;\n      this._dir = this._end.sub(this._start).normalize();\n    }\n\n    if (this.isComplete(this._actor)) {\n      this._actor.pos = vec(this._end.x, this._end.y);\n      this._actor.vel = vec(0, 0);\n    } else {\n      this._actor.vel = this._dir.scale(this._speed);\n    }\n  }\n\n  public isComplete(actor: Actor): boolean {\n    return this._stopped || actor.pos.distance(this._start) >= this._distance;\n  }\n\n  public stop(): void {\n    this._actor.vel = vec(0, 0);\n    this._stopped = true;\n  }\n\n  public reset(): void {\n    this._started = false;\n  }\n}\n","import { Actor } from '../../Actor';\nimport { Vector, vec } from '../../Math/vector';\nimport { Action } from '../Action';\n\nexport class MoveTo implements Action {\n  private _actor: Actor;\n  public x: number;\n  public y: number;\n  private _start: Vector;\n  private _end: Vector;\n  private _dir: Vector;\n  private _speed: number;\n  private _distance: number;\n  private _started = false;\n  private _stopped = false;\n  constructor(actor: Actor, destx: number, desty: number, speed: number) {\n    this._actor = actor;\n    this._end = new Vector(destx, desty);\n    this._speed = speed;\n  }\n\n  public update(_delta: number): void {\n    if (!this._started) {\n      this._started = true;\n      this._start = new Vector(this._actor.pos.x, this._actor.pos.y);\n      this._distance = this._start.distance(this._end);\n      this._dir = this._end.sub(this._start).normalize();\n    }\n    const m = this._dir.scale(this._speed);\n    this._actor.vel = vec(m.x, m.y);\n\n    if (this.isComplete(this._actor)) {\n      this._actor.pos = vec(this._end.x, this._end.y);\n      this._actor.vel = vec(0, 0);\n    }\n  }\n\n  public isComplete(actor: Actor): boolean {\n    return this._stopped || new Vector(actor.pos.x, actor.pos.y).distance(this._start) >= this._distance;\n  }\n\n  public stop(): void {\n    this._actor.vel = vec(0, 0);\n    this._stopped = true;\n  }\n\n  public reset(): void {\n    this._started = false;\n  }\n}\n","/**\r\n * An enum that describes the strategies that rotation actions can use\r\n */\r\nexport enum RotationType {\r\n  /**\r\n   * Rotation via `ShortestPath` will use the smallest angle\r\n   * between the starting and ending points. This strategy is the default behavior.\r\n   */\r\n  ShortestPath = 0,\r\n  /**\r\n   * Rotation via `LongestPath` will use the largest angle\r\n   * between the starting and ending points.\r\n   */\r\n  LongestPath = 1,\r\n  /**\r\n   * Rotation via `Clockwise` will travel in a clockwise direction,\r\n   * regardless of the starting and ending points.\r\n   */\r\n  Clockwise = 2,\r\n  /**\r\n   * Rotation via `CounterClockwise` will travel in a counterclockwise direction,\r\n   * regardless of the starting and ending points.\r\n   */\r\n  CounterClockwise = 3\r\n}\r\n","import { Actor } from '../../Actor';\r\nimport { Action } from '../Action';\r\nimport { RotationType } from '../RotationType';\r\nimport * as Util from '../../Util/Util';\r\n\r\nexport class RotateTo implements Action {\r\n  private _actor: Actor;\r\n  public x: number;\r\n  public y: number;\r\n  private _start: number;\r\n  private _end: number;\r\n  private _speed: number;\r\n  private _rotationType: RotationType;\r\n  private _direction: number;\r\n  private _distance: number;\r\n  private _shortDistance: number;\r\n  private _longDistance: number;\r\n  private _shortestPathIsPositive: boolean;\r\n  private _currentNonCannonAngle: number;\r\n  private _started = false;\r\n  private _stopped = false;\r\n  constructor(actor: Actor, angleRadians: number, speed: number, rotationType?: RotationType) {\r\n    this._actor = actor;\r\n    this._end = angleRadians;\r\n    this._speed = speed;\r\n    this._rotationType = rotationType || RotationType.ShortestPath;\r\n  }\r\n\r\n  public update(_delta: number): void {\r\n    if (!this._started) {\r\n      this._started = true;\r\n      this._start = this._actor.rotation;\r\n      this._currentNonCannonAngle = this._actor.rotation;\r\n      const distance1 = Math.abs(this._end - this._start);\r\n      const distance2 = Util.TwoPI - distance1;\r\n      if (distance1 > distance2) {\r\n        this._shortDistance = distance2;\r\n        this._longDistance = distance1;\r\n      } else {\r\n        this._shortDistance = distance1;\r\n        this._longDistance = distance2;\r\n      }\r\n\r\n      this._shortestPathIsPositive = (this._start - this._end + Util.TwoPI) % Util.TwoPI >= Math.PI;\r\n\r\n      switch (this._rotationType) {\r\n        case RotationType.ShortestPath:\r\n          this._distance = this._shortDistance;\r\n          if (this._shortestPathIsPositive) {\r\n            this._direction = 1;\r\n          } else {\r\n            this._direction = -1;\r\n          }\r\n          break;\r\n        case RotationType.LongestPath:\r\n          this._distance = this._longDistance;\r\n          if (this._shortestPathIsPositive) {\r\n            this._direction = -1;\r\n          } else {\r\n            this._direction = 1;\r\n          }\r\n          break;\r\n        case RotationType.Clockwise:\r\n          this._direction = 1;\r\n          if (this._shortestPathIsPositive) {\r\n            this._distance = this._shortDistance;\r\n          } else {\r\n            this._distance = this._longDistance;\r\n          }\r\n          break;\r\n        case RotationType.CounterClockwise:\r\n          this._direction = -1;\r\n          if (!this._shortestPathIsPositive) {\r\n            this._distance = this._shortDistance;\r\n          } else {\r\n            this._distance = this._longDistance;\r\n          }\r\n          break;\r\n      }\r\n    }\r\n\r\n    this._actor.angularVelocity = this._direction * this._speed;\r\n    this._currentNonCannonAngle += this._direction * this._speed * (_delta / 1000);\r\n\r\n    if (this.isComplete()) {\r\n      this._actor.rotation = this._end;\r\n      this._actor.angularVelocity = 0;\r\n      this._stopped = true;\r\n    }\r\n  }\r\n\r\n  public isComplete(): boolean {\r\n    const distanceTravelled = Math.abs(this._currentNonCannonAngle - this._start);\r\n    return this._stopped || distanceTravelled >= Math.abs(this._distance);\r\n  }\r\n\r\n  public stop(): void {\r\n    this._actor.angularVelocity = 0;\r\n    this._stopped = true;\r\n  }\r\n\r\n  public reset(): void {\r\n    this._started = false;\r\n  }\r\n}\r\n","import { Actor } from '../../Actor';\r\nimport { Action } from '../Action';\r\nimport { RotationType } from '../RotationType';\r\nimport * as Util from '../../Util/Util';\r\n\r\nexport class RotateBy implements Action {\r\n  private _actor: Actor;\r\n  public x: number;\r\n  public y: number;\r\n  private _start: number;\r\n  private _end: number;\r\n  private _speed: number;\r\n  private _offset: number;\r\n\r\n  private _rotationType: RotationType;\r\n  private _direction: number;\r\n  private _distance: number;\r\n  private _shortDistance: number;\r\n  private _longDistance: number;\r\n  private _shortestPathIsPositive: boolean;\r\n  private _currentNonCannonAngle: number;\r\n  private _started = false;\r\n  private _stopped = false;\r\n  constructor(actor: Actor, angleRadiansOffset: number, speed: number, rotationType?: RotationType) {\r\n    this._actor = actor;\r\n    this._speed = speed;\r\n    this._offset = angleRadiansOffset;\r\n    this._rotationType = rotationType || RotationType.ShortestPath;\r\n  }\r\n\r\n  public update(_delta: number): void {\r\n    if (!this._started) {\r\n      this._started = true;\r\n      this._start = this._actor.rotation;\r\n      this._currentNonCannonAngle = this._actor.rotation;\r\n      this._end = this._start + this._offset;\r\n\r\n      const distance1 = Math.abs(this._end - this._start);\r\n      const distance2 = Util.TwoPI - distance1;\r\n      if (distance1 > distance2) {\r\n        this._shortDistance = distance2;\r\n        this._longDistance = distance1;\r\n      } else {\r\n        this._shortDistance = distance1;\r\n        this._longDistance = distance2;\r\n      }\r\n\r\n      this._shortestPathIsPositive = (this._start - this._end + Util.TwoPI) % Util.TwoPI >= Math.PI;\r\n\r\n      switch (this._rotationType) {\r\n        case RotationType.ShortestPath:\r\n          this._distance = this._shortDistance;\r\n          if (this._shortestPathIsPositive) {\r\n            this._direction = 1;\r\n          } else {\r\n            this._direction = -1;\r\n          }\r\n          break;\r\n        case RotationType.LongestPath:\r\n          this._distance = this._longDistance;\r\n          if (this._shortestPathIsPositive) {\r\n            this._direction = -1;\r\n          } else {\r\n            this._direction = 1;\r\n          }\r\n          break;\r\n        case RotationType.Clockwise:\r\n          this._direction = 1;\r\n          if (this._shortDistance >= 0) {\r\n            this._distance = this._shortDistance;\r\n          } else {\r\n            this._distance = this._longDistance;\r\n          }\r\n          break;\r\n        case RotationType.CounterClockwise:\r\n          this._direction = -1;\r\n          if (this._shortDistance <= 0) {\r\n            this._distance = this._shortDistance;\r\n          } else {\r\n            this._distance = this._longDistance;\r\n          }\r\n          break;\r\n      }\r\n    }\r\n\r\n    this._actor.angularVelocity = this._direction * this._speed;\r\n    this._currentNonCannonAngle += this._direction * this._speed * (_delta / 1000);\r\n\r\n    if (this.isComplete()) {\r\n      this._actor.rotation = this._end;\r\n      this._actor.angularVelocity = 0;\r\n      this._stopped = true;\r\n    }\r\n  }\r\n\r\n  public isComplete(): boolean {\r\n    const distanceTravelled = Math.abs(this._currentNonCannonAngle - this._start);\r\n    return this._stopped || distanceTravelled >= Math.abs(this._distance);\r\n  }\r\n\r\n  public stop(): void {\r\n    this._actor.angularVelocity = 0;\r\n    this._stopped = true;\r\n  }\r\n\r\n  public reset(): void {\r\n    this._started = false;\r\n  }\r\n}\r\n","import { Entity } from './Entity';\r\n\r\n/**\r\n * Component Contructor Types\r\n */\r\nexport declare type ComponentCtor<T extends Component = Component> = new (...args:any[]) => T;\r\n\r\n/**\r\n * Type guard to check if a component implements clone\r\n * @param x\r\n */\r\nfunction hasClone(x: any): x is { clone(): any } {\r\n  return !!x?.clone;\r\n}\r\n\r\nexport type ComponentType<ComponentToParse> = ComponentToParse extends Component<infer TypeName> ? TypeName : never;\r\n\r\n/**\r\n * Plucks the string type out of a component type\r\n */\r\nexport type ComponentStringType<T> = T extends Component<infer R> ? R : string;\r\n\r\n/**\r\n * Components are containers for state in Excalibur, the are meant to convey capabilities that an Entity posesses\r\n *\r\n * Implementations of Component must have a zero-arg constructor to support dependecies\r\n *\r\n * ```typescript\r\n * class MyComponent extends ex.Component<'my'> {\r\n *   public readonly type = 'my';\r\n *   // zero arg support required if you want to use component dependencies\r\n *   constructor(public optionalPos?: ex.Vector) {}\r\n * }\r\n * ```\r\n */\r\nexport abstract class Component<TypeName extends string = string> {\r\n  /**\r\n   * Optionally list any component types this component depends on\r\n   * If the owner entity does not have these components, new components will be added to the entity\r\n   *\r\n   * Only components with zero-arg constructors are supported as automatic component dependencies\r\n   */\r\n  readonly dependencies?: ComponentCtor[];\r\n\r\n  // todo implement optional\r\n  readonly optional?: ComponentCtor[];\r\n\r\n  /**\r\n   * Type of this component, must be a unique type among component types in you game.\r\n   */\r\n  abstract readonly type: TypeName;\r\n\r\n  /**\r\n   * Current owning [[Entity]], if any, of this component. Null if not added to any [[Entity]]\r\n   */\r\n  owner?: Entity = null;\r\n\r\n  /**\r\n   * Clones any properties on this component, if that property value has a `clone()` method it will be called\r\n   */\r\n  clone(): this {\r\n    const newComponent = new (this.constructor as any)();\r\n    for (const prop in this) {\r\n      if (this.hasOwnProperty(prop)) {\r\n        const val = this[prop];\r\n        if (hasClone(val) && prop !== 'owner' && prop !== 'clone') {\r\n          newComponent[prop] = val.clone();\r\n        } else {\r\n          newComponent[prop] = val;\r\n        }\r\n      }\r\n    }\r\n    return newComponent;\r\n  }\r\n\r\n  /**\r\n   * Optional callback called when a component is added to an entity\r\n   */\r\n  onAdd?(owner: Entity): void;\r\n\r\n  /**\r\n   * Opitonal callback called when acomponent is added to an entity\r\n   */\r\n  onRemove?(previousOwner: Entity): void;\r\n}\r\n\r\n/**\r\n * Tag components are a way of tagging a component with label and a simple value\r\n *\r\n * For example:\r\n *\r\n * ```typescript\r\n * const isOffscreen = new TagComponent('offscreen');\r\n * entity.addComponent(isOffscreen);\r\n * entity.tags.includes\r\n * ```\r\n */\r\nexport class TagComponent<TypeName extends string, MaybeValueType extends string | symbol | number | boolean = never> extends Component<\r\nTypeName\r\n> {\r\n  constructor(public readonly type: TypeName, public readonly value?: MaybeValueType) {\r\n    super();\r\n  }\r\n}\r\n","import { Vector } from '../../Math/vector';\nimport { Component } from '../Component';\n\nexport interface Motion {\n  /**\n   * The velocity of an entity in pixels per second\n   */\n  vel: Vector;\n\n  /**\n   * The acceleration of entity in pixels per second^2\n   */\n  acc: Vector;\n\n  /**\n   * The scale rate of change in scale units per second\n   */\n  scaleFactor: Vector;\n\n  /**\n   * The angular velocity which is how quickly the entity is rotating in radians per second\n   */\n  angularVelocity: number;\n\n  /**\n   * The amount of torque applied to the entity, angular acceleration is torque * inertia\n   */\n  torque: number;\n\n  /**\n   * Inerita can be thought of as the resistance to motion\n   */\n  inertia: number;\n}\n\nexport class MotionComponent extends Component<'ex.motion'> {\n  public readonly type = 'ex.motion';\n\n  /**\n   * The velocity of an entity in pixels per second\n   */\n  public vel: Vector = Vector.Zero;\n\n  /**\n   * The acceleration of entity in pixels per second^2\n   */\n  public acc: Vector = Vector.Zero;\n\n  /**\n   * The scale rate of change in scale units per second\n   */\n  public scaleFactor: Vector = Vector.Zero;\n\n  /**\n   * The angular velocity which is how quickly the entity is rotating in radians per second\n   */\n  public angularVelocity = 0;\n\n  /**\n   * The amount of torque applied to the entity, angular acceleration is torque * inertia\n   */\n  public torque: number = 0;\n\n  /**\n   * Inerita can be thought of as the resistance to motion\n   */\n  public inertia: number = 1;\n}\n","import { Vector } from './vector';\r\n\r\nexport interface VectorViewOptions {\r\n  getX: () => number;\r\n  getY: () => number;\r\n  setX: (x: number) => void;\r\n  setY: (y: number) => void;\r\n}\r\nexport class VectorView extends Vector {\r\n  private _getX: () => number;\r\n  private _getY: () => number;\r\n  private _setX: (x: number) => void;\r\n  private _setY: (y: number) => void;\r\n  constructor(options: VectorViewOptions) {\r\n    super(0, 0);\r\n    this._getX = options.getX;\r\n    this._getY = options.getY;\r\n    this._setX = options.setX;\r\n    this._setY = options.setY;\r\n  }\r\n  public get x() {\r\n    return (this._x = this._getX());\r\n  }\r\n\r\n  public set x(val) {\r\n    this._setX(val);\r\n    this._x = val;\r\n  }\r\n\r\n  public get y() {\r\n    return (this._y = this._getY());\r\n  }\r\n  public set y(val) {\r\n    this._setY(val);\r\n    this._y = val;\r\n  }\r\n}\r\n","import { Matrix, MatrixLocations } from '../../Math/matrix';\r\nimport { VectorView } from '../../Math/vector-view';\r\nimport { Vector, vec } from '../../Math/vector';\r\nimport { Component } from '../Component';\r\n\r\nexport interface Transform {\r\n  /**\r\n   * The [[CoordPlane|coordinate plane]] for this transform for the entity.\r\n   */\r\n  coordPlane: CoordPlane;\r\n\r\n  /**\r\n   * The current position of the entity in world space or in screen space depending on the the [[CoordPlane|coordinate plane]].\r\n   *\r\n   * If the entity has a parent this position is relative to the parent entity.\r\n   */\r\n  pos: Vector;\r\n\r\n  /**\r\n   * The z-index ordering of the entity, a higher values are drawn on top of lower values.\r\n   * For example z=99 would be drawn on top of z=0.\r\n   */\r\n  z: number;\r\n\r\n  /**\r\n   * The rotation of the entity in radians. For example `Math.PI` radians is the same as 180 degrees.\r\n   *\r\n   * If the entity has a parent this rotation is relative to the parent.\r\n   */\r\n  rotation: number;\r\n\r\n  /**\r\n   * The scale of the entity. If the entity has a parent this scale is relative to the parent.\r\n   */\r\n  scale: Vector;\r\n}\r\n\r\nconst createPosView = (matrix: Matrix) => {\r\n  const source = matrix;\r\n  return new VectorView({\r\n    setX: (x) => {\r\n      source.data[MatrixLocations.X] = x;\r\n    },\r\n    setY: (y) => {\r\n      source.data[MatrixLocations.Y] = y;\r\n    },\r\n    getX: () => {\r\n      return source.data[MatrixLocations.X];\r\n    },\r\n    getY: () => {\r\n      return source.data[MatrixLocations.Y];\r\n    }\r\n  });\r\n};\r\n\r\nconst createScaleView = (matrix: Matrix) => {\r\n  const source = matrix;\r\n  return new VectorView({\r\n    setX: (x) => {\r\n      source.setScaleX(x);\r\n    },\r\n    setY: (y) => {\r\n      source.setScaleY(y);\r\n    },\r\n    getX: () => {\r\n      return source.getScaleX();\r\n    },\r\n    getY: () => {\r\n      return source.getScaleY();\r\n    }\r\n  });\r\n};\r\n\r\n/**\r\n * Enum representing the coordinate plane for the position 2D vector in the [[TransformComponent]]\r\n */\r\nexport enum CoordPlane {\r\n  /**\r\n   * The world coordinate plane (default) represents world space, any entities drawn with world\r\n   * space move when the camera moves.\r\n   */\r\n  World = 'world',\r\n  /**\r\n   * The screen coordinate plane represents screen space, entities drawn in screen space are pinned\r\n   * to screen coordinates ignoring the camera.\r\n   */\r\n  Screen = 'screen'\r\n}\r\n\r\nexport class TransformComponent extends Component<'ex.transform'> implements Transform {\r\n  public readonly type = 'ex.transform';\r\n\r\n  private _dirty = false;\r\n\r\n  public readonly matrix = Matrix.identity().translate(0, 0).rotate(0).scale(1, 1);\r\n  private _position = createPosView(this.matrix);\r\n  private _rotation = 0;\r\n  private _scale = createScaleView(this.matrix);\r\n\r\n  private _recalculate() {\r\n    this._rotation = this.matrix.getRotation();\r\n    this._dirty = false;\r\n  }\r\n\r\n  public getGlobalMatrix(): Matrix {\r\n    if (!this.parent) {\r\n      return this.matrix;\r\n    } else {\r\n      return this.parent.getGlobalMatrix().multm(this.matrix);\r\n    }\r\n  }\r\n\r\n  public getGlobalTransform(): Transform {\r\n    return {\r\n      pos: this.globalPos,\r\n      scale: this.globalScale,\r\n      rotation: this.globalRotation,\r\n      z: this.z,\r\n      coordPlane: this.coordPlane\r\n    };\r\n  }\r\n\r\n  public get parent(): TransformComponent | null {\r\n    return this?.owner?.parent?.get(TransformComponent);\r\n  }\r\n\r\n  /**\r\n   * The [[CoordPlane|coordinate plane|]] for this transform for the entity.\r\n   */\r\n  public coordPlane = CoordPlane.World;\r\n\r\n  /**\r\n   * The current position of the entity in world space or in screen space depending on the the [[CoordPlane|coordinate plane]].\r\n   *\r\n   * If a parent entity exists coordinates are local to the parent.\r\n   */\r\n  public get pos(): Vector {\r\n    if (this._dirty) {\r\n      this._recalculate();\r\n    }\r\n    return this._position;\r\n  }\r\n\r\n  public set pos(val: Vector) {\r\n    this.matrix.setPosition(val.x, val.y);\r\n    this._dirty = true;\r\n  }\r\n\r\n  // Dirty flag check up the chain\r\n  public get dirty(): boolean {\r\n    if (this?.owner?.parent) {\r\n      const parent = this.parent;\r\n      return parent.dirty || this._dirty;\r\n    }\r\n    return this._dirty;\r\n  }\r\n\r\n  /**\r\n   * The current world position calculated\r\n   */\r\n  public get globalPos(): Vector {\r\n    const source = this.getGlobalMatrix();\r\n    return new VectorView({\r\n      getX: () => source.data[MatrixLocations.X],\r\n      getY: () => source.data[MatrixLocations.Y],\r\n      setX: (x) => {\r\n        if (this.parent) {\r\n          const [newX] = this.parent?.getGlobalMatrix().getAffineInverse().multv([x, source.data[MatrixLocations.Y]]);\r\n          this.matrix.data[MatrixLocations.X] = newX;\r\n        } else {\r\n          this.matrix.data[MatrixLocations.X] = x;\r\n        }\r\n      },\r\n      setY: (y) => {\r\n        if (this.parent) {\r\n          const [, newY] = this.parent?.getGlobalMatrix().getAffineInverse().multv([source.data[MatrixLocations.X], y]);\r\n          this.matrix.data[MatrixLocations.Y] = newY;\r\n        } else {\r\n          this.matrix.data[MatrixLocations.Y] = y;\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  public set globalPos(val: Vector) {\r\n    const parentTransform = this.parent;\r\n    if (!parentTransform) {\r\n      this.pos = val;\r\n    } else {\r\n      this.pos = parentTransform.getGlobalMatrix().getAffineInverse().multv(val);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * The z-index ordering of the entity, a higher values are drawn on top of lower values.\r\n   * For example z=99 would be drawn on top of z=0.\r\n   */\r\n  public z: number = 0;\r\n\r\n  /**\r\n   * The rotation of the entity in radians. For example `Math.PI` radians is the same as 180 degrees.\r\n   */\r\n  public get rotation(): number {\r\n    if (this._dirty) {\r\n      this._recalculate();\r\n    }\r\n    return this._rotation;\r\n  }\r\n\r\n  public set rotation(val: number) {\r\n    this.matrix.setRotation(val);\r\n    this._dirty = true;\r\n  }\r\n\r\n  public get globalRotation(): number {\r\n    return this.getGlobalMatrix().getRotation();\r\n  }\r\n\r\n  public set globalRotation(val: number) {\r\n    const parentTransform = this.parent;\r\n    if (!parentTransform) {\r\n      this.rotation = val;\r\n    } else {\r\n      this.rotation = val - parentTransform.globalRotation;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * The scale of the entity.\r\n   */\r\n  public get scale(): Vector {\r\n    if (this._dirty) {\r\n      this._recalculate();\r\n    }\r\n    return this._scale;\r\n  }\r\n\r\n  public set scale(val: Vector) {\r\n    this.matrix.setScale(val);\r\n    this._dirty = true;\r\n  }\r\n\r\n  public get globalScale(): Vector {\r\n    const source = this.getGlobalMatrix();\r\n    return new VectorView({\r\n      getX: () => source.getScaleX(),\r\n      getY: () => source.getScaleY(),\r\n      setX: (x) => {\r\n        if (this.parent) {\r\n          const globalScaleX = this.parent.globalScale.x;\r\n          this.matrix.setScaleX(x / globalScaleX);\r\n        } else {\r\n          this.matrix.setScaleX(x);\r\n        }\r\n      },\r\n      setY: (y) => {\r\n        if (this.parent) {\r\n          const globalScaleY = this.parent.globalScale.y;\r\n          this.matrix.setScaleY(y / globalScaleY);\r\n        } else {\r\n          this.matrix.setScaleY(y);\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  public set globalScale(val: Vector) {\r\n    const parentTransform = this.parent;\r\n    if (!parentTransform) {\r\n      this.scale = val;\r\n    } else {\r\n      this.scale = vec(val.x / parentTransform.globalScale.x, val.y / parentTransform.globalScale.y);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Apply the transform to a point\r\n   * @param point\r\n   */\r\n  public apply(point: Vector): Vector {\r\n    return this.matrix.multv(point);\r\n  }\r\n\r\n  /**\r\n   * Apply the inverse transform to a point\r\n   * @param point\r\n   */\r\n  public applyInverse(point: Vector): Vector {\r\n    return this.matrix.getAffineInverse().multv(point);\r\n  }\r\n}\r\n","/**\r\n * An enum that describes the types of collisions bodies can participate in\r\n */\r\nexport enum CollisionType {\r\n  /**\r\n   * Bodies with the `PreventCollision` setting do not participate in any\r\n   * collisions and do not raise collision events.\r\n   */\r\n  PreventCollision = 'PreventCollision',\r\n  /**\r\n   * Bodies with the `Passive` setting only raise collision events, but are not\r\n   * influenced or moved by other bodies and do not influence or move other bodies.\r\n   * This is useful for use in trigger type behavior.\r\n   */\r\n  Passive = 'Passive',\r\n  /**\r\n   * Bodies with the `Active` setting raise collision events and participate\r\n   * in collisions with other bodies and will be push or moved by bodies sharing\r\n   * the `Active` or `Fixed` setting.\r\n   */\r\n  Active = 'Active',\r\n  /**\r\n   * Bodies with the `Fixed` setting raise collision events and participate in\r\n   * collisions with other bodies. Actors with the `Fixed` setting will not be\r\n   * pushed or moved by other bodies sharing the `Fixed`. Think of Fixed\r\n   * bodies as \"immovable/unstoppable\" objects. If two `Fixed` bodies meet they will\r\n   * not be pushed or moved by each other, they will not interact except to throw\r\n   * collision events.\r\n   */\r\n  Fixed = 'Fixed'\r\n}\r\n","import { Vector } from '../Math/vector';\r\nimport { obsolete } from '../Util/Decorators';\r\n\r\n\r\n/**\r\n * Possible collision resolution strategies\r\n *\r\n * The default is [[CollisionResolutionStrategy.Arcade]] which performs simple axis aligned arcade style physics. This is useful for things\r\n * like platformers or top down games.\r\n *\r\n * More advanced rigid body physics are enabled by setting [[CollisionResolutionStrategy.Realistic]] which allows for complicated\r\n * simulated physical interactions.\r\n */\r\nexport enum CollisionResolutionStrategy {\r\n  Arcade = 'arcade',\r\n  Realistic = 'realistic'\r\n}\r\n\r\n/**\r\n * Possible broadphase collision pair identification strategies\r\n *\r\n * The default strategy is [[BroadphaseStrategy.DynamicAABBTree]] which uses a binary tree of axis-aligned bounding boxes to identify\r\n * potential collision pairs which is O(nlog(n)) faster.\r\n */\r\nexport enum BroadphaseStrategy {\r\n  DynamicAABBTree\r\n}\r\n\r\n/**\r\n * Possible numerical integrators for position and velocity\r\n */\r\nexport enum Integrator {\r\n  Euler\r\n}\r\n\r\n/**\r\n * The [[Physics]] object is the global configuration object for all Excalibur physics.\r\n */\r\n/* istanbul ignore next */\r\nexport class Physics {\r\n  /**\r\n   * Global acceleration that is applied to all vanilla actors that have a [[CollisionType.Active|active]] collision type.\r\n   * Global acceleration won't effect [[Label|labels]], [[ScreenElement|ui actors]], or [[Trigger|triggers]] in Excalibur.\r\n   *\r\n   * This is a great way to globally simulate effects like gravity.\r\n   */\r\n  public static acc = new Vector(0, 0);\r\n  public static get gravity() {\r\n    return Physics.acc;\r\n  }\r\n  public static set gravity(v: Vector) {\r\n    Physics.acc = v;\r\n  }\r\n\r\n  /**\r\n   * Globally switches all Excalibur physics behavior on or off.\r\n   */\r\n  public static enabled = true;\r\n\r\n  /**\r\n   * Gets or sets the broadphase pair identification strategy.\r\n   *\r\n   * The default strategy is [[BroadphaseStrategy.DynamicAABBTree]] which uses a binary tree of axis-aligned bounding boxes to identify\r\n   * potential collision pairs which is O(nlog(n)) faster.\r\n   */\r\n  public static broadphaseStrategy: BroadphaseStrategy = BroadphaseStrategy.DynamicAABBTree;\r\n\r\n  /**\r\n   * Gets or sets the global collision resolution strategy (narrowphase).\r\n   *\r\n   * The default is [[CollisionResolutionStrategy.Arcade]] which performs simple axis aligned arcade style physics.\r\n   *\r\n   * More advanced rigid body physics are enabled by setting [[CollisionResolutionStrategy.Realistic]] which allows for complicated\r\n   * simulated physical interactions.\r\n   */\r\n  public static collisionResolutionStrategy: CollisionResolutionStrategy = CollisionResolutionStrategy.Arcade;\r\n  /**\r\n   * The default mass to use if none is specified\r\n   */\r\n  public static defaultMass: number = 10;\r\n  /**\r\n   * Gets or sets the position and velocity positional integrator, currently only Euler is supported.\r\n   */\r\n  public static integrator: Integrator = Integrator.Euler;\r\n\r\n  /**\r\n   * Configures Excalibur to use \"arcade\" physics. Arcade physics which performs simple axis aligned arcade style physics.\r\n   */\r\n  public static useArcadePhysics(): void {\r\n    Physics.collisionResolutionStrategy = CollisionResolutionStrategy.Arcade;\r\n  }\r\n\r\n  /**\r\n   * Configures Excalibur to use rigid body physics. Rigid body physics allows for complicated\r\n   * simulated physical interactions.\r\n   */\r\n  public static useRealisticPhysics(): void {\r\n    Physics.collisionResolutionStrategy = CollisionResolutionStrategy.Realistic;\r\n  }\r\n\r\n  /**\r\n   * Factor to add to the RigidBody BoundingBox, bounding box (dimensions += vel * dynamicTreeVelocityMultiplier);\r\n   */\r\n  public static dynamicTreeVelocityMultiplier = 2;\r\n\r\n  @obsolete({\r\n    message: 'Alias for incorrect spelling used in older versions, will be removed in v0.25.0',\r\n    alternateMethod: 'dynamicTreeVelocityMultiplier'\r\n  })\r\n  public static get dynamicTreeVelocityMultiplyer() {\r\n    return Physics.dynamicTreeVelocityMultiplier;\r\n  }\r\n\r\n  public static set dynamicTreeVelocityMultiplyer(value: number) {\r\n    Physics.dynamicTreeVelocityMultiplier = value;\r\n  }\r\n\r\n  /**\r\n   * Pad RigidBody BoundingBox by a constant amount\r\n   */\r\n  public static boundsPadding = 5;\r\n\r\n  /**\r\n   * Number of position iterations (overlap) to run in the solver\r\n   */\r\n  public static positionIterations = 3;\r\n\r\n  /**\r\n   * Number of velocity iteration (response) to run in the solver\r\n   */\r\n  public static velocityIterations = 8;\r\n\r\n  /**\r\n   * Amount of overlap to tolerate in pixels\r\n   */\r\n  public static slop = 1;\r\n\r\n  /**\r\n   * Amount of positional overlap correction to apply each position iteration of the solver\r\n   * O - meaning no correction, 1 - meaning correct all overlap\r\n   */\r\n  public static steeringFactor = 0.2;\r\n\r\n  /**\r\n   * Warm start set to true re-uses impulses from previous frames back in the solver\r\n   */\r\n  public static warmStart = true;\r\n\r\n  /**\r\n   * By default bodies do not sleep\r\n   */\r\n  public static bodiesCanSleepByDefault = false;\r\n\r\n  /**\r\n   * Surface epsilon is used to help deal with surface penetration\r\n   */\r\n  public static surfaceEpsilon = 0.1;\r\n\r\n  public static sleepEpsilon = 0.07;\r\n\r\n  public static wakeThreshold = Physics.sleepEpsilon * 3;\r\n\r\n  public static sleepBias = 0.9;\r\n\r\n  /**\r\n   * Enable fast moving body checking, this enables checking for collision pairs via raycast for fast moving objects to prevent\r\n   * bodies from tunneling through one another.\r\n   */\r\n  public static checkForFastBodies = true;\r\n\r\n  /**\r\n   * Disable minimum fast moving body raycast, by default if ex.Physics.checkForFastBodies = true Excalibur will only check if the\r\n   * body is moving at least half of its minimum dimension in an update. If ex.Physics.disableMinimumSpeedForFastBody is set to true,\r\n   * Excalibur will always perform the fast body raycast regardless of speed.\r\n   */\r\n  public static disableMinimumSpeedForFastBody = false;\r\n}\r\n","import { Actor } from '../../Actor';\nimport { vec } from '../../Math/vector';\nimport { MotionComponent } from '../../EntityComponentSystem/Components/MotionComponent';\nimport { TransformComponent } from '../../EntityComponentSystem/Components/TransformComponent';\nimport { Action } from '../Action';\n\nexport class ScaleTo implements Action {\n  private _actor: Actor;\n  public x: number;\n  public y: number;\n  private _startX: number;\n  private _startY: number;\n  private _endX: number;\n  private _endY: number;\n  private _speedX: number;\n  private _speedY: number;\n  private _distanceX: number;\n  private _distanceY: number;\n  private _started = false;\n  private _stopped = false;\n  constructor(actor: Actor, scaleX: number, scaleY: number, speedX: number, speedY: number) {\n    this._actor = actor;\n    this._endX = scaleX;\n    this._endY = scaleY;\n    this._speedX = speedX;\n    this._speedY = speedY;\n  }\n\n  public update(_delta: number): void {\n    const transform = this._actor.get(TransformComponent);\n    const motion = this._actor.get(MotionComponent);\n    if (!this._started) {\n      this._started = true;\n      this._startX = transform.scale.x;\n      this._startY = transform.scale.y;\n      this._distanceX = Math.abs(this._endX - this._startX);\n      this._distanceY = Math.abs(this._endY - this._startY);\n    }\n\n    if (!(Math.abs(transform.scale.x - this._startX) >= this._distanceX)) {\n      const directionX = this._endY < this._startY ? -1 : 1;\n      motion.scaleFactor.x = this._speedX * directionX;\n    } else {\n      motion.scaleFactor.x = 0;\n    }\n\n    if (!(Math.abs(transform.scale.y - this._startY) >= this._distanceY)) {\n      const directionY = this._endY < this._startY ? -1 : 1;\n      motion.scaleFactor.y = this._speedY * directionY;\n    } else {\n      motion.scaleFactor.y = 0;\n    }\n\n    if (this.isComplete()) {\n      this._actor.scale = vec(this._endX, this._endY);\n      motion.scaleFactor.x = 0;\n      motion.scaleFactor.y = 0;\n    }\n  }\n\n  public isComplete(): boolean {\n    return (\n      this._stopped ||\n      (Math.abs(this._actor.scale.y - this._startX) >= this._distanceX && Math.abs(this._actor.scale.y - this._startY) >= this._distanceY)\n    );\n  }\n\n  public stop(): void {\n    const motion = this._actor.get(MotionComponent);\n    motion.scaleFactor.x = 0;\n    motion.scaleFactor.y = 0;\n    this._stopped = true;\n  }\n\n  public reset(): void {\n    this._started = false;\n  }\n}\n","import { Actor } from '../../Actor';\nimport { Vector } from '../../Math/vector';\nimport { TransformComponent } from '../../EntityComponentSystem';\nimport { MotionComponent } from '../../EntityComponentSystem/Components/MotionComponent';\nimport { Action } from '../Action';\n\nexport class ScaleBy implements Action {\n  private _actor: Actor;\n  public x: number;\n  public y: number;\n  private _startScale: Vector;\n  private _endScale: Vector;\n  private _offset: Vector;\n  private _distanceX: number;\n  private _distanceY: number;\n  private _directionX: number;\n  private _directionY: number;\n  private _started = false;\n  private _stopped = false;\n  private _speedX: number;\n  private _speedY: number;\n  constructor(actor: Actor, scaleOffsetX: number, scaleOffsetY: number, speed: number) {\n    this._actor = actor;\n    this._offset = new Vector(scaleOffsetX, scaleOffsetY);\n    this._speedX = this._speedY = speed;\n  }\n\n  public update(_delta: number): void {\n    const transform = this._actor.get(TransformComponent);\n    const motion = this._actor.get(MotionComponent);\n    if (!this._started) {\n      this._started = true;\n      this._startScale = transform.scale.clone();\n      this._endScale = this._startScale.add(this._offset);\n      this._distanceX = Math.abs(this._endScale.x - this._startScale.x);\n      this._distanceY = Math.abs(this._endScale.y - this._startScale.y);\n      this._directionX = this._endScale.x < this._startScale.x ? -1 : 1;\n      this._directionY = this._endScale.y < this._startScale.y ? -1 : 1;\n    }\n\n    motion.scaleFactor.x = this._speedX * this._directionX;\n    motion.scaleFactor.y = this._speedY * this._directionY;\n\n    if (this.isComplete()) {\n      transform.scale = this._endScale;\n      motion.scaleFactor.x = 0;\n      motion.scaleFactor.y = 0;\n    }\n  }\n\n  public isComplete(): boolean {\n    return (\n      this._stopped ||\n      (Math.abs(this._actor.scale.x - this._startScale.x) >= this._distanceX &&\n        Math.abs(this._actor.scale.y - this._startScale.y) >= this._distanceY)\n    );\n  }\n\n  public stop(): void {\n    const motion = this._actor.get(MotionComponent);\n    motion.scaleFactor.x = 0;\n    motion.scaleFactor.y = 0;\n    this._stopped = true;\n  }\n\n  public reset(): void {\n    this._started = false;\n  }\n}\n","import { Action } from '../Action';\r\n\r\nexport class CallMethod implements Action {\r\n  private _method: () => any = null;\r\n  private _hasBeenCalled: boolean = false;\r\n  constructor(method: () => any) {\r\n    this._method = method;\r\n  }\r\n\r\n  public update(_delta: number) {\r\n    this._method();\r\n    this._hasBeenCalled = true;\r\n  }\r\n  public isComplete() {\r\n    return this._hasBeenCalled;\r\n  }\r\n  public reset() {\r\n    this._hasBeenCalled = false;\r\n  }\r\n  public stop() {\r\n    this._hasBeenCalled = true;\r\n  }\r\n}\r\n","import { Actor } from '../../Actor';\nimport { vec, Vector } from '../../Math/vector';\nimport { Action } from '../Action';\n\nexport class EaseTo implements Action {\n  private _currentLerpTime: number = 0;\n  private _lerpDuration: number = 1 * 1000; // 1 second\n  private _lerpStart: Vector = new Vector(0, 0);\n  private _lerpEnd: Vector = new Vector(0, 0);\n  private _initialized: boolean = false;\n  private _stopped: boolean = false;\n  private _distance: number = 0;\n  constructor(\n    public actor: Actor,\n    x: number,\n    y: number,\n    duration: number,\n    public easingFcn: (currentTime: number, startValue: number, endValue: number, duration: number) => number\n  ) {\n    this._lerpDuration = duration;\n    this._lerpEnd = new Vector(x, y);\n  }\n  private _initialize() {\n    this._lerpStart = new Vector(this.actor.pos.x, this.actor.pos.y);\n    this._currentLerpTime = 0;\n    this._distance = this._lerpStart.distance(this._lerpEnd);\n  }\n\n  public update(delta: number): void {\n    if (!this._initialized) {\n      this._initialize();\n      this._initialized = true;\n    }\n\n    // Need to update lerp time first, otherwise the first update will always be zero\n    this._currentLerpTime += delta;\n    let newX = this.actor.pos.x;\n    let newY = this.actor.pos.y;\n    if (this._currentLerpTime < this._lerpDuration) {\n      if (this._lerpEnd.x < this._lerpStart.x) {\n        newX =\n          this._lerpStart.x -\n          (this.easingFcn(this._currentLerpTime, this._lerpEnd.x, this._lerpStart.x, this._lerpDuration) - this._lerpEnd.x);\n      } else {\n        newX = this.easingFcn(this._currentLerpTime, this._lerpStart.x, this._lerpEnd.x, this._lerpDuration);\n      }\n\n      if (this._lerpEnd.y < this._lerpStart.y) {\n        newY =\n          this._lerpStart.y -\n          (this.easingFcn(this._currentLerpTime, this._lerpEnd.y, this._lerpStart.y, this._lerpDuration) - this._lerpEnd.y);\n      } else {\n        newY = this.easingFcn(this._currentLerpTime, this._lerpStart.y, this._lerpEnd.y, this._lerpDuration);\n      }\n      // Given the lerp position figure out the velocity in pixels per second\n      this.actor.vel = vec((newX - this.actor.pos.x) / (delta / 1000), (newY - this.actor.pos.y) / (delta / 1000));\n    } else {\n      this.actor.pos = vec(this._lerpEnd.x, this._lerpEnd.y);\n      this.actor.vel = Vector.Zero;\n    }\n  }\n  public isComplete(actor: Actor): boolean {\n    return this._stopped || new Vector(actor.pos.x, actor.pos.y).distance(this._lerpStart) >= this._distance;\n  }\n\n  public reset(): void {\n    this._initialized = false;\n  }\n  public stop(): void {\n    this.actor.vel = vec(0, 0);\n    this._stopped = true;\n  }\n}\n","import { Actor } from '../../Actor';\r\nimport { Action } from '../Action';\r\n\r\nexport class Blink implements Action {\r\n  private _timeVisible: number = 0;\r\n  private _timeNotVisible: number = 0;\r\n  private _elapsedTime: number = 0;\r\n  private _totalTime: number = 0;\r\n  private _actor: Actor;\r\n  private _duration: number;\r\n  private _stopped: boolean = false;\r\n  private _started: boolean = false;\r\n  constructor(actor: Actor, timeVisible: number, timeNotVisible: number, numBlinks: number = 1) {\r\n    this._actor = actor;\r\n    this._timeVisible = timeVisible;\r\n    this._timeNotVisible = timeNotVisible;\r\n    this._duration = (timeVisible + timeNotVisible) * numBlinks;\r\n  }\r\n\r\n  public update(delta: number): void {\r\n    if (!this._started) {\r\n      this._started = true;\r\n    }\r\n\r\n    this._elapsedTime += delta;\r\n    this._totalTime += delta;\r\n    if (this._actor.graphics.visible && this._elapsedTime >= this._timeVisible) {\r\n      this._actor.graphics.visible = false;\r\n      this._elapsedTime = 0;\r\n    }\r\n\r\n    if (!this._actor.graphics.visible && this._elapsedTime >= this._timeNotVisible) {\r\n      this._actor.graphics.visible = true;\r\n      this._elapsedTime = 0;\r\n    }\r\n\r\n    if (this.isComplete()) {\r\n      this._actor.graphics.visible = true;\r\n    }\r\n  }\r\n\r\n  public isComplete(): boolean {\r\n    return this._stopped || this._totalTime >= this._duration;\r\n  }\r\n\r\n  public stop(): void {\r\n    this._actor.graphics.visible = true;\r\n    this._stopped = true;\r\n  }\r\n\r\n  public reset() {\r\n    this._started = false;\r\n    this._elapsedTime = 0;\r\n    this._totalTime = 0;\r\n  }\r\n}\r\n","import { Actor } from '../../Actor';\r\nimport { Logger } from '../../Util/Log';\r\nimport { Action } from '../Action';\r\n\r\nexport class Fade implements Action {\r\n  public x: number;\r\n  public y: number;\r\n\r\n  private _actor: Actor;\r\n  private _endOpacity: number;\r\n  private _speed: number;\r\n  private _multiplier: number = 1;\r\n  private _started = false;\r\n  private _stopped = false;\r\n\r\n  constructor(actor: Actor, endOpacity: number, speed: number) {\r\n    this._actor = actor;\r\n    this._endOpacity = endOpacity;\r\n    this._speed = speed;\r\n  }\r\n\r\n  public update(delta: number): void {\r\n    if (!this._started) {\r\n      this._started = true;\r\n\r\n      // determine direction when we start\r\n      if (this._endOpacity < this._actor.graphics.opacity) {\r\n        this._multiplier = -1;\r\n      } else {\r\n        this._multiplier = 1;\r\n      }\r\n    }\r\n\r\n    if (this._speed > 0) {\r\n      this._actor.graphics.opacity += (this._multiplier *\r\n        (Math.abs(this._actor.graphics.opacity - this._endOpacity) * delta)) / this._speed;\r\n    }\r\n\r\n    this._speed -= delta;\r\n\r\n    if (this.isComplete()) {\r\n      this._actor.graphics.opacity = this._endOpacity;\r\n    }\r\n\r\n    Logger.getInstance().debug('[Action fade] Actor opacity:', this._actor.graphics.opacity);\r\n  }\r\n\r\n  public isComplete(): boolean {\r\n    return this._stopped || Math.abs(this._actor.graphics.opacity - this._endOpacity) < 0.05;\r\n  }\r\n\r\n  public stop(): void {\r\n    this._stopped = true;\r\n  }\r\n\r\n  public reset(): void {\r\n    this._started = false;\r\n  }\r\n}\r\n","import { Actor } from '../../Actor';\r\nimport { Action } from '../Action';\r\n\r\nexport class Delay implements Action {\r\n  public x: number;\r\n  public y: number;\r\n  private _actor: Actor;\r\n  private _elapsedTime: number = 0;\r\n  private _delay: number;\r\n  private _started: boolean = false;\r\n  private _stopped = false;\r\n  constructor(actor: Actor, delay: number) {\r\n    this._actor = actor;\r\n    this._delay = delay;\r\n  }\r\n\r\n  public update(delta: number): void {\r\n    if (!this._started) {\r\n      this._started = true;\r\n    }\r\n\r\n    this.x = this._actor.pos.x;\r\n    this.y = this._actor.pos.y;\r\n\r\n    this._elapsedTime += delta;\r\n  }\r\n\r\n  isComplete(): boolean {\r\n    return this._stopped || this._elapsedTime >= this._delay;\r\n  }\r\n\r\n  public stop(): void {\r\n    this._stopped = true;\r\n  }\r\n\r\n  reset(): void {\r\n    this._elapsedTime = 0;\r\n    this._started = false;\r\n  }\r\n}\r\n","import { Actor } from '../../Actor';\r\nimport { Action } from '../Action';\r\n\r\nexport class Die implements Action {\r\n  public x: number;\r\n  public y: number;\r\n\r\n  private _actor: Actor;\r\n  private _stopped = false;\r\n\r\n  constructor(actor: Actor) {\r\n    this._actor = actor;\r\n  }\r\n\r\n  public update(_delta: number): void {\r\n    this._actor.actions.clearActions();\r\n    this._actor.kill();\r\n    this._stopped = true;\r\n  }\r\n\r\n  public isComplete(): boolean {\r\n    return this._stopped;\r\n  }\r\n\r\n  public stop(): void {\r\n    return;\r\n  }\r\n\r\n  public reset(): void {\r\n    return;\r\n  }\r\n}\r\n","import { Actor } from '../../Actor';\nimport { vec, Vector } from '../../Math/vector';\nimport { Action } from '../Action';\n\nexport class Follow implements Action {\n  private _actor: Actor;\n  private _actorToFollow: Actor;\n  public x: number;\n  public y: number;\n  private _current: Vector;\n  private _end: Vector;\n  private _dir: Vector;\n  private _speed: number;\n  private _maximumDistance: number;\n  private _distanceBetween: number;\n  private _started = false;\n  private _stopped = false;\n\n  constructor(actor: Actor, actorToFollow: Actor, followDistance?: number) {\n    this._actor = actor;\n    this._actorToFollow = actorToFollow;\n    this._current = new Vector(this._actor.pos.x, this._actor.pos.y);\n    this._end = new Vector(actorToFollow.pos.x, actorToFollow.pos.y);\n    this._maximumDistance = followDistance !== undefined ? followDistance : this._current.distance(this._end);\n    this._speed = 0;\n  }\n\n  public update(_delta: number): void {\n    if (!this._started) {\n      this._started = true;\n      this._distanceBetween = this._current.distance(this._end);\n      this._dir = this._end.sub(this._current).normalize();\n    }\n\n    const actorToFollowSpeed = Math.sqrt(Math.pow(this._actorToFollow.vel.x, 2) + Math.pow(this._actorToFollow.vel.y, 2));\n    if (actorToFollowSpeed !== 0) {\n      this._speed = actorToFollowSpeed;\n    }\n    this._current = vec(this._actor.pos.x, this._actor.pos.y);\n\n    this._end = vec(this._actorToFollow.pos.x, this._actorToFollow.pos.y);\n    this._distanceBetween = this._current.distance(this._end);\n    this._dir = this._end.sub(this._current).normalize();\n\n    if (this._distanceBetween >= this._maximumDistance) {\n      const m = this._dir.scale(this._speed);\n      this._actor.vel = vec(m.x, m.y);\n    } else {\n      this._actor.vel = vec(0, 0);\n    }\n\n    if (this.isComplete()) {\n      this._actor.pos = vec(this._end.x, this._end.y);\n      this._actor.vel = vec(0, 0);\n    }\n  }\n\n  public stop(): void {\n    this._actor.vel = vec(0, 0);\n    this._stopped = true;\n  }\n\n  public isComplete(): boolean {\n    // the actor following should never stop unless specified to do so\n    return this._stopped;\n  }\n\n  public reset(): void {\n    this._started = false;\n  }\n}\n","import { Actor } from '../../Actor';\nimport { Vector, vec } from '../../Math/vector';\nimport { Action } from '../Action';\n\nexport class Meet implements Action {\n  private _actor: Actor;\n  private _actorToMeet: Actor;\n  public x: number;\n  public y: number;\n  private _current: Vector;\n  private _end: Vector;\n  private _dir: Vector;\n  private _speed: number;\n  private _distanceBetween: number;\n  private _started = false;\n  private _stopped = false;\n  private _speedWasSpecified = false;\n\n  constructor(actor: Actor, actorToMeet: Actor, speed?: number) {\n    this._actor = actor;\n    this._actorToMeet = actorToMeet;\n    this._current = new Vector(this._actor.pos.x, this._actor.pos.y);\n    this._end = new Vector(actorToMeet.pos.x, actorToMeet.pos.y);\n    this._speed = speed || 0;\n\n    if (speed !== undefined) {\n      this._speedWasSpecified = true;\n    }\n  }\n\n  public update(_delta: number): void {\n    if (!this._started) {\n      this._started = true;\n      this._distanceBetween = this._current.distance(this._end);\n      this._dir = this._end.sub(this._current).normalize();\n    }\n\n    const actorToMeetSpeed = Math.sqrt(Math.pow(this._actorToMeet.vel.x, 2) + Math.pow(this._actorToMeet.vel.y, 2));\n    if (actorToMeetSpeed !== 0 && !this._speedWasSpecified) {\n      this._speed = actorToMeetSpeed;\n    }\n    this._current = vec(this._actor.pos.x, this._actor.pos.y);\n\n    this._end = vec(this._actorToMeet.pos.x, this._actorToMeet.pos.y);\n    this._distanceBetween = this._current.distance(this._end);\n    this._dir = this._end.sub(this._current).normalize();\n\n    const m = this._dir.scale(this._speed);\n    this._actor.vel = vec(m.x, m.y);\n\n    if (this.isComplete()) {\n      this._actor.pos = vec(this._end.x, this._end.y);\n      this._actor.vel = vec(0, 0);\n    }\n  }\n\n  public isComplete(): boolean {\n    return this._stopped || this._distanceBetween <= 1;\n  }\n\n  public stop(): void {\n    this._actor.vel = vec(0, 0);\n    this._stopped = true;\n  }\n\n  public reset(): void {\n    this._started = false;\n  }\n}\n","import { RotationType } from './RotationType';\r\n\r\nimport { Actor } from '../Actor';\r\nimport { EasingFunction, EasingFunctions } from '../Util/EasingFunctions';\r\nimport { ActionQueue } from './ActionQueue';\r\nimport { Repeat } from './Action/Repeat';\r\nimport { RepeatForever } from './Action/RepeatForever';\r\nimport { MoveBy } from './Action/MoveBy';\r\nimport { MoveTo } from './Action/MoveTo';\r\nimport { RotateTo } from './Action/RotateTo';\r\nimport { RotateBy } from './Action/RotateBy';\r\nimport { ScaleTo } from './Action/ScaleTo';\r\nimport { ScaleBy } from './Action/ScaleBy';\r\nimport { CallMethod } from './Action/CallMethod';\r\nimport { EaseTo } from './Action/EaseTo';\r\nimport { Blink } from './Action/Blink';\r\nimport { Fade } from './Action/Fade';\r\nimport { Delay } from './Action/Delay';\r\nimport { Die } from './Action/Die';\r\nimport { Follow } from './Action/Follow';\r\nimport { Meet } from './Action/Meet';\r\nimport { Vector } from '..';\r\n\r\n/**\r\n * The fluent Action API allows you to perform \"actions\" on\r\n * [[Actor|Actors]] such as following, moving, rotating, and\r\n * more. You can implement your own actions by implementing\r\n * the [[Action]] interface.\r\n */\r\nexport class ActionContext {\r\n  private _actor: Actor;\r\n  private _queue: ActionQueue;\r\n\r\n  constructor(actor: Actor) {\r\n    this._actor = actor;\r\n    this._queue = new ActionQueue(actor);\r\n  }\r\n\r\n  public getQueue(): ActionQueue {\r\n    return this._queue;\r\n  }\r\n\r\n  public update(elapsedMs: number) {\r\n    this._queue.update(elapsedMs);\r\n  }\r\n\r\n  /**\r\n   * Clears all queued actions from the Actor\r\n   */\r\n  public clearActions(): void {\r\n    this._queue.clearActions();\r\n  }\r\n\r\n  /**\r\n   * This method will move an actor to the specified `x` and `y` position over the\r\n   * specified duration using a given [[EasingFunctions]] and return back the actor. This\r\n   * method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param pos       The x,y vector location to move the actor to\r\n   * @param duration  The time it should take the actor to move to the new location in milliseconds\r\n   * @param easingFcn Use [[EasingFunctions]] or a custom function to use to calculate position, Default is [[EasingFunctions.Linear]]\r\n   */\r\n  public easeTo(pos: Vector, duration: number, easingFcn?: EasingFunction): ActionContext\r\n  /**\r\n   * This method will move an actor to the specified `x` and `y` position over the\r\n   * specified duration using a given [[EasingFunctions]] and return back the actor. This\r\n   * method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param x         The x location to move the actor to\r\n   * @param y         The y location to move the actor to\r\n   * @param duration  The time it should take the actor to move to the new location in milliseconds\r\n   * @param easingFcn Use [[EasingFunctions]] or a custom function to use to calculate position, Default is [[EasingFunctions.Linear]]\r\n   */\r\n  public easeTo(x: number, y: number, duration: number, easingFcn?: EasingFunction): ActionContext\r\n  public easeTo(...args: any[]): ActionContext {\r\n    let x = 0;\r\n    let y = 0;\r\n    let duration = 0;\r\n    let easingFcn = EasingFunctions.Linear;\r\n    if (args[0] instanceof Vector) {\r\n      x = args[0].x;\r\n      y = args[0].y;\r\n      duration = args[1];\r\n      easingFcn = args[2] ?? easingFcn;\r\n    } else {\r\n      x = args[0];\r\n      y = args[1];\r\n      duration = args[2];\r\n      easingFcn = args[3] ?? easingFcn;\r\n    }\r\n\r\n    this._queue.add(new EaseTo(this._actor, x, y, duration, easingFcn));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This method will move an actor to the specified x and y position at the\r\n   * speed specified (in pixels per second) and return back the actor. This\r\n   * method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param pos    The x,y vector location to move the actor to\r\n   * @param speed  The speed in pixels per second to move\r\n   */\r\n  public moveTo(pos: Vector, speed: number): ActionContext;\r\n  /**\r\n   * This method will move an actor to the specified x and y position at the\r\n   * speed specified (in pixels per second) and return back the actor. This\r\n   * method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param x      The x location to move the actor to\r\n   * @param y      The y location to move the actor to\r\n   * @param speed  The speed in pixels per second to move\r\n   */\r\n  public moveTo(x: number, y: number, speed: number): ActionContext;\r\n  public moveTo(xOrPos: number | Vector, yOrSpeed: number, speedOrUndefined?: number | undefined): ActionContext {\r\n    let x = 0;\r\n    let y = 0;\r\n    let speed = 0;\r\n    if (xOrPos instanceof Vector) {\r\n      x = xOrPos.x;\r\n      y = xOrPos.y;\r\n      speed = yOrSpeed;\r\n    } else {\r\n      x = xOrPos;\r\n      y = yOrSpeed;\r\n      speed = speedOrUndefined;\r\n    }\r\n    this._queue.add(new MoveTo(this._actor, x, y, speed));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This method will move an actor by the specified x offset and y offset from its current position, at a certain speed.\r\n   * This method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param xOffset     The x offset to apply to this actor\r\n   * @param yOffset     The y location to move the actor to\r\n   * @param speed  The speed in pixels per second the actor should move\r\n   */\r\n  public moveBy(offset: Vector, speed: number): ActionContext;\r\n  public moveBy(xOffset: number, yOffset: number, speed: number): ActionContext;\r\n  public moveBy(xOffsetOrVector: number | Vector, yOffsetOrSpeed: number, speedOrUndefined?: number | undefined): ActionContext {\r\n    let xOffset = 0;\r\n    let yOffset = 0;\r\n    let speed = 0;\r\n    if (xOffsetOrVector instanceof Vector) {\r\n      xOffset = xOffsetOrVector.x;\r\n      yOffset = xOffsetOrVector.y;\r\n      speed = yOffsetOrSpeed;\r\n    } else {\r\n      xOffset = xOffsetOrVector;\r\n      yOffset = yOffsetOrSpeed;\r\n      speed = speedOrUndefined;\r\n    }\r\n    this._queue.add(new MoveBy(this._actor, xOffset, yOffset, speed));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This method will rotate an actor to the specified angle at the speed\r\n   * specified (in radians per second) and return back the actor. This\r\n   * method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param angleRadians  The angle to rotate to in radians\r\n   * @param speed         The angular velocity of the rotation specified in radians per second\r\n   * @param rotationType  The [[RotationType]] to use for this rotation\r\n   */\r\n  public rotateTo(angleRadians: number, speed: number, rotationType?: RotationType): ActionContext {\r\n    this._queue.add(new RotateTo(this._actor, angleRadians, speed, rotationType));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This method will rotate an actor by the specified angle offset, from it's current rotation given a certain speed\r\n   * in radians/sec and return back the actor. This method is part\r\n   * of the actor 'Action' fluent API allowing action chaining.\r\n   * @param angleRadiansOffset  The angle to rotate to in radians relative to the current rotation\r\n   * @param speed          The speed in radians/sec the actor should rotate at\r\n   * @param rotationType  The [[RotationType]] to use for this rotation, default is shortest path\r\n   */\r\n  public rotateBy(angleRadiansOffset: number, speed: number, rotationType?: RotationType): ActionContext {\r\n    this._queue.add(new RotateBy(this._actor, angleRadiansOffset, speed, rotationType));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This method will scale an actor to the specified size at the speed\r\n   * specified (in magnitude increase per second) and return back the\r\n   * actor. This method is part of the actor 'Action' fluent API allowing\r\n   * action chaining.\r\n   * @param size    The scale to adjust the actor to over time\r\n   * @param speed   The speed of scaling specified in magnitude increase per second\r\n   */\r\n  public scaleTo(size: Vector, speed: Vector): ActionContext;\r\n  /**\r\n   * This method will scale an actor to the specified size at the speed\r\n   * specified (in magnitude increase per second) and return back the\r\n   * actor. This method is part of the actor 'Action' fluent API allowing\r\n   * action chaining.\r\n   * @param sizeX   The scaling factor to apply on X axis\r\n   * @param sizeY   The scaling factor to apply on Y axis\r\n   * @param speedX  The speed of scaling specified in magnitude increase per second on X axis\r\n   * @param speedY  The speed of scaling specified in magnitude increase per second on Y axis\r\n   */\r\n  public scaleTo(sizeX: number, sizeY: number, speedX: number, speedY: number): ActionContext;\r\n  public scaleTo(sizeXOrVector: number | Vector,\r\n    sizeYOrSpeed: number | Vector,\r\n    speedXOrUndefined?: number | undefined,\r\n    speedYOrUndefined?: number | undefined): ActionContext {\r\n\r\n    let sizeX = 1;\r\n    let sizeY = 1;\r\n    let speedX = 0;\r\n    let speedY = 0;\r\n\r\n    if (sizeXOrVector instanceof Vector && sizeYOrSpeed instanceof Vector) {\r\n      sizeX = sizeXOrVector.x;\r\n      sizeY = sizeXOrVector.y;\r\n\r\n      speedX = sizeYOrSpeed.x;\r\n      speedY = sizeYOrSpeed.y;\r\n    }\r\n    if (typeof sizeXOrVector === 'number' && typeof sizeYOrSpeed === 'number') {\r\n      sizeX = sizeXOrVector;\r\n      sizeY = sizeYOrSpeed;\r\n\r\n      speedX = speedXOrUndefined;\r\n      speedY = speedYOrUndefined;\r\n    }\r\n\r\n    this._queue.add(new ScaleTo(this._actor, sizeX, sizeY, speedX, speedY));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This method will scale an actor by an amount relative to the current scale at a certain speed in scale units/sec\r\n   * and return back the actor. This method is part of the\r\n   * actor 'Action' fluent API allowing action chaining.\r\n   * @param offset   The scaling factor to apply to the actor\r\n   * @param speed    The speed to scale at in scale units/sec\r\n   */\r\n  public scaleBy(offset: Vector, speed: number): ActionContext;\r\n  /**\r\n   * This method will scale an actor by an amount relative to the current scale at a certain speed in scale units/sec\r\n   * and return back the actor. This method is part of the\r\n   * actor 'Action' fluent API allowing action chaining.\r\n   * @param sizeOffsetX   The scaling factor to apply on X axis\r\n   * @param sizeOffsetY   The scaling factor to apply on Y axis\r\n   * @param speed    The speed to scale at in scale units/sec\r\n   */\r\n  public scaleBy(sizeOffsetX: number, sizeOffsetY: number, speed: number): ActionContext;\r\n  public scaleBy(sizeOffsetXOrVector: number | Vector, sizeOffsetYOrSpeed: number, speed?: number | undefined): ActionContext {\r\n    let sizeOffsetX = 1;\r\n    let sizeOffsetY = 1;\r\n\r\n    if (sizeOffsetXOrVector instanceof Vector) {\r\n      sizeOffsetX = sizeOffsetXOrVector.x;\r\n      sizeOffsetY = sizeOffsetXOrVector.y;\r\n\r\n      speed = sizeOffsetYOrSpeed;\r\n    }\r\n    if (typeof sizeOffsetXOrVector === 'number' && typeof sizeOffsetYOrSpeed === 'number') {\r\n      sizeOffsetX = sizeOffsetXOrVector;\r\n      sizeOffsetY = sizeOffsetYOrSpeed;\r\n    }\r\n\r\n    this._queue.add(new ScaleBy(this._actor, sizeOffsetX, sizeOffsetY, speed));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This method will cause an actor to blink (become visible and not\r\n   * visible). Optionally, you may specify the number of blinks. Specify the amount of time\r\n   * the actor should be visible per blink, and the amount of time not visible.\r\n   * This method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param timeVisible     The amount of time to stay visible per blink in milliseconds\r\n   * @param timeNotVisible  The amount of time to stay not visible per blink in milliseconds\r\n   * @param numBlinks       The number of times to blink\r\n   */\r\n  public blink(timeVisible: number, timeNotVisible: number, numBlinks: number = 1): ActionContext {\r\n    this._queue.add(new Blink(this._actor, timeVisible, timeNotVisible, numBlinks));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This method will cause an actor's opacity to change from its current value\r\n   * to the provided value by a specified time (in milliseconds). This method is\r\n   * part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param opacity  The ending opacity\r\n   * @param time     The time it should take to fade the actor (in milliseconds)\r\n   */\r\n  public fade(opacity: number, time: number): ActionContext {\r\n    this._queue.add(new Fade(this._actor, opacity, time));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This method will delay the next action from executing for a certain\r\n   * amount of time (in milliseconds). This method is part of the actor\r\n   * 'Action' fluent API allowing action chaining.\r\n   * @param time  The amount of time to delay the next action in the queue from executing in milliseconds\r\n   */\r\n  public delay(time: number): ActionContext {\r\n    this._queue.add(new Delay(this._actor, time));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This method will add an action to the queue that will remove the actor from the\r\n   * scene once it has completed its previous  Any actions on the\r\n   * action queue after this action will not be executed.\r\n   */\r\n  public die(): ActionContext {\r\n    this._queue.add(new Die(this._actor));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This method allows you to call an arbitrary method as the next action in the\r\n   * action queue. This is useful if you want to execute code in after a specific\r\n   * action, i.e An actor arrives at a destination after traversing a path\r\n   */\r\n  public callMethod(method: () => any): ActionContext {\r\n    this._queue.add(new CallMethod(method));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This method will cause the actor to repeat all of the actions built in\r\n   * the `repeatBuilder` callback. If the number of repeats\r\n   * is not specified it will repeat forever. This method is part of\r\n   * the actor 'Action' fluent API allowing action chaining\r\n   *\r\n   * ```typescript\r\n   * // Move up in a zig-zag by repeated moveBy's\r\n   * actor.actions.repeat(repeatCtx => {\r\n   *  repeatCtx.moveBy(10, 0, 10);\r\n   *  repeatCtx.moveBy(0, 10, 10);\r\n   * }, 5);\r\n   * ```\r\n   *\r\n   * @param repeatBuilder The builder to specify the repeatable list of actions\r\n   * @param times  The number of times to repeat all the previous actions in the action queue. If nothing is specified the actions\r\n   * will repeat forever\r\n   */\r\n  public repeat(repeatBuilder: (repeatContext: ActionContext) => any, times?: number): ActionContext {\r\n    if (!times) {\r\n      this.repeatForever(repeatBuilder);\r\n      return this;\r\n    }\r\n    this._queue.add(new Repeat(this._actor, repeatBuilder, times));\r\n\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This method will cause the actor to repeat all of the actions built in\r\n   * the `repeatBuilder` callback. If the number of repeats\r\n   * is not specified it will repeat forever. This method is part of\r\n   * the actor 'Action' fluent API allowing action chaining\r\n   *\r\n   * ```typescript\r\n   * // Move up in a zig-zag by repeated moveBy's\r\n   * actor.actions.repeat(repeatCtx => {\r\n   *  repeatCtx.moveBy(10, 0, 10);\r\n   *  repeatCtx.moveBy(0, 10, 10);\r\n   * }, 5);\r\n   * ```\r\n   *\r\n   * @param repeatBuilder The builder to specify the repeatable list of actions\r\n   */\r\n  public repeatForever(repeatBuilder: (repeatContext: ActionContext) => any): ActionContext {\r\n    this._queue.add(new RepeatForever(this._actor, repeatBuilder));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This method will cause the actor to follow another at a specified distance\r\n   * @param actor           The actor to follow\r\n   * @param followDistance  The distance to maintain when following, if not specified the actor will follow at the current distance.\r\n   */\r\n  public follow(actor: Actor, followDistance?: number): ActionContext {\r\n    if (followDistance === undefined) {\r\n      this._queue.add(new Follow(this._actor, actor));\r\n    } else {\r\n      this._queue.add(new Follow(this._actor, actor, followDistance));\r\n    }\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This method will cause the actor to move towards another until they\r\n   * collide \"meet\" at a specified speed.\r\n   * @param actor  The actor to meet\r\n   * @param speed  The speed in pixels per second to move, if not specified it will match the speed of the other actor\r\n   */\r\n  public meet(actor: Actor, speed?: number): ActionContext {\r\n    if (speed === undefined) {\r\n      this._queue.add(new Meet(this._actor, actor));\r\n    } else {\r\n      this._queue.add(new Meet(this._actor, actor, speed));\r\n    }\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Returns a promise that resolves when the current action queue up to now\r\n   * is finished.\r\n   */\r\n  public asPromise(): Promise<void> {\r\n    const temp = new Promise<void>((resolve) => {\r\n      this._queue.add(\r\n        new CallMethod(() => {\r\n          resolve();\r\n        })\r\n      );\r\n    });\r\n    return temp;\r\n  }\r\n}\r\n","/**\r\n * CollisionGroups indicate like members that do not collide with each other. Use [[CollisionGroupManager]] to create [[CollisionGroup]]s\r\n *\r\n * For example:\r\n *\r\n * Players have collision group \"player\"\r\n *\r\n * ![Player Collision Group](/assets/images/docs/CollisionGroupsPlayer.png)\r\n *\r\n * Enemies have collision group \"enemy\"\r\n *\r\n * ![Enemy Collision Group](/assets/images/docs/CollisionGroupsEnemy.png)\r\n *\r\n * Blocks have collision group \"ground\"\r\n *\r\n * ![Ground collision group](/assets/images/docs/CollisionGroupsGround.png)\r\n *\r\n * Players don't collide with each other, but enemies and blocks. Likewise, enemies don't collide with each other but collide\r\n * with players and blocks.\r\n *\r\n * This is done with bitmasking, see the following pseudo-code\r\n *\r\n * PlayerGroup = `0b001`\r\n * PlayerGroupMask = `0b110`\r\n *\r\n * EnemyGroup = `0b010`\r\n * EnemyGroupMask = `0b101`\r\n *\r\n * BlockGroup = `0b100`\r\n * BlockGroupMask = `0b011`\r\n *\r\n * Should Players collide? No because the bitwise mask evaluates to 0\r\n * `(player1.group & player2.mask) === 0`\r\n * `(0b001 & 0b110) === 0`\r\n *\r\n * Should Players and Enemies collide? Yes because the bitwise mask is non-zero\r\n * `(player1.group & enemy1.mask) === 1`\r\n * `(0b001 & 0b101) === 1`\r\n *\r\n * Should Players and Blocks collide? Yes because the bitwise mask is non-zero\r\n * `(player1.group & blocks1.mask) === 1`\r\n * `(0b001 & 0b011) === 1`\r\n */\r\nexport class CollisionGroup {\r\n  /**\r\n   * The `All` [[CollisionGroup]] is a special group that collides with all other groups including itself,\r\n   * it is the default collision group on colliders.\r\n   */\r\n  public static All = new CollisionGroup('Collide with all groups', -1, -1);\r\n\r\n  private _name: string;\r\n  private _category: number;\r\n  private _mask: number;\r\n\r\n  /**\r\n   * STOP!!** It is preferred that [[CollisionGroupManager.create]] is used to create collision groups\r\n   *  unless you know how to construct the proper bitmasks. See https://github.com/excaliburjs/Excalibur/issues/1091 for more info.\r\n   * @param name Name of the collision group\r\n   * @param category 32 bit category for the group, should be a unique power of 2. For example `0b001` or `0b010`\r\n   * @param mask 32 bit mask of category, or `~category` generally. For a category of `0b001`, the mask would be `0b110`\r\n   */\r\n  constructor(name: string, category: number, mask: number) {\r\n    this._name = name;\r\n    this._category = category;\r\n    this._mask = mask;\r\n  }\r\n\r\n  /**\r\n   * Get the name of the collision group\r\n   */\r\n  public get name() {\r\n    return this._name;\r\n  }\r\n\r\n  /**\r\n   * Get the category of the collision group, a 32 bit number which should be a unique power of 2\r\n   */\r\n  public get category() {\r\n    return this._category;\r\n  }\r\n\r\n  /**\r\n   * Get the mask for this collision group\r\n   */\r\n  public get mask() {\r\n    return this._mask;\r\n  }\r\n\r\n  /**\r\n   * Evaluates whether 2 collision groups can collide\r\n   * @param other  CollisionGroup\r\n   */\r\n  public canCollide(other: CollisionGroup): boolean {\r\n    return (this.category & other.mask) !== 0 && (other.category & this.mask) !== 0;\r\n  }\r\n\r\n  /**\r\n   * Inverts the collision group. For example, if before the group specified \"players\",\r\n   * inverting would specify all groups except players\r\n   * @returns CollisionGroup\r\n   */\r\n  public invert(): CollisionGroup {\r\n    return new CollisionGroup('~(' + this.name + ')', ~this.category, ~this.mask);\r\n  }\r\n\r\n  /**\r\n   * Combine collision groups with each other. The new group includes all of the previous groups.\r\n   *\r\n   * @param collisionGroups\r\n   * @returns\r\n   */\r\n  public static combine(collisionGroups: CollisionGroup[]) {\r\n    const combinedName = collisionGroups.map((c) => c.name).join('+');\r\n    const combinedCategory = collisionGroups.reduce((current, g) => g.category | current, 0b0);\r\n    const combinedMask = ~combinedCategory;\r\n\r\n    return new CollisionGroup(combinedName, combinedCategory, combinedMask);\r\n  }\r\n\r\n  /**\r\n   * Creates a collision group that collides with the listed groups\r\n   * @param collisionGroups\r\n   */\r\n  public static collidesWith(collisionGroups: CollisionGroup[]) {\r\n    return CollisionGroup.combine(collisionGroups).invert();\r\n  }\r\n}\r\n","/**\r\n * Defines a generic message that can contain any data\r\n * @template T is the typescript Type of the data\r\n */\r\nexport interface Message<T> {\r\n  type: string;\r\n  data: T;\r\n}\r\n\r\n/**\r\n * Defines an interface for an observer to receive a message via a notify() method\r\n */\r\nexport interface Observer<T> {\r\n  notify(message: T): void;\r\n}\r\n\r\n/**\r\n * Defines an interface for something that might be an observer if a notify() is present\r\n */\r\nexport type MaybeObserver<T> = Partial<Observer<T>>;\r\n\r\n/**\r\n * Simple Observable implemenation\r\n * @template T is the typescript Type that defines the data being observed\r\n */\r\nexport class Observable<T> {\r\n  public observers: Observer<T>[] = [];\r\n  public subscriptions: ((val: T) => any)[] = [];\r\n\r\n  /**\r\n   * Register an observer to listen to this observable\r\n   * @param observer\r\n   */\r\n  register(observer: Observer<T>) {\r\n    this.observers.push(observer);\r\n  }\r\n\r\n  /**\r\n   * Register a callback to listen to this observable\r\n   * @param func\r\n   */\r\n  subscribe(func: (val: T) => any) {\r\n    this.subscriptions.push(func);\r\n  }\r\n\r\n  /**\r\n   * Remove an observer from the observable\r\n   * @param observer\r\n   */\r\n  unregister(observer: Observer<T>) {\r\n    const i = this.observers.indexOf(observer);\r\n    if (i !== -1) {\r\n      this.observers.splice(i, 1);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Remove a callback that is listening to this observable\r\n   * @param func\r\n   */\r\n  unsubscribe(func: (val: T) => any) {\r\n    const i = this.subscriptions.indexOf(func);\r\n    if (i !== -1) {\r\n      this.subscriptions.splice(i, 1);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Broadcasts a message to all observers and callbacks\r\n   * @param message\r\n   */\r\n  notifyAll(message: T) {\r\n    this.observers.forEach((o) => o.notify(message));\r\n    this.subscriptions.forEach(cb => cb(message));\r\n  }\r\n\r\n  /**\r\n   * Removes all observers and callbacks\r\n   */\r\n  clear() {\r\n    this.observers.length = 0;\r\n    this.subscriptions.length = 0;\r\n  }\r\n}\r\n","import { CollisionContact } from './CollisionContact';\r\nimport { CollisionType } from '../CollisionType';\r\nimport { BodyComponent } from '../BodyComponent';\r\nimport { Id } from '../../Id';\r\nimport { Collider } from '../Colliders/Collider';\r\n\r\n/**\r\n * Models a potential collision between 2 colliders\r\n */\r\nexport class Pair {\r\n  public id: string = null;\r\n  constructor(public colliderA: Collider, public colliderB: Collider) {\r\n    this.id = Pair.calculatePairHash(colliderA.id, colliderB.id);\r\n  }\r\n\r\n  public static canCollide(colliderA: Collider, colliderB: Collider) {\r\n    const bodyA = colliderA?.owner?.get(BodyComponent);\r\n    const bodyB = colliderB?.owner?.get(BodyComponent);\r\n\r\n    // Body's needed for collision in the current state\r\n    // TODO can we collide without a body?\r\n    if (!bodyA || !bodyB) {\r\n      return false;\r\n    }\r\n\r\n    // If both are in the same collision group short circuit\r\n    if (!bodyA.group.canCollide(bodyB.group)) {\r\n      return false;\r\n    }\r\n\r\n    // if both are fixed short circuit\r\n    if (bodyA.collisionType === CollisionType.Fixed && bodyB.collisionType === CollisionType.Fixed) {\r\n      return false;\r\n    }\r\n\r\n    // if the either is prevent collision short circuit\r\n    if (bodyB.collisionType === CollisionType.PreventCollision || bodyA.collisionType === CollisionType.PreventCollision) {\r\n      return false;\r\n    }\r\n\r\n    // if either is dead short circuit\r\n    if (!bodyA.active || !bodyB.active) {\r\n      return false;\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Returns whether or not it is possible for the pairs to collide\r\n   */\r\n  public get canCollide(): boolean {\r\n    const colliderA = this.colliderA;\r\n    const colliderB = this.colliderB;\r\n    return Pair.canCollide(colliderA, colliderB);\r\n  }\r\n\r\n  /**\r\n   * Runs the collision intersection logic on the members of this pair\r\n   */\r\n  public collide(): CollisionContact[] {\r\n    return this.colliderA.collide(this.colliderB);\r\n  }\r\n\r\n  /**\r\n   * Check if the collider is part of the pair\r\n   * @param collider\r\n   * @returns\r\n   */\r\n  public hasCollider(collider: Collider) {\r\n    return collider === this.colliderA || collider === this.colliderB;\r\n  }\r\n\r\n  /**\r\n   * Calculates the unique pair hash id for this collision pair (owning id)\r\n   */\r\n  public static calculatePairHash(idA: Id<'collider'>, idB: Id<'collider'>): string {\r\n    if (idA.value < idB.value) {\r\n      return `#${idA.value}+${idB.value}`;\r\n    } else {\r\n      return `#${idB.value}+${idA.value}`;\r\n    }\r\n  }\r\n}\r\n","/**\n * A 1 dimensional projection on an axis, used to test overlaps\n */\n\nexport class Projection {\n  constructor(public min: number, public max: number) {}\n  public overlaps(projection: Projection): boolean {\n    return this.max > projection.min && projection.max > this.min;\n  }\n\n  public getOverlap(projection: Projection): number {\n    if (this.overlaps(projection)) {\n      if (this.max > projection.max) {\n        return projection.max - this.min;\n      } else {\n        return this.max - projection.min;\n      }\n    }\n    return 0;\n  }\n}\n","import { Physics } from '../Physics';\r\nimport { BoundingBox } from '../BoundingBox';\r\n\r\nimport { Ray } from '../../Math/ray';\r\nimport { Logger } from '../../Util/Log';\r\nimport { Id } from '../../Id';\r\nimport { Entity } from '../../EntityComponentSystem/Entity';\r\nimport { BodyComponent } from '../BodyComponent';\r\nimport { Color, ExcaliburGraphicsContext } from '../..';\r\n\r\n/**\r\n * Dynamic Tree Node used for tracking bounds within the tree\r\n */\r\nexport class TreeNode<T> {\r\n  public left: TreeNode<T>;\r\n  public right: TreeNode<T>;\r\n  public bounds: BoundingBox;\r\n  public height: number;\r\n  public data: T;\r\n  constructor(public parent?: TreeNode<T>) {\r\n    this.parent = parent || null;\r\n    this.data = null;\r\n    this.bounds = new BoundingBox();\r\n    this.left = null;\r\n    this.right = null;\r\n    this.height = 0;\r\n  }\r\n\r\n  public isLeaf(): boolean {\r\n    return !this.left && !this.right;\r\n  }\r\n}\r\n\r\nexport interface ColliderProxy<T> {\r\n  id: Id<'collider'>;\r\n  owner: T;\r\n  bounds: BoundingBox;\r\n}\r\n\r\n/**\r\n * The DynamicTrees provides a spatial partitioning data structure for quickly querying for overlapping bounding boxes for\r\n * all tracked bodies. The worst case performance of this is O(n*log(n)) where n is the number of bodies in the tree.\r\n *\r\n * Internally the bounding boxes are organized as a balanced binary tree of bounding boxes, where the leaf nodes are tracked bodies.\r\n * Every non-leaf node is a bounding box that contains child bounding boxes.\r\n */\r\nexport class DynamicTree<T extends ColliderProxy<Entity>> {\r\n  public root: TreeNode<T>;\r\n  public nodes: { [key: number]: TreeNode<T> };\r\n  constructor(public worldBounds: BoundingBox = new BoundingBox(-Number.MAX_VALUE, -Number.MAX_VALUE, Number.MAX_VALUE, Number.MAX_VALUE)) {\r\n    this.root = null;\r\n    this.nodes = {};\r\n  }\r\n\r\n  /**\r\n   * Inserts a node into the dynamic tree\r\n   */\r\n  private _insert(leaf: TreeNode<T>): void {\r\n    // If there are no nodes in the tree, make this the root leaf\r\n    if (this.root === null) {\r\n      this.root = leaf;\r\n      this.root.parent = null;\r\n      return;\r\n    }\r\n\r\n    // Search the tree for a node that is not a leaf and find the best place to insert\r\n    const leafAABB = leaf.bounds;\r\n    let currentRoot = this.root;\r\n    while (!currentRoot.isLeaf()) {\r\n      const left = currentRoot.left;\r\n      const right = currentRoot.right;\r\n\r\n      const area = currentRoot.bounds.getPerimeter();\r\n      const combinedAABB = currentRoot.bounds.combine(leafAABB);\r\n      const combinedArea = combinedAABB.getPerimeter();\r\n\r\n      // Calculate cost heuristic for creating a new parent and leaf\r\n      const cost = 2 * combinedArea;\r\n\r\n      // Minimum cost of pushing the leaf down the tree\r\n      const inheritanceCost = 2 * (combinedArea - area);\r\n\r\n      // Cost of descending\r\n      let leftCost = 0;\r\n      const leftCombined = leafAABB.combine(left.bounds);\r\n      let newArea;\r\n      let oldArea;\r\n      if (left.isLeaf()) {\r\n        leftCost = leftCombined.getPerimeter() + inheritanceCost;\r\n      } else {\r\n        oldArea = left.bounds.getPerimeter();\r\n        newArea = leftCombined.getPerimeter();\r\n        leftCost = newArea - oldArea + inheritanceCost;\r\n      }\r\n\r\n      let rightCost = 0;\r\n      const rightCombined = leafAABB.combine(right.bounds);\r\n      if (right.isLeaf()) {\r\n        rightCost = rightCombined.getPerimeter() + inheritanceCost;\r\n      } else {\r\n        oldArea = right.bounds.getPerimeter();\r\n        newArea = rightCombined.getPerimeter();\r\n        rightCost = newArea - oldArea + inheritanceCost;\r\n      }\r\n\r\n      // cost is acceptable\r\n      if (cost < leftCost && cost < rightCost) {\r\n        break;\r\n      }\r\n\r\n      // Descend to the depths\r\n      if (leftCost < rightCost) {\r\n        currentRoot = left;\r\n      } else {\r\n        currentRoot = right;\r\n      }\r\n    }\r\n\r\n    // Create the new parent node and insert into the tree\r\n    const oldParent = currentRoot.parent;\r\n    const newParent = new TreeNode(oldParent);\r\n    newParent.bounds = leafAABB.combine(currentRoot.bounds);\r\n    newParent.height = currentRoot.height + 1;\r\n\r\n    if (oldParent !== null) {\r\n      // The sibling node was not the root\r\n      if (oldParent.left === currentRoot) {\r\n        oldParent.left = newParent;\r\n      } else {\r\n        oldParent.right = newParent;\r\n      }\r\n\r\n      newParent.left = currentRoot;\r\n      newParent.right = leaf;\r\n\r\n      currentRoot.parent = newParent;\r\n      leaf.parent = newParent;\r\n    } else {\r\n      // The sibling node was the root\r\n      newParent.left = currentRoot;\r\n      newParent.right = leaf;\r\n\r\n      currentRoot.parent = newParent;\r\n      leaf.parent = newParent;\r\n      this.root = newParent;\r\n    }\r\n\r\n    // Walk up the tree fixing heights and AABBs\r\n    let currentNode = leaf.parent;\r\n    while (currentNode) {\r\n      currentNode = this._balance(currentNode);\r\n\r\n      if (!currentNode.left) {\r\n        throw new Error('Parent of current leaf cannot have a null left child' + currentNode);\r\n      }\r\n      if (!currentNode.right) {\r\n        throw new Error('Parent of current leaf cannot have a null right child' + currentNode);\r\n      }\r\n\r\n      currentNode.height = 1 + Math.max(currentNode.left.height, currentNode.right.height);\r\n      currentNode.bounds = currentNode.left.bounds.combine(currentNode.right.bounds);\r\n\r\n      currentNode = currentNode.parent;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Removes a node from the dynamic tree\r\n   */\r\n  private _remove(leaf: TreeNode<T>) {\r\n    if (leaf === this.root) {\r\n      this.root = null;\r\n      return;\r\n    }\r\n\r\n    const parent = leaf.parent;\r\n    const grandParent = parent.parent;\r\n    let sibling: TreeNode<T>;\r\n    if (parent.left === leaf) {\r\n      sibling = parent.right;\r\n    } else {\r\n      sibling = parent.left;\r\n    }\r\n\r\n    if (grandParent) {\r\n      if (grandParent.left === parent) {\r\n        grandParent.left = sibling;\r\n      } else {\r\n        grandParent.right = sibling;\r\n      }\r\n      sibling.parent = grandParent;\r\n\r\n      let currentNode = grandParent;\r\n      while (currentNode) {\r\n        currentNode = this._balance(currentNode);\r\n        currentNode.bounds = currentNode.left.bounds.combine(currentNode.right.bounds);\r\n        currentNode.height = 1 + Math.max(currentNode.left.height, currentNode.right.height);\r\n\r\n        currentNode = currentNode.parent;\r\n      }\r\n    } else {\r\n      this.root = sibling;\r\n      sibling.parent = null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Tracks a body in the dynamic tree\r\n   */\r\n  public trackCollider(collider: T) {\r\n    const node = new TreeNode<T>();\r\n    node.data = collider;\r\n    node.bounds = collider.bounds;\r\n    node.bounds.left -= 2;\r\n    node.bounds.top -= 2;\r\n    node.bounds.right += 2;\r\n    node.bounds.bottom += 2;\r\n    this.nodes[collider.id.value] = node;\r\n    this._insert(node);\r\n  }\r\n\r\n  /**\r\n   * Updates the dynamic tree given the current bounds of each body being tracked\r\n   */\r\n  public updateCollider(collider: T) {\r\n    const node = this.nodes[collider.id.value];\r\n    if (!node) {\r\n      return false;\r\n    }\r\n    const b = collider.bounds;\r\n\r\n    // if the body is outside the world no longer update it\r\n    if (!this.worldBounds.contains(b)) {\r\n      Logger.getInstance().warn(\r\n        'Collider with id ' + collider.id.value + ' is outside the world bounds and will no longer be tracked for physics'\r\n      );\r\n      this.untrackCollider(collider);\r\n      return false;\r\n    }\r\n\r\n    if (node.bounds.contains(b)) {\r\n      return false;\r\n    }\r\n\r\n    this._remove(node);\r\n    b.left -= Physics.boundsPadding;\r\n    b.top -= Physics.boundsPadding;\r\n    b.right += Physics.boundsPadding;\r\n    b.bottom += Physics.boundsPadding;\r\n\r\n    // THIS IS CAUSING UNECESSARY CHECKS\r\n    if (collider.owner) {\r\n      const body = collider.owner?.get(BodyComponent);\r\n      if (body) {\r\n        const multdx = ((body.vel.x * 32) / 1000) * Physics.dynamicTreeVelocityMultiplier;\r\n        const multdy = ((body.vel.y * 32) / 1000) * Physics.dynamicTreeVelocityMultiplier;\r\n\r\n        if (multdx < 0) {\r\n          b.left += multdx;\r\n        } else {\r\n          b.right += multdx;\r\n        }\r\n\r\n        if (multdy < 0) {\r\n          b.top += multdy;\r\n        } else {\r\n          b.bottom += multdy;\r\n        }\r\n      }\r\n    }\r\n\r\n    node.bounds = b;\r\n    this._insert(node);\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Untracks a body from the dynamic tree\r\n   */\r\n  public untrackCollider(collider: T) {\r\n    const node = this.nodes[collider.id.value];\r\n    if (!node) {\r\n      return;\r\n    }\r\n    this._remove(node);\r\n    this.nodes[collider.id.value] = null;\r\n    delete this.nodes[collider.id.value];\r\n  }\r\n\r\n  /**\r\n   * Balances the tree about a node\r\n   */\r\n  private _balance(node: TreeNode<T>) {\r\n    if (node === null) {\r\n      throw new Error('Cannot balance at null node');\r\n    }\r\n\r\n    if (node.isLeaf() || node.height < 2) {\r\n      return node;\r\n    }\r\n\r\n    const left = node.left;\r\n    const right = node.right;\r\n\r\n    const a = node;\r\n    const b = left;\r\n    const c = right;\r\n    const d = left.left;\r\n    const e = left.right;\r\n    const f = right.left;\r\n    const g = right.right;\r\n\r\n    const balance = c.height - b.height;\r\n    // Rotate c node up\r\n    if (balance > 1) {\r\n      // Swap the right node with it's parent\r\n      c.left = a;\r\n      c.parent = a.parent;\r\n      a.parent = c;\r\n\r\n      // The original node's old parent should point to the right node\r\n      // this is mega confusing\r\n      if (c.parent) {\r\n        if (c.parent.left === a) {\r\n          c.parent.left = c;\r\n        } else {\r\n          c.parent.right = c;\r\n        }\r\n      } else {\r\n        this.root = c;\r\n      }\r\n\r\n      // Rotate\r\n      if (f.height > g.height) {\r\n        c.right = f;\r\n        a.right = g;\r\n        g.parent = a;\r\n\r\n        a.bounds = b.bounds.combine(g.bounds);\r\n        c.bounds = a.bounds.combine(f.bounds);\r\n\r\n        a.height = 1 + Math.max(b.height, g.height);\r\n        c.height = 1 + Math.max(a.height, f.height);\r\n      } else {\r\n        c.right = g;\r\n        a.right = f;\r\n        f.parent = a;\r\n\r\n        a.bounds = b.bounds.combine(f.bounds);\r\n        c.bounds = a.bounds.combine(g.bounds);\r\n\r\n        a.height = 1 + Math.max(b.height, f.height);\r\n        c.height = 1 + Math.max(a.height, g.height);\r\n      }\r\n\r\n      return c;\r\n    }\r\n    // Rotate left node up\r\n    if (balance < -1) {\r\n      // swap\r\n      b.left = a;\r\n      b.parent = a.parent;\r\n      a.parent = b;\r\n\r\n      // node's old parent should point to b\r\n      if (b.parent) {\r\n        if (b.parent.left === a) {\r\n          b.parent.left = b;\r\n        } else {\r\n          if (b.parent.right !== a) {\r\n            throw 'Error rotating Dynamic Tree';\r\n          }\r\n          b.parent.right = b;\r\n        }\r\n      } else {\r\n        this.root = b;\r\n      }\r\n\r\n      // rotate\r\n      if (d.height > e.height) {\r\n        b.right = d;\r\n        a.left = e;\r\n        e.parent = a;\r\n\r\n        a.bounds = c.bounds.combine(e.bounds);\r\n        b.bounds = a.bounds.combine(d.bounds);\r\n\r\n        a.height = 1 + Math.max(c.height, e.height);\r\n        b.height = 1 + Math.max(a.height, d.height);\r\n      } else {\r\n        b.right = e;\r\n        a.left = d;\r\n        d.parent = a;\r\n\r\n        a.bounds = c.bounds.combine(d.bounds);\r\n        b.bounds = a.bounds.combine(e.bounds);\r\n\r\n        a.height = 1 + Math.max(c.height, d.height);\r\n        b.height = 1 + Math.max(a.height, e.height);\r\n      }\r\n      return b;\r\n    }\r\n\r\n    return node;\r\n  }\r\n\r\n  /**\r\n   * Returns the internal height of the tree, shorter trees are better. Performance drops as the tree grows\r\n   */\r\n  public getHeight(): number {\r\n    if (this.root === null) {\r\n      return 0;\r\n    }\r\n    return this.root.height;\r\n  }\r\n\r\n  /**\r\n   * Queries the Dynamic Axis Aligned Tree for bodies that could be colliding with the provided body.\r\n   *\r\n   * In the query callback, it will be passed a potential collider. Returning true from this callback indicates\r\n   * that you are complete with your query and you do not want to continue. Returning false will continue searching\r\n   * the tree until all possible colliders have been returned.\r\n   */\r\n  public query(collider: T, callback: (other: T) => boolean): void {\r\n    const bounds = collider.bounds;\r\n    const helper = (currentNode: TreeNode<T>): boolean => {\r\n      if (currentNode && currentNode.bounds.intersect(bounds)) {\r\n        if (currentNode.isLeaf() && currentNode.data !== collider) {\r\n          if (callback.call(collider, currentNode.data)) {\r\n            return true;\r\n          }\r\n        } else {\r\n          return helper(currentNode.left) || helper(currentNode.right);\r\n        }\r\n      }\r\n      return false;\r\n    };\r\n    helper(this.root);\r\n  }\r\n\r\n  /**\r\n   * Queries the Dynamic Axis Aligned Tree for bodies that could be intersecting. By default the raycast query uses an infinitely\r\n   * long ray to test the tree specified by `max`.\r\n   *\r\n   * In the query callback, it will be passed a potential body that intersects with the raycast. Returning true from this\r\n   * callback indicates that your are complete with your query and do not want to continue. Return false will continue searching\r\n   * the tree until all possible bodies that would intersect with the ray have been returned.\r\n   */\r\n  public rayCastQuery(ray: Ray, max: number = Infinity, callback: (other: T) => boolean): void {\r\n    const helper = (currentNode: TreeNode<T>): boolean => {\r\n      if (currentNode && currentNode.bounds.rayCast(ray, max)) {\r\n        if (currentNode.isLeaf()) {\r\n          if (callback.call(ray, currentNode.data)) {\r\n            // ray hit a leaf! return the body\r\n            return true;\r\n          }\r\n        } else {\r\n          // ray hit but not at a leaf, recurse deeper\r\n          return helper(currentNode.left) || helper(currentNode.right);\r\n        }\r\n      }\r\n      return false; // ray missed\r\n    };\r\n    helper(this.root);\r\n  }\r\n\r\n  public getNodes(): TreeNode<T>[] {\r\n    const helper = (currentNode: TreeNode<T>): TreeNode<T>[] => {\r\n      if (currentNode) {\r\n        return [currentNode].concat(helper(currentNode.left), helper(currentNode.right));\r\n      } else {\r\n        return [];\r\n      }\r\n    };\r\n    return helper(this.root);\r\n  }\r\n\r\n  public debug(ex: ExcaliburGraphicsContext) {\r\n    // draw all the nodes in the Dynamic Tree\r\n    const helper = (currentNode: TreeNode<T>) => {\r\n      if (currentNode) {\r\n        if (currentNode.isLeaf()) {\r\n          currentNode.bounds.draw(ex, Color.Green);\r\n        } else {\r\n          currentNode.bounds.draw(ex, Color.White);\r\n        }\r\n\r\n        if (currentNode.left) {\r\n          helper(currentNode.left);\r\n        }\r\n        if (currentNode.right) {\r\n          helper(currentNode.right);\r\n        }\r\n      }\r\n    };\r\n\r\n    helper(this.root);\r\n  }\r\n}\r\n","import { Line } from './line';\nimport { Vector } from './vector';\n\n/**\n * A 2D ray that can be cast into the scene to do collision detection\n */\n\nexport class Ray {\n  public pos: Vector;\n  public dir: Vector;\n\n  /**\n   * @param pos The starting position for the ray\n   * @param dir The vector indicating the direction of the ray\n   */\n  constructor(pos: Vector, dir: Vector) {\n    this.pos = pos;\n    this.dir = dir.normalize();\n  }\n\n  /**\n   * Tests a whether this ray intersects with a line segment. Returns a number greater than or equal to 0 on success.\n   * This number indicates the mathematical intersection time.\n   * @param line  The line to test\n   */\n  public intersect(line: Line): number {\n    const numerator = line.begin.sub(this.pos);\n\n    // Test is line and ray are parallel and non intersecting\n    if (this.dir.cross(line.getSlope()) === 0 && numerator.cross(this.dir) !== 0) {\n      return -1;\n    }\n\n    // Lines are parallel\n    const divisor = this.dir.cross(line.getSlope());\n    if (divisor === 0) {\n      return -1;\n    }\n\n    const t = numerator.cross(line.getSlope()) / divisor;\n\n    if (t >= 0) {\n      const u = numerator.cross(this.dir) / divisor / line.getLength();\n      if (u >= 0 && u <= 1) {\n        return t;\n      }\n    }\n    return -1;\n  }\n\n  public intersectPoint(line: Line): Vector {\n    const time = this.intersect(line);\n    if (time < 0) {\n      return null;\n    }\n    return this.getPoint(time);\n  }\n\n  /**\n   * Returns the point of intersection given the intersection time\n   */\n  public getPoint(time: number): Vector {\n    return this.pos.add(this.dir.scale(time));\n  }\n}\n","import { Physics } from '../Physics';\r\nimport { CollisionProcessor } from './CollisionProcessor';\r\nimport { DynamicTree } from './DynamicTree';\r\nimport { Pair } from './Pair';\r\n\r\nimport { Vector } from '../../Math/vector';\r\nimport { Ray } from '../../Math/ray';\r\nimport { FrameStats } from '../../Debug';\r\nimport { Logger } from '../../Util/Log';\r\nimport { CollisionType } from '../CollisionType';\r\nimport { Collider } from '../Colliders/Collider';\r\nimport { CollisionContact } from '../Detection/CollisionContact';\r\nimport { BodyComponent } from '../BodyComponent';\r\nimport { CompositeCollider } from '../Colliders/CompositeCollider';\r\nimport { ExcaliburGraphicsContext } from '../..';\r\n\r\n/**\r\n * Responsible for performing the collision broadphase (locating potential colllisions) and\r\n * the narrowphase (actual collision contacts)\r\n */\r\nexport class DynamicTreeCollisionProcessor implements CollisionProcessor {\r\n  private _dynamicCollisionTree = new DynamicTree<Collider>();\r\n  private _collisions = new Set<string>();\r\n\r\n  private _collisionPairCache: Pair[] = [];\r\n  private _colliders: Collider[] = [];\r\n\r\n  public getColliders(): readonly Collider[] {\r\n    return this._colliders;\r\n  }\r\n\r\n  /**\r\n   * Tracks a physics body for collisions\r\n   */\r\n  public track(target: Collider): void {\r\n    if (!target) {\r\n      Logger.getInstance().warn('Cannot track null collider');\r\n      return;\r\n    }\r\n    if (target instanceof CompositeCollider) {\r\n      const colliders = target.getColliders();\r\n      for (const c of colliders) {\r\n        c.owner = target.owner;\r\n        this._colliders.push(c);\r\n        this._dynamicCollisionTree.trackCollider(c);\r\n      }\r\n    } else {\r\n      this._colliders.push(target);\r\n      this._dynamicCollisionTree.trackCollider(target);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Untracks a physics body\r\n   */\r\n  public untrack(target: Collider): void {\r\n    if (!target) {\r\n      Logger.getInstance().warn('Cannot untrack a null collider');\r\n      return;\r\n    }\r\n\r\n    if (target instanceof CompositeCollider) {\r\n      const colliders = target.getColliders();\r\n      for (const c of colliders) {\r\n        const index = this._colliders.indexOf(c);\r\n        if (index !== -1) {\r\n          this._colliders.splice(index, 1);\r\n        }\r\n        this._dynamicCollisionTree.untrackCollider(c);\r\n      }\r\n    } else {\r\n      const index = this._colliders.indexOf(target);\r\n      if (index !== -1) {\r\n        this._colliders.splice(index, 1);\r\n      }\r\n      this._dynamicCollisionTree.untrackCollider(target);\r\n    }\r\n  }\r\n\r\n  private _shouldGenerateCollisionPair(colliderA: Collider, colliderB: Collider) {\r\n    // if the collision pair must be 2 separate colliders\r\n    // Also separate owners for composite colliders\r\n    if (\r\n      (colliderA.id !== null &&\r\n      colliderB.id !== null &&\r\n      colliderA.id === colliderB.id) ||\r\n      (colliderA.owner !== null &&\r\n       colliderB.owner !== null &&\r\n       colliderA.owner === colliderB.owner)) {\r\n      return false;\r\n    }\r\n\r\n    // if the collision pair has been calculated already short circuit\r\n    const hash = Pair.calculatePairHash(colliderA.id, colliderB.id);\r\n    if (this._collisions.has(hash)) {\r\n      return false; // pair exists easy exit return false\r\n    }\r\n\r\n    // if the pair has a member with zero dimension\r\n    if (colliderA.localBounds.hasZeroDimensions() || colliderB.localBounds.hasZeroDimensions()) {\r\n      return false;\r\n    }\r\n\r\n    return Pair.canCollide(colliderA, colliderB);\r\n  }\r\n\r\n  /**\r\n   * Detects potential collision pairs in a broadphase approach with the dynamic aabb tree strategy\r\n   */\r\n  public broadphase(targets: Collider[], delta: number, stats?: FrameStats): Pair[] {\r\n    const seconds = delta / 1000;\r\n\r\n    // Retrieve the list of potential colliders, exclude killed, prevented, and self\r\n    const potentialColliders = targets.filter((other) => {\r\n      const body = other.owner?.get(BodyComponent);\r\n      return other.owner?.active && body.collisionType !== CollisionType.PreventCollision;\r\n    });\r\n\r\n    // clear old list of collision pairs\r\n    this._collisionPairCache = [];\r\n    this._collisions.clear();\r\n\r\n    // check for normal collision pairs\r\n    let collider: Collider;\r\n    for (let j = 0, l = potentialColliders.length; j < l; j++) {\r\n      collider = potentialColliders[j];\r\n      // Query the collision tree for potential colliders\r\n      this._dynamicCollisionTree.query(collider, (other: Collider) => {\r\n        if (this._shouldGenerateCollisionPair(collider, other)) {\r\n          const pair = new Pair(collider, other);\r\n          this._collisions.add(pair.id);\r\n          this._collisionPairCache.push(pair);\r\n        }\r\n        // Always return false, to query whole tree. Returning true in the query method stops searching\r\n        return false;\r\n      });\r\n    }\r\n    if (stats) {\r\n      stats.physics.pairs = this._collisionPairCache.length;\r\n    }\r\n\r\n    // Check dynamic tree for fast moving objects\r\n    // Fast moving objects are those moving at least there smallest bound per frame\r\n    if (Physics.checkForFastBodies) {\r\n      for (const collider of potentialColliders) {\r\n        const body = collider.owner.get(BodyComponent);\r\n        // Skip non-active objects. Does not make sense on other collision types\r\n        if (body.collisionType !== CollisionType.Active) {\r\n          continue;\r\n        }\r\n\r\n        // Maximum travel distance next frame\r\n        const updateDistance =\r\n          body.vel.size * seconds + // velocity term\r\n          body.acc.size * 0.5 * seconds * seconds; // acc term\r\n\r\n        // Find the minimum dimension\r\n        const minDimension = Math.min(collider.bounds.height, collider.bounds.width);\r\n        if (Physics.disableMinimumSpeedForFastBody || updateDistance > minDimension / 2) {\r\n          if (stats) {\r\n            stats.physics.fastBodies++;\r\n          }\r\n\r\n          // start with the oldPos because the integration for actors has already happened\r\n          // objects resting on a surface may be slightly penetrating in the current position\r\n          const updateVec = body.pos.sub(body.oldPos);\r\n          const centerPoint = collider.center;\r\n          const furthestPoint = collider.getFurthestPoint(body.vel);\r\n          const origin: Vector = furthestPoint.sub(updateVec);\r\n\r\n          const ray: Ray = new Ray(origin, body.vel);\r\n\r\n          // back the ray up by -2x surfaceEpsilon to account for fast moving objects starting on the surface\r\n          ray.pos = ray.pos.add(ray.dir.scale(-2 * Physics.surfaceEpsilon));\r\n          let minCollider: Collider;\r\n          let minTranslate: Vector = new Vector(Infinity, Infinity);\r\n          this._dynamicCollisionTree.rayCastQuery(ray, updateDistance + Physics.surfaceEpsilon * 2, (other: Collider) => {\r\n            if (collider !== other && Pair.canCollide(collider, other)) {\r\n              const hitPoint = other.rayCast(ray, updateDistance + Physics.surfaceEpsilon * 10);\r\n              if (hitPoint) {\r\n                const translate = hitPoint.sub(origin);\r\n                if (translate.size < minTranslate.size) {\r\n                  minTranslate = translate;\r\n                  minCollider = other;\r\n                }\r\n              }\r\n            }\r\n            return false;\r\n          });\r\n\r\n          if (minCollider && Vector.isValid(minTranslate)) {\r\n            const pair = new Pair(collider, minCollider);\r\n            if (!this._collisions.has(pair.id)) {\r\n              this._collisions.add(pair.id);\r\n              this._collisionPairCache.push(pair);\r\n            }\r\n            // move the fast moving object to the other body\r\n            // need to push into the surface by ex.Physics.surfaceEpsilon\r\n            const shift = centerPoint.sub(furthestPoint);\r\n            body.pos = origin\r\n              .add(shift)\r\n              .add(minTranslate)\r\n              .add(ray.dir.scale(10 * Physics.surfaceEpsilon)); // needed to push the shape slightly into contact\r\n            collider.update(body.transform);\r\n\r\n            if (stats) {\r\n              stats.physics.fastBodyCollisions++;\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n    // return cache\r\n    return this._collisionPairCache;\r\n  }\r\n\r\n  /**\r\n   * Applies narrow phase on collision pairs to find actual area intersections\r\n   * Adds actual colliding pairs to stats' Frame data\r\n   */\r\n  public narrowphase(pairs: Pair[], stats?: FrameStats): CollisionContact[] {\r\n    let contacts: CollisionContact[] = [];\r\n    for (let i = 0; i < pairs.length; i++) {\r\n      const newContacts = pairs[i].collide();\r\n      contacts = contacts.concat(newContacts);\r\n      if (stats && newContacts.length > 0) {\r\n        for (const c of newContacts) {\r\n          stats.physics.contacts.set(c.id, c);\r\n        }\r\n      }\r\n    }\r\n    if (stats) {\r\n      stats.physics.collisions += contacts.length;\r\n    }\r\n    return contacts;\r\n  }\r\n\r\n  /**\r\n   * Update the dynamic tree positions\r\n   */\r\n  public update(targets: Collider[]): number {\r\n    let updated = 0;\r\n    const len = targets.length;\r\n\r\n    for (let i = 0; i < len; i++) {\r\n      if (this._dynamicCollisionTree.updateCollider(targets[i])) {\r\n        updated++;\r\n      }\r\n    }\r\n    return updated;\r\n  }\r\n\r\n  public debug(ex: ExcaliburGraphicsContext) {\r\n    this._dynamicCollisionTree.debug(ex);\r\n  }\r\n}\r\n","import { Color } from '../../Color';\r\nimport { CollisionContact } from '../Detection/CollisionContact';\r\nimport { BoundingBox } from '../BoundingBox';\r\nimport { Projection } from '../../Math/projection';\r\nimport { Line } from '../../Math/line';\r\nimport { Vector } from '../../Math/vector';\r\nimport { Ray } from '../../Math/ray';\r\nimport { Clonable } from '../../Interfaces/Clonable';\r\nimport { Entity, Transform } from '../../EntityComponentSystem';\r\nimport { createId, Id } from '../../Id';\r\nimport { EventDispatcher } from '../../EventDispatcher';\r\nimport { ExcaliburGraphicsContext } from '../../Graphics/Context/ExcaliburGraphicsContext';\r\n\r\n/**\r\n * A collision collider specifies the geometry that can detect when other collision colliders intersect\r\n * for the purposes of colliding 2 objects in excalibur.\r\n */\r\nexport abstract class Collider implements Clonable<Collider> {\r\n  private static _ID = 0;\r\n  public readonly id: Id<'collider'> = createId('collider', Collider._ID++);\r\n  public events: EventDispatcher<Collider> = new EventDispatcher<Collider>(this);\r\n\r\n  /**\r\n   * Returns a boolean indicating whether this body collided with\r\n   * or was in stationary contact with\r\n   * the body of the other [[Collider]]\r\n   */\r\n  public touching(other: Collider): boolean {\r\n    const contact = this.collide(other);\r\n\r\n    if (contact) {\r\n      return true;\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  public owner: Entity;\r\n\r\n  /**\r\n   * Pixel offset of the collision collider relative to the collider, by default (0, 0) meaning the collider is positioned\r\n   * on top of the collider.\r\n   */\r\n  offset: Vector;\r\n\r\n  /**\r\n   * Position of the collision collider in world coordinates\r\n   */\r\n  abstract get worldPos(): Vector;\r\n\r\n  /**\r\n   * The center point of the collision collider, for example if the collider is a circle it would be the center.\r\n   */\r\n  abstract get center(): Vector;\r\n\r\n  /**\r\n   * Return the axis-aligned bounding box of the collision collider in world coordinates\r\n   */\r\n  abstract get bounds(): BoundingBox;\r\n\r\n  /**\r\n   * Return the axis-aligned bounding box of the collision collider in local coordinates\r\n   */\r\n  abstract get localBounds(): BoundingBox;\r\n\r\n  /**\r\n   * Return the axes of this particular collider\r\n   */\r\n  abstract get axes(): Vector[];\r\n  /**\r\n   * Find the furthest point on the convex hull of this particular collider in a certain direction.\r\n   */\r\n  abstract getFurthestPoint(direction: Vector): Vector;\r\n\r\n  abstract getInertia(mass: number): number;\r\n\r\n  // All new CollisionShape need to do the following\r\n  // Create a new collision function in the CollisionJumpTable against all the primitives\r\n  // Currently there are 3 primitive collision collider 3! = 6 jump functions\r\n  abstract collide(collider: Collider): CollisionContact[];\r\n\r\n  /**\r\n   * Returns the closest line between the surfaces this collider and another\r\n   * @param collider\r\n   */\r\n  abstract getClosestLineBetween(collider: Collider): Line;\r\n\r\n  /**\r\n   * Return wether the collider contains a point inclusive to it's border\r\n   */\r\n  abstract contains(point: Vector): boolean;\r\n\r\n  /**\r\n   * Return the point on the border of the collision collider that intersects with a ray (if any).\r\n   */\r\n  abstract rayCast(ray: Ray, max?: number): Vector;\r\n\r\n  /**\r\n   * Create a projection of this collider along an axis. Think of this as casting a \"shadow\" along an axis\r\n   */\r\n  abstract project(axis: Vector): Projection;\r\n\r\n  /**\r\n   * Updates collider world space geometry\r\n   */\r\n  abstract update(transform: Transform): void;\r\n\r\n  /**\r\n   * Draw the collider\r\n   * @deprecated Will be removed in 0.26.0\r\n   * @param ctx\r\n   * @param color\r\n   */\r\n  abstract draw(ctx: CanvasRenderingContext2D, color?: Color, pos?: Vector): void;\r\n\r\n  abstract debug(ex: ExcaliburGraphicsContext, color: Color): void;\r\n  /**\r\n   * Draw any debug information\r\n   * @deprecated Will be removed in 0.26.0\r\n   */\r\n  abstract debugDraw(ctx: CanvasRenderingContext2D, color: Color): void;\r\n\r\n  abstract clone(): Collider;\r\n}\r\n","import { Util } from '../..';\r\nimport { Pair } from '../Detection/Pair';\r\nimport { Color } from '../../Color';\r\nimport { Transform } from '../../EntityComponentSystem';\r\nimport { ExcaliburGraphicsContext } from '../../Graphics/Context/ExcaliburGraphicsContext';\r\nimport { Line } from '../../Math/line';\r\nimport { Projection } from '../../Math/projection';\r\nimport { Ray } from '../../Math/ray';\r\nimport { Vector } from '../../Math/vector';\r\nimport { BoundingBox } from '../BoundingBox';\r\nimport { CollisionContact } from '../Detection/CollisionContact';\r\nimport { DynamicTree } from '../Detection/DynamicTree';\r\nimport { DynamicTreeCollisionProcessor } from '../Detection/DynamicTreeCollisionProcessor';\r\nimport { Collider } from './Collider';\r\n\r\nexport class CompositeCollider extends Collider {\r\n  private _transform: Transform;\r\n  private _collisionProcessor = new DynamicTreeCollisionProcessor();\r\n  private _dynamicAABBTree = new DynamicTree();\r\n  private _colliders: Collider[] = [];\r\n\r\n  constructor(colliders: Collider[]) {\r\n    super();\r\n    for (const c of colliders) {\r\n      this.addCollider(c);\r\n    }\r\n  }\r\n\r\n  clearColliders() {\r\n    this._colliders = [];\r\n  }\r\n\r\n  addCollider(collider: Collider) {\r\n    this.events.wire(collider.events);\r\n    this._colliders.push(collider);\r\n    this._collisionProcessor.track(collider);\r\n    this._dynamicAABBTree.trackCollider(collider);\r\n  }\r\n\r\n  removeCollider(collider: Collider) {\r\n    this.events.unwire(collider.events);\r\n    Util.removeItemFromArray(collider, this._colliders);\r\n    this._collisionProcessor.untrack(collider);\r\n    this._dynamicAABBTree.untrackCollider(collider);\r\n  }\r\n\r\n  getColliders(): Collider[] {\r\n    return this._colliders;\r\n  }\r\n\r\n  get worldPos(): Vector {\r\n    // TODO transform component world pos\r\n    return this._transform?.pos ?? Vector.Zero;\r\n  }\r\n\r\n  get center(): Vector {\r\n    return this._transform?.pos ?? Vector.Zero;\r\n  }\r\n\r\n  get bounds(): BoundingBox {\r\n    // TODO cache this\r\n    const colliders = this.getColliders();\r\n    const results = colliders.reduce(\r\n      (acc, collider) => acc.combine(collider.bounds),\r\n      colliders[0]?.bounds ?? new BoundingBox().translate(this.worldPos)\r\n    );\r\n\r\n    return results;\r\n  }\r\n\r\n  get localBounds(): BoundingBox {\r\n    // TODO cache this\r\n    const colliders = this.getColliders();\r\n    const results = colliders.reduce((acc, collider) => acc.combine(collider.localBounds), colliders[0]?.localBounds ?? new BoundingBox());\r\n\r\n    return results;\r\n  }\r\n\r\n  get axes(): Vector[] {\r\n    // TODO cache this\r\n    const colliders = this.getColliders();\r\n    let axes: Vector[] = [];\r\n    for (const collider of colliders) {\r\n      axes = axes.concat(collider.axes);\r\n    }\r\n    return axes;\r\n  }\r\n\r\n  getFurthestPoint(direction: Vector): Vector {\r\n    const colliders = this.getColliders();\r\n    const furthestPoints: Vector[] = [];\r\n    for (const collider of colliders) {\r\n      furthestPoints.push(collider.getFurthestPoint(direction));\r\n    }\r\n    // Pick best point from all colliders\r\n    let bestPoint = furthestPoints[0];\r\n    let maxDistance = -Number.MAX_VALUE;\r\n    for (const point of furthestPoints) {\r\n      const distance = point.dot(direction);\r\n      if (distance > maxDistance) {\r\n        bestPoint = point;\r\n        maxDistance = distance;\r\n      }\r\n    }\r\n    return bestPoint;\r\n  }\r\n\r\n  getInertia(mass: number): number {\r\n    const colliders = this.getColliders();\r\n    let totalInertia = 0;\r\n    for (const collider of colliders) {\r\n      totalInertia += collider.getInertia(mass);\r\n    }\r\n    return totalInertia;\r\n  }\r\n\r\n  collide(other: Collider): CollisionContact[] {\r\n    let otherColliders = [other];\r\n    if (other instanceof CompositeCollider) {\r\n      otherColliders = other.getColliders();\r\n    }\r\n\r\n    const pairs: Pair[] = [];\r\n    for (const c of otherColliders) {\r\n      this._dynamicAABBTree.query(c, (potentialCollider: Collider) => {\r\n        pairs.push(new Pair(c, potentialCollider));\r\n        return false;\r\n      });\r\n    }\r\n\r\n    let contacts: CollisionContact[] = [];\r\n    for (const p of pairs) {\r\n      contacts = contacts.concat(p.collide());\r\n    }\r\n    return contacts;\r\n  }\r\n\r\n  getClosestLineBetween(other: Collider): Line {\r\n    const colliders = this.getColliders();\r\n    const lines: Line[] = [];\r\n    if (other instanceof CompositeCollider) {\r\n      const otherColliders = other.getColliders();\r\n      for (const colliderA of colliders) {\r\n        for (const colliderB of otherColliders) {\r\n          const maybeLine = colliderA.getClosestLineBetween(colliderB);\r\n          if (maybeLine) {\r\n            lines.push(maybeLine);\r\n          }\r\n        }\r\n      }\r\n    } else {\r\n      for (const collider of colliders) {\r\n        const maybeLine = other.getClosestLineBetween(collider);\r\n        if (maybeLine) {\r\n          lines.push(maybeLine);\r\n        }\r\n      }\r\n    }\r\n\r\n    if (lines.length) {\r\n      let minLength = lines[0].getLength();\r\n      let minLine = lines[0];\r\n      for (const line of lines) {\r\n        const length = line.getLength();\r\n        if (length < minLength) {\r\n          minLength = length;\r\n          minLine = line;\r\n        }\r\n      }\r\n      return minLine;\r\n    }\r\n    return null;\r\n  }\r\n  contains(point: Vector): boolean {\r\n    const colliders = this.getColliders();\r\n    for (const collider of colliders) {\r\n      if (collider.contains(point)) {\r\n        return true;\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n  rayCast(ray: Ray, max?: number): Vector {\r\n    const colliders = this.getColliders();\r\n    const points: Vector[] = [];\r\n    for (const collider of colliders) {\r\n      const vec = collider.rayCast(ray, max);\r\n      if (vec) {\r\n        points.push(vec);\r\n      }\r\n    }\r\n    if (points.length) {\r\n      let minPoint = points[0];\r\n      let minDistance = minPoint.dot(ray.dir);\r\n      for (const point of points) {\r\n        const distance = ray.dir.dot(point);\r\n        if (distance < minDistance) {\r\n          minPoint = point;\r\n          minDistance = distance;\r\n        }\r\n      }\r\n      return minPoint;\r\n    }\r\n    return null;\r\n  }\r\n  project(axis: Vector): Projection {\r\n    const colliders = this.getColliders();\r\n    const projs: Projection[] = [];\r\n    for (const collider of colliders) {\r\n      const proj = collider.project(axis);\r\n      if (proj) {\r\n        projs.push(proj);\r\n      }\r\n    }\r\n    // Merge all proj's on the same axis\r\n    if (projs.length) {\r\n      const newProjection = new Projection(projs[0].min, projs[0].max);\r\n      for (const proj of projs) {\r\n        newProjection.min = Math.min(proj.min, newProjection.min);\r\n        newProjection.max = Math.max(proj.max, newProjection.max);\r\n      }\r\n      return newProjection;\r\n    }\r\n    return null;\r\n  }\r\n\r\n  update(transform: Transform): void {\r\n    if (transform) {\r\n      const colliders = this.getColliders();\r\n      for (const collider of colliders) {\r\n        collider.owner = this.owner;\r\n        collider.update(transform);\r\n      }\r\n    }\r\n  }\r\n\r\n  draw(ctx: CanvasRenderingContext2D, color?: Color, pos?: Vector): void {\r\n    const colliders = this.getColliders();\r\n    for (const collider of colliders) {\r\n      collider.draw(ctx, color, pos);\r\n    }\r\n  }\r\n\r\n  public debug(ex: ExcaliburGraphicsContext, color: Color) {\r\n    const colliders = this.getColliders();\r\n    for (const collider of colliders) {\r\n      collider.debug(ex, color);\r\n    }\r\n  }\r\n\r\n  debugDraw(ctx: CanvasRenderingContext2D, color: Color): void {\r\n    const colliders = this.getColliders();\r\n    for (const collider of colliders) {\r\n      collider.draw(ctx, color);\r\n    }\r\n  }\r\n  clone(): Collider {\r\n    return new CompositeCollider(this._colliders.map((c) => c.clone()));\r\n  }\r\n}\r\n","import { Vector } from './vector';\n\n/**\n * A 2D line segment\n */\n\nexport class Line {\n  /**\n   * @param begin  The starting point of the line segment\n   * @param end  The ending point of the line segment\n   */\n  constructor(public begin: Vector, public end: Vector) {}\n\n  /**\n   * Gets the raw slope (m) of the line. Will return (+/-)Infinity for vertical lines.\n   */\n  public get slope() {\n    return (this.end.y - this.begin.y) / (this.end.x - this.begin.x);\n  }\n\n  /**\n   * Gets the Y-intercept (b) of the line. Will return (+/-)Infinity if there is no intercept.\n   */\n  public get intercept() {\n    return this.begin.y - this.slope * this.begin.x;\n  }\n\n  /**\n   * Gets the normal of the line\n   */\n  public normal(): Vector {\n    return this.end.sub(this.begin).normal();\n  }\n\n  public dir(): Vector {\n    return this.end.sub(this.begin);\n  }\n\n  public getPoints(): Vector[] {\n    return [this.begin, this.end];\n  }\n\n  /**\n   * Returns the slope of the line in the form of a vector of length 1\n   */\n  public getSlope(): Vector {\n    const begin = this.begin;\n    const end = this.end;\n    const distance = begin.distance(end);\n    return end.sub(begin).scale(1 / distance);\n  }\n\n  /**\n   * Returns the edge of the line as vector, the length of the vector is the length of the edge\n   */\n  public getEdge(): Vector {\n    const begin = this.begin;\n    const end = this.end;\n    return end.sub(begin);\n  }\n\n  /**\n   * Returns the length of the line segment in pixels\n   */\n  public getLength(): number {\n    const begin = this.begin;\n    const end = this.end;\n    const distance = begin.distance(end);\n    return distance;\n  }\n\n  /**\n   * Returns the midpoint of the edge\n   */\n  public get midpoint(): Vector {\n    return this.begin.add(this.end).scale(0.5);\n  }\n\n  /**\n   * Flips the direction of the line segment\n   */\n  public flip(): Line {\n    return new Line(this.end, this.begin);\n  }\n\n  /**\n   * Tests if a given point is below the line, points in the normal direction above the line are considered above.\n   * @param point\n   */\n  public below(point: Vector): boolean {\n    const above2 = (this.end.x - this.begin.x) * (point.y - this.begin.y) - (this.end.y - this.begin.y) * (point.x - this.begin.x);\n    return above2 >= 0;\n  }\n\n  /**\n   * Returns the clip point\n   * @param sideVector Vector that traces the line\n   * @param length Length to clip along side\n   */\n  public clip(sideVector: Vector, length: number): Line {\n    let dir = sideVector;\n    dir = dir.normalize();\n\n    const near = dir.dot(this.begin) - length;\n    const far = dir.dot(this.end) - length;\n\n    const results = [];\n    if (near <= 0) {\n      results.push(this.begin);\n    }\n    if (far <= 0) {\n      results.push(this.end);\n    }\n\n    if (near * far < 0) {\n      const clipTime = near / (near - far);\n      results.push(this.begin.add(this.end.sub(this.begin).scale(clipTime)));\n    }\n    if (results.length !== 2) {\n      return null;\n    }\n\n    return new Line(results[0], results[1]);\n  }\n\n  /**\n   * Find the perpendicular distance from the line to a point\n   * https://en.wikipedia.org/wiki/Distance_from_a_point_to_a_line\n   * @param point\n   */\n  public distanceToPoint(point: Vector, signed: boolean = false) {\n    const x0 = point.x;\n    const y0 = point.y;\n\n    const l = this.getLength();\n\n    const dy = this.end.y - this.begin.y;\n    const dx = this.end.x - this.begin.x;\n    const distance = (dy * x0 - dx * y0 + this.end.x * this.begin.y - this.end.y * this.begin.x) / l;\n    return signed ? distance : Math.abs(distance);\n  }\n\n  /**\n   * Find the perpendicular line from the line to a point\n   * https://en.wikipedia.org/wiki/Distance_from_a_point_to_a_line\n   * (a - p) - ((a - p) * n)n\n   * a is a point on the line\n   * p is the arbitrary point above the line\n   * n is a unit vector in direction of the line\n   * @param point\n   */\n  public findVectorToPoint(point: Vector): Vector {\n    const aMinusP = this.begin.sub(point);\n    const n = this.getSlope();\n\n    return aMinusP.sub(n.scale(aMinusP.dot(n)));\n  }\n\n  /**\n   * Finds a point on the line given only an X or a Y value. Given an X value, the function returns\n   * a new point with the calculated Y value and vice-versa.\n   *\n   * @param x The known X value of the target point\n   * @param y The known Y value of the target point\n   * @returns A new point with the other calculated axis value\n   */\n  public findPoint(x: number = null, y: number = null): Vector {\n    const m = this.slope;\n    const b = this.intercept;\n\n    if (x !== null) {\n      return new Vector(x, m * x + b);\n    } else if (y !== null) {\n      return new Vector((y - b) / m, y);\n    } else {\n      throw new Error('You must provide an X or a Y value');\n    }\n  }\n\n  /**\n   * Whether or not the given point lies on this line. This method is precise by default\n   * meaning the point must lie exactly on the line. Adjust threshold to\n   * loosen the strictness of the check for floating-point calculations.\n   */\n  public hasPoint(x: number, y: number, threshold?: number): boolean;\n\n  /**\n   * Whether or not the given point lies on this line. This method is precise by default\n   * meaning the point must lie exactly on the line. Adjust threshold to\n   * loosen the strictness of the check for floating-point calculations.\n   */\n  public hasPoint(v: Vector, threshold?: number): boolean;\n\n  /**\n   * @see http://stackoverflow.com/a/11908158/109458\n   */\n  public hasPoint(): boolean {\n    let currPoint: Vector;\n    let threshold = 0;\n\n    if (typeof arguments[0] === 'number' && typeof arguments[1] === 'number') {\n      currPoint = new Vector(arguments[0], arguments[1]);\n      threshold = arguments[2] || 0;\n    } else if (arguments[0] instanceof Vector) {\n      currPoint = arguments[0];\n      threshold = arguments[1] || 0;\n    } else {\n      throw 'Could not determine the arguments for Vector.hasPoint';\n    }\n\n    const dxc = currPoint.x - this.begin.x;\n    const dyc = currPoint.y - this.begin.y;\n\n    const dx1 = this.end.x - this.begin.x;\n    const dy1 = this.end.y - this.begin.y;\n\n    const cross = dxc * dy1 - dyc * dx1;\n\n    // check whether point lines on the line\n    if (Math.abs(cross) > threshold) {\n      return false;\n    }\n\n    // check whether point lies in-between start and end\n    if (Math.abs(dx1) >= Math.abs(dy1)) {\n      return dx1 > 0 ? this.begin.x <= currPoint.x && currPoint.x <= this.end.x : this.end.x <= currPoint.x && currPoint.x <= this.begin.x;\n    } else {\n      return dy1 > 0 ? this.begin.y <= currPoint.y && currPoint.y <= this.end.y : this.end.y <= currPoint.y && currPoint.y <= this.begin.y;\n    }\n  }\n}\n","import { Line } from '../../Math/line';\nimport { Vector } from '../../Math/vector';\nimport { Ray } from '../../Math/ray';\nimport { PolygonCollider } from './PolygonCollider';\nimport { EdgeCollider } from './EdgeCollider';\nimport { CircleCollider } from './CircleCollider';\n\n/**\n * Finds the closes line between 2 line segments, were the magnitude of u, v are the lengths of each segment\n * L1 = P(s) = p0 + s * u, where s is time and p0 is the start of the line\n * L2 = Q(t) = q0 + t * v, where t is time and q0 is the start of the line\n * @param p0 Point where L1 begins\n * @param u Direction and length of L1\n * @param q0 Point were L2 begins\n * @param v Direction and length of L2\n */\nexport function ClosestLine(p0: Vector, u: Vector, q0: Vector, v: Vector) {\n  // Distance between 2 lines http://geomalgorithms.com/a07-_distance.html\n\n  // w(s, t) = P(s) - Q(t)\n  // The w(s, t) that has the minimum distance we will say is w(sClosest, tClosest) = wClosest\n  //\n  // wClosest is the vector that is uniquely perpendicular to the 2 line directions u & v.\n  // wClosest = w0 + sClosest * u - tClosest * v, where w0 is p0 - q0\n  //\n  // The closest point between 2 lines then satisfies this pair of equations\n  // 1: u * wClosest = 0\n  // 2: v * wClosest = 0\n  //\n  // Substituting wClosest into the equations we get\n  //\n  // 1: (u * u) * sClosest - (u * v) tClosest = -u * w0\n  // 2: (v * u) * sClosest - (v * v) tClosest = -v * w0\n\n  // simplify w0\n  const w0 = p0.sub(q0);\n\n  // simplify (u * u);\n  const a = u.dot(u);\n  // simplify (u * v);\n  const b = u.dot(v);\n  // simplify (v * v)\n  const c = v.dot(v);\n  // simplify (u * w0)\n  const d = u.dot(w0);\n  // simplify (v * w0)\n  const e = v.dot(w0);\n\n  // denominator ac - b^2\n  const denom = a * c - b * b;\n  let sDenom = denom;\n  let tDenom = denom;\n  // if denom is 0 they are parallel, use any point from either as the start in this case p0\n  if (denom === 0 || denom <= 0.01) {\n    const tClosestParallel = d / b;\n    return new Line(p0, q0.add(v.scale(tClosestParallel)));\n  }\n\n  // Solve for sClosest for infinite line\n  let sClosest = b * e - c * d; // / denom;\n\n  // Solve for tClosest for infinite line\n  let tClosest = a * e - b * d; // / denom;\n\n  // Solve for segments candidate edges, if sClosest and tClosest are outside their segments\n  if (sClosest < 0) {\n    sClosest = 0;\n    tClosest = e;\n    tDenom = c;\n  } else if (sClosest > sDenom) {\n    sClosest = sDenom;\n    tClosest = e + b;\n    tDenom = c;\n  }\n\n  if (tClosest < 0) {\n    tClosest = 0;\n    if (-d < 0) {\n      sClosest = 0;\n    } else if (-d > a) {\n      sClosest = sDenom;\n    } else {\n      sClosest = -d;\n      sDenom = a;\n    }\n  } else if (tClosest > tDenom) {\n    tClosest = tDenom;\n    if (-d + b < 0) {\n      sClosest = 0;\n    } else if (-d + b > a) {\n      sClosest = sDenom;\n    } else {\n      sClosest = -d + b;\n      sDenom = a;\n    }\n  }\n  sClosest = Math.abs(sClosest) < 0.001 ? 0 : sClosest / sDenom;\n  tClosest = Math.abs(tClosest) < 0.001 ? 0 : tClosest / tDenom;\n\n  return new Line(p0.add(u.scale(sClosest)), q0.add(v.scale(tClosest)));\n}\n\nexport const ClosestLineJumpTable = {\n  PolygonPolygonClosestLine(polygonA: PolygonCollider, polygonB: PolygonCollider) {\n    // Find the 2 closest faces on each polygon\n    const otherWorldPos = polygonB.worldPos;\n    const otherDirection = otherWorldPos.sub(polygonA.worldPos);\n    const thisDirection = otherDirection.negate();\n\n    const rayTowardsOther = new Ray(polygonA.worldPos, otherDirection);\n    const rayTowardsThis = new Ray(otherWorldPos, thisDirection);\n\n    const thisPoint = polygonA.rayCast(rayTowardsOther).add(rayTowardsOther.dir.scale(0.1));\n    const otherPoint = polygonB.rayCast(rayTowardsThis).add(rayTowardsThis.dir.scale(0.1));\n\n    const thisFace = polygonA.getClosestFace(thisPoint);\n    const otherFace = polygonB.getClosestFace(otherPoint);\n\n    // L1 = P(s) = p0 + s * u, where s is time and p0 is the start of the line\n    const p0 = thisFace.face.begin;\n    const u = thisFace.face.getEdge();\n\n    // L2 = Q(t) = q0 + t * v, where t is time and q0 is the start of the line\n    const q0 = otherFace.face.begin;\n    const v = otherFace.face.getEdge();\n\n    return ClosestLine(p0, u, q0, v);\n  },\n\n  PolygonEdgeClosestLine(polygon: PolygonCollider, edge: EdgeCollider) {\n    // Find the 2 closest faces on each polygon\n    const otherWorldPos = edge.worldPos;\n    const otherDirection = otherWorldPos.sub(polygon.worldPos);\n\n    const rayTowardsOther = new Ray(polygon.worldPos, otherDirection);\n\n    const thisPoint = polygon.rayCast(rayTowardsOther).add(rayTowardsOther.dir.scale(0.1));\n\n    const thisFace = polygon.getClosestFace(thisPoint);\n\n    // L1 = P(s) = p0 + s * u, where s is time and p0 is the start of the line\n    const p0 = thisFace.face.begin;\n    const u = thisFace.face.getEdge();\n\n    // L2 = Q(t) = q0 + t * v, where t is time and q0 is the start of the line\n    const edgeLine = edge.asLine();\n    const edgeStart = edgeLine.begin;\n    const edgeVector = edgeLine.getEdge();\n    const q0 = edgeStart;\n    const v = edgeVector;\n\n    return ClosestLine(p0, u, q0, v);\n  },\n\n  PolygonCircleClosestLine(polygon: PolygonCollider, circle: CircleCollider) {\n    // https://math.stackexchange.com/questions/1919177/how-to-find-point-on-line-closest-to-sphere\n    // Find the 2 closest faces on each polygon\n    const otherWorldPos = circle.worldPos;\n    const otherDirection = otherWorldPos.sub(polygon.worldPos);\n\n    const rayTowardsOther = new Ray(polygon.worldPos, otherDirection.normalize());\n\n    const thisPoint = polygon.rayCast(rayTowardsOther).add(rayTowardsOther.dir.scale(0.1));\n\n    const thisFace = polygon.getClosestFace(thisPoint);\n\n    // L1 = P(s) = p0 + s * u, where s is time and p0 is the start of the line\n    const p0 = thisFace.face.begin;\n    const u = thisFace.face.getEdge();\n\n    // Time of minimum distance\n    let t = (u.x * (otherWorldPos.x - p0.x) + u.y * (otherWorldPos.y - p0.y)) / (u.x * u.x + u.y * u.y);\n\n    // If time of minimum is past the edge clamp\n    if (t > 1) {\n      t = 1;\n    } else if (t < 0) {\n      t = 0;\n    }\n\n    // Minimum distance\n    const d = Math.sqrt(Math.pow(p0.x + u.x * t - otherWorldPos.x, 2) + Math.pow(p0.y + u.y * t - otherWorldPos.y, 2)) - circle.radius;\n\n    const circlex = ((p0.x + u.x * t - otherWorldPos.x) * circle.radius) / (circle.radius + d);\n    const circley = ((p0.y + u.y * t - otherWorldPos.y) * circle.radius) / (circle.radius + d);\n    return new Line(u.scale(t).add(p0), new Vector(otherWorldPos.x + circlex, otherWorldPos.y + circley));\n  },\n\n  CircleCircleClosestLine(circleA: CircleCollider, circleB: CircleCollider) {\n    // Find the 2 closest faces on each polygon\n    const otherWorldPos = circleB.worldPos;\n    const otherDirection = otherWorldPos.sub(circleA.worldPos);\n\n    const thisWorldPos = circleA.worldPos;\n    const thisDirection = thisWorldPos.sub(circleB.worldPos);\n\n    const rayTowardsOther = new Ray(circleA.worldPos, otherDirection);\n    const rayTowardsThis = new Ray(circleB.worldPos, thisDirection);\n\n    const thisPoint = circleA.rayCast(rayTowardsOther);\n    const otherPoint = circleB.rayCast(rayTowardsThis);\n\n    return new Line(thisPoint, otherPoint);\n  },\n\n  CircleEdgeClosestLine(circle: CircleCollider, edge: EdgeCollider) {\n    // https://math.stackexchange.com/questions/1919177/how-to-find-point-on-line-closest-to-sphere\n    const circleWorlPos = circle.worldPos;\n\n    // L1 = P(s) = p0 + s * u, where s is time and p0 is the start of the line\n    const edgeLine = edge.asLine();\n    const edgeStart = edgeLine.begin;\n    const edgeVector = edgeLine.getEdge();\n    const p0 = edgeStart;\n    const u = edgeVector;\n\n    // Time of minimum distance\n    let t = (u.x * (circleWorlPos.x - p0.x) + u.y * (circleWorlPos.y - p0.y)) / (u.x * u.x + u.y * u.y);\n\n    // If time of minimum is past the edge clamp to edge\n    if (t > 1) {\n      t = 1;\n    } else if (t < 0) {\n      t = 0;\n    }\n\n    // Minimum distance\n    const d = Math.sqrt(Math.pow(p0.x + u.x * t - circleWorlPos.x, 2) + Math.pow(p0.y + u.y * t - circleWorlPos.y, 2)) - circle.radius;\n\n    const circlex = ((p0.x + u.x * t - circleWorlPos.x) * circle.radius) / (circle.radius + d);\n    const circley = ((p0.y + u.y * t - circleWorlPos.y) * circle.radius) / (circle.radius + d);\n    return new Line(u.scale(t).add(p0), new Vector(circleWorlPos.x + circlex, circleWorlPos.y + circley));\n  },\n\n  EdgeEdgeClosestLine(edgeA: EdgeCollider, edgeB: EdgeCollider) {\n    // L1 = P(s) = p0 + s * u, where s is time and p0 is the start of the line\n    const edgeLineA = edgeA.asLine();\n    const edgeStartA = edgeLineA.begin;\n    const edgeVectorA = edgeLineA.getEdge();\n    const p0 = edgeStartA;\n    const u = edgeVectorA;\n\n    // L2 = Q(t) = q0 + t * v, where t is time and q0 is the start of the line\n    const edgeLineB = edgeB.asLine();\n    const edgeStartB = edgeLineB.begin;\n    const edgeVectorB = edgeLineB.getEdge();\n    const q0 = edgeStartB;\n    const v = edgeVectorB;\n\n    return ClosestLine(p0, u, q0, v);\n  }\n};\n","import { BoundingBox } from '../BoundingBox';\r\nimport { CollisionJumpTable } from './CollisionJumpTable';\r\nimport { CollisionContact } from '../Detection/CollisionContact';\r\nimport { PolygonCollider } from './PolygonCollider';\r\nimport { EdgeCollider } from './EdgeCollider';\r\n\r\nimport { Projection } from '../../Math/projection';\r\nimport { Line } from '../../Math/line';\r\nimport { Vector } from '../../Math/vector';\r\nimport { Ray } from '../../Math/ray';\r\nimport { Color } from '../../Color';\r\nimport { Collider } from './Collider';\r\n\r\nimport { ClosestLineJumpTable } from './ClosestLineJumpTable';\r\nimport { Transform, TransformComponent } from '../../EntityComponentSystem';\r\nimport { ExcaliburGraphicsContext } from '../../Graphics/Context/ExcaliburGraphicsContext';\r\n\r\nexport interface CircleColliderOptions {\r\n  /**\r\n   * Optional pixel offset to shift the circle relative to the collider, by default (0, 0).\r\n   */\r\n  offset?: Vector;\r\n  /**\r\n   * Required radius of the circle\r\n   */\r\n  radius: number;\r\n}\r\n\r\n/**\r\n * This is a circle collider for the excalibur rigid body physics simulation\r\n */\r\nexport class CircleCollider extends Collider {\r\n  /**\r\n   * Position of the circle relative to the collider, by default (0, 0).\r\n   */\r\n  public offset: Vector = Vector.Zero;\r\n\r\n  public get worldPos(): Vector {\r\n    return this.offset.add(this._transform?.pos ?? Vector.Zero);\r\n  }\r\n\r\n  /**\r\n   * This is the radius of the circle\r\n   */\r\n  public radius: number;\r\n\r\n  private _transform: Transform;\r\n\r\n  constructor(options: CircleColliderOptions) {\r\n    super();\r\n    this.offset = options.offset || Vector.Zero;\r\n    this.radius = options.radius || 0;\r\n  }\r\n\r\n  /**\r\n   * Returns a clone of this shape, not associated with any collider\r\n   */\r\n  public clone(): CircleCollider {\r\n    return new CircleCollider({\r\n      offset: this.offset.clone(),\r\n      radius: this.radius\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Get the center of the collider in world coordinates\r\n   */\r\n  public get center(): Vector {\r\n    return this.offset.add(this._transform?.pos ?? Vector.Zero);\r\n  }\r\n\r\n  /**\r\n   * Tests if a point is contained in this collider\r\n   */\r\n  public contains(point: Vector): boolean {\r\n    const pos = this._transform?.pos ?? this.offset;\r\n    const distance = pos.distance(point);\r\n    if (distance <= this.radius) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * Casts a ray at the Circle collider and returns the nearest point of collision\r\n   * @param ray\r\n   */\r\n  public rayCast(ray: Ray, max: number = Infinity): Vector {\r\n    //https://en.wikipedia.org/wiki/Line%E2%80%93sphere_intersection\r\n    const c = this.center;\r\n    const dir = ray.dir;\r\n    const orig = ray.pos;\r\n\r\n    const discriminant = Math.sqrt(Math.pow(dir.dot(orig.sub(c)), 2) - Math.pow(orig.sub(c).distance(), 2) + Math.pow(this.radius, 2));\r\n\r\n    if (discriminant < 0) {\r\n      // no intersection\r\n      return null;\r\n    } else {\r\n      let toi = 0;\r\n      if (discriminant === 0) {\r\n        toi = -dir.dot(orig.sub(c));\r\n        if (toi > 0 && toi < max) {\r\n          return ray.getPoint(toi);\r\n        }\r\n        return null;\r\n      } else {\r\n        const toi1 = -dir.dot(orig.sub(c)) + discriminant;\r\n        const toi2 = -dir.dot(orig.sub(c)) - discriminant;\r\n\r\n        const positiveToi: number[] = [];\r\n        if (toi1 >= 0) {\r\n          positiveToi.push(toi1);\r\n        }\r\n\r\n        if (toi2 >= 0) {\r\n          positiveToi.push(toi2);\r\n        }\r\n\r\n        const mintoi = Math.min(...positiveToi);\r\n        if (mintoi <= max) {\r\n          return ray.getPoint(mintoi);\r\n        }\r\n        return null;\r\n      }\r\n    }\r\n  }\r\n\r\n  public getClosestLineBetween(shape: Collider): Line {\r\n    if (shape instanceof CircleCollider) {\r\n      return ClosestLineJumpTable.CircleCircleClosestLine(this, shape);\r\n    } else if (shape instanceof PolygonCollider) {\r\n      return ClosestLineJumpTable.PolygonCircleClosestLine(shape, this).flip();\r\n    } else if (shape instanceof EdgeCollider) {\r\n      return ClosestLineJumpTable.CircleEdgeClosestLine(this, shape).flip();\r\n    } else {\r\n      throw new Error(`Polygon could not collide with unknown CollisionShape ${typeof shape}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @inheritdoc\r\n   */\r\n  public collide(collider: Collider): CollisionContact[] {\r\n    if (collider instanceof CircleCollider) {\r\n      return CollisionJumpTable.CollideCircleCircle(this, collider);\r\n    } else if (collider instanceof PolygonCollider) {\r\n      return CollisionJumpTable.CollideCirclePolygon(this, collider);\r\n    } else if (collider instanceof EdgeCollider) {\r\n      return CollisionJumpTable.CollideCircleEdge(this, collider);\r\n    } else {\r\n      throw new Error(`Circle could not collide with unknown CollisionShape ${typeof collider}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Find the point on the collider furthest in the direction specified\r\n   */\r\n  public getFurthestPoint(direction: Vector): Vector {\r\n    return this.center.add(direction.normalize().scale(this.radius));\r\n  }\r\n\r\n  /**\r\n   * Find the local point on the shape in the direction specified\r\n   * @param direction\r\n   */\r\n  public getFurthestLocalPoint(direction: Vector): Vector {\r\n    const dir = direction.normalize();\r\n    return dir.scale(this.radius);\r\n  }\r\n\r\n  /**\r\n   * Get the axis aligned bounding box for the circle collider in world coordinates\r\n   */\r\n  public get bounds(): BoundingBox {\r\n    const tx = this._transform as TransformComponent;\r\n    const bodyPos = tx?.globalPos ?? Vector.Zero;\r\n    return new BoundingBox(\r\n      this.offset.x + bodyPos.x - this.radius,\r\n      this.offset.y + bodyPos.y - this.radius,\r\n      this.offset.x + bodyPos.x + this.radius,\r\n      this.offset.y + bodyPos.y + this.radius\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Get the axis aligned bounding box for the circle collider in local coordinates\r\n   */\r\n  public get localBounds(): BoundingBox {\r\n    return new BoundingBox(\r\n      this.offset.x - this.radius,\r\n      this.offset.y - this.radius,\r\n      this.offset.x + this.radius,\r\n      this.offset.y + this.radius\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Get axis not implemented on circles, since there are infinite axis in a circle\r\n   */\r\n  public get axes(): Vector[] {\r\n    return [];\r\n  }\r\n\r\n  /**\r\n   * Returns the moment of inertia of a circle given it's mass\r\n   * https://en.wikipedia.org/wiki/List_of_moments_of_inertia\r\n   */\r\n  public getInertia(mass: number): number {\r\n    return (mass * this.radius * this.radius) / 2;\r\n  }\r\n\r\n  /* istanbul ignore next */\r\n  public update(transform: Transform): void {\r\n    this._transform = transform;\r\n  }\r\n\r\n  /**\r\n   * Project the circle along a specified axis\r\n   */\r\n  public project(axis: Vector): Projection {\r\n    const scalars = [];\r\n    const point = this.center;\r\n    const dotProduct = point.dot(axis);\r\n    scalars.push(dotProduct);\r\n    scalars.push(dotProduct + this.radius);\r\n    scalars.push(dotProduct - this.radius);\r\n    return new Projection(Math.min.apply(Math, scalars), Math.max.apply(Math, scalars));\r\n  }\r\n\r\n  public draw(ctx: CanvasRenderingContext2D, color: Color = Color.Green, pos: Vector = Vector.Zero) {\r\n    const newPos = pos.add(this.offset);\r\n    ctx.beginPath();\r\n    ctx.fillStyle = color.toString();\r\n    ctx.arc(newPos.x, newPos.y, this.radius, 0, Math.PI * 2);\r\n    ctx.closePath();\r\n    ctx.fill();\r\n  }\r\n\r\n  public debug(ex: ExcaliburGraphicsContext, color: Color) {\r\n    const tx = this._transform as TransformComponent;\r\n    const pos = tx?.globalPos ? tx?.globalPos.add(this.offset) : this.offset;\r\n    ex.drawCircle(pos, this.radius, color);\r\n  }\r\n\r\n  /* istanbul ignore next */\r\n  public debugDraw(ctx: CanvasRenderingContext2D, color: Color = Color.Green) {\r\n    const transform = this._transform;\r\n    const pos = transform ? transform.pos.add(this.offset) : this.offset;\r\n    const rotation = transform ? transform.rotation : 0;\r\n\r\n    ctx.beginPath();\r\n    ctx.strokeStyle = color.toString();\r\n    ctx.arc(pos.x, pos.y, this.radius, 0, Math.PI * 2);\r\n    ctx.closePath();\r\n    ctx.stroke();\r\n    ctx.beginPath();\r\n    ctx.moveTo(pos.x, pos.y);\r\n    ctx.lineTo(Math.cos(rotation) * this.radius + pos.x, Math.sin(rotation) * this.radius + pos.y);\r\n    ctx.closePath();\r\n    ctx.stroke();\r\n  }\r\n}\r\n","import { Vector } from '../../Math/vector';\nimport { Physics } from '../Physics';\nimport { Collider } from '../Colliders/Collider';\nimport { CollisionType } from '../CollisionType';\nimport { Pair } from './Pair';\nimport { SeparationInfo } from '../Colliders/SeparatingAxis';\nimport { BodyComponent } from '../BodyComponent';\n\n/**\n * Collision contacts are used internally by Excalibur to resolve collision between colliders. This\n * Pair prevents collisions from being evaluated more than one time\n */\nexport class CollisionContact {\n  private _canceled = false;\n\n  /**\n   * Currently the ids between colliders\n   */\n  readonly id: string;\n\n  /**\n   * The first collider in the collision\n   */\n  colliderA: Collider;\n\n  /**\n   * The second collider in the collision\n   */\n  colliderB: Collider;\n\n  /**\n   * The minimum translation vector to resolve overlap, pointing away from colliderA\n   */\n  mtv: Vector;\n\n  /**\n   * World space contact points between colliderA and colliderB\n   */\n  points: Vector[];\n\n  /**\n   * Local space contact points between colliderA and colliderB\n   */\n  localPoints: Vector[];\n\n  /**\n   * The collision normal, pointing away from colliderA\n   */\n  normal: Vector;\n\n  /**\n   * The collision tangent\n   */\n  tangent: Vector;\n\n  /**\n   * Information about the specifics of the collision contact separation\n   */\n  info: SeparationInfo;\n\n  constructor(\n    colliderA: Collider,\n    colliderB: Collider,\n    mtv: Vector,\n    normal: Vector,\n    tangent: Vector,\n    points: Vector[],\n    localPoints: Vector[],\n    info: SeparationInfo\n  ) {\n    this.colliderA = colliderA;\n    this.colliderB = colliderB;\n    this.mtv = mtv;\n    this.normal = normal;\n    this.tangent = tangent;\n    this.points = points;\n    this.localPoints = localPoints;\n    this.info = info;\n    this.id = Pair.calculatePairHash(colliderA.id, colliderB.id);\n  }\n\n  /**\n   * Match contact awake state, except if body's are Fixed\n   */\n  public matchAwake(): void {\n    const bodyA = this.colliderA.owner.get(BodyComponent);\n    const bodyB = this.colliderB.owner.get(BodyComponent);\n    if (bodyA && bodyB) {\n      if (bodyA.sleeping !== bodyB.sleeping) {\n        if (bodyA.sleeping && bodyA.collisionType !== CollisionType.Fixed && bodyB.sleepMotion >= Physics.wakeThreshold) {\n          bodyA.setSleeping(false);\n        }\n        if (bodyB.sleeping && bodyB.collisionType !== CollisionType.Fixed && bodyA.sleepMotion >= Physics.wakeThreshold) {\n          bodyB.setSleeping(false);\n        }\n      }\n    }\n  }\n\n  public isCanceled() {\n    return this._canceled;\n  }\n\n  public cancel(): void {\n    this._canceled = true;\n  }\n}\n","import { Line } from '../../Math/line';\nimport { Vector } from '../../Math/vector';\nimport { Collider } from './Collider';\nimport { CircleCollider } from './CircleCollider';\nimport { PolygonCollider } from './PolygonCollider';\n\n/**\n * Specific information about a contact and it's separation\n */\nexport interface SeparationInfo {\n  /**\n   * Collider A\n   */\n  collider: Collider;\n\n  /**\n   * Signed value (negative means overlap, positive no overlap)\n   */\n  separation: number;\n\n  /**\n   * Axis of separation from the collider's perpective\n   */\n  axis: Vector;\n\n  /**\n   * Side of separation (reference) from the collider's perpsective\n   */\n\n  side?: Line;\n\n  /**\n   * Local side of separation (reference) from the collider's perspective\n   */\n  localSide?: Line;\n\n  /**\n   * Index of the separation side (reference) from the collider's perspective\n   */\n  sideId?: number;\n\n  /**\n   * Point on collider B (incident point)\n   */\n  point: Vector;\n\n  /**\n   * Local point on collider B (incident point)\n   */\n  localPoint?: Vector;\n}\n\nexport class SeparatingAxis {\n  static findPolygonPolygonSeparation(polyA: PolygonCollider, polyB: PolygonCollider): SeparationInfo {\n    let bestSeparation = -Number.MAX_VALUE;\n    let bestSide: Line | null = null;\n    let bestAxis: Vector | null = null;\n    let bestSideIndex: number = -1;\n    let bestOtherPoint: Vector | null = null;\n    const sides = polyA.getSides();\n    const localSides = polyA.getLocalSides();\n    for (let i = 0; i < sides.length; i++) {\n      const side = sides[i];\n      const axis = side.normal();\n      const vertB = polyB.getFurthestPoint(axis.negate());\n      // Separation on side i's axis\n      // We are looking for the largest separation between poly A's sides\n      const vertSeparation = side.distanceToPoint(vertB, true);\n      if (vertSeparation > bestSeparation) {\n        bestSeparation = vertSeparation;\n        bestSide = side;\n        bestAxis = axis;\n        bestSideIndex = i;\n        bestOtherPoint = vertB;\n      }\n    }\n\n    return {\n      collider: polyA,\n      separation: bestAxis ? bestSeparation : 99,\n      axis: bestAxis as Vector,\n      side: bestSide,\n      localSide: localSides[bestSideIndex],\n      sideId: bestSideIndex,\n      point: bestOtherPoint as Vector,\n      localPoint: bestAxis ? polyB.getFurthestLocalPoint(bestAxis!.negate()) : null\n    };\n  }\n\n  static findCirclePolygonSeparation(circle: CircleCollider, polygon: PolygonCollider): Vector | null {\n    const axes = polygon.axes;\n    const pc = polygon.center;\n    // Special SAT with circles\n    const polyDir = pc.sub(circle.worldPos);\n    const closestPointOnPoly = polygon.getFurthestPoint(polyDir.negate());\n    axes.push(closestPointOnPoly.sub(circle.worldPos).normalize());\n\n    let minOverlap = Number.MAX_VALUE;\n    let minAxis = null;\n    let minIndex = -1;\n    for (let i = 0; i < axes.length; i++) {\n      const proj1 = polygon.project(axes[i]);\n      const proj2 = circle.project(axes[i]);\n      const overlap = proj1.getOverlap(proj2);\n      if (overlap <= 0) {\n        return null;\n      } else {\n        if (overlap < minOverlap) {\n          minOverlap = overlap;\n          minAxis = axes[i];\n          minIndex = i;\n        }\n      }\n    }\n    if (minIndex < 0) {\n      return null;\n    }\n    return minAxis.normalize().scale(minOverlap);\n  }\n}\n","import { CircleCollider } from './CircleCollider';\r\nimport { CollisionContact } from '../Detection/CollisionContact';\r\nimport { PolygonCollider } from './PolygonCollider';\r\nimport { EdgeCollider } from './EdgeCollider';\r\nimport { SeparatingAxis, SeparationInfo } from './SeparatingAxis';\r\nimport { Line } from '../../Math/line';\r\nimport { Vector } from '../../Math/vector';\r\nimport { TransformComponent } from '../../EntityComponentSystem';\r\nimport { Pair } from '../Detection/Pair';\r\n\r\nexport const CollisionJumpTable = {\r\n  CollideCircleCircle(circleA: CircleCollider, circleB: CircleCollider): CollisionContact[] {\r\n    const circleAPos = circleA.worldPos;\r\n    const circleBPos = circleB.worldPos;\r\n    const combinedRadius = circleA.radius + circleB.radius;\r\n    const distance = circleAPos.distance(circleBPos);\r\n\r\n    if (distance > combinedRadius) {\r\n      return [];\r\n    }\r\n\r\n    // negative means overlap\r\n    const separation = combinedRadius - distance;\r\n\r\n    // Normal points from A -> B\r\n    const normal = circleBPos.sub(circleAPos).normalize();\r\n    const tangent = normal.perpendicular();\r\n    const mvt = normal.scale(separation);\r\n\r\n    const point = circleA.getFurthestPoint(normal);\r\n    const local = circleA.getFurthestLocalPoint(normal);\r\n\r\n    const info: SeparationInfo = {\r\n      collider: circleA,\r\n      separation,\r\n      axis: normal,\r\n      point: point\r\n    };\r\n\r\n    return [new CollisionContact(circleA, circleB, mvt, normal, tangent, [point], [local], info)];\r\n  },\r\n\r\n  CollideCirclePolygon(circle: CircleCollider, polygon: PolygonCollider): CollisionContact[] {\r\n    let minAxis = SeparatingAxis.findCirclePolygonSeparation(circle, polygon);\r\n    if (!minAxis) {\r\n      return [];\r\n    }\r\n\r\n    // make sure that the minAxis is pointing away from circle\r\n    const samedir = minAxis.dot(polygon.center.sub(circle.center));\r\n    minAxis = samedir < 0 ? minAxis.negate() : minAxis;\r\n\r\n    const point = circle.getFurthestPoint(minAxis);\r\n    const xf = circle.owner?.get(TransformComponent) ?? new TransformComponent();\r\n    const local = xf.applyInverse(point);\r\n    const normal = minAxis.normalize();\r\n\r\n    const info: SeparationInfo = {\r\n      collider: circle,\r\n      separation: -minAxis.size,\r\n      axis: normal,\r\n      point: point,\r\n      localPoint: local,\r\n      side: polygon.findSide(normal.negate()),\r\n      localSide: polygon.findLocalSide(normal.negate())\r\n    };\r\n\r\n    return [new CollisionContact(circle, polygon, minAxis, normal, normal.perpendicular(), [point], [local], info)];\r\n  },\r\n\r\n  CollideCircleEdge(circle: CircleCollider, edge: EdgeCollider): CollisionContact[] {\r\n    // TODO not sure this actually abides by local/world collisions\r\n    // Are edge.begin and edge.end local space or world space? I think they should be local\r\n\r\n    // center of the circle in world pos\r\n    const cc = circle.center;\r\n    // vector in the direction of the edge\r\n    const edgeWorld = edge.asLine();\r\n    const e = edgeWorld.end.sub(edgeWorld.begin);\r\n\r\n    // amount of overlap with the circle's center along the edge direction\r\n    const u = e.dot(edgeWorld.end.sub(cc));\r\n    const v = e.dot(cc.sub(edgeWorld.begin));\r\n    const side = edge.asLine();\r\n    const localSide = edge.asLocalLine();\r\n\r\n    // Potential region A collision (circle is on the left side of the edge, before the beginning)\r\n    if (v <= 0) {\r\n      const da = edgeWorld.begin.sub(cc);\r\n      const dda = da.dot(da); // quick and dirty way of calc'n distance in r^2 terms saves some sqrts\r\n      // save some sqrts\r\n      if (dda > circle.radius * circle.radius) {\r\n        return []; // no collision\r\n      }\r\n\r\n      const normal = da.normalize();\r\n      const separation = circle.radius - Math.sqrt(dda);\r\n\r\n      const info: SeparationInfo = {\r\n        collider: circle,\r\n        separation: separation,\r\n        axis: normal,\r\n        point: side.begin,\r\n        side: side,\r\n        localSide: localSide\r\n      };\r\n\r\n      return [\r\n        new CollisionContact(circle, edge, normal.scale(separation), normal, normal.perpendicular(), [side.begin], [localSide.begin], info)\r\n      ];\r\n    }\r\n\r\n    // Potential region B collision (circle is on the right side of the edge, after the end)\r\n    if (u <= 0) {\r\n      const db = edgeWorld.end.sub(cc);\r\n      const ddb = db.dot(db);\r\n      if (ddb > circle.radius * circle.radius) {\r\n        return [];\r\n      }\r\n\r\n      const normal = db.normalize();\r\n      const separation = circle.radius - Math.sqrt(ddb);\r\n\r\n      const info: SeparationInfo = {\r\n        collider: circle,\r\n        separation: separation,\r\n        axis: normal,\r\n        point: side.end,\r\n        side: side,\r\n        localSide: localSide\r\n      };\r\n\r\n      return [\r\n        new CollisionContact(circle, edge, normal.scale(separation), normal, normal.perpendicular(), [side.end], [localSide.end], info)\r\n      ];\r\n    }\r\n\r\n    // Otherwise potential region AB collision (circle is in the middle of the edge between the beginning and end)\r\n    const den = e.dot(e);\r\n    const pointOnEdge = edgeWorld.begin\r\n      .scale(u)\r\n      .add(edgeWorld.end.scale(v))\r\n      .scale(1 / den);\r\n    const d = cc.sub(pointOnEdge);\r\n\r\n    const dd = d.dot(d);\r\n    if (dd > circle.radius * circle.radius) {\r\n      return []; // no collision\r\n    }\r\n\r\n    let normal = e.perpendicular();\r\n    // flip correct direction\r\n    if (normal.dot(cc.sub(edgeWorld.begin)) < 0) {\r\n      normal.x = -normal.x;\r\n      normal.y = -normal.y;\r\n    }\r\n\r\n    normal = normal.normalize();\r\n    const separation = circle.radius - Math.sqrt(dd);\r\n\r\n    const mvt = normal.scale(separation);\r\n    const info: SeparationInfo = {\r\n      collider: circle,\r\n      separation: separation,\r\n      axis: normal,\r\n      point: pointOnEdge,\r\n      side: side,\r\n      localSide: localSide\r\n    };\r\n\r\n    return [\r\n      new CollisionContact(\r\n        circle,\r\n        edge,\r\n        mvt,\r\n        normal.negate(),\r\n        normal.negate().perpendicular(),\r\n        [pointOnEdge],\r\n        [pointOnEdge.sub(edge.worldPos)],\r\n        info\r\n      )\r\n    ];\r\n  },\r\n\r\n  CollideEdgeEdge(): CollisionContact[] {\r\n    // Edge-edge collision doesn't make sense\r\n    return [];\r\n  },\r\n\r\n  CollidePolygonEdge(polygon: PolygonCollider, edge: EdgeCollider): CollisionContact[] {\r\n    const pc = polygon.center;\r\n    const ec = edge.center;\r\n    const dir = ec.sub(pc).normalize();\r\n\r\n    // build a temporary polygon from the edge to use SAT\r\n    const linePoly = new PolygonCollider({\r\n      points: [edge.begin, edge.end, edge.end.add(dir.scale(100)), edge.begin.add(dir.scale(100))],\r\n      offset: edge.offset\r\n    });\r\n    linePoly.owner = edge.owner;\r\n    const tx = edge.owner?.get(TransformComponent);\r\n    if (tx) {\r\n      linePoly.update(edge.owner.get(TransformComponent));\r\n    }\r\n    // Gross hack but poly-poly works well\r\n    const contact = this.CollidePolygonPolygon(polygon, linePoly);\r\n    if (contact.length) {\r\n      // Fudge the contact back to edge\r\n      contact[0].colliderB = edge;\r\n      (contact[0].id as any) = Pair.calculatePairHash(polygon.id, edge.id);\r\n      // contact[0].info.collider\r\n    }\r\n    return contact;\r\n  },\r\n\r\n  CollidePolygonPolygon(polyA: PolygonCollider, polyB: PolygonCollider): CollisionContact[] {\r\n    // Multi contact from SAT\r\n    // https://gamedev.stackexchange.com/questions/111390/multiple-contacts-for-sat-collision-detection\r\n    // do a SAT test to find a min axis if it exists\r\n    const separationA = SeparatingAxis.findPolygonPolygonSeparation(polyA, polyB);\r\n    // If there is no overlap from boxA's perspective we can end early\r\n    if (separationA.separation > 0) {\r\n      return [];\r\n    }\r\n\r\n    const separationB = SeparatingAxis.findPolygonPolygonSeparation(polyB, polyA);\r\n    // If there is no overlap from boxB's perspective exit now\r\n    if (separationB.separation > 0) {\r\n      return [];\r\n    }\r\n\r\n    // Separations are both negative, we want to pick the least negative (minimal movement)\r\n    const separation = separationA.separation > separationB.separation ? separationA : separationB;\r\n\r\n    // The incident side is the most opposite from the axes of collision on the other collider\r\n    const other = separation.collider === polyA ? polyB : polyA;\r\n    const incident = other.findSide(separation.axis.negate()) as Line;\r\n\r\n    // Clip incident side by the perpendicular lines at each end of the reference side\r\n    // https://en.wikipedia.org/wiki/Sutherland%E2%80%93Hodgman_algorithm\r\n    const reference = separation.side;\r\n    const refDir = reference.dir().normalize();\r\n\r\n    // Find our contact points by clipping the incident by the collision side\r\n    const clipRight = incident.clip(refDir.negate(), -refDir.dot(reference.begin));\r\n    let clipLeft: Line | null = null;\r\n    if (clipRight) {\r\n      clipLeft = clipRight.clip(refDir, refDir.dot(reference.end));\r\n    }\r\n\r\n    // If there is no left there is no collision\r\n    if (clipLeft) {\r\n      // We only want clip points below the reference edge, discard the others\r\n      const points = clipLeft.getPoints().filter((p) => {\r\n        return reference.below(p);\r\n      });\r\n\r\n      let normal = separation.axis;\r\n      let tangent = normal.perpendicular();\r\n      // Point Contact A -> B\r\n      if (polyB.worldPos.sub(polyA.worldPos).dot(normal) < 0) {\r\n        normal = normal.negate();\r\n        tangent = normal.perpendicular();\r\n      }\r\n      // Points are clipped from incident which is the other collider\r\n      // Store those as locals\r\n      let localPoints: Vector[] = [];\r\n      if (separation.collider === polyA) {\r\n        const xf = polyB.owner?.get(TransformComponent) ?? new TransformComponent();\r\n        localPoints = points.map((p) => xf.applyInverse(p));\r\n      } else {\r\n        const xf = polyA.owner?.get(TransformComponent) ?? new TransformComponent();\r\n        localPoints = points.map((p) => xf.applyInverse(p));\r\n      }\r\n      return [new CollisionContact(polyA, polyB, normal.scale(-separation.separation), normal, tangent, points, localPoints, separation)];\r\n    }\r\n    return [];\r\n  },\r\n\r\n  FindContactSeparation(contact: CollisionContact, localPoint: Vector) {\r\n    const shapeA = contact.colliderA;\r\n    const txA = contact.colliderA.owner?.get(TransformComponent) ?? new TransformComponent();\r\n    const shapeB = contact.colliderB;\r\n    const txB = contact.colliderB.owner?.get(TransformComponent) ?? new TransformComponent();\r\n\r\n    // both are circles\r\n    if (shapeA instanceof CircleCollider && shapeB instanceof CircleCollider) {\r\n      const combinedRadius = shapeA.radius + shapeB.radius;\r\n      const distance = txA.pos.distance(txB.pos);\r\n      const separation = combinedRadius - distance;\r\n      return -separation;\r\n    }\r\n\r\n    // both are polygons\r\n    if (shapeA instanceof PolygonCollider && shapeB instanceof PolygonCollider) {\r\n      if (contact.info.localSide) {\r\n        let side: Line;\r\n        let worldPoint: Vector;\r\n        if (contact.info.collider === shapeA) {\r\n          side = new Line(txA.apply(contact.info.localSide.begin), txA.apply(contact.info.localSide.end));\r\n          worldPoint = txB.apply(localPoint);\r\n        } else {\r\n          side = new Line(txB.apply(contact.info.localSide.begin), txB.apply(contact.info.localSide.end));\r\n          worldPoint = txA.apply(localPoint);\r\n        }\r\n\r\n        return side.distanceToPoint(worldPoint, true);\r\n      }\r\n    }\r\n\r\n    // polygon v circle\r\n    if (\r\n      (shapeA instanceof PolygonCollider && shapeB instanceof CircleCollider) ||\r\n      (shapeB instanceof PolygonCollider && shapeA instanceof CircleCollider)\r\n    ) {\r\n      const worldPoint = txA.apply(localPoint);\r\n      if (contact.info.side) {\r\n        return contact.info.side.distanceToPoint(worldPoint, true);\r\n      }\r\n    }\r\n\r\n    // polygon v edge\r\n    if (\r\n      (shapeA instanceof EdgeCollider && shapeB instanceof PolygonCollider) ||\r\n      (shapeB instanceof EdgeCollider && shapeA instanceof PolygonCollider)\r\n    ) {\r\n      let worldPoint: Vector;\r\n      if (contact.info.collider === shapeA) {\r\n        worldPoint = txB.apply(localPoint);\r\n      } else {\r\n        worldPoint = txA.apply(localPoint);\r\n      }\r\n      if (contact.info.side) {\r\n        return contact.info.side.distanceToPoint(worldPoint, true);\r\n      }\r\n    }\r\n\r\n    // circle v edge\r\n    if (\r\n      (shapeA instanceof CircleCollider && shapeB instanceof EdgeCollider) ||\r\n      (shapeB instanceof CircleCollider && shapeA instanceof EdgeCollider)\r\n    ) {\r\n      // Local point is always on the edge which is always shapeB\r\n      const worldPoint = txB.apply(localPoint);\r\n\r\n      let circlePoint: Vector;\r\n      if (shapeA instanceof CircleCollider) {\r\n        circlePoint = shapeA.getFurthestPoint(contact.normal);\r\n      }\r\n\r\n      const dist = worldPoint.distance(circlePoint);\r\n\r\n      if (contact.info.side) {\r\n        return dist > 0 ? -dist : 0;\r\n      }\r\n    }\r\n\r\n    return 0;\r\n  }\r\n};\r\n","import { BoundingBox } from '../BoundingBox';\r\nimport { CollisionContact } from '../Detection/CollisionContact';\r\nimport { CollisionJumpTable } from './CollisionJumpTable';\r\nimport { CircleCollider } from './CircleCollider';\r\nimport { PolygonCollider } from './PolygonCollider';\r\n\r\nimport { Projection } from '../../Math/projection';\r\nimport { Line } from '../../Math/line';\r\nimport { Vector } from '../../Math/vector';\r\nimport { Ray } from '../../Math/ray';\r\nimport { Color } from '../../Color';\r\nimport { Collider } from './Collider';\r\nimport { ClosestLineJumpTable } from './ClosestLineJumpTable';\r\nimport { Transform, TransformComponent } from '../../EntityComponentSystem/Components/TransformComponent';\r\nimport { ExcaliburGraphicsContext } from '../../Graphics/Context/ExcaliburGraphicsContext';\r\n\r\nexport interface EdgeColliderOptions {\r\n  /**\r\n   * The beginning of the edge defined in local coordinates to the collider\r\n   */\r\n  begin: Vector;\r\n  /**\r\n   * The ending of the edge defined in local coordinates to the collider\r\n   */\r\n  end: Vector;\r\n  /**\r\n   * Optionall specify an offset\r\n   */\r\n  offset?: Vector;\r\n}\r\n\r\n/**\r\n * Edge is a single line collider to create collisions with a single line.\r\n */\r\nexport class EdgeCollider extends Collider {\r\n  offset: Vector;\r\n  begin: Vector;\r\n  end: Vector;\r\n\r\n  private _transform: Transform;\r\n\r\n  constructor(options: EdgeColliderOptions) {\r\n    super();\r\n    this.begin = options.begin || Vector.Zero;\r\n    this.end = options.end || Vector.Zero;\r\n    this.offset = options.offset ?? Vector.Zero;\r\n  }\r\n\r\n  /**\r\n   * Returns a clone of this Edge, not associated with any collider\r\n   */\r\n  public clone(): EdgeCollider {\r\n    return new EdgeCollider({\r\n      begin: this.begin.clone(),\r\n      end: this.end.clone()\r\n    });\r\n  }\r\n\r\n  public get worldPos(): Vector {\r\n    const tx = this._transform as TransformComponent;\r\n    return tx?.globalPos.add(this.offset) ?? this.offset;\r\n  }\r\n\r\n  /**\r\n   * Get the center of the collision area in world coordinates\r\n   */\r\n  public get center(): Vector {\r\n    const pos = this.begin.average(this.end).add(this._getBodyPos());\r\n    return pos;\r\n  }\r\n\r\n  private _getBodyPos(): Vector {\r\n    const tx = this._transform as TransformComponent;\r\n    const bodyPos = tx?.globalPos ?? Vector.Zero;\r\n    return bodyPos;\r\n  }\r\n\r\n  private _getTransformedBegin(): Vector {\r\n    const tx = this._transform as TransformComponent;\r\n    const angle = tx ? tx.globalRotation : 0;\r\n    return this.begin.rotate(angle).add(this._getBodyPos());\r\n  }\r\n\r\n  private _getTransformedEnd(): Vector {\r\n    const tx = this._transform as TransformComponent;\r\n    const angle = tx ? tx.globalRotation : 0;\r\n    return this.end.rotate(angle).add(this._getBodyPos());\r\n  }\r\n\r\n  /**\r\n   * Returns the slope of the line in the form of a vector\r\n   */\r\n  public getSlope(): Vector {\r\n    const begin = this._getTransformedBegin();\r\n    const end = this._getTransformedEnd();\r\n    const distance = begin.distance(end);\r\n    return end.sub(begin).scale(1 / distance);\r\n  }\r\n\r\n  /**\r\n   * Returns the length of the line segment in pixels\r\n   */\r\n  public getLength(): number {\r\n    const begin = this._getTransformedBegin();\r\n    const end = this._getTransformedEnd();\r\n    const distance = begin.distance(end);\r\n    return distance;\r\n  }\r\n\r\n  /**\r\n   * Tests if a point is contained in this collision area\r\n   */\r\n  public contains(): boolean {\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * @inheritdoc\r\n   */\r\n  public rayCast(ray: Ray, max: number = Infinity): Vector {\r\n    const numerator = this._getTransformedBegin().sub(ray.pos);\r\n\r\n    // Test is line and ray are parallel and non intersecting\r\n    if (ray.dir.cross(this.getSlope()) === 0 && numerator.cross(ray.dir) !== 0) {\r\n      return null;\r\n    }\r\n\r\n    // Lines are parallel\r\n    const divisor = ray.dir.cross(this.getSlope());\r\n    if (divisor === 0) {\r\n      return null;\r\n    }\r\n\r\n    const t = numerator.cross(this.getSlope()) / divisor;\r\n\r\n    if (t >= 0 && t <= max) {\r\n      const u = numerator.cross(ray.dir) / divisor / this.getLength();\r\n      if (u >= 0 && u <= 1) {\r\n        return ray.getPoint(t);\r\n      }\r\n    }\r\n\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Returns the closes line between this and another collider, from this -> collider\r\n   * @param shape\r\n   */\r\n  public getClosestLineBetween(shape: Collider): Line {\r\n    if (shape instanceof CircleCollider) {\r\n      return ClosestLineJumpTable.CircleEdgeClosestLine(shape, this);\r\n    } else if (shape instanceof PolygonCollider) {\r\n      return ClosestLineJumpTable.PolygonEdgeClosestLine(shape, this).flip();\r\n    } else if (shape instanceof EdgeCollider) {\r\n      return ClosestLineJumpTable.EdgeEdgeClosestLine(this, shape);\r\n    } else {\r\n      throw new Error(`Polygon could not collide with unknown CollisionShape ${typeof shape}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @inheritdoc\r\n   */\r\n  public collide(shape: Collider): CollisionContact[] {\r\n    if (shape instanceof CircleCollider) {\r\n      return CollisionJumpTable.CollideCircleEdge(shape, this);\r\n    } else if (shape instanceof PolygonCollider) {\r\n      return CollisionJumpTable.CollidePolygonEdge(shape, this);\r\n    } else if (shape instanceof EdgeCollider) {\r\n      return CollisionJumpTable.CollideEdgeEdge();\r\n    } else {\r\n      throw new Error(`Edge could not collide with unknown CollisionShape ${typeof shape}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Find the point on the collider furthest in the direction specified\r\n   */\r\n  public getFurthestPoint(direction: Vector): Vector {\r\n    const transformedBegin = this._getTransformedBegin();\r\n    const transformedEnd = this._getTransformedEnd();\r\n    if (direction.dot(transformedBegin) > 0) {\r\n      return transformedBegin;\r\n    } else {\r\n      return transformedEnd;\r\n    }\r\n  }\r\n\r\n  private _boundsFromBeginEnd(begin: Vector, end: Vector, padding = 10) {\r\n    // A perfectly vertical or horizontal edge would have a bounds 0 width or height\r\n    // this causes problems for the collision system so we give them some padding\r\n    return new BoundingBox(\r\n      Math.min(begin.x, end.x) - padding,\r\n      Math.min(begin.y, end.y) - padding,\r\n      Math.max(begin.x, end.x) + padding,\r\n      Math.max(begin.y, end.y) + padding\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Get the axis aligned bounding box for the edge collider in world space\r\n   */\r\n  public get bounds(): BoundingBox {\r\n    const transformedBegin = this._getTransformedBegin();\r\n    const transformedEnd = this._getTransformedEnd();\r\n    return this._boundsFromBeginEnd(transformedBegin, transformedEnd);\r\n  }\r\n\r\n  /**\r\n   * Get the axis aligned bounding box for the edge collider in local space\r\n   */\r\n  public get localBounds(): BoundingBox {\r\n    return this._boundsFromBeginEnd(this.begin, this.end);\r\n  }\r\n\r\n  /**\r\n   * Returns this edge represented as a line in world coordinates\r\n   */\r\n  public asLine(): Line {\r\n    return new Line(this._getTransformedBegin(), this._getTransformedEnd());\r\n  }\r\n\r\n  /**\r\n   * Return this edge as a line in local line coordinates (relative to the position)\r\n   */\r\n  public asLocalLine(): Line {\r\n    return new Line(this.begin, this.end);\r\n  }\r\n\r\n  /**\r\n   * Get the axis associated with the edge\r\n   */\r\n  public get axes(): Vector[] {\r\n    const e = this._getTransformedEnd().sub(this._getTransformedBegin());\r\n    const edgeNormal = e.normal();\r\n\r\n    const axes = [];\r\n    axes.push(edgeNormal);\r\n    axes.push(edgeNormal.negate());\r\n    axes.push(edgeNormal.normal());\r\n    axes.push(edgeNormal.normal().negate());\r\n    return axes;\r\n  }\r\n\r\n  /**\r\n   * Get the moment of inertia for an edge\r\n   * https://en.wikipedia.org/wiki/List_of_moments_of_inertia\r\n   */\r\n  public getInertia(mass: number): number {\r\n    const length = this.end.sub(this.begin).distance() / 2;\r\n    return mass * length * length;\r\n  }\r\n\r\n  /**\r\n   * @inheritdoc\r\n   */\r\n  public update(transform: Transform): void {\r\n    this._transform = transform;\r\n  }\r\n\r\n  /**\r\n   * Project the edge along a specified axis\r\n   */\r\n  public project(axis: Vector): Projection {\r\n    const scalars = [];\r\n\r\n    const points = [this._getTransformedBegin(), this._getTransformedEnd()];\r\n    const len = points.length;\r\n    for (let i = 0; i < len; i++) {\r\n      scalars.push(points[i].dot(axis));\r\n    }\r\n\r\n    return new Projection(Math.min.apply(Math, scalars), Math.max.apply(Math, scalars));\r\n  }\r\n\r\n  public draw(ctx: CanvasRenderingContext2D, color: Color = Color.Green, pos: Vector = Vector.Zero) {\r\n    const begin = this.begin.add(pos);\r\n    const end = this.end.add(pos);\r\n    ctx.strokeStyle = color.toString();\r\n    ctx.beginPath();\r\n    ctx.moveTo(begin.x, begin.y);\r\n    ctx.lineTo(end.x, end.y);\r\n    ctx.closePath();\r\n    ctx.stroke();\r\n  }\r\n\r\n  public debug(ex: ExcaliburGraphicsContext, color: Color) {\r\n    const begin = this._getTransformedBegin();\r\n    const end = this._getTransformedEnd();\r\n    ex.drawLine(begin, end, color, 2);\r\n    ex.drawCircle(begin, 2, color);\r\n    ex.drawCircle(end, 2, color);\r\n  }\r\n\r\n  /* istanbul ignore next */\r\n  public debugDraw(ctx: CanvasRenderingContext2D, color: Color = Color.Red) {\r\n    const begin = this._getTransformedBegin();\r\n    const end = this._getTransformedEnd();\r\n    ctx.strokeStyle = color.toString();\r\n    ctx.beginPath();\r\n    ctx.moveTo(begin.x, begin.y);\r\n    ctx.lineTo(end.x, end.y);\r\n    ctx.closePath();\r\n    ctx.stroke();\r\n  }\r\n}\r\n","import { Color } from '../../Color';\r\nimport { BoundingBox } from '../BoundingBox';\r\nimport { EdgeCollider } from './EdgeCollider';\r\nimport { CollisionJumpTable } from './CollisionJumpTable';\r\nimport { CircleCollider } from './CircleCollider';\r\nimport { CollisionContact } from '../Detection/CollisionContact';\r\nimport { Projection } from '../../Math/projection';\r\nimport { Line } from '../../Math/line';\r\nimport { Vector } from '../../Math/vector';\r\nimport { Ray } from '../../Math/ray';\r\nimport { ClosestLineJumpTable } from './ClosestLineJumpTable';\r\nimport { Transform, TransformComponent } from '../../EntityComponentSystem';\r\nimport { Collider } from './Collider';\r\nimport { ExcaliburGraphicsContext } from '../..';\r\n\r\nexport interface PolygonColliderOptions {\r\n  /**\r\n   * Pixel offset relative to a collider's body transform position.\r\n   */\r\n  offset?: Vector;\r\n  /**\r\n   * Points in the polygon in order around the perimeter in local coordinates. These are relative from the body transform position.\r\n   */\r\n  points: Vector[];\r\n  /**\r\n   * Whether points are specified in clockwise or counter clockwise order, default counter-clockwise\r\n   */\r\n  clockwiseWinding?: boolean;\r\n}\r\n\r\n/**\r\n * Polygon collider for detecting collisions\r\n */\r\nexport class PolygonCollider extends Collider {\r\n  /**\r\n   * Pixel offset relative to a collider's body transform position.\r\n   */\r\n  public offset: Vector;\r\n\r\n  /**\r\n   * Points in the polygon in order around the perimeter in local coordinates. These are relative from the body transform position.\r\n   */\r\n  public points: Vector[];\r\n\r\n  private _transform: Transform;\r\n\r\n  private _transformedPoints: Vector[] = [];\r\n  private _axes: Vector[] = [];\r\n  private _sides: Line[] = [];\r\n  private _localSides: Line[] = [];\r\n\r\n  constructor(options: PolygonColliderOptions) {\r\n    super();\r\n    this.offset = options.offset ?? Vector.Zero;\r\n    const winding = !!options.clockwiseWinding;\r\n    this.points = (winding ? options.points.reverse() : options.points) || [];\r\n\r\n    // calculate initial transformation\r\n    this._calculateTransformation();\r\n  }\r\n\r\n  /**\r\n   * Returns a clone of this ConvexPolygon, not associated with any collider\r\n   */\r\n  public clone(): PolygonCollider {\r\n    return new PolygonCollider({\r\n      offset: this.offset.clone(),\r\n      points: this.points.map((p) => p.clone())\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Returns the world position of the collider, which is the current body transform plus any defined offset\r\n   */\r\n  public get worldPos(): Vector {\r\n    if (this._transform) {\r\n      return this._transform.pos.add(this.offset);\r\n    }\r\n    return this.offset;\r\n  }\r\n\r\n  /**\r\n   * Get the center of the collider in world coordinates\r\n   */\r\n  public get center(): Vector {\r\n    return this.bounds.center;\r\n  }\r\n\r\n  /**\r\n   * Calculates the underlying transformation from the body relative space to world space\r\n   */\r\n  private _calculateTransformation() {\r\n    const transform = this._transform as TransformComponent;\r\n\r\n    const pos = transform ? transform.globalPos.add(this.offset) : this.offset;\r\n    const angle = transform ? transform.globalRotation : 0;\r\n    const scale = transform ? transform.globalScale : Vector.One;\r\n\r\n    const len = this.points.length;\r\n    this._transformedPoints.length = 0; // clear out old transform\r\n    for (let i = 0; i < len; i++) {\r\n      this._transformedPoints[i] = this.points[i].scale(scale).rotate(angle).add(pos);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Gets the points that make up the polygon in world space, from actor relative space (if specified)\r\n   */\r\n  public getTransformedPoints(): Vector[] {\r\n    this._calculateTransformation();\r\n    return this._transformedPoints;\r\n  }\r\n\r\n  /**\r\n   * Gets the sides of the polygon in world space\r\n   */\r\n  public getSides(): Line[] {\r\n    if (this._sides.length) {\r\n      return this._sides;\r\n    }\r\n    const lines = [];\r\n    const points = this.getTransformedPoints();\r\n    const len = points.length;\r\n    for (let i = 0; i < len; i++) {\r\n      // This winding is important\r\n      lines.push(new Line(points[i], points[(i + 1) % len]));\r\n    }\r\n    this._sides = lines;\r\n    return this._sides;\r\n  }\r\n\r\n  /**\r\n   * Returns the local coordinate space sides\r\n   */\r\n  public getLocalSides(): Line[] {\r\n    if (this._localSides.length) {\r\n      return this._localSides;\r\n    }\r\n    const lines = [];\r\n    const points = this.points;\r\n    const len = points.length;\r\n    for (let i = 0; i < len; i++) {\r\n      // This winding is important\r\n      lines.push(new Line(points[i], points[(i + 1) % len]));\r\n    }\r\n    this._localSides = lines;\r\n    return this._localSides;\r\n  }\r\n\r\n  /**\r\n   * Given a direction vector find the world space side that is most in that direction\r\n   * @param direction\r\n   */\r\n  public findSide(direction: Vector): Line {\r\n    const sides = this.getSides();\r\n    let bestSide = sides[0];\r\n    let maxDistance = -Number.MAX_VALUE;\r\n    for (let side = 0; side < sides.length; side++) {\r\n      const currentSide = sides[side];\r\n      const sideNormal = currentSide.normal();\r\n      const mostDirection = sideNormal.dot(direction);\r\n      if (mostDirection > maxDistance) {\r\n        bestSide = currentSide;\r\n        maxDistance = mostDirection;\r\n      }\r\n    }\r\n    return bestSide;\r\n  }\r\n\r\n  /**\r\n   * Given a direction vector find the local space side that is most in that direction\r\n   * @param direction\r\n   */\r\n  public findLocalSide(direction: Vector): Line {\r\n    const sides = this.getLocalSides();\r\n    let bestSide = sides[0];\r\n    let maxDistance = -Number.MAX_VALUE;\r\n    for (let side = 0; side < sides.length; side++) {\r\n      const currentSide = sides[side];\r\n      const sideNormal = currentSide.normal();\r\n      const mostDirection = sideNormal.dot(direction);\r\n      if (mostDirection > maxDistance) {\r\n        bestSide = currentSide;\r\n        maxDistance = mostDirection;\r\n      }\r\n    }\r\n    return bestSide;\r\n  }\r\n\r\n  /**\r\n   * Get the axis associated with the convex polygon\r\n   */\r\n  public get axes(): Vector[] {\r\n    if (this._axes.length) {\r\n      return this._axes;\r\n    }\r\n    const axes = this.getSides().map((s) => s.normal());\r\n    this._axes = axes;\r\n    return this._axes;\r\n  }\r\n\r\n  public update(transform: Transform): void {\r\n    this._transform = transform;\r\n    this._sides.length = 0;\r\n    this._localSides.length = 0;\r\n    this._axes.length = 0;\r\n    this._transformedPoints.length = 0;\r\n    this.getTransformedPoints();\r\n    this.getSides();\r\n    this.getLocalSides();\r\n  }\r\n\r\n  /**\r\n   * Tests if a point is contained in this collider in world space\r\n   */\r\n  public contains(point: Vector): boolean {\r\n    // Always cast to the right, as long as we cast in a consistent fixed direction we\r\n    // will be fine\r\n    const testRay = new Ray(point, new Vector(1, 0));\r\n    const intersectCount = this.getSides().reduce(function (accum, side) {\r\n      if (testRay.intersect(side) >= 0) {\r\n        return accum + 1;\r\n      }\r\n      return accum;\r\n    }, 0);\r\n\r\n    if (intersectCount % 2 === 0) {\r\n      return false;\r\n    }\r\n    return true;\r\n  }\r\n\r\n  public getClosestLineBetween(collider: Collider): Line {\r\n    if (collider instanceof CircleCollider) {\r\n      return ClosestLineJumpTable.PolygonCircleClosestLine(this, collider);\r\n    } else if (collider instanceof PolygonCollider) {\r\n      return ClosestLineJumpTable.PolygonPolygonClosestLine(this, collider);\r\n    } else if (collider instanceof EdgeCollider) {\r\n      return ClosestLineJumpTable.PolygonEdgeClosestLine(this, collider);\r\n    } else {\r\n      throw new Error(`Polygon could not collide with unknown CollisionShape ${typeof collider}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns a collision contact if the 2 colliders collide, otherwise collide will\r\n   * return null.\r\n   * @param collider\r\n   */\r\n  public collide(collider: Collider): CollisionContact[] {\r\n    if (collider instanceof CircleCollider) {\r\n      return CollisionJumpTable.CollideCirclePolygon(collider, this);\r\n    } else if (collider instanceof PolygonCollider) {\r\n      return CollisionJumpTable.CollidePolygonPolygon(this, collider);\r\n    } else if (collider instanceof EdgeCollider) {\r\n      return CollisionJumpTable.CollidePolygonEdge(this, collider);\r\n    } else {\r\n      throw new Error(`Polygon could not collide with unknown CollisionShape ${typeof collider}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Find the point on the collider furthest in the direction specified\r\n   */\r\n  public getFurthestPoint(direction: Vector): Vector {\r\n    const pts = this.getTransformedPoints();\r\n    let furthestPoint = null;\r\n    let maxDistance = -Number.MAX_VALUE;\r\n    for (let i = 0; i < pts.length; i++) {\r\n      const distance = direction.dot(pts[i]);\r\n      if (distance > maxDistance) {\r\n        maxDistance = distance;\r\n        furthestPoint = pts[i];\r\n      }\r\n    }\r\n    return furthestPoint;\r\n  }\r\n\r\n  /**\r\n   * Find the local point on the collider furthest in the direction specified\r\n   * @param direction\r\n   */\r\n  public getFurthestLocalPoint(direction: Vector): Vector {\r\n    const pts = this.points;\r\n    let furthestPoint = pts[0];\r\n    let maxDistance = -Number.MAX_VALUE;\r\n    for (let i = 0; i < pts.length; i++) {\r\n      const distance = direction.dot(pts[i]);\r\n      if (distance > maxDistance) {\r\n        maxDistance = distance;\r\n        furthestPoint = pts[i];\r\n      }\r\n    }\r\n    return furthestPoint;\r\n  }\r\n\r\n  /**\r\n   * Finds the closes face to the point using perpendicular distance\r\n   * @param point point to test against polygon\r\n   */\r\n  public getClosestFace(point: Vector): { distance: Vector; face: Line } {\r\n    const sides = this.getSides();\r\n    let min = Number.POSITIVE_INFINITY;\r\n    let faceIndex = -1;\r\n    let distance = -1;\r\n    for (let i = 0; i < sides.length; i++) {\r\n      const dist = sides[i].distanceToPoint(point);\r\n      if (dist < min) {\r\n        min = dist;\r\n        faceIndex = i;\r\n        distance = dist;\r\n      }\r\n    }\r\n\r\n    if (faceIndex !== -1) {\r\n      return {\r\n        distance: sides[faceIndex].normal().scale(distance),\r\n        face: sides[faceIndex]\r\n      };\r\n    }\r\n\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Get the axis aligned bounding box for the polygon collider in world coordinates\r\n   */\r\n  public get bounds(): BoundingBox {\r\n    const tx = this._transform as TransformComponent;\r\n    const scale = tx?.globalScale ?? Vector.One;\r\n    const rotation = tx?.globalRotation ?? 0;\r\n    const pos = (tx?.globalPos ?? Vector.Zero).add(this.offset);\r\n    return this.localBounds.scale(scale).rotate(rotation).translate(pos);\r\n  }\r\n\r\n  /**\r\n   * Get the axis aligned bounding box for the polygon collider in local coordinates\r\n   */\r\n  public get localBounds(): BoundingBox {\r\n    return BoundingBox.fromPoints(this.points);\r\n  }\r\n\r\n  /**\r\n   * Get the moment of inertia for an arbitrary polygon\r\n   * https://en.wikipedia.org/wiki/List_of_moments_of_inertia\r\n   */\r\n  public getInertia(mass: number): number {\r\n    let numerator = 0;\r\n    let denominator = 0;\r\n    for (let i = 0; i < this.points.length; i++) {\r\n      const iplusone = (i + 1) % this.points.length;\r\n      const crossTerm = this.points[iplusone].cross(this.points[i]);\r\n      numerator +=\r\n        crossTerm *\r\n        (this.points[i].dot(this.points[i]) + this.points[i].dot(this.points[iplusone]) + this.points[iplusone].dot(this.points[iplusone]));\r\n      denominator += crossTerm;\r\n    }\r\n    return (mass / 6) * (numerator / denominator);\r\n  }\r\n\r\n  /**\r\n   * Casts a ray into the polygon and returns a vector representing the point of contact (in world space) or null if no collision.\r\n   */\r\n  public rayCast(ray: Ray, max: number = Infinity) {\r\n    // find the minimum contact time greater than 0\r\n    // contact times less than 0 are behind the ray and we don't want those\r\n    const sides = this.getSides();\r\n    const len = sides.length;\r\n    let minContactTime = Number.MAX_VALUE;\r\n    let contactIndex = -1;\r\n    for (let i = 0; i < len; i++) {\r\n      const contactTime = ray.intersect(sides[i]);\r\n      if (contactTime >= 0 && contactTime < minContactTime && contactTime <= max) {\r\n        minContactTime = contactTime;\r\n        contactIndex = i;\r\n      }\r\n    }\r\n\r\n    // contact was found\r\n    if (contactIndex >= 0) {\r\n      return ray.getPoint(minContactTime);\r\n    }\r\n\r\n    // no contact found\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Project the edges of the polygon along a specified axis\r\n   */\r\n  public project(axis: Vector): Projection {\r\n    const points = this.getTransformedPoints();\r\n    const len = points.length;\r\n    let min = Number.MAX_VALUE;\r\n    let max = -Number.MAX_VALUE;\r\n    for (let i = 0; i < len; i++) {\r\n      const scalar = points[i].dot(axis);\r\n      min = Math.min(min, scalar);\r\n      max = Math.max(max, scalar);\r\n    }\r\n\r\n    return new Projection(min, max);\r\n  }\r\n\r\n  public draw(ctx: CanvasRenderingContext2D, color: Color = Color.Green, pos: Vector = Vector.Zero) {\r\n    const effectiveOffset = pos.add(this.offset);\r\n    ctx.beginPath();\r\n    ctx.fillStyle = color.toString();\r\n\r\n    const firstPoint = this.points[0].add(effectiveOffset);\r\n    ctx.moveTo(firstPoint.x, firstPoint.y);\r\n\r\n    // Points are relative\r\n    this.points\r\n      .map((p) => p.add(effectiveOffset))\r\n      .forEach(function (point) {\r\n        ctx.lineTo(point.x, point.y);\r\n      });\r\n    ctx.lineTo(firstPoint.x, firstPoint.y);\r\n    ctx.closePath();\r\n    ctx.fill();\r\n  }\r\n  public debug(ex: ExcaliburGraphicsContext, color: Color) {\r\n    const firstPoint = this.getTransformedPoints()[0];\r\n    const points = [firstPoint, ...this.getTransformedPoints(), firstPoint];\r\n    for (let i = 0; i < points.length - 1; i++) {\r\n      ex.drawLine(points[i], points[i + 1], color, 2);\r\n      ex.drawCircle(points[i], 2, color);\r\n      ex.drawCircle(points[i + 1], 2, color);\r\n    }\r\n  }\r\n\r\n  /* istanbul ignore next */\r\n  public debugDraw(ctx: CanvasRenderingContext2D, color: Color = Color.Red) {\r\n    ctx.beginPath();\r\n    ctx.strokeStyle = color.toString();\r\n    // Iterate through the supplied points and construct a 'polygon'\r\n    const firstPoint = this.getTransformedPoints()[0];\r\n    ctx.moveTo(firstPoint.x, firstPoint.y);\r\n    this.getTransformedPoints().forEach(function (point) {\r\n      ctx.lineTo(point.x, point.y);\r\n    });\r\n    ctx.lineTo(firstPoint.x, firstPoint.y);\r\n    ctx.closePath();\r\n    ctx.stroke();\r\n  }\r\n}\r\n","import { PolygonCollider } from './PolygonCollider';\r\nimport { CircleCollider } from './CircleCollider';\r\nimport { EdgeCollider } from './EdgeCollider';\r\nimport { BoundingBox } from '../BoundingBox';\r\nimport { vec, Vector } from '../../Math/vector';\r\nimport { CompositeCollider } from './CompositeCollider';\r\nimport { Logger } from '../..';\r\n\r\n/**\r\n * Excalibur helper for defining colliders quickly\r\n */\r\nexport class Shape {\r\n  /**\r\n   * Creates a box collider, under the hood defines a [[PolygonCollider]] collider\r\n   * @param width Width of the box\r\n   * @param height Height of the box\r\n   * @param anchor Anchor of the box (default (.5, .5)) which positions the box relative to the center of the collider's position\r\n   * @param offset Optional offset relative to the collider in local coordinates\r\n   */\r\n  static Box(width: number, height: number, anchor: Vector = Vector.Half, offset: Vector = Vector.Zero): PolygonCollider {\r\n    return new PolygonCollider({\r\n      points: new BoundingBox(-width * anchor.x, -height * anchor.y, width - width * anchor.x, height - height * anchor.y).getPoints(),\r\n      offset: offset\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Creates a new [[PolygonCollider|arbitrary polygon]] collider\r\n   *\r\n   * PolygonColliders are useful for creating convex polygon shapes\r\n   * @param points Points specified in counter clockwise\r\n   * @param clockwiseWinding Optionally changed the winding of points, by default false meaning counter-clockwise winding.\r\n   * @param offset Optional offset relative to the collider in local coordinates\r\n   */\r\n  static Polygon(points: Vector[], clockwiseWinding: boolean = false, offset: Vector = Vector.Zero): PolygonCollider {\r\n    return new PolygonCollider({\r\n      points: points,\r\n      offset: offset,\r\n      clockwiseWinding: clockwiseWinding\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Creates a new [[CircleCollider|circle]] collider\r\n   *\r\n   * Circle colliders are useful for balls, or to make collisions more forgiving on sharp edges\r\n   * @param radius Radius of the circle collider\r\n   * @param offset Optional offset relative to the collider in local coordinates\r\n   */\r\n  static Circle(radius: number, offset: Vector = Vector.Zero): CircleCollider {\r\n    return new CircleCollider({\r\n      radius: radius,\r\n      offset: offset\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Creates a new [[EdgeCollider|edge]] collider\r\n   *\r\n   * Edge colliders are useful for  floors, walls, and other barriers\r\n   * @param begin Beginning of the edge in local coordinates to the collider\r\n   * @param end Ending of the edge in local coordinates to the collider\r\n   */\r\n  static Edge(begin: Vector, end: Vector): EdgeCollider {\r\n    return new EdgeCollider({\r\n      begin: begin,\r\n      end: end\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Creates a new capsule shaped [[CompositeCollider]] using 2 circles and a box\r\n   *\r\n   * Capsule colliders are useful for platformers with incline or jagged floors to have a smooth\r\n   * player experience.\r\n   *\r\n   * @param width\r\n   * @param height\r\n   * @param offset Optional offset\r\n   */\r\n  static Capsule(width: number, height: number, offset = Vector.Zero): CompositeCollider {\r\n    const logger = Logger.getInstance();\r\n    if (width === height) {\r\n      logger.warn('A capsule collider with equal width and height is a circle, consider using a ex.Shape.Circle or ex.CircleCollider');\r\n    }\r\n\r\n    const vertical = height >= width;\r\n\r\n    if (vertical) {\r\n      // height > width, if equal maybe use a circle\r\n      const capsule = new CompositeCollider([\r\n        Shape.Circle(width / 2, vec(0, -height / 2 + width / 2).add(offset)),\r\n        Shape.Box(width, height - width, Vector.Half, offset),\r\n        Shape.Circle(width / 2, vec(0, height / 2 - width / 2).add(offset))\r\n      ]);\r\n      return capsule;\r\n    } else {\r\n      // width > height, if equal maybe use a circle\r\n      const capsule = new CompositeCollider([\r\n        Shape.Circle(height / 2, vec(-width / 2 + height / 2, 0).add(offset)),\r\n        Shape.Box(width - height, height, Vector.Half, offset),\r\n        Shape.Circle(height / 2, vec(width / 2 - height / 2, 0).add(offset))\r\n      ]);\r\n      return capsule;\r\n    }\r\n  }\r\n}\r\n","import { Vector } from '../Math/vector';\r\nimport { TransformComponent } from '../EntityComponentSystem';\r\nimport { Component } from '../EntityComponentSystem/Component';\r\nimport { Entity } from '../EntityComponentSystem/Entity';\r\nimport { EventDispatcher } from '../EventDispatcher';\r\nimport { CollisionEndEvent, CollisionStartEvent, PostCollisionEvent, PreCollisionEvent } from '../Events';\r\nimport { Observable } from '../Util/Observable';\r\nimport { BoundingBox } from './BoundingBox';\r\nimport { CollisionContact } from './Detection/CollisionContact';\r\nimport { CircleCollider } from './Colliders/CircleCollider';\r\nimport { Collider } from './Colliders/Collider';\r\nimport { CompositeCollider } from './Colliders/CompositeCollider';\r\nimport { PolygonCollider } from './Colliders/PolygonCollider';\r\nimport { EdgeCollider } from './Colliders/EdgeCollider';\r\nimport { Shape } from './Colliders/Shape';\r\n\r\nexport class ColliderComponent extends Component<'ex.collider'> {\r\n  public readonly type = 'ex.collider';\r\n\r\n  public events = new EventDispatcher(this);\r\n  /**\r\n   * Observable that notifies when a collider is added to the body\r\n   */\r\n  public $colliderAdded = new Observable<Collider>();\r\n\r\n  /**\r\n   * Observable that notifies when a collider is removed from the body\r\n   */\r\n  public $colliderRemoved = new Observable<Collider>();\r\n\r\n  constructor(collider?: Collider) {\r\n    super();\r\n    this.set(collider);\r\n  }\r\n\r\n  private _collider: Collider;\r\n  /**\r\n   * Get the current collider geometry\r\n   * @returns\r\n   */\r\n  public get() {\r\n    return this._collider;\r\n  }\r\n\r\n  /**\r\n   * Set the collider geometry\r\n   * @param collider\r\n   * @returns the collider you set\r\n   */\r\n  public set<T extends Collider>(collider: T): T {\r\n    this.clear();\r\n    if (collider) {\r\n      this._collider = collider;\r\n      this._collider.owner = this.owner;\r\n      this.events.wire(collider.events);\r\n      this.$colliderAdded.notifyAll(collider);\r\n      this.update();\r\n    }\r\n    return collider;\r\n  }\r\n\r\n  /**\r\n   * Remove collider geometry from collider component\r\n   */\r\n  public clear() {\r\n    if (this._collider) {\r\n      this.events.unwire(this._collider.events);\r\n      this.$colliderRemoved.notifyAll(this._collider);\r\n      this._collider.owner = null;\r\n      this._collider = null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Return world space bounds\r\n   */\r\n  public get bounds() {\r\n    return this._collider?.bounds ?? new BoundingBox();\r\n  }\r\n\r\n  /**\r\n   * Return local space bounds\r\n   */\r\n  public get localBounds() {\r\n    return this._collider?.localBounds ?? new BoundingBox();\r\n  }\r\n\r\n  /**\r\n   * Update the collider's transformed geometry\r\n   */\r\n  public update() {\r\n    const tx = this.owner?.get(TransformComponent);\r\n    if (this._collider) {\r\n      this._collider.owner = this.owner;\r\n      if (tx) {\r\n        this._collider.update(tx);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Collide component with another\r\n   * @param other\r\n   * @returns\r\n   */\r\n  collide(other: ColliderComponent): CollisionContact[] {\r\n    let colliderA = this._collider;\r\n    let colliderB = other._collider;\r\n    if (!colliderA || !colliderB) {\r\n      return [];\r\n    }\r\n\r\n    // If we have a composite lefthand side :(\r\n    // Might bite us, but to avoid updating all the handlers make composite always left side\r\n    let flipped = false;\r\n    if (colliderB instanceof CompositeCollider) {\r\n      colliderA = colliderB;\r\n      colliderB = this._collider;\r\n      flipped = true;\r\n    }\r\n\r\n    if (this._collider) {\r\n      const contacts = colliderA.collide(colliderB);\r\n      if (contacts) {\r\n        if (flipped) {\r\n          contacts.forEach((contact) => {\r\n            contact.mtv = contact.mtv.negate();\r\n            contact.normal = contact.normal.negate();\r\n            contact.tangent = contact.normal.perpendicular();\r\n            contact.colliderA = this._collider;\r\n            contact.colliderB = other._collider;\r\n          });\r\n        }\r\n        return contacts;\r\n      }\r\n      return [];\r\n    }\r\n    return [];\r\n  }\r\n\r\n  onAdd(entity: Entity) {\r\n    if (this._collider) {\r\n      this.update();\r\n    }\r\n    // Wire up the collider events to the owning entity\r\n    this.events.on('precollision', (evt: any) => {\r\n      const precollision = evt as PreCollisionEvent<Collider>;\r\n      entity.events.emit(\r\n        'precollision',\r\n        new PreCollisionEvent(precollision.target.owner, precollision.other.owner, precollision.side, precollision.intersection)\r\n      );\r\n    });\r\n    this.events.on('postcollision', (evt: any) => {\r\n      const postcollision = evt as PostCollisionEvent<Collider>;\r\n      entity.events.emit(\r\n        'postcollision',\r\n        new PostCollisionEvent(postcollision.target.owner, postcollision.other.owner, postcollision.side, postcollision.intersection)\r\n      );\r\n    });\r\n    this.events.on('collisionstart', (evt: any) => {\r\n      const start = evt as CollisionStartEvent<Collider>;\r\n      entity.events.emit('collisionstart', new CollisionStartEvent(start.target.owner, start.other.owner, start.contact));\r\n    });\r\n    this.events.on('collisionend', (evt: any) => {\r\n      const end = evt as CollisionEndEvent<Collider>;\r\n      entity.events.emit('collisionend', new CollisionEndEvent(end.target.owner, end.other.owner));\r\n    });\r\n  }\r\n\r\n  onRemove() {\r\n    this.events.clear();\r\n    this.$colliderRemoved.notifyAll(this._collider);\r\n  }\r\n\r\n  /**\r\n   * Sets up a box geometry based on the current bounds of the associated actor of this physics body.\r\n   *\r\n   * If no width/height are specified the body will attempt to use the associated actor's width/height.\r\n   *\r\n   * By default, the box is center is at (0, 0) which means it is centered around the actors anchor.\r\n   */\r\n  useBoxCollider(width: number, height: number, anchor: Vector = Vector.Half, center: Vector = Vector.Zero): PolygonCollider {\r\n    const collider = Shape.Box(width, height, anchor, center);\r\n    return (this.set(collider));\r\n  }\r\n\r\n  /**\r\n   * Sets up a [[PolygonCollider|polygon]] collision geometry based on a list of of points relative\r\n   *  to the anchor of the associated actor\r\n   * of this physics body.\r\n   *\r\n   * Only [convex polygon](https://en.wikipedia.org/wiki/Convex_polygon) definitions are supported.\r\n   *\r\n   * By default, the box is center is at (0, 0) which means it is centered around the actors anchor.\r\n   */\r\n  usePolygonCollider(points: Vector[], center: Vector = Vector.Zero): PolygonCollider {\r\n    const poly = Shape.Polygon(points, false, center);\r\n    return (this.set(poly));\r\n  }\r\n\r\n  /**\r\n   * Sets up a [[Circle|circle collision geometry]] as the only collider with a specified radius in pixels.\r\n   *\r\n   * By default, the box is center is at (0, 0) which means it is centered around the actors anchor.\r\n   */\r\n  useCircleCollider(radius: number, center: Vector = Vector.Zero): CircleCollider {\r\n    const collider = Shape.Circle(radius, center);\r\n    return (this.set(collider));\r\n  }\r\n\r\n  /**\r\n   * Sets up an [[Edge|edge collision geometry]] with a start point and an end point relative to the anchor of the associated actor\r\n   * of this physics body.\r\n   *\r\n   * By default, the box is center is at (0, 0) which means it is centered around the actors anchor.\r\n   */\r\n  useEdgeCollider(begin: Vector, end: Vector): EdgeCollider {\r\n    const collider = Shape.Edge(begin, end);\r\n    return (this.set(collider));\r\n  }\r\n\r\n  /**\r\n   * Setups up a [[CompositeCollider]] which can define any arbitrary set of excalibur colliders\r\n   * @param colliders\r\n   * @returns\r\n   */\r\n  useCompositeCollider(colliders: Collider[]): CompositeCollider {\r\n    return (this.set(new CompositeCollider(colliders)));\r\n  }\r\n}\r\n","import { Vector } from '../Math/vector';\r\nimport { CollisionType } from './CollisionType';\r\nimport { Physics } from './Physics';\r\nimport { Clonable } from '../Interfaces/Clonable';\r\nimport { TransformComponent } from '../EntityComponentSystem/Components/TransformComponent';\r\nimport { MotionComponent } from '../EntityComponentSystem/Components/MotionComponent';\r\nimport { Component } from '../EntityComponentSystem/Component';\r\nimport { CollisionGroup } from './Group/CollisionGroup';\r\nimport { EventDispatcher } from '../EventDispatcher';\r\nimport { createId, Id } from '../Id';\r\nimport { clamp } from '../Util/Util';\r\nimport { ColliderComponent } from './ColliderComponent';\r\n\r\nexport interface BodyComponentOptions {\r\n  type?: CollisionType;\r\n  group?: CollisionGroup;\r\n  useGravity?: boolean;\r\n}\r\n\r\nexport enum DegreeOfFreedom {\r\n  Rotation = 'rotation',\r\n  X = 'x',\r\n  Y = 'y'\r\n}\r\n\r\n/**\r\n * Body describes all the physical properties pos, vel, acc, rotation, angular velocity for the purpose of\r\n * of physics simulation.\r\n */\r\nexport class BodyComponent extends Component<'ex.body'> implements Clonable<BodyComponent> {\r\n  public readonly type = 'ex.body';\r\n  public dependencies = [TransformComponent, MotionComponent];\r\n  public static _ID = 0;\r\n  public readonly id: Id<'body'> = createId('body', BodyComponent._ID++);\r\n  public events = new EventDispatcher(this);\r\n\r\n  constructor(options?: BodyComponentOptions) {\r\n    super();\r\n    if (options) {\r\n      this.collisionType = options.type ?? this.collisionType;\r\n      this.group = options.group ?? this.group;\r\n      this.useGravity = options.useGravity ?? this.useGravity;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Collision type for the rigidbody physics simulation, by default [[CollisionType.PreventCollision]]\r\n   */\r\n  public collisionType: CollisionType = CollisionType.PreventCollision;\r\n\r\n  /**\r\n   * The collision group for the body's colliders, by default body colliders collide with everything\r\n   */\r\n  public group: CollisionGroup = CollisionGroup.All;\r\n\r\n  /**\r\n   * The amount of mass the body has\r\n   */\r\n  public mass: number = Physics.defaultMass;\r\n\r\n  /**\r\n   * The inverse mass (1/mass) of the body. If [[CollisionType.Fixed]] this is 0, meaning \"infinite\" mass\r\n   */\r\n  public get inverseMass(): number {\r\n    return this.collisionType === CollisionType.Fixed ? 0 : 1 / this.mass;\r\n  }\r\n\r\n  /**\r\n   * Amount of \"motion\" the body has before sleeping. If below [[Physics.sleepEpsilon]] it goes to \"sleep\"\r\n   */\r\n  public sleepMotion: number = Physics.sleepEpsilon * 5;\r\n\r\n  /**\r\n   * Can this body sleep, by default bodies do not sleep\r\n   */\r\n  public canSleep: boolean = Physics.bodiesCanSleepByDefault;\r\n\r\n  private _sleeping = false;\r\n  /**\r\n   * Whether this body is sleeping or not\r\n   */\r\n  public get sleeping(): boolean {\r\n    return this._sleeping;\r\n  }\r\n\r\n  /**\r\n   * Set the sleep state of the body\r\n   * @param sleeping\r\n   */\r\n  public setSleeping(sleeping: boolean) {\r\n    this._sleeping = sleeping;\r\n    if (!sleeping) {\r\n      // Give it a kick to keep it from falling asleep immediately\r\n      this.sleepMotion = Physics.sleepEpsilon * 5;\r\n    } else {\r\n      this.vel = Vector.Zero;\r\n      this.acc = Vector.Zero;\r\n      this.angularVelocity = 0;\r\n      this.sleepMotion = 0;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update body's [[BodyComponent.sleepMotion]] for the purpose of sleeping\r\n   */\r\n  public updateMotion() {\r\n    if (this._sleeping) {\r\n      this.setSleeping(true);\r\n    }\r\n    const currentMotion = this.vel.size * this.vel.size + Math.abs(this.angularVelocity * this.angularVelocity);\r\n    const bias = Physics.sleepBias;\r\n    this.sleepMotion = bias * this.sleepMotion + (1 - bias) * currentMotion;\r\n    this.sleepMotion = clamp(this.sleepMotion, 0, 10 * Physics.sleepEpsilon);\r\n    if (this.canSleep && this.sleepMotion < Physics.sleepEpsilon) {\r\n      this.setSleeping(true);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get the moment of inertia from the [[ColliderComponent]]\r\n   */\r\n  public get inertia() {\r\n    // Inertia is a property of the geometry, so this is a little goofy but seems to be okay?\r\n    const collider = this.owner.get(ColliderComponent);\r\n    if (collider?.get()) {\r\n      return collider.get().getInertia(this.mass);\r\n    }\r\n    return 0;\r\n  }\r\n\r\n  /**\r\n   * Get the inverse moment of inertial from the [[ColliderComponent]]. If [[CollisionType.Fixed]] this is 0, meaning \"infinite\" mass\r\n   */\r\n  public get inverseInertia() {\r\n    return this.collisionType === CollisionType.Fixed ? 0 : 1 / this.inertia;\r\n  }\r\n\r\n  /**\r\n   * The also known as coefficient of restitution of this actor, represents the amount of energy preserved after collision or the\r\n   * bounciness. If 1, it is 100% bouncy, 0 it completely absorbs.\r\n   */\r\n  public bounciness: number = 0.2;\r\n\r\n  /**\r\n   * The coefficient of friction on this actor\r\n   */\r\n  public friction: number = 0.99;\r\n\r\n  /**\r\n   * Should use global gravity [[Physics.gravity]] in it's physics simulation, default is true\r\n   */\r\n  public useGravity: boolean = true;\r\n\r\n  /**\r\n   * Degrees of freedom to limit\r\n   */\r\n  public limitDegreeOfFreedom: DegreeOfFreedom[] = [];\r\n\r\n  /**\r\n   * Returns if the owner is active\r\n   */\r\n  public get active() {\r\n    return !!this.owner?.active;\r\n  }\r\n\r\n  public get center() {\r\n    return this.pos;\r\n  }\r\n\r\n  public get transform(): TransformComponent {\r\n    return this.owner?.get(TransformComponent);\r\n  }\r\n\r\n  public get motion(): MotionComponent {\r\n    return this.owner?.get(MotionComponent);\r\n  }\r\n\r\n  /**\r\n   * The (x, y) position of the actor this will be in the middle of the actor if the\r\n   * [[Actor.anchor]] is set to (0.5, 0.5) which is default.\r\n   * If you want the (x, y) position to be the top left of the actor specify an anchor of (0, 0).\r\n   */\r\n  public get pos(): Vector {\r\n    return this.transform.globalPos;\r\n  }\r\n\r\n  public set pos(val: Vector) {\r\n    this.transform.globalPos = val;\r\n  }\r\n\r\n  /**\r\n   * The position of the actor last frame (x, y) in pixels\r\n   */\r\n  public oldPos: Vector = new Vector(0, 0);\r\n\r\n  /**\r\n   * The current velocity vector (vx, vy) of the actor in pixels/second\r\n   */\r\n  public get vel(): Vector {\r\n    return this.motion.vel;\r\n  }\r\n\r\n  public set vel(val: Vector) {\r\n    this.motion.vel = val;\r\n  }\r\n\r\n  /**\r\n   * The velocity of the actor last frame (vx, vy) in pixels/second\r\n   */\r\n  public oldVel: Vector = new Vector(0, 0);\r\n\r\n  /**\r\n   * The current acceleration vector (ax, ay) of the actor in pixels/second/second. An acceleration pointing down such as (0, 100) may\r\n   * be useful to simulate a gravitational effect.\r\n   */\r\n  public get acc(): Vector {\r\n    return this.motion.acc;\r\n  }\r\n\r\n  public set acc(val: Vector) {\r\n    this.motion.acc = val;\r\n  }\r\n\r\n  /**\r\n   * Gets/sets the acceleration of the actor from the last frame. This does not include the global acc [[Physics.acc]].\r\n   */\r\n  public oldAcc: Vector = Vector.Zero;\r\n\r\n  /**\r\n   * The current torque applied to the actor\r\n   */\r\n  public get torque(): number {\r\n    return this.motion.torque;\r\n  }\r\n\r\n  public set torque(val: number) {\r\n    this.motion.torque = val;\r\n  }\r\n\r\n  /**\r\n   * Gets/sets the rotation of the body from the last frame.\r\n   */\r\n  public oldRotation: number = 0; // radians\r\n\r\n  /**\r\n   * The rotation of the body in radians\r\n   */\r\n  public get rotation() {\r\n    return this.transform.globalRotation;\r\n  }\r\n\r\n  public set rotation(val: number) {\r\n    this.transform.globalRotation = val;\r\n  }\r\n\r\n  /**\r\n   * The scale vector of the actor\r\n   * @deprecated ex.Body.scale will be removed in v0.25.0, Use ex.Transform.scale\r\n   */\r\n  public get scale(): Vector {\r\n    return this.transform.globalScale;\r\n  }\r\n\r\n  public set scale(val: Vector) {\r\n    this.transform.globalScale = val;\r\n  }\r\n\r\n  /**\r\n   * The scale of the actor last frame\r\n   * @deprecated ex.Body.scale will be removed in v0.25.0\r\n   */\r\n  public oldScale: Vector = Vector.One;\r\n\r\n  /**\r\n   * The x scalar velocity of the actor in scale/second\r\n   * @deprecated ex.Body.scale will be removed in v0.25.0\r\n   */\r\n  public get sx(): number {\r\n    return this.motion.scaleFactor.x;\r\n  }\r\n\r\n  public set sx(xFactor: number) {\r\n    this.motion.scaleFactor.x = xFactor;\r\n  }\r\n\r\n  /**\r\n   * The y scalar velocity of the actor in scale/second\r\n   * @deprecated ex.Body.scale will be removed in v0.25.0\r\n   */\r\n  public get sy(): number {\r\n    return this.motion.scaleFactor.y;\r\n  }\r\n\r\n  public set sy(yFactor: number) {\r\n    this.motion.scaleFactor.y = yFactor;\r\n  }\r\n\r\n  /**\r\n   * The rotational velocity of the actor in radians/second\r\n   * @deprecated\r\n   */\r\n  public get rx(): number {\r\n    return this.motion.angularVelocity;\r\n  }\r\n\r\n  /**\r\n   * The rotational velocity of the actor in radians/second\r\n   * @deprecated\r\n   */\r\n  public set rx(value: number) {\r\n    this.motion.angularVelocity = value;\r\n  }\r\n\r\n  /**\r\n   * Get the angular velocity in radians/second\r\n   */\r\n  public get angularVelocity(): number {\r\n    return this.motion.angularVelocity;\r\n  }\r\n\r\n  /**\r\n   * Set the angular velocity in radians/second\r\n   */\r\n  public set angularVelocity(value: number) {\r\n    this.motion.angularVelocity = value;\r\n  }\r\n\r\n  /**\r\n   * Apply a specific impulse to the body\r\n   * @param point\r\n   * @param impulse\r\n   */\r\n  public applyImpulse(point: Vector, impulse: Vector) {\r\n    if (this.collisionType !== CollisionType.Active) {\r\n      return; // only active objects participate in the simulation\r\n    }\r\n\r\n    const finalImpulse = impulse.scale(this.inverseMass);\r\n    if (this.limitDegreeOfFreedom.includes(DegreeOfFreedom.X)) {\r\n      finalImpulse.x = 0;\r\n    }\r\n    if (this.limitDegreeOfFreedom.includes(DegreeOfFreedom.Y)) {\r\n      finalImpulse.y = 0;\r\n    }\r\n\r\n    this.vel.addEqual(finalImpulse);\r\n\r\n    if (!this.limitDegreeOfFreedom.includes(DegreeOfFreedom.Rotation)) {\r\n      const distanceFromCenter = point.sub(this.pos);\r\n      this.angularVelocity += this.inverseInertia * distanceFromCenter.cross(impulse);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Apply only linear impulse to the body\r\n   * @param impulse\r\n   */\r\n  public applyLinearImpulse(impulse: Vector) {\r\n    if (this.collisionType !== CollisionType.Active) {\r\n      return; // only active objects participate in the simulation\r\n    }\r\n\r\n    const finalImpulse = impulse.scale(this.inverseMass);\r\n\r\n    if (this.limitDegreeOfFreedom.includes(DegreeOfFreedom.X)) {\r\n      finalImpulse.x = 0;\r\n    }\r\n    if (this.limitDegreeOfFreedom.includes(DegreeOfFreedom.Y)) {\r\n      finalImpulse.y = 0;\r\n    }\r\n\r\n    this.vel = this.vel.add(finalImpulse);\r\n  }\r\n\r\n  /**\r\n   * Apply only angular impuse to the body\r\n   * @param point\r\n   * @param impulse\r\n   */\r\n  public applyAngularImpulse(point: Vector, impulse: Vector) {\r\n    if (this.collisionType !== CollisionType.Active) {\r\n      return; // only active objects participate in the simulation\r\n    }\r\n\r\n    if (!this.limitDegreeOfFreedom.includes(DegreeOfFreedom.Rotation)) {\r\n      const distanceFromCenter = point.sub(this.pos);\r\n      this.angularVelocity += this.inverseInertia * distanceFromCenter.cross(impulse);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Sets the old versions of pos, vel, acc, and scale.\r\n   */\r\n  public captureOldTransform() {\r\n    // Capture old values before integration step updates them\r\n    this.oldVel.setTo(this.vel.x, this.vel.y);\r\n    this.oldPos.setTo(this.pos.x, this.pos.y);\r\n    this.oldAcc.setTo(this.acc.x, this.acc.y);\r\n    this.oldScale.setTo(this.scale.x, this.scale.y);\r\n    this.oldRotation = this.rotation;\r\n  }\r\n\r\n  debugDraw(_ctx: CanvasRenderingContext2D) {\r\n    // pass\r\n  }\r\n}\r\n","import { Vector, vec } from '../Math/vector';\nimport { Actor } from '../Actor';\nimport { Engine } from '../Engine';\nimport { Color } from '../Color';\n\n/**\n * @deprecated Will be removed in 0.26.0\n */\nexport class CullingBox {\n  private _topLeft: Vector = new Vector(0, 0);\n  private _topRight: Vector = new Vector(0, 0);\n  private _bottomLeft: Vector = new Vector(0, 0);\n  private _bottomRight: Vector = new Vector(0, 0);\n\n  private _xCoords: Array<number>;\n  private _yCoords: Array<number>;\n  private _xMin: number;\n  private _yMin: number;\n  private _xMax: number;\n  private _yMax: number;\n\n  private _xMinWorld: number;\n  private _yMinWorld: number;\n  private _xMaxWorld: number;\n  private _yMaxWorld: number;\n\n  public isSpriteOffScreen(actor: Actor, engine: Engine): boolean {\n    const drawingWidth = actor.currentDrawing.drawWidth;\n    const drawingHeight = actor.currentDrawing.drawHeight;\n    const rotation = actor.rotation;\n    const anchor = actor.center;\n    const worldPos = actor.getGlobalPos();\n\n    this._topLeft = vec(worldPos.x - drawingWidth / 2, worldPos.y - drawingHeight / 2);\n    this._topLeft = this._topLeft.rotate(rotation, anchor);\n\n    this._topRight = vec(worldPos.x + drawingWidth / 2, worldPos.y - drawingHeight / 2);\n    this._topRight = this._topRight.rotate(rotation, anchor);\n\n    this._bottomLeft = vec(worldPos.x - drawingWidth / 2, worldPos.y + drawingHeight / 2);\n    this._bottomLeft = this._bottomLeft.rotate(rotation, anchor);\n\n    this._bottomRight = vec(worldPos.x + drawingWidth / 2, worldPos.y + drawingHeight / 2);\n    this._bottomRight = this._bottomRight.rotate(rotation, anchor);\n\n    const topLeftScreen = engine.worldToScreenCoordinates(this._topLeft);\n    const topRightScreen = engine.worldToScreenCoordinates(this._topRight);\n    const bottomLeftScreen = engine.worldToScreenCoordinates(this._bottomLeft);\n    const bottomRightScreen = engine.worldToScreenCoordinates(this._bottomRight);\n    this._xCoords = [];\n    this._yCoords = [];\n\n    this._xCoords.push(topLeftScreen.x, topRightScreen.x, bottomLeftScreen.x, bottomRightScreen.x);\n    this._yCoords.push(topLeftScreen.y, topRightScreen.y, bottomLeftScreen.y, bottomRightScreen.y);\n\n    this._xMin = Math.min.apply(null, this._xCoords);\n    this._yMin = Math.min.apply(null, this._yCoords);\n    this._xMax = Math.max.apply(null, this._xCoords);\n    this._yMax = Math.max.apply(null, this._yCoords);\n\n    const minWorld = engine.screenToWorldCoordinates(new Vector(this._xMin, this._yMin));\n    const maxWorld = engine.screenToWorldCoordinates(new Vector(this._xMax, this._yMax));\n    this._xMinWorld = minWorld.x;\n    this._yMinWorld = minWorld.y;\n    this._xMaxWorld = maxWorld.x;\n    this._yMaxWorld = maxWorld.y;\n\n    const boundingPoints = [\n      new Vector(this._xMin, this._yMin), // top left\n      new Vector(this._xMax, this._yMin), // top right\n      new Vector(this._xMin, this._yMax), // bottom left\n      new Vector(this._xMax, this._yMax) // bottom right\n    ];\n\n    // sprite can be wider than canvas screen (and still visible within canvas)\n    // top or bottom of sprite must be within canvas\n    if (\n      boundingPoints[0].x < 0 &&\n      boundingPoints[1].x > engine.canvas.clientWidth &&\n      (boundingPoints[0].y > 0 || boundingPoints[2].y < engine.canvas.clientHeight)\n    ) {\n      return false;\n    }\n\n    // sprite can be taller than canvas screen (and still visible within canvas)\n    // left or right of sprite must be within canvas\n    if (\n      boundingPoints[0].y < 0 &&\n      boundingPoints[2].y > engine.canvas.clientHeight &&\n      (boundingPoints[1].x > 0 || boundingPoints[0].x < engine.canvas.clientWidth)\n    ) {\n      return false;\n    }\n\n    // otherwise if any corner is visible, we're not offscreen\n    for (let i = 0; i < boundingPoints.length; i++) {\n      if (\n        boundingPoints[i].x > 0 &&\n        boundingPoints[i].y > 0 &&\n        boundingPoints[i].x < engine.canvas.clientWidth &&\n        boundingPoints[i].y < engine.canvas.clientHeight\n      ) {\n        return false;\n      }\n    }\n\n    return true;\n  }\n\n  public debugDraw(ctx: CanvasRenderingContext2D) {\n    // bounding rectangle\n    ctx.beginPath();\n    ctx.strokeStyle = Color.White.toString();\n    ctx.rect(this._xMinWorld, this._yMinWorld, this._xMaxWorld - this._xMinWorld, this._yMaxWorld - this._yMinWorld);\n    ctx.stroke();\n\n    ctx.fillStyle = Color.Red.toString();\n    ctx.beginPath();\n    ctx.arc(this._topLeft.x, this._topLeft.y, 5, 0, Math.PI * 2);\n    ctx.closePath();\n    ctx.fill();\n\n    ctx.fillStyle = Color.Green.toString();\n    ctx.beginPath();\n    ctx.arc(this._topRight.x, this._topRight.y, 5, 0, Math.PI * 2);\n    ctx.closePath();\n    ctx.fill();\n\n    ctx.fillStyle = Color.Blue.toString();\n    ctx.beginPath();\n    ctx.arc(this._bottomLeft.x, this._bottomLeft.y, 5, 0, Math.PI * 2);\n    ctx.closePath();\n    ctx.fill();\n\n    ctx.fillStyle = Color.Magenta.toString();\n    ctx.beginPath();\n    ctx.arc(this._bottomRight.x, this._bottomRight.y, 5, 0, Math.PI * 2);\n    ctx.closePath();\n    ctx.fill();\n  }\n}\n","import { CullingBox } from './../Util/CullingBox';\nimport { Trait } from '../Interfaces/Trait';\nimport { Actor } from '../Actor';\nimport { Engine } from '../Engine';\nimport { ExitViewPortEvent, EnterViewPortEvent } from '../Events';\nimport { TagComponent } from '../EntityComponentSystem';\n\n/**\n * @deprecated will be removed in 0.26.0\n */\nexport class OffscreenCulling implements Trait {\n  public cullingBox: CullingBox = new CullingBox();\n\n  public update(actor: Actor, engine: Engine) {\n    const events = actor.eventDispatcher;\n\n    let isSpriteOffScreen = true;\n    if (actor.currentDrawing != null) {\n      isSpriteOffScreen = this.cullingBox.isSpriteOffScreen(actor, engine);\n    }\n\n    let actorBoundsOffscreen = false;\n    if (engine && engine.currentScene && engine.currentScene.camera && engine.currentScene.camera.viewport && !actor.parent) {\n      actorBoundsOffscreen = !engine.currentScene.camera.viewport.intersect(actor.collider.bounds);\n    }\n\n    if (!actor.isOffScreen) {\n      if (actorBoundsOffscreen && isSpriteOffScreen) {\n        events.emit('exitviewport', new ExitViewPortEvent(actor));\n        actor.addComponent(new TagComponent('offscreen'));\n      }\n    } else {\n      if (!actorBoundsOffscreen || !isSpriteOffScreen) {\n        events.emit('enterviewport', new EnterViewPortEvent(actor));\n        actor.removeComponent('offscreen');\n      }\n    }\n  }\n}\n","import { Trait } from '../Interfaces/Trait';\r\nimport { Actor } from '../Actor';\r\nimport { Engine } from '../Engine';\r\n\r\n/**\r\n * Revises pointer events path accordingly to the actor\r\n * @deprecated Will be removed in 0.26.0\r\n */\r\nexport class CapturePointer implements Trait {\r\n  public update(actor: Actor, engine: Engine) {\r\n    if (!actor.enableCapturePointer) {\r\n      return;\r\n    }\r\n    if (actor.isKilled()) {\r\n      return;\r\n    }\r\n\r\n    engine.input.pointers.checkAndUpdateActorUnderPointer(actor);\r\n  }\r\n}\r\n","import { Component, ComponentCtor, TagComponent } from './Component';\r\n\r\nimport { Observable, Message } from '../Util/Observable';\r\nimport { Class } from '../Class';\r\nimport { OnInitialize, OnPreUpdate, OnPostUpdate } from '../Interfaces/LifecycleEvents';\r\nimport { Engine } from '../Engine';\r\nimport { InitializeEvent, PreUpdateEvent, PostUpdateEvent } from '../Events';\r\nimport { EventDispatcher } from '../EventDispatcher';\r\nimport { Util } from '..';\r\n\r\n/**\r\n * Interface holding an entity component pair\r\n */\r\nexport interface EntityComponent {\r\n  component: Component;\r\n  entity: Entity;\r\n}\r\n\r\n/**\r\n * AddedComponent message\r\n */\r\nexport class AddedComponent implements Message<EntityComponent> {\r\n  readonly type: 'Component Added' = 'Component Added';\r\n  constructor(public data: EntityComponent) {}\r\n}\r\n\r\n/**\r\n * Type guard to know if message is f an Added Component\r\n */\r\nexport function isAddedComponent(x: Message<EntityComponent>): x is AddedComponent {\r\n  return !!x && x.type === 'Component Added';\r\n}\r\n\r\n/**\r\n * RemovedComponent message\r\n */\r\nexport class RemovedComponent implements Message<EntityComponent> {\r\n  readonly type: 'Component Removed' = 'Component Removed';\r\n  constructor(public data: EntityComponent) {}\r\n}\r\n\r\n/**\r\n * Type guard to know if message is for a Removed Component\r\n */\r\nexport function isRemovedComponent(x: Message<EntityComponent>): x is RemovedComponent {\r\n  return !!x && x.type === 'Component Removed';\r\n}\r\n\r\n/**\r\n * An Entity is the base type of anything that can have behavior in Excalibur, they are part of the built in entity component system\r\n *\r\n * Entities can be strongly typed with the components they contain\r\n *\r\n * ```typescript\r\n * const entity = new Entity<ComponentA | ComponentB>();\r\n * entity.components.a; // Type ComponentA\r\n * entity.components.b; // Type ComponentB\r\n * ```\r\n */\r\nexport class Entity extends Class implements OnInitialize, OnPreUpdate, OnPostUpdate {\r\n  private static _ID = 0;\r\n\r\n  constructor(components?: Component[], name?: string) {\r\n    super();\r\n    this._setName(name);\r\n    if (components) {\r\n      for (const component of components) {\r\n        this.addComponent(component);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * The unique identifier for the entity\r\n   */\r\n  public id: number = Entity._ID++;\r\n\r\n  private _name: string = 'anonymous';\r\n  protected _setName(name: string) {\r\n    if (name) {\r\n      this._name = name;\r\n    }\r\n  }\r\n  public get name(): string {\r\n    return this._name;\r\n  }\r\n\r\n  public get events(): EventDispatcher {\r\n    return this.eventDispatcher;\r\n  }\r\n\r\n  /**\r\n   * Whether this entity is active, if set to false it will be reclaimed\r\n   */\r\n  public active: boolean = true;\r\n\r\n  /**\r\n   * Kill the entity, means it will no longer be updated. Kills are deferred to the end of the update.\r\n   */\r\n  public kill() {\r\n    this.active = false;\r\n  }\r\n\r\n  public isKilled() {\r\n    return !this.active;\r\n  }\r\n\r\n  /**\r\n   * Specifically get the tags on the entity from [[TagComponent]]\r\n   */\r\n  public get tags(): readonly string[] {\r\n    return this._tagsMemo;\r\n  }\r\n\r\n  /**\r\n   * Check if a tag exists on the entity\r\n   * @param tag name to check for\r\n   */\r\n  public hasTag(tag: string): boolean {\r\n    return this.tags.includes(tag);\r\n  }\r\n\r\n  /**\r\n   * Adds a tag to an entity\r\n   * @param tag\r\n   * @returns Entity\r\n   */\r\n  public addTag(tag: string) {\r\n    return this.addComponent(new TagComponent(tag));\r\n  }\r\n\r\n  /**\r\n   * Removes a tag on the entity\r\n   *\r\n   * Removals are deferred until the end of update\r\n   * @param tag\r\n   * @param force Remove component immediately, no deferred\r\n   */\r\n  public removeTag(tag: string, force = false) {\r\n    return this.removeComponent(tag, force);\r\n  }\r\n\r\n  /**\r\n   * The types of the components on the Entity\r\n   */\r\n  public get types(): string[] {\r\n    return this._typesMemo;\r\n  }\r\n\r\n  /**\r\n   * Bucket to hold on to deferred removals\r\n   */\r\n  private _componentsToRemove: (Component | string)[] = [];\r\n  private _componentTypeToInstance = new Map<ComponentCtor, Component>();\r\n  private _componentStringToInstance = new Map<string, Component>();\r\n\r\n  private _tagsMemo: string[] = [];\r\n  private _typesMemo: string[] = [];\r\n  private _rebuildMemos() {\r\n    this._tagsMemo = Array.from(this._componentStringToInstance.values())\r\n      .filter((c) => c instanceof TagComponent)\r\n      .map((c) => c.type);\r\n    this._typesMemo = Array.from(this._componentStringToInstance.keys());\r\n  }\r\n\r\n  public getComponents(): Component[] {\r\n    return Array.from(this._componentStringToInstance.values());\r\n  }\r\n\r\n  /**\r\n   * Observable that keeps track of component add or remove changes on the entity\r\n   */\r\n  public componentAdded$ = new Observable<AddedComponent>();\r\n  private _notifyAddComponent(component: Component) {\r\n    this._rebuildMemos();\r\n    const added = new AddedComponent({\r\n      component,\r\n      entity: this\r\n    });\r\n    this.componentAdded$.notifyAll(added);\r\n  }\r\n\r\n  public componentRemoved$ = new Observable<RemovedComponent>();\r\n  private _notifyRemoveComponent(component: Component) {\r\n    const removed = new RemovedComponent({\r\n      component,\r\n      entity: this\r\n    });\r\n    this.componentRemoved$.notifyAll(removed);\r\n    this._rebuildMemos();\r\n  }\r\n\r\n  private _parent: Entity = null;\r\n  public get parent(): Entity {\r\n    return this._parent;\r\n  }\r\n\r\n  public childrenAdded$ = new Observable<Entity>();\r\n  public childrenRemoved$ = new Observable<Entity>();\r\n\r\n  private _children: Entity[] = [];\r\n  /**\r\n   * Get the direct children of this entity\r\n   */\r\n  public get children(): readonly Entity[] {\r\n    return this._children;\r\n  }\r\n\r\n  /**\r\n   * Unparents this entity, if there is a parent. Otherwise it does nothing.\r\n   */\r\n  public unparent() {\r\n    if (this._parent) {\r\n      this._parent.removeChild(this);\r\n      this._parent = null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Adds an entity to be a child of this entity\r\n   * @param entity\r\n   */\r\n  public addChild(entity: Entity): Entity {\r\n    if (entity.parent === null) {\r\n      if (this.getAncestors().includes(entity)) {\r\n        throw new Error('Cycle detected, cannot add entity');\r\n      }\r\n      this._children.push(entity);\r\n      entity._parent = this;\r\n      this.childrenAdded$.notifyAll(entity);\r\n    } else {\r\n      throw new Error('Entity already has a parent, cannot add without unparenting');\r\n    }\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Remove an entity from children if it exists\r\n   * @param entity\r\n   */\r\n  public removeChild(entity: Entity): Entity {\r\n    if (entity.parent === this) {\r\n      Util.removeItemFromArray(entity, this._children);\r\n      entity._parent = null;\r\n      this.childrenRemoved$.notifyAll(entity);\r\n    }\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Removes all children from this entity\r\n   */\r\n  public removeAllChildren(): Entity {\r\n    this.children.forEach((c) => {\r\n      this.removeChild(c);\r\n    });\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Returns a list of parent entities starting with the topmost parent. Includes the current entity.\r\n   */\r\n  public getAncestors(): Entity[] {\r\n    const result: Entity[] = [this];\r\n    let current = this.parent;\r\n    while (current) {\r\n      result.push(current);\r\n      current = current.parent;\r\n    }\r\n    return result.reverse();\r\n  }\r\n\r\n  /**\r\n   * Returns a list of all the entities that descend from this entity. Includes the current entity.\r\n   */\r\n  public getDescendants(): Entity[] {\r\n    let result: Entity[] = [this];\r\n    let queue: Entity[] = [this];\r\n    while (queue.length > 0) {\r\n      const curr = queue.pop();\r\n      queue = queue.concat(curr.children);\r\n      result = result.concat(curr.children);\r\n    }\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Creates a deep copy of the entity and a copy of all its components\r\n   */\r\n  public clone(): Entity {\r\n    const newEntity = new Entity();\r\n    for (const c of this.types) {\r\n      newEntity.addComponent(this.get(c).clone());\r\n    }\r\n    for (const child of this.children) {\r\n      newEntity.addChild(child.clone());\r\n    }\r\n    return newEntity;\r\n  }\r\n\r\n  /**\r\n   * Adds a copy of all the components from another template entity as a \"prefab\"\r\n   * @param templateEntity Entity to use as a template\r\n   * @param force Force component replacement if it aleady exists on the target entity\r\n   */\r\n  public addTemplate(templateEntity: Entity, force: boolean = false): Entity {\r\n    for (const c of templateEntity.getComponents()) {\r\n      this.addComponent(c.clone(), force);\r\n    }\r\n    for (const child of templateEntity.children) {\r\n      this.addChild(child.clone().addTemplate(child));\r\n    }\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Adds a component to the entity\r\n   * @param component Component or Entity to add copy of components from\r\n   * @param force Optionally overwrite any existing components of the same type\r\n   */\r\n  public addComponent<T extends Component>(component: T, force: boolean = false): Entity {\r\n    // if component already exists, skip if not forced\r\n    if (this.has(component.type)) {\r\n      if (force) {\r\n        // Remove existing component type if exists when forced\r\n        this.removeComponent(component);\r\n      } else {\r\n        // early exit component exiss\r\n        return this;\r\n      }\r\n    }\r\n\r\n    // TODO circular dependencies will be a problem\r\n    if (component.dependencies && component.dependencies.length) {\r\n      for (const ctor of component.dependencies) {\r\n        this.addComponent(new ctor());\r\n      }\r\n    }\r\n\r\n    component.owner = this;\r\n    const constuctorType = component.constructor as ComponentCtor<T>;\r\n    this._componentTypeToInstance.set(constuctorType, component);\r\n    this._componentStringToInstance.set(component.type, component);\r\n    if (component.onAdd) {\r\n      component.onAdd(this);\r\n    }\r\n    this._notifyAddComponent(component);\r\n\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Removes a component from the entity, by default removals are deferred to the end of entity update to avoid consistency issues\r\n   *\r\n   * Components can be force removed with the `force` flag, the removal is not deferred and happens immediately\r\n   * @param componentOrType\r\n   * @param force\r\n   */\r\n  public removeComponent<ComponentOrType extends string | Component>(componentOrType: ComponentOrType, force = false): Entity {\r\n    if (force) {\r\n      if (typeof componentOrType === 'string') {\r\n        this._removeComponentByType(componentOrType);\r\n      } else if (componentOrType instanceof Component) {\r\n        this._removeComponentByType(componentOrType.type);\r\n      }\r\n    } else {\r\n      this._componentsToRemove.push(componentOrType);\r\n    }\r\n\r\n    return this as any;\r\n  }\r\n\r\n  private _removeComponentByType(type: string) {\r\n    if (this.has(type)) {\r\n      const component = this.get(type);\r\n      component.owner = null;\r\n      if (component.onRemove) {\r\n        component.onRemove(this);\r\n      }\r\n      const ctor = component.constructor as ComponentCtor;\r\n      this._componentTypeToInstance.delete(ctor);\r\n      this._componentStringToInstance.delete(component.type);\r\n      this._notifyRemoveComponent(component);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @hidden\r\n   * @internal\r\n   */\r\n  public processComponentRemoval() {\r\n    for (const componentOrType of this._componentsToRemove) {\r\n      const type = typeof componentOrType === 'string' ? componentOrType : componentOrType.type;\r\n      this._removeComponentByType(type);\r\n    }\r\n    this._componentsToRemove.length = 0;\r\n  }\r\n\r\n  /**\r\n   * Check if a component type exists\r\n   * @param type\r\n   */\r\n  public has<T extends Component>(type: ComponentCtor<T>): boolean;\r\n  public has(type: string): boolean;\r\n  public has<T extends Component>(type: ComponentCtor<T> | string): boolean {\r\n    if (typeof type === 'string') {\r\n      return this._componentStringToInstance.has(type);\r\n    } else {\r\n      return this._componentTypeToInstance.has(type);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get a component by type with typecheck\r\n   *\r\n   * (Does not work on tag components, use .hasTag(\"mytag\") instead)\r\n   * @param type\r\n   */\r\n  public get<T extends Component>(type: ComponentCtor<T>): T | null;\r\n  public get<T extends Component>(type: string): T | null;\r\n  public get<T extends Component>(type: ComponentCtor<T> | string): T | null {\r\n    if (typeof type === 'string') {\r\n      return this._componentStringToInstance.get(type) as T;\r\n    } else {\r\n      return this._componentTypeToInstance.get(type) as T;\r\n    }\r\n  }\r\n\r\n  private _isInitialized = false;\r\n\r\n  /**\r\n   * Gets whether the actor is Initialized\r\n   */\r\n  public get isInitialized(): boolean {\r\n    return this._isInitialized;\r\n  }\r\n\r\n  /**\r\n   * Initializes this entity, meant to be called by the Scene before first update not by users of Excalibur.\r\n   *\r\n   * It is not recommended that internal excalibur methods be overriden, do so at your own risk.\r\n   *\r\n   * @internal\r\n   */\r\n  public _initialize(engine: Engine) {\r\n    if (!this.isInitialized) {\r\n      this.onInitialize(engine);\r\n      super.emit('initialize', new InitializeEvent(engine, this));\r\n      this._isInitialized = true;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * It is not recommended that internal excalibur methods be overriden, do so at your own risk.\r\n   *\r\n   * Internal _preupdate handler for [[onPreUpdate]] lifecycle event\r\n   * @internal\r\n   */\r\n  public _preupdate(engine: Engine, delta: number): void {\r\n    this.emit('preupdate', new PreUpdateEvent(engine, delta, this));\r\n    this.onPreUpdate(engine, delta);\r\n  }\r\n\r\n  /**\r\n   * It is not recommended that internal excalibur methods be overriden, do so at your own risk.\r\n   *\r\n   * Internal _preupdate handler for [[onPostUpdate]] lifecycle event\r\n   * @internal\r\n   */\r\n  public _postupdate(engine: Engine, delta: number): void {\r\n    this.emit('postupdate', new PostUpdateEvent(engine, delta, this));\r\n    this.onPostUpdate(engine, delta);\r\n  }\r\n\r\n  /**\r\n   * `onInitialize` is called before the first update of the entity. This method is meant to be\r\n   * overridden.\r\n   *\r\n   * Synonymous with the event handler `.on('initialize', (evt) => {...})`\r\n   */\r\n  public onInitialize(_engine: Engine): void {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * Safe to override onPreUpdate lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\r\n   *\r\n   * `onPreUpdate` is called directly before an entity is updated.\r\n   */\r\n  public onPreUpdate(_engine: Engine, _delta: number): void {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * Safe to override onPostUpdate lifecycle event handler. Synonymous with `.on('postupdate', (evt) =>{...})`\r\n   *\r\n   * `onPostUpdate` is called directly after an entity is updated.\r\n   */\r\n  public onPostUpdate(_engine: Engine, _delta: number): void {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   *\r\n   * Entity update lifecycle, called internally\r\n   *\r\n   * @internal\r\n   * @param engine\r\n   * @param delta\r\n   */\r\n  public update(engine: Engine, delta: number): void {\r\n    this._initialize(engine);\r\n    this._preupdate(engine, delta);\r\n    for (const child of this.children) {\r\n      child.update(engine, delta);\r\n    }\r\n    this._postupdate(engine, delta);\r\n  }\r\n}\r\n","import { Component } from '../EntityComponentSystem';\r\n\r\n/**\r\n * Shim to draw to the canvas when in LegacyDrawing mode\r\n * @deprecated\r\n */\r\nexport class CanvasDrawComponent extends Component<'ex.canvas'> {\r\n  public readonly type = 'ex.canvas';\r\n\r\n  constructor(public draw?: (ctx: CanvasRenderingContext2D, delta: number) => void) {\r\n    super();\r\n    // eslint-disable-next-line @typescript-eslint/no-empty-function\r\n    this.draw = this.draw ?? (() => {});\r\n  }\r\n}\r\n","import { Vector, vec } from '../Math/vector';\nimport { Graphic } from './Graphic';\nimport { HasTick } from './Animation';\nimport { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\nimport { Logger } from '../Util/Log';\nimport { BoundingBox } from '../Collision/Index';\nimport { Component } from '../EntityComponentSystem/Component';\n\n/**\n * Type guard for checking if a Graphic HasTick (used for graphics that change over time like animations)\n * @param graphic\n */\nexport function hasGraphicsTick(graphic: Graphic): graphic is Graphic & HasTick {\n  return !!(graphic as unknown as HasTick).tick;\n}\nexport interface GraphicsShowOptions {\n  offset?: Vector;\n  anchor?: Vector;\n}\n\nexport interface GraphicsComponentOptions {\n  onPostDraw?: (ex: ExcaliburGraphicsContext, elapsed: number) => void;\n  onPreDraw?: (ex: ExcaliburGraphicsContext, elapsed: number) => void;\n\n  /**\n   * Name of current graphic to use\n   */\n  current?: string;\n\n  /**\n   * Optionally copy instances of graphics by calling .clone(), you may set this to false to avoid sharing graphics when added to the\n   * component for performance reasons. By default graphics are not copied and are shared when added to the component.\n   */\n  copyGraphics?: boolean;\n\n  /**\n   * Optional visible flag, if the graphics component is not visible it will not be displayed\n   */\n  visible?: boolean;\n\n  /**\n   * Optional opacity\n   */\n  opacity?: number;\n\n  /**\n   * List of graphics\n   */\n  graphics?: { [graphicName: string]: Graphic };\n\n  /**\n   * Optional offset in absolute pixels to shift all graphics in this component from each graphic's anchor (default is top left corner)\n   */\n  offset?: Vector;\n\n  /**\n   * Optional anchor\n   */\n  anchor?: Vector;\n}\n\nexport interface GraphicsLayerOptions {\n  /**\n   * Name of the layer required, for example 'background'\n   */\n  name: string;\n  /**\n   * Order of the layer, a layer with order -1 will be below a layer with order of 1\n   */\n  order: number;\n  /**\n   * Offset to shift the entire layer\n   */\n  offset?: Vector;\n}\nexport class GraphicsLayer {\n  public graphics: { graphic: Graphic; options: GraphicsShowOptions }[] = [];\n  constructor(private _options: GraphicsLayerOptions, private _graphics: GraphicsComponent) {}\n  public get name(): string {\n    return this._options.name;\n  }\n\n  /**\n   * Remove any instance(s) of a graphic currently being shown in this layer\n   */\n  public hide(nameOrGraphic: string | Graphic): void;\n  /**\n   * Remove all currently shown graphics in this layer\n   */\n  public hide(): void;\n  public hide(nameOrGraphic?: string | Graphic): void {\n    if (!nameOrGraphic) {\n      this.graphics.length = 0;\n    } else {\n      let gfx: Graphic = null;\n      if (nameOrGraphic instanceof Graphic) {\n        gfx = nameOrGraphic;\n      } else {\n        gfx = this._graphics.getGraphic(nameOrGraphic);\n      }\n      this.graphics = this.graphics.filter((g) => g.graphic !== gfx);\n    }\n  }\n\n  /**\n   * Show a graphic by name or instance at an offset, graphics are shown in the order in which `show()` is called.\n   *\n   * If `show()` is called multiple times for the same graphic it will be shown multiple times.\n   * @param nameOrGraphic\n   * @param options\n   */\n  public show<T extends Graphic = Graphic>(nameOrGraphic: string | T, options?: GraphicsShowOptions): T {\n    options = { ...options };\n    let gfx: Graphic;\n    if (nameOrGraphic instanceof Graphic) {\n      gfx = this._graphics.copyGraphics ? nameOrGraphic.clone() : nameOrGraphic;\n    } else {\n      gfx = this._graphics.getGraphic(nameOrGraphic);\n      if (!gfx) {\n        Logger.getInstance().error(\n          `No such graphic added to component named ${nameOrGraphic}. These named graphics are available: `,\n          this._graphics.getNames()\n        );\n      }\n    }\n    if (gfx) {\n      this.graphics.push({ graphic: gfx, options });\n      return gfx as T;\n    } else {\n      return null;\n    }\n  }\n\n  /**\n   * Use a specific graphic, swap out any current graphics being shown\n   * @param nameOrGraphic\n   * @param options\n   */\n  public use<T extends Graphic = Graphic>(nameOrGraphic: string | T, options?: GraphicsShowOptions): T {\n    options = { ...options };\n    this.hide();\n    return this.show<T>(nameOrGraphic, options);\n  }\n\n  /**\n   * Current order of the layer, higher numbers are on top, lower numbers are on the bottom.\n   *\n   * For example a layer with `order = -1` would be under a layer of `order = 1`\n   */\n  public get order(): number {\n    return this._options.order;\n  }\n\n  /**\n   * Set the order of the layer, higher numbers are on top, lower numbers are on the bottom.\n   *\n   * For example a layer with `order = -1` would be under a layer of `order = 1`\n   */\n  public set order(order: number) {\n    this._options.order = order;\n  }\n\n  /**\n   * Get or set the pixel offset from the layer anchor for all graphics in the layer\n   */\n  public get offset(): Vector {\n    return this._options.offset ?? Vector.Zero;\n  }\n\n  public set offset(value: Vector) {\n    this._options.offset = value;\n  }\n}\n\nexport class GraphicsLayers {\n  private _layers: GraphicsLayer[] = [];\n  private _layerMap: { [layerName: string]: GraphicsLayer } = {};\n  public default: GraphicsLayer;\n  constructor(private _component: GraphicsComponent) {\n    this.default = new GraphicsLayer({ name: 'default', order: 0 }, _component);\n    this._maybeAddLayer(this.default);\n  }\n  public create(options: GraphicsLayerOptions): GraphicsLayer {\n    const layer = new GraphicsLayer(options, this._component);\n    return this._maybeAddLayer(layer);\n  }\n\n  /**\n   * Retrieve a single layer by name\n   * @param name\n   */\n  public get(name: string): GraphicsLayer;\n  /**\n   * Retrieve all layers\n   */\n  public get(): readonly GraphicsLayer[];\n  public get(name?: string): GraphicsLayer | readonly GraphicsLayer[] {\n    if (name) {\n      return this._getLayer(name);\n    }\n    return this._layers;\n  }\n\n  public has(name: string): boolean {\n    return name in this._layerMap;\n  }\n\n  private _maybeAddLayer(layer: GraphicsLayer) {\n    if (this._layerMap[layer.name]) {\n      // todo log warning\n      return this._layerMap[layer.name];\n    }\n    this._layerMap[layer.name] = layer;\n    this._layers.push(layer);\n    this._layers.sort((a, b) => a.order - b.order);\n    return layer;\n  }\n\n  private _getLayer(name: string): GraphicsLayer | undefined {\n    return this._layerMap[name];\n  }\n}\n\n/**\n * Component to manage drawings, using with the position component\n */\nexport class GraphicsComponent extends Component<'ex.graphics'> {\n  readonly type = 'ex.graphics';\n\n  private _graphics: { [graphicName: string]: Graphic } = {};\n\n  public layers: GraphicsLayers;\n\n  public getGraphic(name: string): Graphic | undefined {\n    return this._graphics[name];\n  }\n\n  /**\n   * Get registered graphics names\n   */\n  public getNames(): string[] {\n    return Object.keys(this._graphics);\n  }\n\n  /**\n   * Draws after the entity transform has bene applied, but before graphics component graphics have been drawn\n   */\n  public onPreDraw: (ctx: ExcaliburGraphicsContext, elapsedMilliseconds: number) => void;\n\n  /**\n   * Draws after the entity transform has been applied, and after graphics component graphics has been drawn\n   */\n  public onPostDraw: (ctx: ExcaliburGraphicsContext, elapsedMilliseconds: number) => void;\n\n  /**\n   * Sets or gets wether any drawing should be visible in this component\n   */\n  public visible: boolean = true;\n\n  /**\n   * Sets or gets wither all drawings should have an opacity applied\n   */\n  public opacity: number = 1;\n\n  /**\n   * Offset to apply to graphics by default\n   */\n  public offset: Vector = Vector.Zero;\n\n  /**\n   * Anchor to apply to graphics by default\n   */\n  public anchor: Vector = Vector.Half;\n\n  /**\n   * If set to true graphics added to the component will be copied. This can affect performance\n   */\n  public copyGraphics: boolean = false;\n\n  constructor(options?: GraphicsComponentOptions) {\n    super();\n    // Defaults\n    options = {\n      visible: this.visible,\n      ...options\n    };\n\n    const { current, anchor, opacity, visible, graphics, offset, copyGraphics, onPreDraw, onPostDraw } = options;\n\n    this._graphics = graphics || {};\n    this.offset = offset ?? this.offset;\n    this.opacity = opacity ?? this.opacity;\n    this.anchor = anchor ?? this.anchor;\n    this.copyGraphics = copyGraphics ?? this.copyGraphics;\n    this.onPreDraw = onPreDraw ?? this.onPreDraw;\n    this.onPostDraw = onPostDraw ?? this.onPostDraw;\n    this.visible = !!visible;\n\n    this.layers = new GraphicsLayers(this);\n    if (current && this._graphics[current]) {\n      this.show(this._graphics[current]);\n    }\n  }\n\n  /**\n   * Returns the currently displayed graphics and their offsets, empty array if hidden\n   */\n  public get current(): { graphic: Graphic; options: GraphicsShowOptions }[] {\n    return this.layers.default.graphics;\n  }\n\n  /**\n   * Returns all graphics associated with this component\n   */\n  public get graphics(): { [graphicName: string]: Graphic } {\n    return this._graphics;\n  }\n\n  /**\n   * Adds a named graphic to this component, if the name is \"default\" or not specified, it will be shown by default without needing to call\n   * `show(\"default\")`\n   * @param graphic\n   */\n  public add(graphic: Graphic): Graphic;\n  public add(name: string, graphic: Graphic): Graphic;\n  public add(nameOrGraphic: string | Graphic, graphic?: Graphic): Graphic {\n    let name = 'default';\n    let graphicToSet: Graphic = null;\n    if (typeof nameOrGraphic === 'string') {\n      name = nameOrGraphic;\n      graphicToSet = graphic;\n    } else {\n      graphicToSet = nameOrGraphic;\n    }\n\n    this._graphics[name] = this.copyGraphics ? graphicToSet.clone() : graphicToSet;\n    if (name === 'default') {\n      this.show('default');\n    }\n    return graphicToSet;\n  }\n\n  /**\n   * Show a graphic by name on the **default** layer, returns the new [[Graphic]]\n   */\n  public show<T extends Graphic = Graphic>(nameOrGraphic: string | T, options?: GraphicsShowOptions): T {\n    return this.layers.default.show<T>(nameOrGraphic, options);\n  }\n\n  /**\n   * Use a graphic only, swap out any graphics on the **default** layer, returns the new [[Graphic]]\n   * @param nameOrGraphic\n   * @param options\n   */\n  public use<T extends Graphic = Graphic>(nameOrGraphic: string | T, options?: GraphicsShowOptions): T {\n    return this.layers.default.use<T>(nameOrGraphic, options);\n  }\n\n  /**\n   * Remove any instance(s) of a graphic currently being shown in the **default** layer\n   */\n  public hide(nameOrGraphic: string | Graphic): void;\n  /**\n   * Remove all currently shown graphics in the **default** layer\n   */\n  public hide(): void;\n  public hide(nameOrGraphic?: string | Graphic): void {\n    this.layers.default.hide(nameOrGraphic);\n  }\n\n  private _bounds: BoundingBox = null;\n  public set localBounds(bounds: BoundingBox) {\n    this._bounds = bounds;\n  }\n\n  public get localBounds(): BoundingBox {\n    if (this._bounds) {\n      return this._bounds;\n    }\n    let bb = new BoundingBox();\n    for (const layer of this.layers.get()) {\n      for (const { graphic, options } of layer.graphics) {\n        let anchor = this.anchor;\n        let offset = this.offset;\n        if (options?.anchor) {\n          anchor = options.anchor;\n        }\n        if (options?.offset) {\n          offset = options.offset;\n        }\n        const bounds = graphic.localBounds;\n        const offsetX = -bounds.width * graphic.scale.x * anchor.x + offset.x;\n        const offsetY = -bounds.height * graphic.scale.y * anchor.y + offset.y;\n        bb = graphic?.localBounds.translate(vec(offsetX + layer.offset.x, offsetY + layer.offset.y)).combine(bb);\n      }\n    }\n    return bb;\n  }\n\n  /**\n   * Update underlying graphics if necesary, called internally\n   * @param elapsed\n   * @internal\n   */\n  public update(elapsed: number, idempotencyToken: number = 0) {\n    for (const layer of this.layers.get()) {\n      for (const { graphic } of layer.graphics) {\n        if (hasGraphicsTick(graphic)) {\n          graphic?.tick(elapsed, idempotencyToken);\n        }\n      }\n    }\n  }\n}\n","import { Raster, RasterOptions } from './Raster';\r\n\r\nexport interface RectangleOptions {\r\n  width: number;\r\n  height: number;\r\n}\r\n\r\n/**\r\n * A Rectangle [[Graphic]] for drawing rectangles to the [[ExcaliburGraphicsContext]]\r\n */\r\nexport class Rectangle extends Raster {\r\n  constructor(options: RasterOptions & RectangleOptions) {\r\n    super(options);\r\n    this.width = options.width;\r\n    this.height = options.height;\r\n    this.rasterize();\r\n  }\r\n\r\n  public clone(): Rectangle {\r\n    return new Rectangle({\r\n      width: this.width,\r\n      height: this.height,\r\n      ...this.cloneGraphicOptions(),\r\n      ...this.cloneRasterOptions()\r\n    });\r\n  }\r\n\r\n  execute(ctx: CanvasRenderingContext2D): void {\r\n    if (this.color) {\r\n      ctx.fillRect(0, 0, this.width, this.height);\r\n    }\r\n    if (this.strokeColor) {\r\n      ctx.strokeRect(0, 0, this.width, this.height);\r\n    }\r\n  }\r\n}\r\n","import { Raster, RasterOptions } from './Raster';\r\n\r\nexport interface CircleOptions {\r\n  radius: number;\r\n}\r\n\r\n/**\r\n * A circle [[Graphic]] for drawing circles to the [[ExcaliburGraphicsContext]]\r\n */\r\nexport class Circle extends Raster {\r\n  private _radius: number = 0;\r\n  public get radius() {\r\n    return this._radius;\r\n  }\r\n  public set radius(value: number) {\r\n    this._radius = value;\r\n    this.width = this._radius * 2;\r\n    this.height = this._radius * 2;\r\n    this.flagDirty();\r\n  }\r\n  constructor(options: RasterOptions & CircleOptions) {\r\n    super(options);\r\n    this.padding = options.padding ?? 2; // default 2 padding for circles looks nice\r\n    this.radius = options.radius;\r\n    this.rasterize();\r\n  }\r\n\r\n  public clone(): Circle {\r\n    return new Circle({\r\n      radius: this.radius,\r\n      ...this.cloneGraphicOptions(),\r\n      ...this.cloneRasterOptions()\r\n    });\r\n  }\r\n\r\n  execute(ctx: CanvasRenderingContext2D): void {\r\n    if (this.radius > 0) {\r\n      ctx.beginPath();\r\n      ctx.arc(this.radius, this.radius, this.radius, 0, Math.PI * 2);\r\n\r\n      if (this.color) {\r\n        ctx.fill();\r\n      }\r\n\r\n      if (this.strokeColor) {\r\n        ctx.stroke();\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { Color } from '../Color';\nimport { Vector } from '../Math/vector';\nimport { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\n\n/**\n * Enum representing the different font size units\n * https://developer.mozilla.org/en-US/docs/Web/CSS/font-size\n */\nexport enum FontUnit {\n  /**\n   * Em is a scalable unit, 1 em is equal to the current font size of the current element, parent elements can effect em values\n   */\n  Em = 'em',\n  /**\n   * Rem is similar to the Em, it is a scalable unit. 1 rem is equal to the font size of the root element\n   */\n  Rem = 'rem',\n  /**\n   * Pixel is a unit of length in screen pixels\n   */\n  Px = 'px',\n  /**\n   * Point is a physical unit length (1/72 of an inch)\n   */\n  Pt = 'pt',\n  /**\n   * Percent is a scalable unit similar to Em, the only difference is the Em units scale faster when Text-Size stuff\n   */\n  Percent = '%'\n}\n\n/**\n * Enum representing the different horizontal text alignments\n */\nexport enum TextAlign {\n  /**\n   * The text is left-aligned.\n   */\n  Left = 'left',\n  /**\n   * The text is right-aligned.\n   */\n  Right = 'right',\n  /**\n   * The text is centered.\n   */\n  Center = 'center',\n  /**\n   * The text is aligned at the normal start of the line (left-aligned for left-to-right locales,\n   * right-aligned for right-to-left locales).\n   */\n  Start = 'start',\n  /**\n   * The text is aligned at the normal end of the line (right-aligned for left-to-right locales,\n   * left-aligned for right-to-left locales).\n   */\n  End = 'end'\n}\n\n/**\n * Enum representing the different baseline text alignments\n */\nexport enum BaseAlign {\n  /**\n   * The text baseline is the top of the em square.\n   */\n  Top = 'top',\n  /**\n   * The text baseline is the hanging baseline.  Currently unsupported; this will act like\n   * alphabetic.\n   */\n  Hanging = 'hanging',\n  /**\n   * The text baseline is the middle of the em square.\n   */\n  Middle = 'middle',\n  /**\n   * The text baseline is the normal alphabetic baseline.\n   */\n  Alphabetic = 'alphabetic',\n  /**\n   * The text baseline is the ideographic baseline; this is the bottom of\n   * the body of the characters, if the main body of characters protrudes\n   * beneath the alphabetic baseline.  Currently unsupported; this will\n   * act like alphabetic.\n   */\n  Ideographic = 'ideographic',\n  /**\n   * The text baseline is the bottom of the bounding box.  This differs\n   * from the ideographic baseline in that the ideographic baseline\n   * doesn't consider descenders.\n   */\n  Bottom = 'bottom'\n}\n\n/**\n * Enum representing the different possible font styles\n */\nexport enum FontStyle {\n  Normal = 'normal',\n  Italic = 'italic',\n  Oblique = 'oblique'\n}\n\nexport enum Direction {\n  LeftToRight = 'ltr',\n  RightToLeft = 'rtl'\n}\n\nexport interface FontOptions {\n  size?: number;\n  unit?: FontUnit;\n  lineHeight?: number;\n  family?: string;\n  style?: FontStyle;\n  bold?: boolean;\n  textAlign?: TextAlign;\n  baseAlign?: BaseAlign;\n  direction?: Direction;\n  quality?: number;\n  shadow?: {\n    blur?: number;\n    offset?: Vector;\n    color?: Color;\n  };\n}\n\nexport interface FontRenderer {\n  render(ex: ExcaliburGraphicsContext, text: string, x: number, y: number): void;\n}\n","import { Texture } from './Drawing/Texture';\r\nimport {\r\n  InitializeEvent,\r\n  KillEvent,\r\n  PreUpdateEvent,\r\n  PostUpdateEvent,\r\n  PreDrawEvent,\r\n  PostDrawEvent,\r\n  PreDebugDrawEvent,\r\n  PostDebugDrawEvent,\r\n  PostCollisionEvent,\r\n  PreCollisionEvent,\r\n  CollisionStartEvent,\r\n  CollisionEndEvent,\r\n  PostKillEvent,\r\n  PreKillEvent,\r\n  GameEvent,\r\n  ExitTriggerEvent,\r\n  EnterTriggerEvent,\r\n  EnterViewPortEvent,\r\n  ExitViewPortEvent\r\n} from './Events';\r\nimport { PointerEvent, WheelEvent, PointerDragEvent, PointerEventName } from './Input/PointerEvents';\r\nimport { Engine } from './Engine';\r\nimport { Color } from './Color';\r\nimport { Sprite } from './Drawing/Sprite';\r\nimport { Animation } from './Drawing/Animation';\r\nimport { Trait } from './Interfaces/Trait';\r\nimport { Drawable } from './Interfaces/Drawable';\r\nimport { CanInitialize, CanUpdate, CanDraw, CanBeKilled } from './Interfaces/LifecycleEvents';\r\nimport { Scene } from './Scene';\r\nimport { Logger } from './Util/Log';\r\nimport { ActionContext } from './Actions/ActionContext';\r\nimport { Vector, vec } from './Math/vector';\r\nimport { BodyComponent } from './Collision/BodyComponent';\r\nimport { Eventable } from './Interfaces/Evented';\r\nimport { Actionable } from './Actions/Actionable';\r\nimport * as Traits from './Traits/Index';\r\nimport * as Events from './Events';\r\nimport { PointerEvents } from './Interfaces/PointerEventHandlers';\r\nimport { CollisionType } from './Collision/CollisionType';\r\n\r\nimport { Entity } from './EntityComponentSystem/Entity';\r\nimport { CanvasDrawComponent } from './Drawing/CanvasDrawComponent';\r\nimport { TransformComponent } from './EntityComponentSystem/Components/TransformComponent';\r\nimport { MotionComponent } from './EntityComponentSystem/Components/MotionComponent';\r\nimport { GraphicsComponent } from './Graphics/GraphicsComponent';\r\nimport { Rectangle } from './Graphics/Rectangle';\r\nimport { Flags, Legacy } from './Flags';\r\nimport { obsolete } from './Util/Decorators';\r\nimport { ColliderComponent } from './Collision/ColliderComponent';\r\nimport { Shape } from './Collision/Colliders/Shape';\r\nimport { watch } from './Util/Watch';\r\nimport { Collider, CollisionGroup } from './Collision/Index';\r\nimport { Circle } from './Graphics/Circle';\r\nimport { CapturePointerConfig } from './Input/CapturePointerConfig';\r\n\r\n/**\r\n * Type guard for checking if something is an Actor\r\n * @param x\r\n */\r\nexport function isActor(x: any): x is Actor {\r\n  return x instanceof Actor;\r\n}\r\n\r\n/**\r\n * Actor contructor options\r\n */\r\nexport interface ActorArgs {\r\n  /**\r\n   * Optionally set the name of the actor, default is 'anonymous'\r\n   */\r\n  name?: string;\r\n  /**\r\n   * Optionally set the x position of the actor, default is 0\r\n   */\r\n  x?: number;\r\n  /**\r\n   * Optionally set the y position of the actor, default is 0\r\n   */\r\n  y?: number;\r\n  /**\r\n   * Optionaly set the (x, y) position of the actor as a vector, default is (0, 0)\r\n   */\r\n  pos?: Vector;\r\n  /**\r\n   * Optionally set the width of a box collider for the actor\r\n   */\r\n  width?: number;\r\n  /**\r\n   * Optionally set the height of a box collider for the actor\r\n   */\r\n  height?: number;\r\n  /**\r\n   * Optionally set the radius of the circle collider for the actor\r\n   */\r\n  radius?: number;\r\n  /**\r\n   * Optionally set the velocity of the actor in pixels/sec\r\n   */\r\n  vel?: Vector;\r\n  /**\r\n   * Optionally set the acceleration of the actor in pixels/sec^2\r\n   */\r\n  acc?: Vector;\r\n  /**\r\n   * Optionally se the rotation in radians (180 degrees = Math.PI radians)\r\n   */\r\n  rotation?: number;\r\n  /**\r\n   * Optionally set the angular velocity of the actor in radians/sec (180 degrees = Math.PI radians)\r\n   */\r\n  angularVelocity?: number;\r\n  /**\r\n   * Optionally set the scale of the actor's transform\r\n   */\r\n  scale?: Vector;\r\n  /**\r\n   * Optionally set the z index of the actor, default is 0\r\n   */\r\n  z?: number;\r\n  /**\r\n   * Optionally set the color of an actor, only used if no graphics are present\r\n   * If a width/height or a radius was set a default graphic will be added\r\n   */\r\n  color?: Color;\r\n  /**\r\n   * Optionally set the visibility of the actor\r\n   */\r\n  visible?: boolean;\r\n  /**\r\n   * Optionally set the anchor for graphics in the actor\r\n   */\r\n  anchor?: Vector;\r\n  /**\r\n   * Optionally set the collision type\r\n   */\r\n  collisionType?: CollisionType;\r\n  /**\r\n   * Optionally supply a collider for an actor, if supplied ignores any supplied width/height\r\n   */\r\n  collider?: Collider;\r\n  /**\r\n   * Optionally suppy a [[CollisionGroup]]\r\n   */\r\n  collisionGroup?: CollisionGroup;\r\n}\r\n\r\n/**\r\n * The most important primitive in Excalibur is an `Actor`. Anything that\r\n * can move on the screen, collide with another `Actor`, respond to events,\r\n * or interact with the current scene, must be an actor. An `Actor` **must**\r\n * be part of a [[Scene]] for it to be drawn to the screen.\r\n */\r\nexport class Actor extends Entity implements Actionable, Eventable, PointerEvents, CanInitialize, CanUpdate, CanDraw, CanBeKilled {\r\n  // #region Properties\r\n\r\n  /**\r\n   * Set defaults for all Actors\r\n   */\r\n  public static defaults = {\r\n    anchor: Vector.Half\r\n  };\r\n\r\n  /**\r\n   * The physics body the is associated with this actor. The body is the container for all physical properties, like position, velocity,\r\n   * acceleration, mass, inertia, etc.\r\n   */\r\n  public get body(): BodyComponent {\r\n    return this.get(BodyComponent);\r\n  }\r\n\r\n  /**\r\n   * Access the Actor's built in [[TransformComponent]]\r\n   */\r\n  public get transform(): TransformComponent {\r\n    return this.get(TransformComponent);\r\n  }\r\n\r\n  /**\r\n   * Access the Actor's built in [[MotionComponent]]\r\n   */\r\n  public get motion(): MotionComponent {\r\n    return this.get(MotionComponent);\r\n  }\r\n\r\n  /**\r\n   * Access to the Actor's built in [[GraphicsComponent]]\r\n   */\r\n  public get graphics(): GraphicsComponent {\r\n    return this.get(GraphicsComponent);\r\n  }\r\n\r\n  /**\r\n   * Access to the Actor's build in [[ColliderComponent]]\r\n   */\r\n  public get collider(): ColliderComponent {\r\n    return this.get(ColliderComponent);\r\n  }\r\n\r\n  /**\r\n   * Gets the position vector of the actor in pixels\r\n   */\r\n  public get pos(): Vector {\r\n    return this.transform.pos;\r\n  }\r\n\r\n  /**\r\n   * Sets the position vector of the actor in pixels\r\n   */\r\n  public set pos(thePos: Vector) {\r\n    this.transform.pos = thePos.clone();\r\n  }\r\n\r\n  /**\r\n   * Gets the position vector of the actor from the last frame\r\n   */\r\n  public get oldPos(): Vector {\r\n    return this.body.oldPos;\r\n  }\r\n\r\n  /**\r\n   * Sets the position vector of the actor in the last frame\r\n   */\r\n  public set oldPos(thePos: Vector) {\r\n    this.body.oldPos.setTo(thePos.x, thePos.y);\r\n  }\r\n\r\n  /**\r\n   * Gets the velocity vector of the actor in pixels/sec\r\n   */\r\n  public get vel(): Vector {\r\n    return this.motion.vel;\r\n  }\r\n\r\n  /**\r\n   * Sets the velocity vector of the actor in pixels/sec\r\n   */\r\n  public set vel(theVel: Vector) {\r\n    this.motion.vel = theVel.clone();\r\n  }\r\n\r\n  /**\r\n   * Gets the velocity vector of the actor from the last frame\r\n   */\r\n  public get oldVel(): Vector {\r\n    return this.body.oldVel;\r\n  }\r\n\r\n  /**\r\n   * Sets the velocity vector of the actor from the last frame\r\n   */\r\n  public set oldVel(theVel: Vector) {\r\n    this.body.oldVel.setTo(theVel.x, theVel.y);\r\n  }\r\n\r\n  /**\r\n   * Gets the acceleration vector of the actor in pixels/second/second. An acceleration pointing down such as (0, 100) may be\r\n   * useful to simulate a gravitational effect.\r\n   */\r\n  public get acc(): Vector {\r\n    return this.motion.acc;\r\n  }\r\n\r\n  /**\r\n   * Sets the acceleration vector of teh actor in pixels/second/second\r\n   */\r\n  public set acc(theAcc: Vector) {\r\n    this.motion.acc = theAcc.clone();\r\n  }\r\n\r\n  /**\r\n   * Sets the acceleration of the actor from the last frame. This does not include the global acc [[Physics.acc]].\r\n   */\r\n  public set oldAcc(theAcc: Vector) {\r\n    this.body.oldAcc.setTo(theAcc.x, theAcc.y);\r\n  }\r\n\r\n  /**\r\n   * Gets the acceleration of the actor from the last frame. This does not include the global acc [[Physics.acc]].\r\n   */\r\n  public get oldAcc(): Vector {\r\n    return this.body.oldAcc;\r\n  }\r\n\r\n  /**\r\n   * Gets the rotation of the actor in radians. 1 radian = 180/PI Degrees.\r\n   */\r\n  public get rotation(): number {\r\n    return this.transform.rotation;\r\n  }\r\n\r\n  /**\r\n   * Sets the rotation of the actor in radians. 1 radian = 180/PI Degrees.\r\n   */\r\n  public set rotation(theAngle: number) {\r\n    this.transform.rotation = theAngle;\r\n  }\r\n\r\n  /**\r\n   * Gets the rotational velocity of the actor in radians/second\r\n   */\r\n  public get angularVelocity(): number {\r\n    return this.motion.angularVelocity;\r\n  }\r\n\r\n  /**\r\n   * Sets the rotational velocity of the actor in radians/sec\r\n   */\r\n  public set angularVelocity(angularVelocity: number) {\r\n    this.motion.angularVelocity = angularVelocity;\r\n  }\r\n\r\n  public get scale(): Vector {\r\n    return this.get(TransformComponent).scale;\r\n  }\r\n\r\n  public set scale(scale: Vector) {\r\n    this.get(TransformComponent).scale = scale;\r\n  }\r\n\r\n  /**\r\n   * The anchor to apply all actor related transformations like rotation,\r\n   * translation, and scaling. By default the anchor is in the center of\r\n   * the actor. By default it is set to the center of the actor (.5, .5)\r\n   *\r\n   * An anchor of (.5, .5) will ensure that drawings are centered.\r\n   *\r\n   * Use `anchor.setTo` to set the anchor to a different point using\r\n   * values between 0 and 1. For example, anchoring to the top-left would be\r\n   * `Actor.anchor.setTo(0, 0)` and top-right would be `Actor.anchor.setTo(0, 1)`.\r\n   */\r\n  private _anchor: Vector = watch(Vector.Half, (v) => this._handleAnchorChange(v));\r\n  public get anchor(): Vector {\r\n    return this._anchor;\r\n  }\r\n\r\n  public set anchor(vec: Vector) {\r\n    this._anchor = watch(vec, (v) => this._handleAnchorChange(v));\r\n    this._handleAnchorChange(vec);\r\n  }\r\n\r\n  private _handleAnchorChange(v: Vector) {\r\n    if (this.graphics) {\r\n      this.graphics.anchor = v;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Indicates whether the actor is physically in the viewport\r\n   */\r\n  public get isOffScreen(): boolean {\r\n    return this.hasTag('offscreen');\r\n  }\r\n  /**\r\n   * The visibility of an actor\r\n   * @deprecated Use [[GraphicsComponent.visible|Actor.graphics.visible]], will be removed in v0.26.0\r\n   */\r\n  @obsolete({ message: 'Actor.visible will be removed in v0.26.0', alternateMethod: 'Use Actor.graphics.visible' })\r\n  public get visible(): boolean {\r\n    return this.graphics.visible;\r\n  }\r\n\r\n  public set visible(isVisible: boolean) {\r\n    this.graphics.visible = isVisible;\r\n  }\r\n\r\n  /**\r\n   * The opacity of an actor.\r\n   *\r\n   * @deprecated Actor.opacity will be removed in v0.26.0, use [[GraphicsComponent.opacity|Actor.graphics.opacity]].\r\n   */\r\n  @obsolete({\r\n    message: 'Actor.opacity will be removed in v0.26.0',\r\n    alternateMethod: 'Use Actor.graphics.opacity'\r\n  })\r\n  public get opacity(): number {\r\n    return this.graphics.opacity;\r\n  }\r\n\r\n  public set opacity(opacity: number) {\r\n    this.graphics.opacity = opacity;\r\n  }\r\n\r\n  /**\r\n   * [[ActionContext|Action context]] of the actor. Useful for scripting actor behavior.\r\n   */\r\n  public actions: ActionContext;\r\n\r\n  /**\r\n   * Convenience reference to the global logger\r\n   */\r\n  public logger: Logger = Logger.getInstance();\r\n\r\n  /**\r\n   * The scene that the actor is in\r\n   */\r\n  public scene: Scene = null;\r\n\r\n  public frames: { [key: string]: Drawable } = {};\r\n\r\n  /**\r\n   * Access to the current drawing for the actor, this can be\r\n   * an [[Animation]], [[Sprite]], or [[Polygon]].\r\n   * Set drawings with [[setDrawing]].\r\n   * @deprecated\r\n   */\r\n  public currentDrawing: Drawable = null;\r\n\r\n  /**\r\n   * Draggable helper\r\n   */\r\n  private _draggable: boolean = false;\r\n  private _dragging: boolean = false;\r\n\r\n  private _pointerDragStartHandler = () => {\r\n    this._dragging = true;\r\n  };\r\n\r\n  private _pointerDragEndHandler = () => {\r\n    this._dragging = false;\r\n  };\r\n\r\n  private _pointerDragMoveHandler = (pe: PointerEvent) => {\r\n    if (this._dragging) {\r\n      this.pos = pe.pointer.lastWorldPos;\r\n    }\r\n  };\r\n\r\n  private _pointerDragLeaveHandler = (pe: PointerEvent) => {\r\n    if (this._dragging) {\r\n      this.pos = pe.pointer.lastWorldPos;\r\n    }\r\n  };\r\n\r\n  public get draggable(): boolean {\r\n    return this._draggable;\r\n  }\r\n\r\n  public set draggable(isDraggable: boolean) {\r\n    if (isDraggable) {\r\n      if (isDraggable && !this._draggable) {\r\n        this.on('pointerdragstart', this._pointerDragStartHandler);\r\n        this.on('pointerdragend', this._pointerDragEndHandler);\r\n        this.on('pointerdragmove', this._pointerDragMoveHandler);\r\n        this.on('pointerdragleave', this._pointerDragLeaveHandler);\r\n      } else if (!isDraggable && this._draggable) {\r\n        this.off('pointerdragstart', this._pointerDragStartHandler);\r\n        this.off('pointerdragend', this._pointerDragEndHandler);\r\n        this.off('pointerdragmove', this._pointerDragMoveHandler);\r\n        this.off('pointerdragleave', this._pointerDragLeaveHandler);\r\n      }\r\n\r\n      this._draggable = isDraggable;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Modify the current actor update pipeline.\r\n   */\r\n  public traits: Trait[] = [];\r\n\r\n  /**\r\n   * Sets the color of the actor. A rectangle of this color will be\r\n   * drawn if no [[Drawable]] is specified as the actors drawing.\r\n   *\r\n   * The default is `null` which prevents a rectangle from being drawn.\r\n   */\r\n  public get color(): Color {\r\n    return this._color;\r\n  }\r\n  public set color(v: Color) {\r\n    this._color = v.clone();\r\n  }\r\n  private _color: Color;\r\n\r\n  /**\r\n   * Whether or not to enable the [[Traits.CapturePointer]] trait that propagates\r\n   * pointer events to this actor\r\n   */\r\n  public enableCapturePointer: boolean = false;\r\n\r\n  /**\r\n   * Configuration for [[Traits.CapturePointer]] trait\r\n   */\r\n  public capturePointer: CapturePointerConfig = {\r\n    captureMoveEvents: false,\r\n    captureDragEvents: false\r\n  };\r\n\r\n  // #endregion\r\n\r\n  /**\r\n   *\r\n   * @param config\r\n   */\r\n  constructor(config?: ActorArgs) {\r\n    super();\r\n\r\n    const {\r\n      name,\r\n      x,\r\n      y,\r\n      pos,\r\n      scale,\r\n      width,\r\n      height,\r\n      radius,\r\n      collider,\r\n      vel,\r\n      acc,\r\n      rotation,\r\n      angularVelocity,\r\n      z,\r\n      color,\r\n      visible,\r\n      anchor,\r\n      collisionType,\r\n      collisionGroup\r\n    } = {\r\n      ...config\r\n    };\r\n\r\n    this._setName(name);\r\n    this.anchor = anchor ?? Actor.defaults.anchor.clone();\r\n\r\n    this.addComponent(new TransformComponent());\r\n    this.pos = pos ?? vec(x ?? 0, y ?? 0);\r\n    this.rotation = rotation ?? 0;\r\n    this.scale = scale ?? vec(1, 1);\r\n    this.z = z ?? 0;\r\n\r\n    this.addComponent(new GraphicsComponent());\r\n    this.addComponent(new CanvasDrawComponent((ctx, delta) => this.draw(ctx, delta)));\r\n    this.addComponent(new MotionComponent());\r\n    this.vel = vel ?? Vector.Zero;\r\n    this.acc = acc ?? Vector.Zero;\r\n    this.angularVelocity = angularVelocity ?? 0;\r\n\r\n    this.addComponent(new BodyComponent());\r\n    this.body.collisionType = collisionType ?? CollisionType.Passive;\r\n    if (collisionGroup) {\r\n      this.body.group = collisionGroup;\r\n    }\r\n\r\n    if (collider) {\r\n      this.addComponent(new ColliderComponent(collider));\r\n    } else if (radius) {\r\n      this.addComponent(new ColliderComponent(Shape.Circle(radius, this.anchor)));\r\n    } else {\r\n      if (width > 0 && height > 0) {\r\n        this.addComponent(new ColliderComponent(Shape.Box(width, height, this.anchor)));\r\n      } else {\r\n        this.addComponent(new ColliderComponent()); // no collider\r\n      }\r\n    }\r\n\r\n    this.graphics.visible = visible ?? true;\r\n\r\n    if (color) {\r\n      this.color = color;\r\n      if (width && height) {\r\n        this.graphics.add(\r\n          new Rectangle({\r\n            color: color,\r\n            width,\r\n            height\r\n          })\r\n        );\r\n      } else if (radius) {\r\n        this.graphics.add(\r\n          new Circle({\r\n            color: color,\r\n            radius\r\n          })\r\n        );\r\n      }\r\n    }\r\n\r\n    // Build default pipeline\r\n    if (Flags.isEnabled(Legacy.LegacyDrawing)) {\r\n      // TODO remove offscreen trait after legacy drawing removed\r\n      this.traits.push(new Traits.OffscreenCulling());\r\n    }\r\n    this.traits.push(new Traits.CapturePointer());\r\n\r\n    // Build the action queue\r\n    this.actions = new ActionContext(this);\r\n  }\r\n\r\n  /**\r\n   * `onInitialize` is called before the first update of the actor. This method is meant to be\r\n   * overridden. This is where initialization of child actors should take place.\r\n   *\r\n   * Synonymous with the event handler `.on('initialize', (evt) => {...})`\r\n   */\r\n  public onInitialize(_engine: Engine): void {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * Initializes this actor and all it's child actors, meant to be called by the Scene before first update not by users of Excalibur.\r\n   *\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * @internal\r\n   */\r\n  public _initialize(engine: Engine) {\r\n    super._initialize(engine);\r\n    for (const child of this.children) {\r\n      child._initialize(engine);\r\n    }\r\n  }\r\n\r\n  // #region Events\r\n\r\n  private _capturePointerEvents: PointerEventName[] = [\r\n    'pointerup',\r\n    'pointerdown',\r\n    'pointermove',\r\n    'pointerenter',\r\n    'pointerleave',\r\n    'pointerdragstart',\r\n    'pointerdragend',\r\n    'pointerdragmove',\r\n    'pointerdragenter',\r\n    'pointerdragleave'\r\n  ];\r\n\r\n  private _captureMoveEvents: PointerEventName[] = [\r\n    'pointermove',\r\n    'pointerenter',\r\n    'pointerleave',\r\n    'pointerdragmove',\r\n    'pointerdragenter',\r\n    'pointerdragleave'\r\n  ];\r\n\r\n  private _captureDragEvents: PointerEventName[] = [\r\n    'pointerdragstart',\r\n    'pointerdragend',\r\n    'pointerdragmove',\r\n    'pointerdragenter',\r\n    'pointerdragleave'\r\n  ];\r\n\r\n  private _checkForPointerOptIn(eventName: string) {\r\n    if (eventName) {\r\n      const normalized = <PointerEventName>eventName.toLowerCase();\r\n\r\n      if (this._capturePointerEvents.indexOf(normalized) !== -1) {\r\n        this.enableCapturePointer = true;\r\n\r\n        if (this._captureMoveEvents.indexOf(normalized) !== -1) {\r\n          this.capturePointer.captureMoveEvents = true;\r\n        }\r\n\r\n        if (this._captureDragEvents.indexOf(normalized) !== -1) {\r\n          this.capturePointer.captureDragEvents = true;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  public on(eventName: Events.exittrigger, handler: (event: ExitTriggerEvent) => void): void;\r\n  public on(eventName: Events.entertrigger, handler: (event: EnterTriggerEvent) => void): void;\r\n  /**\r\n   * The **collisionstart** event is fired when a [[BodyComponent|physics body]], usually attached to an actor,\r\n   *  first starts colliding with another [[BodyComponent|body]], and will not fire again while in contact until\r\n   *  the the pair separates and collides again.\r\n   * Use cases for the **collisionstart** event may be detecting when an actor has touched a surface\r\n   * (like landing) or if a item has been touched and needs to be picked up.\r\n   */\r\n  public on(eventName: Events.collisionstart, handler: (event: CollisionStartEvent) => void): void;\r\n  /**\r\n   * The **collisionend** event is fired when two [[BodyComponent|physics bodies]] are no longer in contact.\r\n   * This event will not fire again until another collision and separation.\r\n   *\r\n   * Use cases for the **collisionend** event might be to detect when an actor has left a surface\r\n   * (like jumping) or has left an area.\r\n   */\r\n  public on(eventName: Events.collisionend, handler: (event: CollisionEndEvent) => void): void;\r\n  /**\r\n   * The **precollision** event is fired **every frame** where a collision pair is found and two\r\n   * bodies are intersecting.\r\n   *\r\n   * This event is useful for building in custom collision resolution logic in Passive-Passive or\r\n   * Active-Passive scenarios. For example in a breakout game you may want to tweak the angle of\r\n   * ricochet of the ball depending on which side of the paddle you hit.\r\n   */\r\n  public on(eventName: Events.precollision, handler: (event: PreCollisionEvent) => void): void;\r\n  /**\r\n   * The **postcollision** event is fired for **every frame** where collision resolution was performed.\r\n   * Collision resolution is when two bodies influence each other and cause a response like bouncing\r\n   * off one another. It is only possible to have *postcollision* event in Active-Active and Active-Fixed\r\n   * type collision pairs.\r\n   *\r\n   * Post collision would be useful if you need to know that collision resolution is happening or need to\r\n   * tweak the default resolution.\r\n   */\r\n  public on(eventName: Events.postcollision, handler: (event: PostCollisionEvent) => void): void;\r\n  public on(eventName: Events.kill, handler: (event: KillEvent) => void): void;\r\n  public on(eventName: Events.prekill, handler: (event: PreKillEvent) => void): void;\r\n  public on(eventName: Events.postkill, handler: (event: PostKillEvent) => void): void;\r\n  public on(eventName: Events.initialize, handler: (event: InitializeEvent<Actor>) => void): void;\r\n  public on(eventName: Events.preupdate, handler: (event: PreUpdateEvent<Actor>) => void): void;\r\n  public on(eventName: Events.postupdate, handler: (event: PostUpdateEvent<Actor>) => void): void;\r\n  public on(eventName: Events.predraw, handler: (event: PreDrawEvent) => void): void;\r\n  public on(eventName: Events.postdraw, handler: (event: PostDrawEvent) => void): void;\r\n  public on(eventName: Events.predebugdraw, handler: (event: PreDebugDrawEvent) => void): void;\r\n  public on(eventName: Events.postdebugdraw, handler: (event: PostDebugDrawEvent) => void): void;\r\n  public on(eventName: Events.pointerup, handler: (event: PointerEvent) => void): void;\r\n  public on(eventName: Events.pointerdown, handler: (event: PointerEvent) => void): void;\r\n  public on(eventName: Events.pointerenter, handler: (event: PointerEvent) => void): void;\r\n  public on(eventName: Events.pointerleave, handler: (event: PointerEvent) => void): void;\r\n  public on(eventName: Events.pointermove, handler: (event: PointerEvent) => void): void;\r\n  public on(eventName: Events.pointercancel, handler: (event: PointerEvent) => void): void;\r\n  public on(eventName: Events.pointerwheel, handler: (event: WheelEvent) => void): void;\r\n  public on(eventName: Events.pointerdragstart, handler: (event: PointerDragEvent) => void): void;\r\n  public on(eventName: Events.pointerdragend, handler: (event: PointerDragEvent) => void): void;\r\n  public on(eventName: Events.pointerdragenter, handler: (event: PointerDragEvent) => void): void;\r\n  public on(eventName: Events.pointerdragleave, handler: (event: PointerDragEvent) => void): void;\r\n  public on(eventName: Events.pointerdragmove, handler: (event: PointerDragEvent) => void): void;\r\n  public on(eventName: Events.enterviewport, handler: (event: EnterViewPortEvent) => void): void;\r\n  public on(eventName: Events.exitviewport, handler: (event: ExitViewPortEvent) => void): void;\r\n  public on(eventName: string, handler: (event: GameEvent<Actor>) => void): void;\r\n  public on(eventName: string, handler: (event: any) => void): void {\r\n    this._checkForPointerOptIn(eventName);\r\n    super.on(eventName, handler);\r\n  }\r\n\r\n  public once(eventName: Events.exittrigger, handler: (event: ExitTriggerEvent) => void): void;\r\n  public once(eventName: Events.entertrigger, handler: (event: EnterTriggerEvent) => void): void;\r\n  /**\r\n   * The **collisionstart** event is fired when a [[BodyComponent|physics body]], usually attached to an actor,\r\n   *  first starts colliding with another [[BodyComponent|body]], and will not fire again while in contact until\r\n   *  the the pair separates and collides again.\r\n   * Use cases for the **collisionstart** event may be detecting when an actor has touch a surface\r\n   * (like landing) or if a item has been touched and needs to be picked up.\r\n   */\r\n  public once(eventName: Events.collisionstart, handler: (event: CollisionStartEvent) => void): void;\r\n  /**\r\n   * The **collisionend** event is fired when two [[BodyComponent|physics bodies]] are no longer in contact.\r\n   * This event will not fire again until another collision and separation.\r\n   *\r\n   * Use cases for the **collisionend** event might be to detect when an actor has left a surface\r\n   * (like jumping) or has left an area.\r\n   */\r\n  public once(eventName: Events.collisionend, handler: (event: CollisionEndEvent) => void): void;\r\n  /**\r\n   * The **precollision** event is fired **every frame** where a collision pair is found and two\r\n   * bodies are intersecting.\r\n   *\r\n   * This event is useful for building in custom collision resolution logic in Passive-Passive or\r\n   * Active-Passive scenarios. For example in a breakout game you may want to tweak the angle of\r\n   * ricochet of the ball depending on which side of the paddle you hit.\r\n   */\r\n  public once(eventName: Events.precollision, handler: (event: PreCollisionEvent) => void): void;\r\n  /**\r\n   * The **postcollision** event is fired for **every frame** where collision resolution was performed.\r\n   * Collision resolution is when two bodies influence each other and cause a response like bouncing\r\n   * off one another. It is only possible to have *postcollision* event in Active-Active and Active-Fixed\r\n   * type collision pairs.\r\n   *\r\n   * Post collision would be useful if you need to know that collision resolution is happening or need to\r\n   * tweak the default resolution.\r\n   */\r\n  public once(eventName: Events.postcollision, handler: (event: PostCollisionEvent) => void): void;\r\n  public once(eventName: Events.kill, handler: (event: KillEvent) => void): void;\r\n  public once(eventName: Events.postkill, handler: (event: PostKillEvent) => void): void;\r\n  public once(eventName: Events.prekill, handler: (event: PreKillEvent) => void): void;\r\n  public once(eventName: Events.initialize, handler: (event: InitializeEvent<Actor>) => void): void;\r\n  public once(eventName: Events.preupdate, handler: (event: PreUpdateEvent<Actor>) => void): void;\r\n  public once(eventName: Events.postupdate, handler: (event: PostUpdateEvent<Actor>) => void): void;\r\n  public once(eventName: Events.predraw, handler: (event: PreDrawEvent) => void): void;\r\n  public once(eventName: Events.postdraw, handler: (event: PostDrawEvent) => void): void;\r\n  public once(eventName: Events.predebugdraw, handler: (event: PreDebugDrawEvent) => void): void;\r\n  public once(eventName: Events.postdebugdraw, handler: (event: PostDebugDrawEvent) => void): void;\r\n  public once(eventName: Events.pointerup, handler: (event: PointerEvent) => void): void;\r\n  public once(eventName: Events.pointerdown, handler: (event: PointerEvent) => void): void;\r\n  public once(eventName: Events.pointerenter, handler: (event: PointerEvent) => void): void;\r\n  public once(eventName: Events.pointerleave, handler: (event: PointerEvent) => void): void;\r\n  public once(eventName: Events.pointermove, handler: (event: PointerEvent) => void): void;\r\n  public once(eventName: Events.pointercancel, handler: (event: PointerEvent) => void): void;\r\n  public once(eventName: Events.pointerwheel, handler: (event: WheelEvent) => void): void;\r\n  public once(eventName: Events.pointerdragstart, handler: (event: PointerDragEvent) => void): void;\r\n  public once(eventName: Events.pointerdragend, handler: (event: PointerDragEvent) => void): void;\r\n  public once(eventName: Events.pointerdragenter, handler: (event: PointerDragEvent) => void): void;\r\n  public once(eventName: Events.pointerdragleave, handler: (event: PointerDragEvent) => void): void;\r\n  public once(eventName: Events.pointerdragmove, handler: (event: PointerDragEvent) => void): void;\r\n  public once(eventName: Events.enterviewport, handler: (event: EnterViewPortEvent) => void): void;\r\n  public once(eventName: Events.exitviewport, handler: (event: ExitViewPortEvent) => void): void;\r\n  public once(eventName: string, handler: (event: GameEvent<Actor>) => void): void;\r\n  public once(eventName: string, handler: (event: any) => void): void {\r\n    this._checkForPointerOptIn(eventName);\r\n    super.once(eventName, handler);\r\n  }\r\n\r\n  public off(eventName: Events.exittrigger, handler?: (event: ExitTriggerEvent) => void): void;\r\n  public off(eventName: Events.entertrigger, handler?: (event: EnterTriggerEvent) => void): void;\r\n  /**\r\n   * The **collisionstart** event is fired when a [[BodyComponent|physics body]], usually attached to an actor,\r\n   *  first starts colliding with another [[BodyComponent|body]], and will not fire again while in contact until\r\n   *  the the pair separates and collides again.\r\n   * Use cases for the **collisionstart** event may be detecting when an actor has touch a surface\r\n   * (like landing) or if a item has been touched and needs to be picked up.\r\n   */\r\n  public off(eventName: Events.collisionstart, handler?: (event: CollisionStartEvent) => void): void;\r\n  /**\r\n   * The **collisionend** event is fired when two [[BodyComponent|physics bodies]] are no longer in contact.\r\n   * This event will not fire again until another collision and separation.\r\n   *\r\n   * Use cases for the **collisionend** event might be to detect when an actor has left a surface\r\n   * (like jumping) or has left an area.\r\n   */\r\n  public off(eventName: Events.collisionend, handler?: (event: CollisionEndEvent) => void): void;\r\n  /**\r\n   * The **precollision** event is fired **every frame** where a collision pair is found and two\r\n   * bodies are intersecting.\r\n   *\r\n   * This event is useful for building in custom collision resolution logic in Passive-Passive or\r\n   * Active-Passive scenarios. For example in a breakout game you may want to tweak the angle of\r\n   * ricochet of the ball depending on which side of the paddle you hit.\r\n   */\r\n  public off(eventName: Events.precollision, handler?: (event: PreCollisionEvent) => void): void;\r\n  /**\r\n   * The **postcollision** event is fired for **every frame** where collision resolution was performed.\r\n   * Collision resolution is when two bodies influence each other and cause a response like bouncing\r\n   * off one another. It is only possible to have *postcollision* event in Active-Active and Active-Fixed\r\n   * type collision pairs.\r\n   *\r\n   * Post collision would be useful if you need to know that collision resolution is happening or need to\r\n   * tweak the default resolution.\r\n   */\r\n  public off(eventName: Events.postcollision, handler: (event: PostCollisionEvent) => void): void;\r\n  public off(eventName: Events.pointerup, handler?: (event: PointerEvent) => void): void;\r\n  public off(eventName: Events.pointerdown, handler?: (event: PointerEvent) => void): void;\r\n  public off(eventName: Events.pointerenter, handler?: (event: PointerEvent) => void): void;\r\n  public off(eventName: Events.pointerleave, handler?: (event: PointerEvent) => void): void;\r\n  public off(eventName: Events.pointermove, handler?: (event: PointerEvent) => void): void;\r\n  public off(eventName: Events.pointercancel, handler?: (event: PointerEvent) => void): void;\r\n  public off(eventName: Events.pointerwheel, handler?: (event: WheelEvent) => void): void;\r\n  public off(eventName: Events.pointerdragstart, handler?: (event: PointerDragEvent) => void): void;\r\n  public off(eventName: Events.pointerdragend, handler?: (event: PointerDragEvent) => void): void;\r\n  public off(eventName: Events.pointerdragenter, handler?: (event: PointerDragEvent) => void): void;\r\n  public off(eventName: Events.pointerdragleave, handler?: (event: PointerDragEvent) => void): void;\r\n  public off(eventName: Events.pointerdragmove, handler?: (event: PointerDragEvent) => void): void;\r\n  public off(eventName: Events.prekill, handler?: (event: PreKillEvent) => void): void;\r\n  public off(eventName: Events.postkill, handler?: (event: PostKillEvent) => void): void;\r\n  public off(eventName: Events.initialize, handler?: (event: Events.InitializeEvent<Actor>) => void): void;\r\n  public off(eventName: Events.postupdate, handler?: (event: Events.PostUpdateEvent<Actor>) => void): void;\r\n  public off(eventName: Events.preupdate, handler?: (event: Events.PreUpdateEvent<Actor>) => void): void;\r\n  public off(eventName: Events.postdraw, handler?: (event: Events.PostDrawEvent) => void): void;\r\n  public off(eventName: Events.predraw, handler?: (event: Events.PreDrawEvent) => void): void;\r\n  public off(eventName: Events.enterviewport, handler?: (event: EnterViewPortEvent) => void): void;\r\n  public off(eventName: Events.exitviewport, handler?: (event: ExitViewPortEvent) => void): void;\r\n  public off(eventName: string, handler?: (event: GameEvent<Actor>) => void): void;\r\n  public off(eventName: string, handler?: (event: any) => void): void {\r\n    super.off(eventName, handler);\r\n  }\r\n\r\n  // #endregion\r\n\r\n  /**\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Internal _prekill handler for [[onPreKill]] lifecycle event\r\n   * @internal\r\n   */\r\n  public _prekill(_scene: Scene) {\r\n    super.emit('prekill', new PreKillEvent(this));\r\n    this.onPreKill(_scene);\r\n  }\r\n\r\n  /**\r\n   * Safe to override onPreKill lifecycle event handler. Synonymous with `.on('prekill', (evt) =>{...})`\r\n   *\r\n   * `onPreKill` is called directly before an actor is killed and removed from its current [[Scene]].\r\n   */\r\n  public onPreKill(_scene: Scene) {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Internal _prekill handler for [[onPostKill]] lifecycle event\r\n   * @internal\r\n   */\r\n  public _postkill(_scene: Scene) {\r\n    super.emit('postkill', new PostKillEvent(this));\r\n    this.onPostKill(_scene);\r\n  }\r\n\r\n  /**\r\n   * Safe to override onPostKill lifecycle event handler. Synonymous with `.on('postkill', (evt) => {...})`\r\n   *\r\n   * `onPostKill` is called directly after an actor is killed and remove from its current [[Scene]].\r\n   */\r\n  public onPostKill(_scene: Scene) {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * If the current actor is a member of the scene, this will remove\r\n   * it from the scene graph. It will no longer be drawn or updated.\r\n   */\r\n  public kill() {\r\n    if (this.scene) {\r\n      this._prekill(this.scene);\r\n      this.emit('kill', new KillEvent(this));\r\n      super.kill();\r\n      this._postkill(this.scene);\r\n    } else {\r\n      this.logger.warn('Cannot kill actor, it was never added to the Scene');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * If the current actor is killed, it will now not be killed.\r\n   */\r\n  public unkill() {\r\n    this.active = true;\r\n  }\r\n\r\n  /**\r\n   * Indicates wether the actor has been killed.\r\n   */\r\n  public isKilled(): boolean {\r\n    return !this.active;\r\n  }\r\n\r\n  /**\r\n   * Sets the current drawing of the actor to the drawing corresponding to\r\n   * the key.\r\n   * @param key The key of the drawing\r\n   * @deprecated Use [[GraphicsComponent.show|Actor.graphics.show]] or [[GraphicsComponent.use|Actor.graphics.use]]\r\n   */\r\n  public setDrawing(key: string): void;\r\n  /**\r\n   * Sets the current drawing of the actor to the drawing corresponding to\r\n   * an `enum` key (e.g. `Animations.Left`)\r\n   * @param key The `enum` key of the drawing\r\n   * @deprecated Use [[GraphicsComponent.show|Actor.graphics.show]] or [[GraphicsComponent.use|Actor.graphics.use]]\r\n   */\r\n  public setDrawing(key: number): void;\r\n  @obsolete({\r\n    message: 'Actor.setDrawing will be removed in v0.26.0',\r\n    alternateMethod: 'Use Actor.graphics.show() or Actor.graphics.use()'\r\n  })\r\n  public setDrawing(key: any): void {\r\n    key = key.toString();\r\n    if (this.currentDrawing !== this.frames[<string>key]) {\r\n      if (this.frames[key] != null) {\r\n        this.frames[key].reset();\r\n        this.currentDrawing = this.frames[key];\r\n      } else {\r\n        Logger.getInstance().error(`the specified drawing key ${key} does not exist`);\r\n      }\r\n    }\r\n    if (this.currentDrawing && this.currentDrawing instanceof Animation) {\r\n      this.currentDrawing.tick(0);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Adds a whole texture as the \"default\" drawing. Set a drawing using [[setDrawing]].\r\n   * @deprecated Use [[GraphicsComponent.add|Actor.graphics.add]]\r\n   */\r\n  public addDrawing(texture: Texture): void;\r\n  /**\r\n   * Adds a whole sprite as the \"default\" drawing. Set a drawing using [[setDrawing]].\r\n   * @deprecated Use [[GraphicsComponent.add|Actor.graphics.add]]\r\n   */\r\n  public addDrawing(sprite: Sprite): void;\r\n  /**\r\n   * Adds a drawing to the list of available drawings for an actor. Set a drawing using [[setDrawing]].\r\n   * @param key     The key to associate with a drawing for this actor\r\n   * @param drawing This can be an [[Animation]], [[Sprite]], or [[Polygon]].\r\n   * @deprecated Use [[GraphicsComponent.add|Actor.graphics.add]]\r\n   */\r\n  public addDrawing(key: any, drawing: Drawable): void;\r\n  @obsolete({\r\n    message: 'Actor.addDrawing will be removed in v0.26.0',\r\n    alternateMethod: 'Use Actor.graphics.add()'\r\n  })\r\n  public addDrawing(): void {\r\n    if (arguments.length === 2) {\r\n      this.frames[<string>arguments[0]] = arguments[1];\r\n      if (!this.currentDrawing) {\r\n        this.currentDrawing = arguments[1];\r\n      }\r\n    } else {\r\n      if (arguments[0] instanceof Sprite) {\r\n        this.addDrawing('default', arguments[0]);\r\n      }\r\n      if (arguments[0] instanceof Texture) {\r\n        this.addDrawing('default', arguments[0].asSprite());\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Gets the z-index of an actor. The z-index determines the relative order an actor is drawn in.\r\n   * Actors with a higher z-index are drawn on top of actors with a lower z-index\r\n   */\r\n  public get z(): number {\r\n    return this.get(TransformComponent).z;\r\n  }\r\n\r\n  /**\r\n   * @deprecated Use [[Actor.z]]\r\n   */\r\n  @obsolete({\r\n    message: 'Actor.getZIndex will be removed in v0.26.0',\r\n    alternateMethod: 'Use Actor.transform.z or Actor.z'\r\n  })\r\n  public getZIndex(): number {\r\n    return this.get(TransformComponent).z;\r\n  }\r\n\r\n  /**\r\n   * Sets the z-index of an actor and updates it in the drawing list for the scene.\r\n   * The z-index determines the relative order an actor is drawn in.\r\n   * Actors with a higher z-index are drawn on top of actors with a lower z-index\r\n   * @param newZ new z-index to assign\r\n   */\r\n  public set z(newZ: number) {\r\n    this.get(TransformComponent).z = newZ;\r\n  }\r\n\r\n  /**\r\n   * @param newIndex new z-index to assign\r\n   * @deprecated Use [[Actor.z]]\r\n   */\r\n  @obsolete({\r\n    message: 'Actor.setZIndex will be removed in v0.26.0',\r\n    alternateMethod: 'Use Actor.transform.z or Actor.z'\r\n  })\r\n  public setZIndex(newIndex: number) {\r\n    this.get(TransformComponent).z = newIndex;\r\n  }\r\n\r\n  /**\r\n   * Get the center point of an actor\r\n   */\r\n  public get center(): Vector {\r\n    return new Vector(this.pos.x + this.width / 2 - this.anchor.x * this.width, this.pos.y + this.height / 2 - this.anchor.y * this.height);\r\n  }\r\n\r\n  public get width() {\r\n    return this.collider.localBounds.width * this.getGlobalScale().x;\r\n  }\r\n\r\n  public get height() {\r\n    return this.collider.localBounds.height * this.getGlobalScale().y;\r\n  }\r\n\r\n  /**\r\n   * Gets this actor's rotation taking into account any parent relationships\r\n   *\r\n   * @returns Rotation angle in radians\r\n   */\r\n  public getGlobalRotation(): number {\r\n    return this.get(TransformComponent).globalRotation;\r\n  }\r\n\r\n  /**\r\n   * Gets an actor's world position taking into account parent relationships, scaling, rotation, and translation\r\n   *\r\n   * @returns Position in world coordinates\r\n   */\r\n  public getGlobalPos(): Vector {\r\n    return this.get(TransformComponent).globalPos;\r\n  }\r\n\r\n  /**\r\n   * Gets the global scale of the Actor\r\n   */\r\n  public getGlobalScale(): Vector {\r\n    return this.get(TransformComponent).globalScale;\r\n  }\r\n\r\n  // #region Collision\r\n\r\n  /**\r\n   * Tests whether the x/y specified are contained in the actor\r\n   * @param x  X coordinate to test (in world coordinates)\r\n   * @param y  Y coordinate to test (in world coordinates)\r\n   * @param recurse checks whether the x/y are contained in any child actors (if they exist).\r\n   */\r\n  public contains(x: number, y: number, recurse: boolean = false): boolean {\r\n    const point = vec(x, y);\r\n    const collider = this.get(ColliderComponent);\r\n    collider.update();\r\n    const geom = collider.get();\r\n    if (!geom) {\r\n      return false;\r\n    }\r\n    const containment = geom.contains(point);\r\n\r\n    if (recurse) {\r\n      return (\r\n        containment ||\r\n        this.children.some((child: Actor) => {\r\n          return child.contains(x, y, true);\r\n        })\r\n      );\r\n    }\r\n\r\n    return containment;\r\n  }\r\n\r\n  /**\r\n   * Returns true if the two actor.collider's surfaces are less than or equal to the distance specified from each other\r\n   * @param actor     Actor to test\r\n   * @param distance  Distance in pixels to test\r\n   */\r\n  public within(actor: Actor, distance: number): boolean {\r\n    const collider = this.get(ColliderComponent);\r\n    const otherCollider = actor.get(ColliderComponent);\r\n    const me = collider.get();\r\n    const other = otherCollider.get();\r\n    if (me && other) {\r\n      return me.getClosestLineBetween(other).getLength() <= distance;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  // #endregion\r\n\r\n  // #region Update\r\n\r\n  /**\r\n   * Called by the Engine, updates the state of the actor\r\n   * @internal\r\n   * @param engine The reference to the current game engine\r\n   * @param delta  The time elapsed since the last update in milliseconds\r\n   */\r\n  public update(engine: Engine, delta: number) {\r\n    this._initialize(engine);\r\n    this._preupdate(engine, delta);\r\n\r\n    // Tick animations\r\n    const drawing = this.currentDrawing;\r\n    if (drawing && drawing instanceof Animation) {\r\n      drawing.tick(delta, engine.stats.currFrame.id);\r\n    }\r\n\r\n    // Update action context\r\n    this.actions.update(delta);\r\n\r\n    // Update actor pipeline (movement, collision detection, event propagation, offscreen culling)\r\n    for (const trait of this.traits) {\r\n      trait.update(this, engine, delta);\r\n    }\r\n\r\n    // Update child actors\r\n    // for (let i = 0; i < this.children.length; i++) {\r\n    //   this.children[i].update(engine, delta);\r\n    // }\r\n\r\n    this._postupdate(engine, delta);\r\n  }\r\n\r\n  /**\r\n   * Safe to override onPreUpdate lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\r\n   *\r\n   * `onPreUpdate` is called directly before an actor is updated.\r\n   */\r\n  public onPreUpdate(_engine: Engine, _delta: number): void {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * Safe to override onPostUpdate lifecycle event handler. Synonymous with `.on('postupdate', (evt) =>{...})`\r\n   *\r\n   * `onPostUpdate` is called directly after an actor is updated.\r\n   */\r\n  public onPostUpdate(_engine: Engine, _delta: number): void {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Internal _preupdate handler for [[onPreUpdate]] lifecycle event\r\n   * @internal\r\n   */\r\n  public _preupdate(engine: Engine, delta: number): void {\r\n    this.emit('preupdate', new PreUpdateEvent(engine, delta, this));\r\n    this.onPreUpdate(engine, delta);\r\n  }\r\n\r\n  /**\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Internal _preupdate handler for [[onPostUpdate]] lifecycle event\r\n   * @internal\r\n   */\r\n  public _postupdate(engine: Engine, delta: number): void {\r\n    this.emit('postupdate', new PreUpdateEvent(engine, delta, this));\r\n    this.onPostUpdate(engine, delta);\r\n  }\r\n\r\n  // endregion\r\n\r\n  // #region Drawing\r\n  /**\r\n   * Called by the Engine, draws the actor to the screen\r\n   * @param ctx   The rendering context\r\n   * @param delta The time since the last draw in milliseconds\r\n   *\r\n   * **Warning** only works with Flags.useLegacyDrawing() enabled\r\n   * @deprecated Use Actor.graphics, will be removed in v0.26.0\r\n   */\r\n  public draw(ctx: CanvasRenderingContext2D, delta: number) {\r\n    // translate canvas by anchor offset\r\n    ctx.save();\r\n\r\n    if (this.currentDrawing) {\r\n      ctx.translate(-(this.width * this.anchor.x), -(this.height * this.anchor.y));\r\n\r\n      this._predraw(ctx, delta);\r\n      const drawing = this.currentDrawing;\r\n      // See https://github.com/excaliburjs/Excalibur/pull/619 for discussion on this formula\r\n      const offsetX = (this.width - drawing.width * drawing.scale.x) * this.anchor.x;\r\n      const offsetY = (this.height - drawing.height * drawing.scale.y) * this.anchor.y;\r\n\r\n      this.currentDrawing.draw({ ctx, x: offsetX, y: offsetY, opacity: this.graphics.opacity });\r\n    } else {\r\n      this._predraw(ctx, delta);\r\n      if (this.color && this.collider) {\r\n        // update collider geometry based on transform\r\n        const collider = this.get(ColliderComponent);\r\n        collider.update();\r\n        if (collider && !collider.bounds.hasZeroDimensions()) {\r\n          // Colliders are already shifted by anchor, unshift\r\n          ctx.globalAlpha = this.graphics.opacity;\r\n          collider.get()?.draw(ctx, this.color, vec(0, 0));\r\n        }\r\n      }\r\n    }\r\n    ctx.restore();\r\n    this._postdraw(ctx, delta);\r\n  }\r\n\r\n  /**\r\n   * Safe to override onPreDraw lifecycle event handler. Synonymous with `.on('predraw', (evt) =>{...})`\r\n   *\r\n   * `onPreDraw` is called directly before an actor is drawn, but after local transforms are made.\r\n   *\r\n   * **Warning** only works with Flags.useLegacyDrawing() enabled\r\n   * @deprecated Use Actor.graphics.onPostDraw, will be removed in v0.26.0\r\n   */\r\n  public onPreDraw(_ctx: CanvasRenderingContext2D, _delta: number): void {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * Safe to override onPostDraw lifecycle event handler. Synonymous with `.on('postdraw', (evt) =>{...})`\r\n   *\r\n   * `onPostDraw` is called directly after an actor is drawn, and before local transforms are removed.\r\n   *\r\n   * **Warning** only works with Flags.useLegacyDrawing() enabled\r\n   * @deprecated Use Actor.graphics.onPostDraw, will be removed in v0.26.0\r\n   */\r\n  public onPostDraw(_ctx: CanvasRenderingContext2D, _delta: number): void {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Internal _predraw handler for [[onPreDraw]] lifecycle event\r\n   *\r\n   * **Warning** only works with Flags.useLegacyDrawing() enabled\r\n   * @deprecated Use Actor.graphics.onPreDraw, will be removed in v0.26.0\r\n   * @internal\r\n   */\r\n  public _predraw(ctx: CanvasRenderingContext2D, delta: number): void {\r\n    this.emit('predraw', new PreDrawEvent(ctx, delta, this));\r\n    this.onPreDraw(ctx, delta);\r\n  }\r\n\r\n  /**\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Internal _postdraw handler for [[onPostDraw]] lifecycle event\r\n   *\r\n   * **Warning** only works with Flags.useLegacyDrawing() enabled\r\n   * @deprecated Use Actor.graphics.onPostDraw, will be removed in v0.26.0\r\n   * @internal\r\n   */\r\n  public _postdraw(ctx: CanvasRenderingContext2D, delta: number): void {\r\n    this.emit('postdraw', new PreDrawEvent(ctx, delta, this));\r\n    this.onPostDraw(ctx, delta);\r\n  }\r\n\r\n  /**\r\n   * Called by the Engine, draws the actors debugging to the screen\r\n   * @param ctx The rendering context\r\n   *\r\n   *\r\n   * **Warning** only works with Flags.useLegacyDrawing() enabled\r\n   * @deprecated Use Actor.graphics.onPostDraw, will be removed in v0.26.0\r\n   * @internal\r\n   */\r\n  /* istanbul ignore next */\r\n  public debugDraw(_ctx: CanvasRenderingContext2D) {\r\n    // pass\r\n  }\r\n  // #endregion\r\n}\r\n","import { Vector, vec } from './Math/vector';\nimport { Engine } from './Engine';\nimport { Actor, ActorArgs } from './Actor';\nimport * as Traits from './Traits/Index';\nimport { CoordPlane, TransformComponent } from './EntityComponentSystem/Components/TransformComponent';\nimport { CollisionType } from './Collision/CollisionType';\n\n/**\n * Helper [[Actor]] primitive for drawing UI's, optimized for UI drawing. Does\n * not participate in collisions. Drawn on top of all other actors.\n */\nexport class ScreenElement extends Actor {\n  protected _engine: Engine;\n\n  constructor();\n  constructor(config?: ActorArgs);\n\n  constructor(config?: ActorArgs) {\n    super({ ...config });\n    this.get(TransformComponent).coordPlane = CoordPlane.Screen;\n    this.traits = [];\n    this.traits.push(new Traits.CapturePointer());\n    this.anchor = vec(0, 0);\n    this.body.collisionType = CollisionType.PreventCollision;\n    this.collider.useBoxCollider(this.width, this.height, this.anchor);\n    this.enableCapturePointer = true;\n  }\n\n  public _initialize(engine: Engine) {\n    this._engine = engine;\n    super._initialize(engine);\n  }\n\n  public contains(x: number, y: number, useWorld: boolean = true) {\n    if (useWorld) {\n      return super.contains(x, y);\n    }\n\n    const coords = this._engine.worldToScreenCoordinates(new Vector(x, y));\n    return super.contains(coords.x, coords.y);\n  }\n}\n","import { Scene } from './Scene';\r\nimport { obsolete } from './Util/Decorators';\r\nimport { Logger } from './Util/Log';\r\n\r\nexport interface TimerOptions {\r\n  repeats?: boolean;\r\n  numberOfRepeats?: number;\r\n  fcn?: () => void;\r\n  interval: number;\r\n}\r\n\r\n/**\r\n * The Excalibur timer hooks into the internal timer and fires callbacks,\r\n * after a certain interval, optionally repeating.\r\n */\r\nexport class Timer {\r\n  private _logger = Logger.getInstance();\r\n  private static _MAX_ID: number = 0;\r\n  public id: number = 0;\r\n\r\n  private _elapsedTime: number = 0;\r\n  private _totalTimeAlive: number = 0;\r\n\r\n  private _running = false;\r\n\r\n  private _numberOfTicks: number = 0;\r\n  private _callbacks: Array<() => void>;\r\n\r\n  public interval: number = 10;\r\n  public repeats: boolean = false;\r\n  public maxNumberOfRepeats: number = -1;\r\n\r\n  private _complete = false;\r\n  public get complete() {\r\n    return this._complete;\r\n  }\r\n  public scene: Scene = null;\r\n\r\n  /**\r\n   * @param options    Options - repeats, numberOfRepeats, fcn, interval\r\n   * @param repeats    Indicates whether this call back should be fired only once, or repeat after every interval as completed.\r\n   * @param numberOfRepeats Specifies a maximum number of times that this timer will execute.\r\n   * @param fcn        The callback to be fired after the interval is complete.\r\n   */\r\n  constructor(options: TimerOptions);\r\n  constructor(fcn: TimerOptions | (() => void), interval?: number, repeats?: boolean, numberOfRepeats?: number) {\r\n    if (typeof fcn !== 'function') {\r\n      const options = fcn;\r\n      fcn = options.fcn;\r\n      interval = options.interval;\r\n      repeats = options.repeats;\r\n      numberOfRepeats = options.numberOfRepeats;\r\n    }\r\n\r\n    if (!!numberOfRepeats && numberOfRepeats >= 0) {\r\n      this.maxNumberOfRepeats = numberOfRepeats;\r\n      if (!repeats) {\r\n        throw new Error('repeats must be set to true if numberOfRepeats is set');\r\n      }\r\n    }\r\n\r\n    this.id = Timer._MAX_ID++;\r\n    this.interval = interval || this.interval;\r\n    this.repeats = repeats || this.repeats;\r\n\r\n    this._callbacks = [];\r\n\r\n    if (fcn) {\r\n      this.on(fcn);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Adds a new callback to be fired after the interval is complete\r\n   * @param fcn The callback to be added to the callback list, to be fired after the interval is complete.\r\n   */\r\n  public on(fcn: () => void) {\r\n    this._callbacks.push(fcn);\r\n  }\r\n\r\n  /**\r\n   * Removes a callback from the callback list to be fired after the interval is complete.\r\n   * @param fcn The callback to be removed from the callback list, to be fired after the interval is complete.\r\n   */\r\n  public off(fcn: () => void) {\r\n    const index = this._callbacks.indexOf(fcn);\r\n    this._callbacks.splice(index, 1);\r\n  }\r\n\r\n  /**\r\n   * Updates the timer after a certain number of milliseconds have elapsed. This is used internally by the engine.\r\n   * @param delta  Number of elapsed milliseconds since the last update.\r\n   */\r\n  public update(delta: number) {\r\n    if (this._running) {\r\n      this._totalTimeAlive += delta;\r\n      this._elapsedTime += delta;\r\n\r\n      if (this.maxNumberOfRepeats > -1 && this._numberOfTicks >= this.maxNumberOfRepeats) {\r\n        this._complete = true;\r\n        this._running = false;\r\n        this._elapsedTime = 0;\r\n      }\r\n\r\n      if (!this.complete && this._elapsedTime >= this.interval) {\r\n        this._callbacks.forEach((c) => {\r\n          c.call(this);\r\n        });\r\n\r\n        this._numberOfTicks++;\r\n        if (this.repeats) {\r\n          this._elapsedTime = 0;\r\n        } else {\r\n          this._complete = true;\r\n          this._running = false;\r\n          this._elapsedTime = 0;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Resets the timer so that it can be reused, and optionally reconfigure the timers interval.\r\n   *\r\n   * Warning** you may need to call `timer.start()` again if the timer had completed\r\n   * @param newInterval If specified, sets a new non-negative interval in milliseconds to refire the callback\r\n   * @param newNumberOfRepeats If specified, sets a new non-negative upper limit to the number of time this timer executes\r\n   */\r\n  public reset(newInterval?: number, newNumberOfRepeats?: number) {\r\n    if (!!newInterval && newInterval >= 0) {\r\n      this.interval = newInterval;\r\n    }\r\n\r\n    if (!!this.maxNumberOfRepeats && this.maxNumberOfRepeats >= 0) {\r\n      this.maxNumberOfRepeats = newNumberOfRepeats;\r\n      if (!this.repeats) {\r\n        throw new Error('repeats must be set to true if numberOfRepeats is set');\r\n      }\r\n    }\r\n\r\n    this._complete = false;\r\n    this._elapsedTime = 0;\r\n    this._numberOfTicks = 0;\r\n  }\r\n\r\n  public get timesRepeated(): number {\r\n    return this._numberOfTicks;\r\n  }\r\n\r\n  public getTimeRunning(): number {\r\n    return this._totalTimeAlive;\r\n  }\r\n\r\n  /**\r\n   * @returns milliseconds until the next action callback, if complete will return 0\r\n   */\r\n  public get timeToNextAction() {\r\n    if (this.complete) {\r\n      return 0;\r\n    }\r\n    return this.interval - this._elapsedTime;\r\n  }\r\n\r\n  /**\r\n   * @returns milliseconds elapsed toward the next action\r\n   */\r\n  public get timeElapsedTowardNextAction() {\r\n    return this._elapsedTime;\r\n  }\r\n\r\n  public get isRunning() {\r\n    return this._running;\r\n  }\r\n\r\n  /**\r\n   * Pauses the timer, time will no longer increment towards the next call\r\n   */\r\n  public pause(): Timer {\r\n    this._running = false;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Unpauses the timer. Time will now increment towards the next call\r\n   * @deprecated Will be removed in v0.26.0\r\n   */\r\n  @obsolete({ message: 'Will be removed in v0.26.0', alternateMethod: 'Use Timer.resume()' })\r\n  public unpause() {\r\n    this._running = true;\r\n  }\r\n\r\n  /**\r\n   * Resumes the timer, time will now increment towards the next call.\r\n   */\r\n  public resume(): Timer {\r\n    this._running = true;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Starts the timer, if the timer was complete it will restart the timer and reset the elapsed time counter\r\n   */\r\n  public start(): Timer {\r\n    if (!this.scene) {\r\n      this._logger.warn('Cannot start a timer not part of a scene, timer wont start until added');\r\n    }\r\n\r\n    this._running = true;\r\n    if (this.complete) {\r\n      this._complete = false;\r\n      this._elapsedTime = 0;\r\n      this._numberOfTicks = 0;\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Stops the timer and resets the elapsed time counter towards the next action invocation\r\n   */\r\n  public stop(): Timer {\r\n    this._running = false;\r\n    this._elapsedTime = 0;\r\n    this._numberOfTicks = 0;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Cancels the timer, preventing any further executions.\r\n   */\r\n  public cancel() {\r\n    this.pause();\r\n    if (this.scene) {\r\n      this.scene.cancelTimer(this);\r\n    }\r\n  }\r\n}\r\n","import { Resource } from '../Resources/Resource';\r\nimport { Texture } from '../Drawing/Texture';\r\nimport { Sprite } from './Sprite';\r\nimport { Loadable } from '../Interfaces/Index';\r\nimport { Logger } from '../Util/Log';\r\n\r\nexport class ImageSource implements Loadable<HTMLImageElement> {\r\n  private _logger = Logger.getInstance();\r\n  private _resource: Resource<Blob>;\r\n\r\n  /**\r\n   * The original size of the source image in pixels\r\n   */\r\n  public get width() {\r\n    return this.image.naturalWidth;\r\n  }\r\n\r\n  /**\r\n   * The original height of the source image in pixels\r\n   */\r\n  public get height() {\r\n    return this.image.naturalHeight;\r\n  }\r\n\r\n  /**\r\n   * Returns true if the Texture is completely loaded and is ready\r\n   * to be drawn.\r\n   */\r\n  public isLoaded(): boolean {\r\n    return !!this.data.src;\r\n  }\r\n\r\n  /**\r\n   * Access to the underlying html image elmeent\r\n   */\r\n  public data: HTMLImageElement = new Image();\r\n  public get image(): HTMLImageElement {\r\n    return this.data;\r\n  }\r\n\r\n  /**\r\n   * Promise the resolves when the image is loaded and ready for use, does not initiate loading\r\n   */\r\n  public ready: Promise<HTMLImageElement>;\r\n  private _loadedResolve: (value?: HTMLImageElement | PromiseLike<HTMLImageElement>) => void;\r\n\r\n  /**\r\n   * The path to the image, can also be a data url like 'data:image/'\r\n   * @param path\r\n   */\r\n  constructor(public readonly path: string, bustCache: boolean = false) {\r\n    this._resource = new Resource(path, 'blob', bustCache);\r\n    if (path.endsWith('.svg') || path.endsWith('.gif')) {\r\n      this._logger.warn(`Image type is not fully supported, you may have mixed results ${path}. Fully supported: jpg, bmp, and png`);\r\n    }\r\n    this.ready = new Promise<HTMLImageElement>((resolve) => {\r\n      this._loadedResolve = resolve;\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Begins loading the image and returns a promise that resolves when the image is loaded\r\n   */\r\n  async load(): Promise<HTMLImageElement> {\r\n    if (this.isLoaded()) {\r\n      return this.data;\r\n    }\r\n    try {\r\n      // Load base64 or blob if needed\r\n      let url: string;\r\n      if (!this.path.includes('data:image/')) {\r\n        const blob = await this._resource.load();\r\n        url = URL.createObjectURL(blob);\r\n      } else {\r\n        url = this.path;\r\n      }\r\n\r\n      // Decode the image\r\n      const image = new Image();\r\n      image.src = url;\r\n      await image.decode();\r\n\r\n      // Set results\r\n      this.data = image;\r\n    } catch {\r\n      await Promise.reject('Error loading texture');\r\n    }\r\n    // todo emit complete\r\n    this._loadedResolve(this.data);\r\n    return this.data;\r\n  }\r\n\r\n  /**\r\n   * Build a sprite from this ImageSource\r\n   */\r\n  public toSprite(): Sprite {\r\n    return Sprite.from(this);\r\n  }\r\n\r\n  /**\r\n   * Create a ImageSource from legacy texture\r\n   * @param tex\r\n   */\r\n  public static fromLegacyTexture(tex: Texture): ImageSource {\r\n    const image = new ImageSource(tex.path);\r\n    if (tex.isLoaded()) {\r\n      image.data = tex.data;\r\n    } else {\r\n      tex.loaded.then(() => {\r\n        image.data = tex.data;\r\n      });\r\n    }\r\n    return image;\r\n  }\r\n\r\n  /**\r\n   * Unload images from memory\r\n   */\r\n  unload(): void {\r\n    this.data = new Image();\r\n  }\r\n}\r\n","import { Graphic, GraphicOptions } from './Graphic';\r\nimport { ImageSource } from './ImageSource';\r\nimport { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\r\n\r\nimport { Sprite as LegacySprite } from '../Drawing/Sprite';\r\nimport { Texture } from '../Drawing/Texture';\r\n\r\nexport type SourceView = { x: number; y: number; width: number; height: number };\r\nexport type DestinationSize = { width: number; height: number };\r\n\r\nexport interface SpriteOptions {\r\n  /**\r\n   * Image to create a sprite from\r\n   */\r\n  image: ImageSource;\r\n  /**\r\n   * By default the source is the entire dimension of the [[ImageSource]]\r\n   */\r\n  sourceView?: { x: number; y: number; width: number; height: number };\r\n  /**\r\n   * By default the size of the final sprite is the size of the [[ImageSource]]\r\n   */\r\n  destSize?: { width: number; height: number };\r\n}\r\n\r\nexport class Sprite extends Graphic {\r\n  public image: ImageSource;\r\n  public sourceView: SourceView;\r\n  public destSize: DestinationSize;\r\n\r\n  public static from(image: ImageSource): Sprite {\r\n    return new Sprite({\r\n      image: image\r\n    });\r\n  }\r\n\r\n  constructor(options: GraphicOptions & SpriteOptions) {\r\n    super(options);\r\n    this.image = options.image;\r\n    const { width, height } = options;\r\n    this.sourceView = options.sourceView ?? { x: 0, y: 0, width: width ?? 0, height: height ?? 0 };\r\n    this.destSize = options.destSize ?? { width: width ?? 0, height: height ?? 0 };\r\n    this._updateSpriteDimensions();\r\n    this.image.ready.then(() => {\r\n      this._updateSpriteDimensions();\r\n    });\r\n  }\r\n\r\n  private _updateSpriteDimensions() {\r\n    const { width: nativeWidth, height: nativeHeight } = this.image;\r\n    // This code uses || to avoid 0's\r\n    // If the source is not specified, use the native dimension\r\n    this.sourceView.width = this.sourceView?.width || nativeWidth;\r\n    this.sourceView.height = this.sourceView?.height || nativeHeight;\r\n\r\n    // If the destination is not specified, use the source if specified, then native\r\n    this.destSize.width = this.destSize?.width || this.sourceView?.width || nativeWidth;\r\n    this.destSize.height = this.destSize?.height || this.sourceView?.height || nativeHeight;\r\n\r\n    this.width = Math.ceil(this.destSize.width);\r\n    this.height = Math.ceil(this.destSize.height);\r\n  }\r\n\r\n  protected _preDraw(ex: ExcaliburGraphicsContext, x: number, y: number): void {\r\n    if (this.image.isLoaded()) {\r\n      this._updateSpriteDimensions();\r\n    }\r\n    super._preDraw(ex, x, y);\r\n  }\r\n\r\n  public _drawImage(ex: ExcaliburGraphicsContext, x: number, y: number): void {\r\n    if (this.image.isLoaded()) {\r\n      this._updateSpriteDimensions();\r\n      ex.drawImage(\r\n        this.image.image,\r\n        this.sourceView.x,\r\n        this.sourceView.y,\r\n        this.sourceView.width,\r\n        this.sourceView.height,\r\n        x,\r\n        y,\r\n        this.destSize.width,\r\n        this.destSize.height\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Create a ImageSource from legacy texture\r\n   * @param sprite\r\n   */\r\n  public static fromLegacySprite(sprite: LegacySprite): Sprite {\r\n    const tex = sprite.texture;\r\n    const image = ImageSource.fromLegacyTexture(tex);\r\n    return new Sprite({\r\n      image,\r\n      sourceView: {\r\n        x: sprite.x,\r\n        y: sprite.y,\r\n        width: sprite.width,\r\n        height: sprite.height\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Converts a sprite to a Legacy sprite\r\n   * @deprecated\r\n   * @param sprite\r\n   * @returns LegacyDrawing.Sprite\r\n   */\r\n  public static toLegacySprite(sprite: Sprite): LegacySprite {\r\n    const image = sprite.image;\r\n    const tex = new Texture(image.path);\r\n    tex.data = image.image;\r\n\r\n    return new LegacySprite(tex, sprite.sourceView.x, sprite.sourceView.y, sprite.sourceView.width, sprite.sourceView.height);\r\n  }\r\n\r\n  public clone(): Sprite {\r\n    return new Sprite({\r\n      image: this.image,\r\n      sourceView: { ...this.sourceView },\r\n      destSize: { ...this.destSize },\r\n      ...this.cloneGraphicOptions()\r\n    });\r\n  }\r\n}\r\n","import { Sprite, SpriteArgs } from './Sprite';\nimport { Animation } from './Animation';\nimport { Color } from '../Color';\nimport * as Effects from './SpriteEffects';\n\nimport { Texture } from './Texture';\nimport { Engine } from '../Engine';\nimport { Logger } from '../Util/Log';\nimport { BaseAlign, TextAlign } from '../Graphics/FontCommon';\nimport { obsolete } from '../Util/Decorators';\nimport { vec } from '../Math/vector';\n\nexport interface SpriteSheetArgs {\n  image: Texture;\n  sprites?: Sprite[];\n  spWidth: number;\n  spHeight: number;\n  rows: number;\n  columns: number;\n  spacing?: number | SpriteSheetSpacingDimensions;\n}\n\nexport interface SpriteSheetSpacingDimensions {\n  top?: number;\n  left?: number;\n  margin?: number;\n}\n\n/**\n * Sprite sheets are a useful mechanism for slicing up image resources into\n * separate sprites or for generating in game animations. [[Sprite|Sprites]] are organized\n * in row major order in the [[SpriteSheet]].\n * @deprecated Will be removed in v0.26.0\n */\nexport class SpriteSheet {\n  private _sprites: Sprite[] = [];\n  private _image: Texture | null = null;\n  private _columns: number = 0;\n  private _rows: number = 0;\n  private _spWidth: number = 0;\n  private _spHeight: number = 0;\n  private _spacing: number | SpriteSheetSpacingDimensions = 0;\n\n  /**\n   * @param config    The configuration of the SpriteSheet\n   */\n  constructor(config: SpriteSheetArgs);\n\n  /**\n   * @param sprites   The backing sprite array to use, if already available\n   */\n  constructor(sprites: Sprite[]);\n\n  /**\n   * @param image     The backing image texture to build the SpriteSheet\n   * @param columns   The number of columns in the image texture\n   * @param rows      The number of rows in the image texture\n   * @param spWidth   The width of each individual sprite in pixels\n   * @param spHeight  The height of each individual sprite in pixels\n   * @param spacing   The spacing between every sprite in a spritesheet\n   */\n  constructor(\n    image: Texture,\n    columns: number,\n    rows: number,\n    spWidth: number,\n    spHeight: number,\n    spacing?: number | SpriteSheetSpacingDimensions\n  );\n\n  /**\n   * @param imageOrConfigOrSprites The backing image texture to build the SpriteSheet, option bag, or sprite list\n   * @param columns   The number of columns in the image texture\n   * @param rows      The number of rows in the image texture\n   * @param spWidth   The width of each individual sprite in pixels\n   * @param spHeight  The height of each individual sprite in pixels\n   * @param spacing   The spacing between every sprite in a spritesheet\n   */\n  constructor(\n    imageOrConfigOrSprites: Texture | SpriteSheetArgs | Sprite[],\n    columns?: number,\n    rows?: number,\n    spWidth?: number,\n    spHeight?: number,\n    spacing?: number | SpriteSheetSpacingDimensions\n  ) {\n    let loadFromImage: boolean = false;\n    if (imageOrConfigOrSprites instanceof Array) {\n      this._sprites = imageOrConfigOrSprites;\n    } else {\n      if (imageOrConfigOrSprites && !(imageOrConfigOrSprites instanceof Texture)) {\n        this._columns = imageOrConfigOrSprites.columns;\n        this._rows = imageOrConfigOrSprites.rows;\n        this._spWidth = imageOrConfigOrSprites.spWidth;\n        this._spHeight = imageOrConfigOrSprites.spHeight;\n        this._image = imageOrConfigOrSprites.image;\n        this._spacing = imageOrConfigOrSprites.spacing || 0;\n      } else {\n        this._image = <Texture>imageOrConfigOrSprites;\n        this._columns = columns;\n        this._rows = rows;\n        this._spWidth = spWidth;\n        this._spHeight = spHeight;\n        this._spacing = spacing || 0;\n      }\n      this._sprites = new Array(this._columns * this._rows);\n      loadFromImage = true;\n    }\n\n    // Inspect actual image dimensions with preloading\n    if (this.image instanceof Texture) {\n      let isWidthError: boolean = false;\n      let isHeightError: boolean = false;\n      if (this.image.isLoaded()) {\n        isWidthError = this.spWidth * this.columns > this.image.image.naturalWidth;\n        isHeightError = this.spHeight * this.rows > this.image.image.naturalHeight;\n        if (isWidthError) {\n          throw new RangeError(\n            `SpriteSheet specified is wider, ` +\n              `${this.columns} cols x ${this.spWidth} pixels > ${this.image.image.naturalWidth} ` +\n              `pixels than image width`\n          );\n        }\n        if (isHeightError) {\n          throw new RangeError(\n            `SpriteSheet specified is taller, ` +\n              `${this.rows} rows x ${this.spHeight} pixels > ${this.image.image.naturalHeight} ` +\n              `pixels than image height`\n          );\n        }\n      }\n    }\n\n    if (loadFromImage) {\n      const spacing = this.getSpacingDimensions();\n\n      for (let row = 0; row < this.rows; row++) {\n        for (let col = 0; col < this.columns; col++) {\n          this._sprites[col + row * this.columns] = new Sprite(\n            this.image,\n            col * this.spWidth + spacing.margin * col + spacing.left,\n            row * this.spHeight + spacing.margin * row + spacing.top,\n            this.spWidth,\n            this.spHeight\n          );\n        }\n      }\n    }\n  }\n\n  /**\n   * Gets the raw spacing dimensions for the sprites in the sheet, which can be a fixed number or custom dimensions.\n   */\n  public get spacing() {\n    return this._spacing;\n  }\n\n  /**\n   * Get a copy of the backing sprite array\n   */\n  public get sprites() {\n    return [...this._sprites];\n  }\n\n  /**\n   * The backing texture used for the sprite sheet\n   */\n  public get image() {\n    return this._image;\n  }\n\n  /**\n   * The number of columns in the sheet\n   */\n  public get columns() {\n    return this._columns;\n  }\n\n  /**\n   * The number of rows in the sheet\n   */\n  public get rows() {\n    return this._rows;\n  }\n\n  /**\n   * The width of the individual sprites\n   */\n  public get spWidth() {\n    return this._spWidth;\n  }\n\n  /**\n   * The height of the individual sprites\n   */\n  public get spHeight() {\n    return this._spHeight;\n  }\n\n  /**\n   * Gets the calculated spacing dimensions based on whether spacing\n   * is a fixed number or has different values for each dimension\n   */\n  public getSpacingDimensions(): SpriteSheetSpacingDimensions {\n    if (typeof this.spacing === 'number') {\n      return {\n        left: this.spacing,\n        top: this.spacing,\n        margin: this.spacing\n      };\n    } else {\n      return {\n        left: this.spacing.left ?? 0,\n        top: this.spacing.top ?? 0,\n        margin: this.spacing.margin ?? 0\n      };\n    }\n  }\n\n  /**\n   * Create an animation from the this SpriteSheet by listing out the\n   * sprite indices. Sprites are organized in row major order in the SpriteSheet.\n   * @param engine   Reference to the current game [[Engine]]\n   * @param indices  An array of sprite indices to use in the animation\n   * @param speed    The number in milliseconds to display each frame in the animation\n   */\n  public getAnimationByIndices(engine: Engine, indices: number[], speed: number) {\n    let images: Sprite[] = indices.map((index) => {\n      return this.sprites[index];\n    });\n\n    images = images.map(function (i) {\n      return i.clone();\n    });\n    return new Animation(engine, images, speed);\n  }\n\n  /**\n   * Create an animation from the this SpriteSheet by specifying the range of\n   * images with the beginning (inclusive) and ending (exclusive) index\n   * For example `getAnimationBetween(engine, 0, 5, 200)` returns an animation with 5 frames.\n   * @param engine      Reference to the current game Engine\n   * @param beginIndex  The index to start taking frames (inclusive)\n   * @param endIndex    The index to stop taking frames (exclusive)\n   * @param speed       The number in milliseconds to display each frame in the animation\n   */\n  public getAnimationBetween(engine: Engine, beginIndex: number, endIndex: number, speed: number) {\n    let images = this.sprites.slice(beginIndex, endIndex);\n    images = images.map(function (i) {\n      return i.clone();\n    });\n    return new Animation(engine, images, speed);\n  }\n\n  /**\n   * Treat the entire SpriteSheet as one animation, organizing the frames in\n   * row major order.\n   * @param engine  Reference to the current game [[Engine]]\n   * @param speed   The number in milliseconds to display each frame the animation\n   */\n  public getAnimationForAll(engine: Engine, speed: number) {\n    const sprites = this.sprites.map(function (i) {\n      return i.clone();\n    });\n    return new Animation(engine, sprites, speed);\n  }\n\n  /**\n   * Retrieve a specific sprite from the SpriteSheet by its index. Sprites are organized\n   * in row major order in the SpriteSheet.\n   * @param index  The index of the sprite\n   */\n  public getSprite(index: number): Sprite {\n    if (index >= 0 && index < this.sprites.length) {\n      return this.sprites[index];\n    } else {\n      throw new Error('Invalid index: ' + index);\n    }\n  }\n\n  /**\n   * Get an animation with bespoke sprite coordinates. This is useful if the SpriteSheet is\n   * packed and not a uniform width or height. The resulting [[Animation]] will have the height and width of the\n   * largest dimension (width, height) from among the sprite coordinates\n   * @param engine\n   * @param spriteCoordinates\n   * @param speed\n   */\n  public getAnimationByCoords(engine: Engine, spriteCoordinates: SpriteArgs[], speed: number): Animation {\n    let maxWidth: number = 0;\n    let maxHeight: number = 0;\n    const sprites: Sprite[] = new Array(spriteCoordinates.length);\n    for (let i = 0; i < spriteCoordinates.length; i++) {\n      const coord = spriteCoordinates[i];\n      // no need to pass image again if using a spritesheet\n      coord.image = coord.image || this.image;\n      maxWidth = Math.max(maxWidth, coord.drawWidth);\n      maxHeight = Math.max(maxHeight, coord.drawHeight);\n      sprites[i] = new Sprite(coord);\n    }\n\n    const anim = new Animation(engine, sprites, speed);\n\n    anim.drawWidth = maxWidth;\n    anim.drawHeight = maxHeight;\n    return anim;\n  }\n}\n\n/**\n * Specify various font attributes for sprite fonts\n */\nexport interface SpriteFontOptions {\n  color?: Color;\n  opacity?: number;\n  fontSize?: number;\n  letterSpacing?: number;\n  textAlign?: TextAlign;\n  baseAlign?: BaseAlign;\n  maxWidth?: number;\n}\n\nexport interface SpriteFontArgs extends SpriteSheetArgs {\n  alphabet: string;\n  caseInsensitive: boolean;\n}\n\n/**\n * Sprite fonts are a used in conjunction with a [[Label]] to specify\n * a particular bitmap as a font. Note that some font features are not\n * supported by Sprite fonts.\n * @deprecated Will be removed into v0.26.0\n */\n@obsolete({\n  message: 'SpriteSheet will be removed in v0.26.0',\n  alternateMethod: 'Use Graphics.SpriteSheet'\n})\nexport class SpriteFont extends SpriteSheet {\n  private _currentColor: Color = Color.Black;\n  private _currentOpacity: Number = 1.0;\n  private _spriteRecord: Record<string, Sprite> = {};\n\n  // text shadow\n  private _textShadowOn: boolean = false;\n  private _textShadowDirty: boolean = true;\n  private _textShadowColor: Color = Color.Black;\n  private _textShadowSprites: { [key: string]: Sprite } = {};\n  private _shadowOffsetX: number = 5;\n  private _shadowOffsetY: number = 5;\n  public readonly alphabet: string;\n  public readonly caseInsensitive: boolean;\n\n  constructor(config: SpriteFontArgs);\n\n  constructor(\n    image: Texture,\n    alphabet: string,\n    caseInsensitive: boolean,\n    columns: number,\n    rows: number,\n    spWidth: number,\n    spHeight: number,\n    spacing?: number | SpriteSheetSpacingDimensions\n  );\n\n  /**\n   * @param imageOrConfig   The backing image texture to build the SpriteFont or the sprite font option bag\n   * @param alphabet        A string representing all the characters in the image, in row major order.\n   * @param caseInsensitive  Indicate whether this font takes case into account\n   * @param columns         The number of columns of characters in the image\n   * @param rows            The number of rows of characters in the image\n   * @param spWidth         The width of each character in pixels\n   * @param spHeight        The height of each character in pixels\n   */\n  constructor(\n    imageOrConfig: Texture | SpriteFontArgs,\n    alphabet?: string,\n    caseInsensitive?: boolean,\n    columns?: number,\n    rows?: number,\n    spWidth?: number,\n    spHeight?: number,\n    spacing?: number | SpriteSheetSpacingDimensions\n  ) {\n    super(\n      imageOrConfig instanceof Texture\n        ? {\n          image: imageOrConfig,\n          spWidth: spWidth,\n          spHeight: spHeight,\n          rows: rows,\n          columns: columns,\n          spacing: spacing || 0\n        }\n        : imageOrConfig\n    );\n\n    if (imageOrConfig && !(imageOrConfig instanceof Texture)) {\n      alphabet = imageOrConfig.alphabet;\n      caseInsensitive = imageOrConfig.caseInsensitive;\n    }\n\n    this.alphabet = alphabet;\n    this.caseInsensitive = caseInsensitive;\n    this._spriteRecord = this.getTextSprites();\n  }\n\n  /**\n   * Returns a dictionary that maps each character in the alphabet to the appropriate [[Sprite]].\n   */\n  public getTextSprites(): { [key: string]: Sprite } {\n    const lookup: { [key: string]: Sprite } = {};\n    for (let i = 0; i < this.alphabet.length; i++) {\n      let char = this.alphabet[i];\n      if (this.caseInsensitive) {\n        char = char.toLowerCase();\n      }\n      lookup[char] = this.sprites[i].clone();\n    }\n    return lookup;\n  }\n\n  /**\n   * Sets the text shadow for sprite fonts\n   * @param offsetX      The x offset in pixels to place the shadow\n   * @param offsetY      The y offset in pixels to place the shadow\n   * @param shadowColor  The color of the text shadow\n   */\n  public setTextShadow(offsetX: number, offsetY: number, shadowColor: Color) {\n    this._textShadowOn = true;\n    this._shadowOffsetX = offsetX;\n    this._shadowOffsetY = offsetY;\n    this._textShadowColor = shadowColor.clone();\n    this._textShadowDirty = true;\n    for (const character in this._spriteRecord) {\n      this._textShadowSprites[character] = this._spriteRecord[character].clone();\n    }\n  }\n\n  /**\n   * Toggles text shadows on or off\n   */\n  public useTextShadow(on: boolean) {\n    this._textShadowOn = on;\n    if (on) {\n      this.setTextShadow(5, 5, this._textShadowColor);\n    }\n  }\n\n  /**\n   * Draws the current sprite font\n   */\n  public draw(ctx: CanvasRenderingContext2D, text: string, x: number, y: number, options: SpriteFontOptions) {\n    options = this._parseOptions(options);\n\n    if (this._currentColor.toString() !== options.color.toString() || this._currentOpacity !== options.opacity) {\n      this._currentOpacity = options.opacity;\n      this._currentColor = options.color;\n      for (const char in this._spriteRecord) {\n        this._spriteRecord[char].clearEffects();\n        this._spriteRecord[char].fill(options.color);\n        this._spriteRecord[char].opacity(options.opacity);\n      }\n    }\n\n    if (this._textShadowOn && this._textShadowDirty && this._textShadowColor) {\n      for (const characterShadow in this._textShadowSprites) {\n        this._textShadowSprites[characterShadow].clearEffects();\n        this._textShadowSprites[characterShadow].addEffect(new Effects.Fill(this._textShadowColor.clone()));\n      }\n      this._textShadowDirty = false;\n    }\n\n    // find the current length of text in pixels\n    const sprite = this.sprites[0];\n\n    // find the current height fo the text in pixels\n    const height = sprite.height;\n\n    // calculate appropriate scale for font size\n    const scale = options.fontSize / height;\n\n    const length = text.length * sprite.width * scale + text.length * options.letterSpacing;\n\n    let currX = x;\n    if (options.textAlign === TextAlign.Left || options.textAlign === TextAlign.Start) {\n      currX = x;\n    } else if (options.textAlign === TextAlign.Right || options.textAlign === TextAlign.End) {\n      currX = x - length;\n    } else if (options.textAlign === TextAlign.Center) {\n      currX = x - length / 2;\n    }\n\n    let currY = y - height * scale;\n    if (options.baseAlign === BaseAlign.Top || options.baseAlign === BaseAlign.Hanging) {\n      currY = y;\n    } else if (\n      options.baseAlign === BaseAlign.Ideographic ||\n      options.baseAlign === BaseAlign.Bottom ||\n      options.baseAlign === BaseAlign.Alphabetic\n    ) {\n      currY = y - height * scale;\n    } else if (options.baseAlign === BaseAlign.Middle) {\n      currY = y - (height * scale) / 2;\n    }\n\n    for (let i = 0; i < text.length; i++) {\n      let character = text[i];\n      if (this.caseInsensitive) {\n        character = character.toLowerCase();\n      }\n      try {\n        // if text shadow\n        if (this._textShadowOn) {\n          this._textShadowSprites[character].drawAroundAnchor = false;\n          this._textShadowSprites[character].scale = vec(scale, scale);\n          this._textShadowSprites[character].draw(ctx, currX + this._shadowOffsetX, currY + this._shadowOffsetY);\n        }\n\n        const charSprite = this._spriteRecord[character];\n        charSprite.drawAroundAnchor = false;\n        charSprite.scale = vec(scale, scale);\n        charSprite.draw(ctx, currX, currY);\n        currX += charSprite.drawWidth + options.letterSpacing;\n      } catch (e) {\n        Logger.getInstance().error(`SpriteFont Error drawing char ${character}`);\n      }\n    }\n  }\n\n  private _parseOptions(options: SpriteFontOptions): SpriteFontOptions {\n    return {\n      fontSize: options.fontSize || 10,\n      letterSpacing: options.letterSpacing || 0,\n      color: options.color || Color.Black,\n      textAlign: typeof options.textAlign === undefined ? TextAlign.Left : options.textAlign,\n      baseAlign: typeof options.baseAlign === undefined ? BaseAlign.Bottom : options.baseAlign,\n      maxWidth: options.maxWidth || -1,\n      opacity: options.opacity || 0\n    };\n  }\n}\n","import { ImageSource } from './ImageSource';\r\nimport { Sprite } from './Sprite';\r\nimport { SpriteSheet as LegacySpriteSheet } from '../Drawing/SpriteSheet';\r\nimport { Logger } from '..';\r\n\r\n\r\n/**\r\n * Specify sprite sheet spacing options, useful if your sprites are not tightly packed\r\n * and have space between them.\r\n */\r\nexport interface SpriteSheetSpacingDimensions {\r\n  /**\r\n   * The starting point to offset and start slicing the sprite sheet from the top left of the image.\r\n   * Default is (0, 0)\r\n   */\r\n  originOffset?: { x?: number, y?: number };\r\n\r\n  /**\r\n   * The margin between sprites.\r\n   * Default is (0, 0)\r\n   */\r\n  margin?: {x?: number, y?: number};\r\n}\r\n\r\n/**\r\n * Sprite sheet options for slicing up images\r\n */\r\nexport interface SpriteSheetGridOptions {\r\n  /**\r\n   * Source image to use for each sprite\r\n   */\r\n  image: ImageSource;\r\n  /**\r\n   * Grid definition for the sprite sheet\r\n   */\r\n  grid: {\r\n    /**\r\n     * Number of rows in the sprite sheet\r\n     */\r\n    rows: number;\r\n    /**\r\n     * Number of columns in the sprite sheet\r\n     */\r\n    columns: number;\r\n    /**\r\n     * Width of each individual sprite\r\n     */\r\n    spriteWidth: number;\r\n    /**\r\n     * Height of each individual sprite\r\n     */\r\n    spriteHeight: number;\r\n  };\r\n  /**\r\n   * Optionally specifiy any spacing information between sprites\r\n   */\r\n  spacing?: SpriteSheetSpacingDimensions;\r\n}\r\n\r\nexport interface SpriteSheetOptions {\r\n  /**\r\n   * Source sprites for the sprite sheet\r\n   */\r\n  sprites: Sprite[];\r\n  /**\r\n   * Optionally specify the number of rows in a sprite sheet (default 1 row)\r\n   */\r\n  rows?: number;\r\n  /**\r\n   * Optionally specify the number of columns in a sprite sheet (default sprites.length)\r\n   */\r\n  columns?: number;\r\n}\r\n\r\n/**\r\n * Represents a collection of sprites from a source image with some organization in a grid\r\n */\r\nexport class SpriteSheet {\r\n  private _logger = Logger.getInstance();\r\n  public readonly sprites: Sprite[] = [];\r\n  public readonly rows: number;\r\n  public readonly columns: number;\r\n\r\n  /**\r\n   * Build a new sprite sheet from a list of sprites\r\n   *\r\n   * Use [[SpriteSheet.fromImageSource]] to create a SpriteSheet from an [[ImageSource]] organized in a grid\r\n   * @param options\r\n   */\r\n  constructor(options: SpriteSheetOptions) {\r\n    const { sprites, rows, columns } = options;\r\n    this.sprites = sprites;\r\n    this.rows = rows ?? 1;\r\n    this.columns = columns ?? this.sprites.length;\r\n  }\r\n\r\n  /**\r\n   * Find a sprite by their x/y position in the SpriteSheet, for example `getSprite(0, 0)` is the [[Sprite]] in the top-left\r\n   * @param x\r\n   * @param y\r\n   */\r\n  public getSprite(x: number, y: number): Sprite | null {\r\n    if (x >= this.columns || x < 0) {\r\n      this._logger.warn(`No sprite exists in the SpriteSheet at (${x}, ${y}), x: ${x} should be between 0 and ${this.columns - 1}`);\r\n      return null;\r\n    }\r\n    if (y >= this.rows || y < 0) {\r\n      this._logger.warn(`No sprite exists in the SpriteSheet at (${x}, ${y}), y: ${y} should be between 0 and ${this.rows - 1}`);\r\n      return null;\r\n    }\r\n    const spriteIndex = x + y * this.columns;\r\n    return this.sprites[spriteIndex];\r\n  }\r\n\r\n  /**\r\n   * To a graphics sprite sheet from a legacy sprite sheet\r\n   */\r\n  public static fromLegacySpriteSheet(legacySpriteSheet: LegacySpriteSheet): SpriteSheet {\r\n    const sprites = legacySpriteSheet.sprites.map(oldSprite => Sprite.fromLegacySprite(oldSprite));\r\n    return new SpriteSheet({\r\n      sprites\r\n    });\r\n  }\r\n\r\n  /**\r\n   * @deprecated\r\n   * @param spriteSheet\r\n   * @returns\r\n   */\r\n  public static toLegacySpriteSheet(spriteSheet: SpriteSheet): LegacySpriteSheet {\r\n    const sprites = spriteSheet.sprites.map(sprite => Sprite.toLegacySprite(sprite));\r\n    return new LegacySpriteSheet(sprites);\r\n  }\r\n\r\n  /**\r\n   * Create a SpriteSheet from an [[ImageSource]] organized in a grid\r\n   *\r\n   * Example:\r\n   * ```\r\n   * const spriteSheet = SpriteSheet.fromImageSource({\r\n   *   image: imageSource,\r\n   *   grid: {\r\n   *     rows: 5,\r\n   *     columns: 2,\r\n   *     spriteWidth: 32, // pixels\r\n   *     spriteHeight: 32 // pixels\r\n   *   },\r\n   *   // Optionally specify spacing\r\n   *   spacing: {\r\n   *     // pixels from the top left to start the sprite parsing\r\n   *     originOffset: {\r\n   *       x: 5,\r\n   *       y: 5\r\n   *     },\r\n   *     // pixels between each sprite while parsing\r\n   *     margin: {\r\n   *       x: 1,\r\n   *       y: 1\r\n   *     }\r\n   *   }\r\n   * })\r\n   * ```\r\n   *\r\n   * @param options\r\n   */\r\n  public static fromImageSource(options: SpriteSheetGridOptions): SpriteSheet {\r\n    const sprites: Sprite[] = [];\r\n    options.spacing = options.spacing ?? {};\r\n    const {\r\n      image,\r\n      grid: { rows, columns: cols, spriteWidth, spriteHeight },\r\n      spacing: { originOffset, margin }\r\n    } = options;\r\n    const offsetDefaults = { x: 0, y: 0, ...originOffset};\r\n    const marginDefaults = { x: 0, y: 0, ...margin};\r\n    for (let x = 0; x < cols; x++) {\r\n      for (let y = 0; y < rows; y++) {\r\n        sprites[x + y * cols] = new Sprite({\r\n          image: image,\r\n          sourceView: {\r\n            x: x * spriteWidth + marginDefaults.x * x + offsetDefaults.x,\r\n            y: y * spriteHeight + marginDefaults.y * y + offsetDefaults.y,\r\n            width: spriteWidth,\r\n            height: spriteHeight\r\n          },\r\n          destSize: { height: spriteHeight, width: spriteWidth }\r\n        });\r\n      }\r\n    }\r\n    return new SpriteSheet({\r\n      sprites: sprites,\r\n      rows: rows,\r\n      columns: cols\r\n    });\r\n  }\r\n}\r\n","import { BoundingBox } from './Collision/BoundingBox';\nimport { Engine } from './Engine';\nimport { Vector, vec } from './Math/vector';\nimport { Logger } from './Util/Log';\nimport { SpriteSheet } from './Drawing/SpriteSheet';\nimport * as Events from './Events';\nimport { Configurable } from './Configurable';\nimport { Entity } from './EntityComponentSystem/Entity';\nimport { TransformComponent } from './EntityComponentSystem/Components/TransformComponent';\nimport { BodyComponent } from './Collision/BodyComponent';\nimport { CollisionType } from './Collision/CollisionType';\nimport { Shape } from './Collision/Colliders/Shape';\nimport { ExcaliburGraphicsContext, GraphicsComponent, hasGraphicsTick } from './Graphics';\nimport * as Graphics from './Graphics';\nimport { CanvasDrawComponent, Sprite } from './Drawing/Index';\nimport { Sprite as LegacySprite } from './Drawing/Index';\nimport { removeItemFromArray } from './Util/Util';\nimport { obsolete } from './Util/Decorators';\nimport { MotionComponent } from './EntityComponentSystem/Components/MotionComponent';\nimport { ColliderComponent } from './Collision/ColliderComponent';\nimport { CompositeCollider } from './Collision/Colliders/CompositeCollider';\n\n/**\n * @hidden\n */\nexport class TileMapImpl extends Entity {\n  private _token = 0;\n  private _onScreenXStart: number = 0;\n  private _onScreenXEnd: number = 9999;\n  private _onScreenYStart: number = 0;\n  private _onScreenYEnd: number = 9999;\n  private _spriteSheets: { [key: string]: Graphics.SpriteSheet } = {};\n\n  private _legacySpriteMap = new Map<Graphics.Sprite, Sprite>();\n  public logger: Logger = Logger.getInstance();\n  public readonly data: Cell[] = [];\n  private _rows: Cell[][] = [];\n  private _cols: Cell[][] = [];\n  public visible = true;\n  public isOffscreen = false;\n  public readonly cellWidth: number;\n  public readonly cellHeight: number;\n  public readonly rows: number;\n  public readonly cols: number;\n\n  private _dirty = true;\n  public flagDirty() {\n    this._dirty = true;\n  }\n  private _transform: TransformComponent;\n  private _motion: MotionComponent;\n  private _collider: ColliderComponent;\n  private _composite: CompositeCollider;\n\n  public get x(): number {\n    return this._transform.pos.x ?? 0;\n  }\n\n  public set x(val: number) {\n    if (this._transform?.pos) {\n      this.get(TransformComponent).pos = vec(val, this.y);\n    }\n  }\n\n  public get y(): number {\n    return this._transform?.pos.y ?? 0;\n  }\n\n  public set y(val: number) {\n    if (this._transform?.pos) {\n      this._transform.pos = vec(this.x, val);\n    }\n  }\n\n  public get z(): number {\n    return this._transform.z ?? 0;\n  }\n\n  public set z(val: number) {\n    if (this._transform?.z) {\n      this._transform.z = val;\n    }\n  }\n\n  public get rotation(): number {\n    return this._transform?.rotation ?? 0;\n  }\n\n  public set rotation(val: number) {\n    if (this._transform?.rotation) {\n      this._transform.rotation = val;\n    }\n  }\n\n  public get scale(): Vector {\n    return this._transform?.scale ?? Vector.One;\n  }\n  public set scale(val: Vector) {\n    if (this._transform?.scale) {\n      this._transform.scale = val;\n    }\n  }\n\n  public get pos(): Vector {\n    return this._transform.pos;\n  }\n\n  public set pos(val: Vector) {\n    this._transform.pos = val;\n  }\n\n  public get vel(): Vector {\n    return this._motion.vel;\n  }\n\n  public set vel(val: Vector) {\n    this._motion.vel = val;\n  }\n\n  public on(eventName: Events.preupdate, handler: (event: Events.PreUpdateEvent<TileMap>) => void): void;\n  public on(eventName: Events.postupdate, handler: (event: Events.PostUpdateEvent<TileMap>) => void): void;\n  public on(eventName: Events.predraw, handler: (event: Events.PreDrawEvent) => void): void;\n  public on(eventName: Events.postdraw, handler: (event: Events.PostDrawEvent) => void): void;\n  public on(eventName: string, handler: (event: Events.GameEvent<any>) => void): void;\n  public on(eventName: string, handler: (event: any) => void): void {\n    super.on(eventName, handler);\n  }\n\n  /**\n   * @param xOrConfig     The x coordinate to anchor the TileMap's upper left corner (should not be changed once set) or TileMap option bag\n   * @param y             The y coordinate to anchor the TileMap's upper left corner (should not be changed once set)\n   * @param cellWidth     The individual width of each cell (in pixels) (should not be changed once set)\n   * @param cellHeight    The individual height of each cell (in pixels) (should not be changed once set)\n   * @param rows          The number of rows in the TileMap (should not be changed once set)\n   * @param cols          The number of cols in the TileMap (should not be changed once set)\n   */\n  constructor(xOrConfig: number | TileMapArgs, y: number, cellWidth: number, cellHeight: number, rows: number, cols: number) {\n    super();\n    if (xOrConfig && typeof xOrConfig === 'object') {\n      const config = xOrConfig;\n      xOrConfig = config.x;\n      y = config.y;\n      cellWidth = config.cellWidth;\n      cellHeight = config.cellHeight;\n      rows = config.rows;\n      cols = config.cols;\n    }\n    this.addComponent(new TransformComponent());\n    this.addComponent(new MotionComponent());\n    this.addComponent(\n      new BodyComponent({\n        type: CollisionType.Fixed\n      })\n    );\n    this.addComponent(new CanvasDrawComponent((ctx, delta) => this.draw(ctx, delta)));\n    this.addComponent(\n      new GraphicsComponent({\n        onPostDraw: (ctx, delta) => this.draw(ctx, delta)\n      })\n    );\n    this.addComponent(new ColliderComponent());\n    this._transform = this.get(TransformComponent);\n    this._motion = this.get(MotionComponent);\n    this._collider = this.get(ColliderComponent);\n    this._composite = this._collider.useCompositeCollider([]);\n\n    this.x = <number>xOrConfig;\n    this.y = y;\n    this.cellWidth = cellWidth;\n    this.cellHeight = cellHeight;\n    this.rows = rows;\n    this.cols = cols;\n    this.data = new Array<Cell>(rows * cols);\n    this._rows = new Array(rows);\n    this._cols = new Array(cols);\n    let currentCol: Cell[] = [];\n    for (let i = 0; i < cols; i++) {\n      for (let j = 0; j < rows; j++) {\n        const cd = new Cell(i * cellWidth + <number>xOrConfig, j * cellHeight + y, cellWidth, cellHeight, i + j * cols);\n        cd.map = this;\n        this.data[i + j * cols] = cd;\n        currentCol.push(cd);\n        if (!this._rows[j]) {\n          this._rows[j] = [];\n        }\n        this._rows[j].push(cd);\n      }\n      this._cols[i] = currentCol;\n      currentCol = [];\n    }\n\n    this.get(GraphicsComponent).localBounds = new BoundingBox({\n      left: 0,\n      top: 0,\n      right: this.cols * this.cellWidth,\n      bottom: this.rows * this.cellHeight\n    });\n  }\n\n  public _initialize(engine: Engine) {\n    super._initialize(engine);\n  }\n\n  /**\n   *\n   * @param key\n   * @param spriteSheet\n   * @deprecated No longer used, will be removed in v0.26.0\n   */\n  public registerSpriteSheet(key: string, spriteSheet: SpriteSheet): void;\n  public registerSpriteSheet(key: string, spriteSheet: Graphics.SpriteSheet): void;\n  @obsolete({ message: 'No longer used, will be removed in v0.26.0' })\n  public registerSpriteSheet(key: string, spriteSheet: SpriteSheet | Graphics.SpriteSheet): void {\n    if (spriteSheet instanceof Graphics.SpriteSheet) {\n      this._spriteSheets[key] = spriteSheet;\n    } else {\n      this._spriteSheets[key] = Graphics.SpriteSheet.fromLegacySpriteSheet(spriteSheet);\n    }\n  }\n\n  /**\n   * Tiles colliders based on the solid tiles in the tilemap.\n   */\n  private _updateColliders(): void {\n    this._composite.clearColliders();\n    const colliders: BoundingBox[] = [];\n    let current: BoundingBox;\n    // Bad square tessalation algo\n    for (let i = 0; i < this.cols; i++) {\n      // Scan column for colliders\n      for (let j = 0; j < this.rows; j++) {\n        // Columns start with a new collider\n        if (j === 0) {\n          current = null;\n        }\n        const tile = this.data[i + j * this.cols];\n        // Current tile in column is solid build up current collider\n        if (tile.solid) {\n          if (!current) {\n            current = tile.bounds;\n          } else {\n            current = current.combine(tile.bounds);\n          }\n        } else {\n          // Not solid skip and cut off the current collider\n          if (current) {\n            colliders.push(current);\n          }\n          current = null;\n        }\n      }\n      // After a column is complete check to see if it can be merged into the last one\n      if (current) {\n        // if previous is the same combine it\n        const prev = colliders[colliders.length - 1];\n        if (prev && prev.top === current.top && prev.bottom === current.bottom) {\n          colliders[colliders.length - 1] = prev.combine(current);\n        } else {\n          // else new collider\n          colliders.push(current);\n        }\n      }\n    }\n    this._composite = this._collider.useCompositeCollider([]);\n    for (const c of colliders) {\n      const collider = Shape.Box(c.width, c.height, Vector.Zero, vec(c.left - this.pos.x, c.top - this.pos.y));\n      collider.owner = this;\n      this._composite.addCollider(collider);\n    }\n    this._collider.update();\n  }\n\n  /**\n   * Returns the [[Cell]] by index (row major order)\n   */\n  public getCellByIndex(index: number): Cell {\n    return this.data[index];\n  }\n  /**\n   * Returns the [[Cell]] by its x and y coordinates\n   */\n  public getCell(x: number, y: number): Cell {\n    if (x < 0 || y < 0 || x >= this.cols || y >= this.rows) {\n      return null;\n    }\n    return this.data[x + y * this.cols];\n  }\n  /**\n   * Returns the [[Cell]] by testing a point in global coordinates,\n   * returns `null` if no cell was found.\n   */\n  public getCellByPoint(x: number, y: number): Cell {\n    x = Math.floor((x - this.pos.x) / this.cellWidth);\n    y = Math.floor((y - this.pos.y) / this.cellHeight);\n    const cell = this.getCell(x, y);\n    if (x >= 0 && y >= 0 && x < this.cols && y < this.rows && cell) {\n      return cell;\n    }\n    return null;\n  }\n\n  public getRows(): readonly Cell[][] {\n    return this._rows;\n  }\n\n  public getColumns(): readonly Cell[][] {\n    return this._cols;\n  }\n\n  public onPreUpdate(_engine: Engine, _delta: number) {\n    // Override me\n  }\n\n  public onPostUpdate(_engine: Engine, _delta: number) {\n    // Override me\n  }\n\n  public update(engine: Engine, delta: number) {\n    this.onPreUpdate(engine, delta);\n    this.emit('preupdate', new Events.PreUpdateEvent(engine, delta, this));\n    if (this._dirty) {\n      this._dirty = false;\n      this._updateColliders();\n    }\n\n    this._token++;\n    const worldBounds = engine.getWorldBounds();\n    const worldCoordsUpperLeft = vec(worldBounds.left, worldBounds.top);\n    const worldCoordsLowerRight = vec(worldBounds.right, worldBounds.bottom);\n\n    this._onScreenXStart = Math.max(Math.floor((worldCoordsUpperLeft.x - this.x) / this.cellWidth) - 2, 0);\n    this._onScreenYStart = Math.max(Math.floor((worldCoordsUpperLeft.y - this.y) / this.cellHeight) - 2, 0);\n    this._onScreenXEnd = Math.max(Math.floor((worldCoordsLowerRight.x - this.x) / this.cellWidth) + 2, 0);\n    this._onScreenYEnd = Math.max(Math.floor((worldCoordsLowerRight.y - this.y) / this.cellHeight) + 2, 0);\n    this._transform.pos = vec(this.x, this.y);\n\n    this.onPostUpdate(engine, delta);\n    this.emit('postupdate', new Events.PostUpdateEvent(engine, delta, this));\n  }\n\n  /**\n   * Draws the tile map to the screen. Called by the [[Scene]].\n   * @param ctx CanvasRenderingContext2D or ExcaliburGraphicsContext\n   * @param delta  The number of milliseconds since the last draw\n   */\n  public draw(ctx: CanvasRenderingContext2D | ExcaliburGraphicsContext, delta: number): void {\n    this.emit('predraw', new Events.PreDrawEvent(ctx as any, delta, this)); // TODO fix event\n\n    let x = this._onScreenXStart;\n    const xEnd = Math.min(this._onScreenXEnd, this.cols);\n    let y = this._onScreenYStart;\n    const yEnd = Math.min(this._onScreenYEnd, this.rows);\n\n    let graphics: Graphics.Graphic[], graphicsIndex: number, graphicsLen: number;\n\n    for (x; x < xEnd; x++) {\n      for (y; y < yEnd; y++) {\n        // get non-negative tile sprites\n        graphics = this.getCell(x, y).graphics;\n\n        for (graphicsIndex = 0, graphicsLen = graphics.length; graphicsIndex < graphicsLen; graphicsIndex++) {\n          // draw sprite, warning if sprite doesn't exist\n          const graphic = graphics[graphicsIndex];\n          if (graphic) {\n            if (!(ctx instanceof CanvasRenderingContext2D)) {\n              if (hasGraphicsTick(graphic)) {\n                graphic?.tick(delta, this._token);\n              }\n              graphic.draw(ctx, x * this.cellWidth, y * this.cellHeight);\n            } else if (graphic instanceof Graphics.Sprite) {\n              // TODO legacy drawing mode\n              if (!this._legacySpriteMap.has(graphic)) {\n                this._legacySpriteMap.set(graphic, Graphics.Sprite.toLegacySprite(graphic));\n              }\n              this._legacySpriteMap.get(graphic).draw(ctx, x * this.cellWidth, y * this.cellHeight);\n            }\n          }\n        }\n      }\n      y = this._onScreenYStart;\n    }\n\n    this.emit('postdraw', new Events.PostDrawEvent(ctx as any, delta, this));\n  }\n}\n\nexport interface TileMapArgs extends Partial<TileMapImpl> {\n  x: number;\n  y: number;\n  cellWidth: number;\n  cellHeight: number;\n  rows: number;\n  cols: number;\n}\n\n/**\n * The [[TileMap]] class provides a lightweight way to do large complex scenes with collision\n * without the overhead of actors.\n */\nexport class TileMap extends Configurable(TileMapImpl) {\n  constructor(config: TileMapArgs);\n  constructor(x: number, y: number, cellWidth: number, cellHeight: number, rows: number, cols: number);\n  constructor(xOrConfig: number | TileMapArgs, y?: number, cellWidth?: number, cellHeight?: number, rows?: number, cols?: number) {\n    super(xOrConfig, y, cellWidth, cellHeight, rows, cols);\n  }\n}\n\n/**\n * @hidden\n */\nexport class CellImpl extends Entity {\n  private _bounds: BoundingBox;\n  /**\n   * World space x coordinate of the left of the cell\n   */\n  public readonly x: number;\n  /**\n   * World space y coordinate of the top of the cell\n   */\n  public readonly y: number;\n  /**\n   * Width of the cell in pixels\n   */\n  public readonly width: number;\n  /**\n   * Height of the cell in pixels\n   */\n  public readonly height: number;\n  /**\n   * Current index in the tilemap\n   */\n  public readonly index: number;\n\n  /**\n   * Reference to the TileMap this Cell is associated with\n   */\n  public map: TileMap;\n\n  private _solid = false;\n  /**\n   * Wether this cell should be treated as solid by the tilemap\n   */\n  public get solid(): boolean {\n    return this._solid;\n  }\n  /**\n   * Wether this cell should be treated as solid by the tilemap\n   */\n  public set solid(val: boolean) {\n    this.map?.flagDirty();\n    this._solid = val;\n  }\n  /**\n   * Current list of graphics for this cell\n   */\n  public readonly graphics: Graphics.Graphic[] = [];\n  /**\n   * Abitrary data storage per cell, useful for any game specific data\n   */\n  public data = new Map<string, any>();\n\n  /**\n   * @param xOrConfig Gets or sets x coordinate of the cell in world coordinates or cell option bag\n   * @param y       Gets or sets y coordinate of the cell in world coordinates\n   * @param width   Gets or sets the width of the cell\n   * @param height  Gets or sets the height of the cell\n   * @param index   The index of the cell in row major order\n   * @param solid   Gets or sets whether this cell is solid\n   * @param graphics The list of tile graphics to use to draw in this cell (in order)\n   */\n  constructor(\n    xOrConfig: number | CellArgs,\n    y: number,\n    width: number,\n    height: number,\n    index: number,\n    solid: boolean = false,\n    graphics: Graphics.Graphic[] = []\n  ) {\n    super();\n    if (xOrConfig && typeof xOrConfig === 'object') {\n      const config = xOrConfig;\n      xOrConfig = config.x;\n      y = config.y;\n      width = config.width;\n      height = config.height;\n      index = config.index;\n      solid = config.solid;\n      graphics = config.sprites;\n    }\n    this.x = <number>xOrConfig;\n    this.y = y;\n    this.width = width;\n    this.height = height;\n    this.index = index;\n    this.solid = solid;\n    this.graphics = graphics;\n    this._bounds = new BoundingBox(this.x, this.y, this.x + this.width, this.y + this.height);\n  }\n\n  public get bounds() {\n    return this._bounds;\n  }\n\n  public get center(): Vector {\n    return new Vector(this.x + this.width / 2, this.y + this.height / 2);\n  }\n\n  /**\n   * Add another [[Sprite]] to this cell\n   * @deprecated Use addSprite, will be removed in v0.26.0\n   */\n  @obsolete({ message: 'Will be removed in v0.26.0', alternateMethod: 'addSprite' })\n  public pushSprite(sprite: Graphics.Sprite | LegacySprite) {\n    this.addGraphic(sprite);\n  }\n\n  /**\n   * Add another [[Graphic]] to this TileMap cell\n   * @param graphic\n   */\n  public addGraphic(graphic: Graphics.Graphic | LegacySprite) {\n    if (graphic instanceof LegacySprite) {\n      this.graphics.push(Graphics.Sprite.fromLegacySprite(graphic));\n    } else {\n      this.graphics.push(graphic);\n    }\n  }\n\n  /**\n   * Remove an instance of a [[Graphic]] from this cell\n   */\n  public removeGraphic(graphic: Graphics.Graphic | LegacySprite) {\n    removeItemFromArray(graphic, this.graphics);\n  }\n\n  /**\n   * Clear all graphis from this cell\n   */\n  public clearGraphics() {\n    this.graphics.length = 0;\n  }\n}\n\nexport interface CellArgs extends Partial<CellImpl> {\n  x: number;\n  y: number;\n  width: number;\n  height: number;\n  index: number;\n  solid?: boolean;\n  sprites?: Graphics.Sprite[];\n}\n\n/**\n * TileMap Cell\n *\n * A light-weight object that occupies a space in a collision map. Generally\n * created by a [[TileMap]].\n *\n * Cells can draw multiple sprites. Note that the order of drawing is the order\n * of the sprites in the array so the last one will be drawn on top. You can\n * use transparency to create layers this way.\n */\nexport class Cell extends Configurable(CellImpl) {\n  constructor(config: CellArgs);\n  constructor(x: number, y: number, width: number, height: number, index: number, solid?: boolean, sprites?: Graphics.Sprite[]);\n  constructor(\n    xOrConfig: number | CellArgs,\n    y?: number,\n    width?: number,\n    height?: number,\n    index?: number,\n    solid?: boolean,\n    sprites?: Graphics.Sprite[]\n  ) {\n    super(xOrConfig, y, width, height, index, solid, sprites);\n  }\n}\n","import { Engine } from './Engine';\r\nimport { EasingFunction, EasingFunctions } from './Util/EasingFunctions';\r\nimport { Vector, vec } from './Math/vector';\r\nimport { Actor } from './Actor';\r\nimport { removeItemFromArray } from './Util/Util';\r\nimport { CanUpdate, CanInitialize } from './Interfaces/LifecycleEvents';\r\nimport { PreUpdateEvent, PostUpdateEvent, GameEvent, InitializeEvent } from './Events';\r\nimport { Class } from './Class';\r\nimport { BoundingBox } from './Collision/BoundingBox';\r\nimport { Logger } from './Util/Log';\r\nimport { ExcaliburGraphicsContext } from './Graphics/Context/ExcaliburGraphicsContext';\r\nimport { watchAny } from './Util/Watch';\r\n\r\n/**\r\n * Interface that describes a custom camera strategy for tracking targets\r\n */\r\nexport interface CameraStrategy<T> {\r\n  /**\r\n   * Target of the camera strategy that will be passed to the action\r\n   */\r\n  target: T;\r\n\r\n  /**\r\n   * Camera strategies perform an action to calculate a new focus returned out of the strategy\r\n   * @param target The target object to apply this camera strategy (if any)\r\n   * @param camera The current camera implementation in excalibur running the game\r\n   * @param engine The current engine running the game\r\n   * @param delta The elapsed time in milliseconds since the last frame\r\n   */\r\n  action: (target: T, camera: Camera, engine: Engine, delta: number) => Vector;\r\n}\r\n\r\n/**\r\n * Container to house convenience strategy methods\r\n * @internal\r\n */\r\nexport class StrategyContainer {\r\n  constructor(public camera: Camera) {}\r\n\r\n  /**\r\n   * Creates and adds the [[LockCameraToActorStrategy]] on the current camera.\r\n   * @param actor The actor to lock the camera to\r\n   */\r\n  public lockToActor(actor: Actor) {\r\n    this.camera.addStrategy(new LockCameraToActorStrategy(actor));\r\n  }\r\n\r\n  /**\r\n   * Creates and adds the [[LockCameraToActorAxisStrategy]] on the current camera\r\n   * @param actor The actor to lock the camera to\r\n   * @param axis The axis to follow the actor on\r\n   */\r\n  public lockToActorAxis(actor: Actor, axis: Axis) {\r\n    this.camera.addStrategy(new LockCameraToActorAxisStrategy(actor, axis));\r\n  }\r\n\r\n  /**\r\n   * Creates and adds the [[ElasticToActorStrategy]] on the current camera\r\n   * If cameraElasticity < cameraFriction < 1.0, the behavior will be a dampened spring that will slowly end at the target without bouncing\r\n   * If cameraFriction < cameraElasticity < 1.0, the behavior will be an oscillating spring that will over\r\n   * correct and bounce around the target\r\n   *\r\n   * @param actor Target actor to elastically follow\r\n   * @param cameraElasticity [0 - 1.0] The higher the elasticity the more force that will drive the camera towards the target\r\n   * @param cameraFriction [0 - 1.0] The higher the friction the more that the camera will resist motion towards the target\r\n   */\r\n  public elasticToActor(actor: Actor, cameraElasticity: number, cameraFriction: number) {\r\n    this.camera.addStrategy(new ElasticToActorStrategy(actor, cameraElasticity, cameraFriction));\r\n  }\r\n\r\n  /**\r\n   * Creates and adds the [[RadiusAroundActorStrategy]] on the current camera\r\n   * @param actor Target actor to follow when it is \"radius\" pixels away\r\n   * @param radius Number of pixels away before the camera will follow\r\n   */\r\n  public radiusAroundActor(actor: Actor, radius: number) {\r\n    this.camera.addStrategy(new RadiusAroundActorStrategy(actor, radius));\r\n  }\r\n\r\n  /**\r\n   * Creates and adds the [[LimitCameraBoundsStrategy]] on the current camera\r\n   * @param box The bounding box to limit the camera to.\r\n   */\r\n  public limitCameraBounds(box: BoundingBox) {\r\n    this.camera.addStrategy(new LimitCameraBoundsStrategy(box));\r\n  }\r\n}\r\n\r\n/**\r\n * Camera axis enum\r\n */\r\nexport enum Axis {\r\n  X,\r\n  Y\r\n}\r\n\r\n/**\r\n * Lock a camera to the exact x/y position of an actor.\r\n */\r\nexport class LockCameraToActorStrategy implements CameraStrategy<Actor> {\r\n  constructor(public target: Actor) {}\r\n  public action = (target: Actor, _cam: Camera, _eng: Engine, _delta: number) => {\r\n    const center = target.center;\r\n    return center;\r\n  };\r\n}\r\n\r\n/**\r\n * Lock a camera to a specific axis around an actor.\r\n */\r\nexport class LockCameraToActorAxisStrategy implements CameraStrategy<Actor> {\r\n  constructor(public target: Actor, public axis: Axis) {}\r\n  public action = (target: Actor, cam: Camera, _eng: Engine, _delta: number) => {\r\n    const center = target.center;\r\n    const currentFocus = cam.getFocus();\r\n    if (this.axis === Axis.X) {\r\n      return new Vector(center.x, currentFocus.y);\r\n    } else {\r\n      return new Vector(currentFocus.x, center.y);\r\n    }\r\n  };\r\n}\r\n\r\n/**\r\n * Using [Hook's law](https://en.wikipedia.org/wiki/Hooke's_law), elastically move the camera towards the target actor.\r\n */\r\nexport class ElasticToActorStrategy implements CameraStrategy<Actor> {\r\n  /**\r\n   * If cameraElasticity < cameraFriction < 1.0, the behavior will be a dampened spring that will slowly end at the target without bouncing\r\n   * If cameraFriction < cameraElasticity < 1.0, the behavior will be an oscillating spring that will over\r\n   * correct and bounce around the target\r\n   *\r\n   * @param target Target actor to elastically follow\r\n   * @param cameraElasticity [0 - 1.0] The higher the elasticity the more force that will drive the camera towards the target\r\n   * @param cameraFriction [0 - 1.0] The higher the friction the more that the camera will resist motion towards the target\r\n   */\r\n  constructor(public target: Actor, public cameraElasticity: number, public cameraFriction: number) {}\r\n  public action = (target: Actor, cam: Camera, _eng: Engine, _delta: number) => {\r\n    const position = target.center;\r\n    let focus = cam.getFocus();\r\n    let cameraVel = cam.vel.clone();\r\n\r\n    // Calculate the stretch vector, using the spring equation\r\n    // F = kX\r\n    // https://en.wikipedia.org/wiki/Hooke's_law\r\n    // Apply to the current camera velocity\r\n    const stretch = position.sub(focus).scale(this.cameraElasticity); // stretch is X\r\n    cameraVel = cameraVel.add(stretch);\r\n\r\n    // Calculate the friction (-1 to apply a force in the opposition of motion)\r\n    // Apply to the current camera velocity\r\n    const friction = cameraVel.scale(-1).scale(this.cameraFriction);\r\n    cameraVel = cameraVel.add(friction);\r\n\r\n    // Update position by velocity deltas\r\n    focus = focus.add(cameraVel);\r\n\r\n    return focus;\r\n  };\r\n}\r\n\r\nexport class RadiusAroundActorStrategy implements CameraStrategy<Actor> {\r\n  /**\r\n   *\r\n   * @param target Target actor to follow when it is \"radius\" pixels away\r\n   * @param radius Number of pixels away before the camera will follow\r\n   */\r\n  constructor(public target: Actor, public radius: number) {}\r\n  public action = (target: Actor, cam: Camera, _eng: Engine, _delta: number) => {\r\n    const position = target.center;\r\n    const focus = cam.getFocus();\r\n\r\n    const direction = position.sub(focus);\r\n    const distance = direction.size;\r\n    if (distance >= this.radius) {\r\n      const offset = distance - this.radius;\r\n      return focus.add(direction.normalize().scale(offset));\r\n    }\r\n    return focus;\r\n  };\r\n}\r\n\r\n/**\r\n * Prevent a camera from going beyond the given camera dimensions.\r\n */\r\nexport class LimitCameraBoundsStrategy implements CameraStrategy<BoundingBox> {\r\n  /**\r\n   * Useful for limiting the camera to a [[TileMap]]'s dimensions, or a specific area inside the map.\r\n   *\r\n   * Note that this strategy does not perform any movement by itself.\r\n   * It only sets the camera position to within the given bounds when the camera has gone beyond them.\r\n   * Thus, it is a good idea to combine it with other camera strategies and set this strategy as the last one.\r\n   *\r\n   * Make sure that the camera bounds are at least as large as the viewport size.\r\n   *\r\n   * @param target The bounding box to limit the camera to\r\n   */\r\n\r\n  boundSizeChecked: boolean = false; // Check and warn only once\r\n\r\n  constructor(public target: BoundingBox) {}\r\n\r\n  public action = (target: BoundingBox, cam: Camera, _eng: Engine, _delta: number) => {\r\n    const focus = cam.getFocus();\r\n\r\n    if (!this.boundSizeChecked) {\r\n      if (target.bottom - target.top < _eng.drawHeight || target.right - target.left < _eng.drawWidth) {\r\n        Logger.getInstance().warn('Camera bounds should not be smaller than the engine viewport');\r\n      }\r\n      this.boundSizeChecked = true;\r\n    }\r\n\r\n    let focusX = focus.x;\r\n    let focusY = focus.y;\r\n    if (focus.x < target.left + _eng.halfDrawWidth) {\r\n      focusX = target.left + _eng.halfDrawWidth;\r\n    } else if (focus.x > target.right - _eng.halfDrawWidth) {\r\n      focusX = target.right - _eng.halfDrawWidth;\r\n    }\r\n\r\n    if (focus.y < target.top + _eng.halfDrawHeight) {\r\n      focusY = target.top + _eng.halfDrawHeight;\r\n    } else if (focus.y > target.bottom - _eng.halfDrawHeight) {\r\n      focusY = target.bottom - _eng.halfDrawHeight;\r\n    }\r\n\r\n    return vec(focusX, focusY);\r\n  };\r\n}\r\n\r\n/**\r\n * Cameras\r\n *\r\n * [[Camera]] is the base class for all Excalibur cameras. Cameras are used\r\n * to move around your game and set focus. They are used to determine\r\n * what is \"off screen\" and can be used to scale the game.\r\n *\r\n */\r\nexport class Camera extends Class implements CanUpdate, CanInitialize {\r\n  protected _follow: Actor;\r\n\r\n  private _cameraStrategies: CameraStrategy<any>[] = [];\r\n\r\n  public strategy: StrategyContainer = new StrategyContainer(this);\r\n\r\n  /**\r\n   * Get or set current zoom of the camera, defaults to 1\r\n   */\r\n  private _z = 1;\r\n  public get zoom(): number {\r\n    return this._z;\r\n  }\r\n\r\n  public set zoom(val: number) {\r\n    this._z = val;\r\n    if (this._engine) {\r\n      this._halfWidth = this._engine.halfDrawWidth;\r\n      this._halfHeight = this._engine.halfDrawHeight;\r\n    }\r\n  }\r\n  /**\r\n   * Get or set rate of change in zoom, defaults to 0\r\n   */\r\n  public dz: number = 0;\r\n  /**\r\n   * Get or set zoom acceleration\r\n   */\r\n  public az: number = 0;\r\n\r\n  /**\r\n   * Current rotation of the camera\r\n   */\r\n  public rotation: number = 0;\r\n\r\n  /**\r\n   * Current angular velocity\r\n   */\r\n  public rx: number = 0;\r\n\r\n  /**\r\n   * Get or set the camera's angular velocity\r\n   */\r\n  public get angularVelocity(): number {\r\n    return this.rx;\r\n  }\r\n\r\n  public set angularVelocity(value: number) {\r\n    this.rx = value;\r\n  }\r\n\r\n  /**\r\n   * Get or set the camera's position\r\n   */\r\n  private _posChanged = false;\r\n  private _pos: Vector = watchAny(Vector.Zero, () => (this._posChanged = true));\r\n  public get pos(): Vector {\r\n    return this._pos;\r\n  }\r\n  public set pos(vec: Vector) {\r\n    this._pos = watchAny(vec, () => (this._posChanged = true));\r\n    this._posChanged = true;\r\n  }\r\n\r\n  /**\r\n   * Get or set the camera's velocity\r\n   */\r\n  public vel: Vector = Vector.Zero;\r\n\r\n  /**\r\n   * GEt or set the camera's acceleration\r\n   */\r\n  public acc: Vector = Vector.Zero;\r\n\r\n  private _cameraMoving: boolean = false;\r\n  private _currentLerpTime: number = 0;\r\n  private _lerpDuration: number = 1000; // 1 second\r\n  private _lerpStart: Vector = null;\r\n  private _lerpEnd: Vector = null;\r\n  private _lerpResolve: (value: Vector) => void;\r\n  private _lerpPromise: Promise<Vector>;\r\n\r\n  //camera effects\r\n  protected _isShaking: boolean = false;\r\n  private _shakeMagnitudeX: number = 0;\r\n  private _shakeMagnitudeY: number = 0;\r\n  private _shakeDuration: number = 0;\r\n  private _elapsedShakeTime: number = 0;\r\n  private _xShake: number = 0;\r\n  private _yShake: number = 0;\r\n\r\n  protected _isZooming: boolean = false;\r\n  private _zoomStart: number = 1;\r\n  private _zoomEnd: number = 1;\r\n  private _currentZoomTime: number = 0;\r\n  private _zoomDuration: number = 0;\r\n\r\n  private _zoomResolve: (val: boolean) => void;\r\n  private _zoomPromise: Promise<boolean>;\r\n  private _zoomEasing: EasingFunction = EasingFunctions.EaseInOutCubic;\r\n  private _easing: EasingFunction = EasingFunctions.EaseInOutCubic;\r\n\r\n  private _halfWidth: number = 0;\r\n  private _halfHeight: number = 0;\r\n\r\n  /**\r\n   * Get the camera's x position\r\n   */\r\n  public get x() {\r\n    return this.pos.x;\r\n  }\r\n\r\n  /**\r\n   * Set the camera's x position (cannot be set when following an [[Actor]] or when moving)\r\n   */\r\n  public set x(value: number) {\r\n    if (!this._follow && !this._cameraMoving) {\r\n      this.pos = vec(value, this.pos.y);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get the camera's y position\r\n   */\r\n  public get y() {\r\n    return this.pos.y;\r\n  }\r\n\r\n  /**\r\n   * Set the camera's y position (cannot be set when following an [[Actor]] or when moving)\r\n   */\r\n  public set y(value: number) {\r\n    if (!this._follow && !this._cameraMoving) {\r\n      this.pos = vec(this.pos.x, value);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get or set the camera's x velocity\r\n   */\r\n  public get dx() {\r\n    return this.vel.x;\r\n  }\r\n\r\n  public set dx(value: number) {\r\n    this.vel = vec(value, this.vel.y);\r\n  }\r\n\r\n  /**\r\n   * Get or set the camera's y velocity\r\n   */\r\n  public get dy() {\r\n    return this.vel.y;\r\n  }\r\n\r\n  public set dy(value: number) {\r\n    this.vel = vec(this.vel.x, value);\r\n  }\r\n\r\n  /**\r\n   * Get or set the camera's x acceleration\r\n   */\r\n  public get ax() {\r\n    return this.acc.x;\r\n  }\r\n\r\n  public set ax(value: number) {\r\n    this.acc = vec(value, this.acc.y);\r\n  }\r\n\r\n  /**\r\n   * Get or set the camera's y acceleration\r\n   */\r\n  public get ay() {\r\n    return this.acc.y;\r\n  }\r\n\r\n  public set ay(value: number) {\r\n    this.acc = vec(this.acc.x, value);\r\n  }\r\n\r\n  /**\r\n   * Returns the focal point of the camera, a new point giving the x and y position of the camera\r\n   */\r\n  public getFocus() {\r\n    return this.pos;\r\n  }\r\n\r\n  /**\r\n   * This moves the camera focal point to the specified position using specified easing function. Cannot move when following an Actor.\r\n   *\r\n   * @param pos The target position to move to\r\n   * @param duration The duration in milliseconds the move should last\r\n   * @param [easingFn] An optional easing function ([[ex.EasingFunctions.EaseInOutCubic]] by default)\r\n   * @returns A [[Promise]] that resolves when movement is finished, including if it's interrupted.\r\n   *          The [[Promise]] value is the [[Vector]] of the target position. It will be rejected if a move cannot be made.\r\n   */\r\n  public move(pos: Vector, duration: number, easingFn: EasingFunction = EasingFunctions.EaseInOutCubic): Promise<Vector> {\r\n    if (typeof easingFn !== 'function') {\r\n      throw 'Please specify an EasingFunction';\r\n    }\r\n\r\n    // cannot move when following an actor\r\n    if (this._follow) {\r\n      return Promise.reject(pos);\r\n    }\r\n\r\n    // resolve existing promise, if any\r\n    if (this._lerpPromise && this._lerpResolve) {\r\n      this._lerpResolve(pos);\r\n    }\r\n\r\n    this._lerpPromise = new Promise<Vector>((resolve) => {\r\n      this._lerpResolve = resolve;\r\n    });\r\n    this._lerpStart = this.getFocus().clone();\r\n    this._lerpDuration = duration;\r\n    this._lerpEnd = pos;\r\n    this._currentLerpTime = 0;\r\n    this._cameraMoving = true;\r\n    this._easing = easingFn;\r\n\r\n    return this._lerpPromise;\r\n  }\r\n\r\n  /**\r\n   * Sets the camera to shake at the specified magnitudes for the specified duration\r\n   * @param magnitudeX  The x magnitude of the shake\r\n   * @param magnitudeY  The y magnitude of the shake\r\n   * @param duration    The duration of the shake in milliseconds\r\n   */\r\n  public shake(magnitudeX: number, magnitudeY: number, duration: number) {\r\n    this._isShaking = true;\r\n    this._shakeMagnitudeX = magnitudeX;\r\n    this._shakeMagnitudeY = magnitudeY;\r\n    this._shakeDuration = duration;\r\n  }\r\n\r\n  /**\r\n   * Zooms the camera in or out by the specified scale over the specified duration.\r\n   * If no duration is specified, it take effect immediately.\r\n   * @param scale    The scale of the zoom\r\n   * @param duration The duration of the zoom in milliseconds\r\n   */\r\n  public zoomOverTime(scale: number, duration: number = 0, easingFn: EasingFunction = EasingFunctions.EaseInOutCubic): Promise<boolean> {\r\n    this._zoomPromise = new Promise<boolean>((resolve) => {\r\n      this._zoomResolve = resolve;\r\n    });\r\n\r\n    if (duration) {\r\n      this._isZooming = true;\r\n      this._zoomEasing = easingFn;\r\n      this._currentZoomTime = 0;\r\n      this._zoomDuration = duration;\r\n      this._zoomStart = this.zoom;\r\n      this._zoomEnd = scale;\r\n    } else {\r\n      this._isZooming = false;\r\n      this.zoom = scale;\r\n      return Promise.resolve(true);\r\n    }\r\n\r\n    return this._zoomPromise;\r\n  }\r\n\r\n  private _viewport: BoundingBox = null;\r\n  /**\r\n   * Gets the bounding box of the viewport of this camera in world coordinates\r\n   */\r\n  public get viewport(): BoundingBox {\r\n    if (this._viewport) {\r\n      return this._viewport;\r\n    }\r\n\r\n    return new BoundingBox(0, 0, 0, 0);\r\n  }\r\n\r\n  /**\r\n   * Adds a new camera strategy to this camera\r\n   * @param cameraStrategy Instance of an [[CameraStrategy]]\r\n   */\r\n  public addStrategy<T>(cameraStrategy: CameraStrategy<T>) {\r\n    this._cameraStrategies.push(cameraStrategy);\r\n  }\r\n\r\n  /**\r\n   * Removes a camera strategy by reference\r\n   * @param cameraStrategy Instance of an [[CameraStrategy]]\r\n   */\r\n  public removeStrategy<T>(cameraStrategy: CameraStrategy<T>) {\r\n    removeItemFromArray(cameraStrategy, this._cameraStrategies);\r\n  }\r\n\r\n  /**\r\n   * Clears all camera strategies from the camera\r\n   */\r\n  public clearAllStrategies() {\r\n    this._cameraStrategies.length = 0;\r\n  }\r\n\r\n  /**\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Internal _preupdate handler for [[onPreUpdate]] lifecycle event\r\n   * @internal\r\n   */\r\n  public _preupdate(engine: Engine, delta: number): void {\r\n    this.emit('preupdate', new PreUpdateEvent(engine, delta, this));\r\n    this.onPreUpdate(engine, delta);\r\n  }\r\n\r\n  /**\r\n   * Safe to override onPreUpdate lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\r\n   *\r\n   * `onPreUpdate` is called directly before a scene is updated.\r\n   */\r\n  public onPreUpdate(_engine: Engine, _delta: number): void {\r\n    // Overridable\r\n  }\r\n\r\n  /**\r\n   *  It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Internal _preupdate handler for [[onPostUpdate]] lifecycle event\r\n   * @internal\r\n   */\r\n  public _postupdate(engine: Engine, delta: number): void {\r\n    this.emit('postupdate', new PostUpdateEvent(engine, delta, this));\r\n    this.onPostUpdate(engine, delta);\r\n  }\r\n\r\n  /**\r\n   * Safe to override onPostUpdate lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\r\n   *\r\n   * `onPostUpdate` is called directly after a scene is updated.\r\n   */\r\n  public onPostUpdate(_engine: Engine, _delta: number): void {\r\n    // Overridable\r\n  }\r\n\r\n  private _engine: Engine;\r\n  private _isInitialized = false;\r\n  public get isInitialized() {\r\n    return this._isInitialized;\r\n  }\r\n\r\n  public _initialize(_engine: Engine) {\r\n    if (!this.isInitialized) {\r\n      this._engine = _engine;\r\n      this._halfWidth = _engine.halfDrawWidth;\r\n      this._halfHeight = _engine.halfDrawHeight;\r\n      // pos unset apply default position is center screen\r\n      if (!this._posChanged) {\r\n        this.pos.x = _engine.halfDrawWidth;\r\n        this.pos.y = _engine.halfDrawHeight;\r\n      }\r\n\r\n      this.onInitialize(_engine);\r\n      super.emit('initialize', new InitializeEvent(_engine, this));\r\n      this._isInitialized = true;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Safe to override onPostUpdate lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\r\n   *\r\n   * `onPostUpdate` is called directly after a scene is updated.\r\n   */\r\n  public onInitialize(_engine: Engine) {\r\n    // Overridable\r\n  }\r\n\r\n  public on(eventName: 'initialize', handler: (event: InitializeEvent) => void): void;\r\n  public on(eventName: 'preupdate', handler: (event: PreUpdateEvent) => void): void;\r\n  public on(eventName: 'postupdate', handler: (event: PostUpdateEvent) => void): void;\r\n  public on(eventName: any, handler: any) {\r\n    super.on(eventName, handler);\r\n  }\r\n\r\n  public off(eventName: 'initialize', handler?: (event: InitializeEvent) => void): void;\r\n  public off(eventName: 'preupdate', handler?: (event: PreUpdateEvent) => void): void;\r\n  public off(eventName: 'postupdate', handler?: (event: PostUpdateEvent) => void): void;\r\n  public off(eventName: string, handler: (event: GameEvent<Camera>) => void): void;\r\n  public off(eventName: string, handler: (event: any) => void): void {\r\n    super.off(eventName, handler);\r\n  }\r\n\r\n  public once(eventName: 'initialize', handler: (event: InitializeEvent) => void): void;\r\n  public once(eventName: 'preupdate', handler: (event: PreUpdateEvent) => void): void;\r\n  public once(eventName: 'postupdate', handler: (event: PostUpdateEvent) => void): void;\r\n  public once(eventName: string, handler: (event: GameEvent<Camera>) => void): void;\r\n  public once(eventName: string, handler: (event: any) => void): void {\r\n    super.once(eventName, handler);\r\n  }\r\n\r\n  public update(_engine: Engine, delta: number) {\r\n    this._initialize(_engine);\r\n    this._preupdate(_engine, delta);\r\n\r\n    // Update placements based on linear algebra\r\n    this.pos = this.pos.add(this.vel.scale(delta / 1000));\r\n    this.zoom += (this.dz * delta) / 1000;\r\n\r\n    this.vel = this.vel.add(this.acc.scale(delta / 1000));\r\n    this.dz += (this.az * delta) / 1000;\r\n\r\n    this.rotation += (this.angularVelocity * delta) / 1000;\r\n\r\n    if (this._isZooming) {\r\n      if (this._currentZoomTime < this._zoomDuration) {\r\n        const zoomEasing = this._zoomEasing;\r\n        const newZoom = zoomEasing(this._currentZoomTime, this._zoomStart, this._zoomEnd, this._zoomDuration);\r\n\r\n        this.zoom = newZoom;\r\n        this._currentZoomTime += delta;\r\n      } else {\r\n        this._isZooming = false;\r\n        this.zoom = this._zoomEnd;\r\n        this._currentZoomTime = 0;\r\n        this._zoomResolve(true);\r\n      }\r\n    }\r\n\r\n    if (this._cameraMoving) {\r\n      if (this._currentLerpTime < this._lerpDuration) {\r\n        const moveEasing = EasingFunctions.CreateVectorEasingFunction(this._easing);\r\n\r\n        const lerpPoint = moveEasing(this._currentLerpTime, this._lerpStart, this._lerpEnd, this._lerpDuration);\r\n\r\n        this.pos = lerpPoint;\r\n\r\n        this._currentLerpTime += delta;\r\n      } else {\r\n        this.pos = this._lerpEnd;\r\n        const end = this._lerpEnd.clone();\r\n\r\n        this._lerpStart = null;\r\n        this._lerpEnd = null;\r\n        this._currentLerpTime = 0;\r\n        this._cameraMoving = false;\r\n        // Order matters here, resolve should be last so any chain promises have a clean slate\r\n        this._lerpResolve(end);\r\n      }\r\n    }\r\n\r\n    if (this._isDoneShaking()) {\r\n      this._isShaking = false;\r\n      this._elapsedShakeTime = 0;\r\n      this._shakeMagnitudeX = 0;\r\n      this._shakeMagnitudeY = 0;\r\n      this._shakeDuration = 0;\r\n      this._xShake = 0;\r\n      this._yShake = 0;\r\n    } else {\r\n      this._elapsedShakeTime += delta;\r\n      this._xShake = ((Math.random() * this._shakeMagnitudeX) | 0) + 1;\r\n      this._yShake = ((Math.random() * this._shakeMagnitudeY) | 0) + 1;\r\n    }\r\n\r\n    for (const s of this._cameraStrategies) {\r\n      this.pos = s.action.call(s, s.target, this, _engine, delta);\r\n    }\r\n\r\n    this._viewport = new BoundingBox(\r\n      this.x - this._halfWidth,\r\n      this.y - this._halfHeight,\r\n      this.x + this._halfWidth,\r\n      this.y + this._halfHeight\r\n    );\r\n\r\n    this._postupdate(_engine, delta);\r\n  }\r\n\r\n  /**\r\n   * Applies the relevant transformations to the game canvas to \"move\" or apply effects to the Camera\r\n   * @param ctx    Canvas context to apply transformations\r\n   */\r\n  public draw(ctx: CanvasRenderingContext2D): void;\r\n  public draw(ctx: ExcaliburGraphicsContext): void;\r\n  public draw(ctx: CanvasRenderingContext2D | ExcaliburGraphicsContext): void {\r\n    let canvasWidth = 0;\r\n    let canvasHeight = 0;\r\n    if (ctx instanceof CanvasRenderingContext2D) {\r\n      canvasWidth = ctx.canvas.width;\r\n      canvasHeight = ctx.canvas.height;\r\n    } else {\r\n      canvasWidth = ctx.width;\r\n      canvasHeight = ctx.height;\r\n    }\r\n    const focus = this.getFocus();\r\n    const pixelRatio = this._engine ? this._engine.pixelRatio : 1;\r\n    const zoom = this.zoom;\r\n\r\n    const newCanvasWidth = canvasWidth / zoom / pixelRatio;\r\n    const newCanvasHeight = canvasHeight / zoom / pixelRatio;\r\n\r\n    ctx.scale(zoom, zoom);\r\n    ctx.translate(-focus.x + newCanvasWidth / 2 + this._xShake, -focus.y + newCanvasHeight / 2 + this._yShake);\r\n  }\r\n\r\n  /* istanbul ignore next */\r\n  public debugDraw(_ctx: CanvasRenderingContext2D) {\r\n    // pass\r\n  }\r\n\r\n  private _isDoneShaking(): boolean {\r\n    return !this._isShaking || this._elapsedShakeTime >= this._shakeDuration;\r\n  }\r\n}\r\n","import { Actor } from '../Actor';\r\nimport { ScreenElement } from '../ScreenElement';\r\nimport { Label } from '../Label';\r\nimport { Trigger } from '../Trigger';\r\n\r\n/**\r\n * Type guard to detect if something is an actor\r\n * @deprecated Will be removed in v0.26.0\r\n * @param actor\r\n */\r\nexport function isVanillaActor(actor: Actor) {\r\n  return !(actor instanceof ScreenElement) && !(actor instanceof Trigger) && !(actor instanceof Label);\r\n}\r\n\r\n/**\r\n * Type guard to detect a screen element\r\n * @todo move to ScreenElement\r\n */\r\nexport function isScreenElement(actor: Actor) {\r\n  return actor instanceof ScreenElement;\r\n}\r\n","import { Color } from './Color';\nimport { Engine } from './Engine';\nimport { EventDispatcher } from './EventDispatcher';\nimport { Vector } from './Math/vector';\nimport { ExitTriggerEvent, EnterTriggerEvent, CollisionEndEvent, CollisionStartEvent } from './Events';\nimport * as Util from './Util/Util';\nimport { CollisionType } from './Collision/CollisionType';\nimport { Entity } from './EntityComponentSystem';\nimport { Actor } from './Actor';\n\n/**\n * ITriggerOptions\n */\nexport interface TriggerOptions {\n  // position of the trigger\n  pos: Vector;\n  // width of the trigger\n  width: number;\n  // height of the trigger\n  height: number;\n  // whether the trigger is visible or not\n  visible: boolean;\n  // action to take when triggered\n  action: () => void;\n  // if specified the trigger will only fire on a specific actor and overrides any filter\n  target: Entity;\n  // Returns true if the triggers should fire on the collided actor\n  filter: (actor: Entity) => boolean;\n  // -1 if it should repeat forever\n  repeat: number;\n}\n\nconst triggerDefaults: Partial<TriggerOptions> = {\n  pos: Vector.Zero,\n  width: 10,\n  height: 10,\n  visible: false,\n  action: () => {\n    return;\n  },\n  filter: () => true,\n  repeat: -1\n};\n\n/**\n * Triggers are a method of firing arbitrary code on collision. These are useful\n * as 'buttons', 'switches', or to trigger effects in a game. By default triggers\n * are invisible, and can only be seen when [[Trigger.visible]] is set to `true`.\n */\nexport class Trigger extends Actor {\n  private _target: Entity;\n  /**\n   * Action to fire when triggered by collision\n   */\n  public action: () => void = () => {\n    return;\n  };\n  /**\n   * Filter to add additional granularity to action dispatch, if a filter is specified the action will only fire when\n   * filter return true for the collided actor.\n   */\n  public filter: (actor: Entity) => boolean = () => true;\n  /**\n   * Number of times to repeat before killing the trigger,\n   */\n  public repeat: number = -1;\n\n  /**\n   *\n   * @param opts Trigger options\n   */\n  constructor(opts: Partial<TriggerOptions>) {\n    super({ x: opts.pos.x, y: opts.pos.y, width: opts.width, height: opts.height });\n    opts = Util.extend({}, triggerDefaults, opts);\n\n    this.filter = opts.filter || this.filter;\n    this.repeat = opts.repeat || this.repeat;\n    this.action = opts.action || this.action;\n    if (opts.target) {\n      this.target = opts.target;\n    }\n\n    this.graphics.visible = opts.visible;\n    this.body.collisionType = CollisionType.Passive;\n    this.eventDispatcher = new EventDispatcher(this);\n\n    this.events.on('collisionstart', (evt: CollisionStartEvent<Actor>) => {\n      if (this.filter(evt.other)) {\n        this.emit('enter', new EnterTriggerEvent(this, evt.other));\n        this._dispatchAction();\n        // remove trigger if its done, -1 repeat forever\n        if (this.repeat === 0) {\n          this.kill();\n        }\n      }\n    });\n\n    this.events.on('collisionend', (evt: CollisionEndEvent<Actor>) => {\n      if (this.filter(evt.other)) {\n        this.emit('exit', new ExitTriggerEvent(this, evt.other));\n      }\n    });\n  }\n\n  public set target(target: Entity) {\n    this._target = target;\n    this.filter = (actor: Entity) => actor === target;\n  }\n\n  public get target() {\n    return this._target;\n  }\n\n  public _initialize(engine: Engine) {\n    super._initialize(engine);\n  }\n\n  private _dispatchAction() {\n    if (this.repeat !== 0) {\n      this.action.call(this);\n      this.repeat--;\n    }\n  }\n\n  /* istanbul ignore next */\n  public debugDraw(ctx: CanvasRenderingContext2D) {\n    super.debugDraw(ctx);\n    // Meant to draw debug information about actors\n    ctx.save();\n    ctx.translate(this.pos.x, this.pos.y);\n\n    const bb = this.collider.bounds;\n    const wp = this.getGlobalPos();\n    bb.left = bb.left - wp.x;\n    bb.right = bb.right - wp.x;\n    bb.top = bb.top - wp.y;\n    bb.bottom = bb.bottom - wp.y;\n\n    ctx.fillStyle = Color.Violet.toString();\n    ctx.strokeStyle = Color.Violet.toString();\n    ctx.fillText('Trigger', 10, 10);\n    bb.debugDraw(ctx);\n\n    ctx.restore();\n  }\n}\n","import { Entity } from './Entity';\r\nimport { Message, Observer } from '../Util/Observable';\r\nimport { Component } from './Component';\r\nimport { Scene } from '../Scene';\r\n\r\n/**\r\n * Enum that determines whether to run the system in the update or draw phase\r\n */\r\nexport enum SystemType {\r\n  Update = 'update',\r\n  Draw = 'draw'\r\n}\r\n\r\nexport type SystemTypes<ComponentTypes> = ComponentTypes extends Component<infer TypeName> ? TypeName : never;\r\n\r\n/**\r\n * An Excalibur [[System]] that updates entities of certain types.\r\n * Systems are scene specific\r\n *\r\n * Excalibur Systems currently require at least 1 Component type to operated\r\n *\r\n * Multiple types are declared as a type union\r\n * For example:\r\n *\r\n * ```typescript\r\n * class MySystem extends System<ComponentA | ComponentB> {\r\n *   public readonly types = ['a', 'b'] as const;\r\n *   public readonly systemType = SystemType.Update;\r\n *   public update(entities: Entity<ComponentA | ComponentB>) {\r\n *      ...\r\n *   }\r\n * }\r\n * ```\r\n */\r\nexport abstract class System<ComponentTypeUnion extends Component = Component, ContextType = Scene>\r\nimplements Observer<AddedEntity | RemovedEntity> {\r\n  /**\r\n   * The types of entities that this system operates on\r\n   * For example ['transform', 'motion']\r\n   */\r\n  abstract readonly types: readonly SystemTypes<ComponentTypeUnion>[];\r\n\r\n  /**\r\n   * Determine whether the system is called in the [[SystemType.Update]] or the [[SystemType.Draw]] phase. Update is first, then Draw.\r\n   */\r\n  abstract readonly systemType: SystemType;\r\n\r\n  /**\r\n   * System can execute in priority order, by default all systems are priority 0. Lower values indicated higher priority.\r\n   * For a system to execute before all other a lower priority value (-1 for example) must be set.\r\n   * For a system to exectue after all other a higher priority value (10 for example) must be set.\r\n   */\r\n  public priority: number = 0;\r\n\r\n  /**\r\n   * Optionally specify a sort order for entities passed to the your system\r\n   * @param a The left entity\r\n   * @param b The right entity\r\n   */\r\n  sort?(a: Entity, b: Entity): number;\r\n\r\n  /**\r\n   * Optionally specify an initialize handler\r\n   * @param scene\r\n   */\r\n  initialize?(engine: ContextType): void;\r\n\r\n  /**\r\n   * Update all entities that match this system's types\r\n   * @param entities Entities to update that match this system's types\r\n   * @param delta Time in milliseconds\r\n   */\r\n  abstract update(entities: Entity[], delta: number): void;\r\n\r\n  /**\r\n   * Optionally run a preupdate before the system processes matching entities\r\n   * @param engine\r\n   * @param elapsedMs Time in milliseconds since the last frame\r\n   */\r\n  preupdate?(engine: ContextType, elapsedMs: number): void;\r\n\r\n  /**\r\n   * Optionally run a postupdate after the system processes matching entities\r\n   * @param engine\r\n   * @param elapsedMs Time in milliseconds since the last frame\r\n   */\r\n  postupdate?(engine: ContextType, elapsedMs: number): void;\r\n\r\n  /**\r\n   * Systems observe when entities match their types or no longer match their types, override\r\n   * @param _entityAddedOrRemoved\r\n   */\r\n  public notify(_entityAddedOrRemoved: AddedEntity | RemovedEntity) {\r\n    // Override me\r\n  }\r\n}\r\n\r\n/**\r\n * An [[Entity]] with [[Component]] types that matches a [[System]] types exists in the current scene.\r\n */\r\nexport class AddedEntity implements Message<Entity> {\r\n  readonly type: 'Entity Added' = 'Entity Added';\r\n  constructor(public data: Entity) {}\r\n}\r\n\r\n/**\r\n * Type guard to check for AddedEntity messages\r\n * @param x\r\n */\r\nexport function isAddedSystemEntity(x: Message<Entity>): x is AddedEntity {\r\n  return !!x && x.type === 'Entity Added';\r\n}\r\n\r\n/**\r\n * An [[Entity]] with [[Component]] types that no longer matches a [[System]] types exists in the current scene.\r\n */\r\nexport class RemovedEntity implements Message<Entity> {\r\n  readonly type: 'Entity Removed' = 'Entity Removed';\r\n  constructor(public data: Entity) {}\r\n}\r\n\r\n/**\r\n * type guard to check for the RemovedEntity message\r\n */\r\nexport function isRemoveSystemEntity(x: Message<Entity>): x is RemovedEntity {\r\n  return !!x && x.type === 'Entity Removed';\r\n}\r\n","import { Entity, RemovedComponent, AddedComponent, isAddedComponent, isRemovedComponent } from './Entity';\r\nimport { Observer } from '../Util/Observable';\r\nimport { World } from './World';\r\nimport { Util } from '..';\r\n\r\n// Add/Remove entitys and components\r\n\r\nexport class EntityManager<ContextType = any> implements Observer<RemovedComponent | AddedComponent> {\r\n  public entities: Entity[] = [];\r\n  public _entityIndex: { [entityId: string]: Entity } = {};\r\n\r\n  constructor(private _world: World<ContextType>) {}\r\n\r\n  /**\r\n   * Runs the entity lifecycle\r\n   * @param _context\r\n   */\r\n  public updateEntities(_context: ContextType, elapsed: number) {\r\n    for (const entity of this.entities) {\r\n      // TODO is this right?\r\n      entity.update((_context as any).engine, elapsed);\r\n      if (!entity.active) {\r\n        this.removeEntity(entity);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * EntityManager observes changes on entities\r\n   * @param message\r\n   */\r\n  public notify(message: RemovedComponent | AddedComponent): void {\r\n    if (isAddedComponent(message)) {\r\n      // we don't need the component, it's already on the entity\r\n      this._world.queryManager.addEntity(message.data.entity);\r\n    }\r\n\r\n    if (isRemovedComponent(message)) {\r\n      this._world.queryManager.removeComponent(message.data.entity, message.data.component);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Adds an entity to be tracked by the EntityManager\r\n   * @param entity\r\n   */\r\n  public addEntity(entity: Entity): void {\r\n    entity.active = true;\r\n    if (entity && !this._entityIndex[entity.id]) {\r\n      this._entityIndex[entity.id] = entity;\r\n      this.entities.push(entity);\r\n      this._world.queryManager.addEntity(entity);\r\n      entity.componentAdded$.register(this);\r\n      entity.componentRemoved$.register(this);\r\n\r\n      // if entity has children\r\n      entity.children.forEach((c) => this.addEntity(c));\r\n      entity.childrenAdded$.register({\r\n        notify: (e) => {\r\n          this.addEntity(e);\r\n        }\r\n      });\r\n      entity.childrenRemoved$.register({\r\n        notify: (e) => {\r\n          this.removeEntity(e, false);\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  public removeEntity(entity: Entity, deferred?: boolean): void;\r\n  public removeEntity(id: number, deferred?: boolean): void;\r\n  public removeEntity(idOrEntity: number | Entity, deferred = true): void {\r\n    let id = 0;\r\n    if (idOrEntity instanceof Entity) {\r\n      id = idOrEntity.id;\r\n    } else {\r\n      id = idOrEntity;\r\n    }\r\n    const entity = this._entityIndex[id];\r\n    if (entity && entity.active) {\r\n      entity.kill();\r\n    }\r\n\r\n    if (entity && deferred) {\r\n      this._entitiesToRemove.push(entity);\r\n      return;\r\n    }\r\n\r\n    delete this._entityIndex[id];\r\n    if (entity) {\r\n      Util.removeItemFromArray(entity, this.entities);\r\n      this._world.queryManager.removeEntity(entity);\r\n      entity.componentAdded$.unregister(this);\r\n      entity.componentRemoved$.unregister(this);\r\n\r\n      // if entity has children\r\n      entity.children.forEach((c) => this.removeEntity(c, deferred));\r\n      entity.childrenAdded$.clear();\r\n      entity.childrenRemoved$.clear();\r\n\r\n      // stats\r\n      if ((this._world.context as any)?.engine) {\r\n        (this._world.context as any).engine.stats.currFrame.actors.killed++;\r\n      }\r\n    }\r\n  }\r\n\r\n  private _entitiesToRemove: Entity[] = [];\r\n  public processEntityRemovals(): void {\r\n    for (const entity of this._entitiesToRemove) {\r\n      if (entity.active) {\r\n        continue;\r\n      }\r\n      this.removeEntity(entity, false);\r\n    }\r\n  }\r\n\r\n  public processComponentRemovals(): void {\r\n    for (const entity of this.entities) {\r\n      entity.processComponentRemoval();\r\n    }\r\n  }\r\n\r\n  public getById(id: number): Entity {\r\n    return this._entityIndex[id];\r\n  }\r\n\r\n  public getByName(name: string): Entity[]{\r\n    return this.entities.filter(e => e.name === name);\r\n  }\r\n\r\n  public clear(): void {\r\n    for (const entity of this.entities) {\r\n      this.removeEntity(entity);\r\n    }\r\n  }\r\n}\r\n","export const buildTypeKey = (types: readonly string[]) => {\r\n  const key = [...types].sort((a, b) => a.localeCompare(b)).join('+');\r\n  return key;\r\n};\r\n","import { Entity } from './Entity';\r\nimport { buildTypeKey } from './Util';\r\nimport { Observable } from '../Util/Observable';\r\nimport { Util, Component, ComponentCtor } from '..';\r\nimport { AddedEntity, RemovedEntity } from './System';\r\n\r\n/**\r\n * Represents query for entities that match a list of types that is cached and observable\r\n *\r\n * Queries can be strongly typed by supplying a type union in the optional type parameter\r\n * ```typescript\r\n * const queryAB = new ex.Query<ComponentTypeA | ComponentTypeB>(['A', 'B']);\r\n * ```\r\n */\r\nexport class Query<T extends Component = Component> extends Observable<AddedEntity | RemovedEntity> {\r\n  public types: readonly string[];\r\n  private _entities: Entity[] = [];\r\n  private _key: string;\r\n  public get key(): string {\r\n    if (this._key) {\r\n      return this._key;\r\n    }\r\n    return (this._key = buildTypeKey(this.types));\r\n  }\r\n\r\n  constructor(types: readonly string[]);\r\n  constructor(types: readonly ComponentCtor<T>[]);\r\n  constructor(types: readonly string[] | readonly ComponentCtor<T>[]) {\r\n    super();\r\n    if (types[0] instanceof Function) {\r\n      this.types = (types as ComponentCtor<T>[]).map(T =>  (new T).type);\r\n    } else {\r\n      this.types = types as string[];\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns a list of entities that match the query\r\n   *\r\n   * @param sort Optional sorting function to sort entities returned from the query\r\n   */\r\n  public getEntities(sort?: (a: Entity, b: Entity) => number): Entity[] {\r\n    if (sort) {\r\n      this._entities.sort(sort);\r\n    }\r\n    return this._entities;\r\n  }\r\n\r\n  /**\r\n   * Add an entity to the query, will only be added if the entity matches the query types\r\n   * @param entity\r\n   */\r\n  public addEntity(entity: Entity): void {\r\n    if (!Util.contains(this._entities, entity) && this.matches(entity)) {\r\n      this._entities.push(entity);\r\n      this.notifyAll(new AddedEntity(entity));\r\n    }\r\n  }\r\n\r\n  /**\r\n   * If the entity is part of the query it will be removed regardless of types\r\n   * @param entity\r\n   */\r\n  public removeEntity(entity: Entity): void {\r\n    if (Util.removeItemFromArray(entity, this._entities)) {\r\n      this.notifyAll(new RemovedEntity(entity));\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Removes all entities and observers from the query\r\n   */\r\n  public clear(): void {\r\n    this._entities.length = 0;\r\n    for (const observer of this.observers) {\r\n      this.unregister(observer);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns whether the entity's types match query\r\n   * @param entity\r\n   */\r\n  public matches(entity: Entity): boolean;\r\n\r\n  /**\r\n   * Returns whether the list of ComponentTypes have at least the same types as the query\r\n   * @param types\r\n   */\r\n  public matches(types: string[]): boolean;\r\n  public matches(typesOrEntity: string[] | Entity): boolean {\r\n    let types: string[] = [];\r\n    if (typesOrEntity instanceof Entity) {\r\n      types = typesOrEntity.types;\r\n    } else {\r\n      types = typesOrEntity;\r\n    }\r\n\r\n    let matches = true;\r\n    for (const type of this.types) {\r\n      matches = matches && types.indexOf(type) > -1;\r\n      if (!matches) {\r\n        return false;\r\n      }\r\n    }\r\n    return matches;\r\n  }\r\n\r\n  public contain(type: string) {\r\n    return this.types.indexOf(type) > -1;\r\n  }\r\n}\r\n","import { Entity } from './Entity';\r\nimport { buildTypeKey } from './Util';\r\nimport { Query } from './Query';\r\nimport { Component } from './Component';\r\nimport { World } from './World';\r\n\r\n/**\r\n * The query manager is responsible for updating all queries when entities/components change\r\n */\r\nexport class QueryManager {\r\n  private _queries: { [entityComponentKey: string]: Query<any> } = {};\r\n\r\n  constructor(private _world: World<any>) {}\r\n\r\n  /**\r\n   * Adds a query to the manager and populates with any entities that match\r\n   * @param query\r\n   */\r\n  private _addQuery(query: Query<any>) {\r\n    this._queries[buildTypeKey(query.types)] = query;\r\n    for (const entity of this._world.entityManager.entities) {\r\n      query.addEntity(entity);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Removes the query if there are no observers left\r\n   * @param query\r\n   */\r\n  public maybeRemoveQuery(query: Query): void {\r\n    if (query.observers.length === 0) {\r\n      query.clear();\r\n      delete this._queries[buildTypeKey(query.types)];\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Adds the entity to any matching query in the query manage\r\n   * @param entity\r\n   */\r\n  public addEntity(entity: Entity) {\r\n    for (const queryType in this._queries) {\r\n      if (this._queries[queryType]) {\r\n        this._queries[queryType].addEntity(entity);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Removes an entity from queries if the removed component disqualifies it\r\n   * @param entity\r\n   * @param component\r\n   */\r\n  public removeComponent(entity: Entity, component: Component) {\r\n    for (const queryType in this._queries) {\r\n      // If the component being removed from an entity is a part of a query,\r\n      // it is now disqualified from that query, remove it\r\n      if (this._queries[queryType].contain(component.type)) {\r\n        this._queries[queryType].removeEntity(entity);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Removes an entity from all queries it is currently a part of\r\n   * @param entity\r\n   */\r\n  public removeEntity(entity: Entity) {\r\n    for (const queryType in this._queries) {\r\n      this._queries[queryType].removeEntity(entity);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Creates a populated query and returns, if the query already exists that will be returned instead of a new instance\r\n   * @param types\r\n   */\r\n  public createQuery<T extends Component = Component>(types: readonly string[]): Query<T> {\r\n    const maybeExistingQuery = this.getQuery<T>(types);\r\n    if (maybeExistingQuery) {\r\n      return maybeExistingQuery;\r\n    }\r\n    const query = new Query<T>(types);\r\n    this._addQuery(query);\r\n    return query;\r\n  }\r\n\r\n  /**\r\n   * Retrieves an existing query by types if it exists otherwise returns null\r\n   * @param types\r\n   */\r\n  public getQuery<T extends Component = Component>(types: readonly string[]): Query<T> {\r\n    const key = buildTypeKey(types);\r\n    if (this._queries[key]) {\r\n      return this._queries[key] as Query<T>;\r\n    }\r\n    return null;\r\n  }\r\n}\r\n","import { System, SystemType } from './System';\r\nimport { Scene, Util } from '..';\r\nimport { World } from './World';\r\n\r\nexport interface SystemCtor<T extends System> {\r\n  new (): T;\r\n}\r\n\r\n/**\r\n * The SystemManager is responsible for keeping track of all systems in a scene.\r\n * Systems are scene specific\r\n */\r\nexport class SystemManager<ContextType> {\r\n  /**\r\n   * List of systems, to add a new system call [[SystemManager.addSystem]]\r\n   */\r\n  public systems: System<any, ContextType>[] = [];\r\n  public _keyToSystem: { [key: string]: System<any, ContextType> };\r\n  public initialized = false;\r\n  constructor(private _world: World<ContextType>) {}\r\n\r\n  /**\r\n   * Get a system registered in the manager by type\r\n   * @param systemType\r\n   * @returns\r\n   */\r\n  public get<T extends System>(systemType: SystemCtor<T>): T | null {\r\n    return this.systems.find((s) => s instanceof systemType) as unknown as T;\r\n  }\r\n\r\n  /**\r\n   * Adds a system to the manager, it will now be updated every frame\r\n   * @param system\r\n   */\r\n  public addSystem(system: System<any, ContextType>): void {\r\n    // validate system has types\r\n    if (!system.types || system.types.length === 0) {\r\n      throw new Error(`Attempted to add a System without any types`);\r\n    }\r\n\r\n    const query = this._world.queryManager.createQuery(system.types);\r\n    this.systems.push(system);\r\n    this.systems.sort((a, b) => a.priority - b.priority);\r\n    query.register(system);\r\n    if (this.initialized && system.initialize) {\r\n      system.initialize(this._world.context);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Removes a system from the manager, it will no longer be updated\r\n   * @param system\r\n   */\r\n  public removeSystem(system: System<any, ContextType>) {\r\n    Util.removeItemFromArray(system, this.systems);\r\n    const query = this._world.queryManager.getQuery(system.types);\r\n    if (query) {\r\n      query.unregister(system);\r\n      this._world.queryManager.maybeRemoveQuery(query);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Updates all systems\r\n   * @param type whether this is an update or draw system\r\n   * @param context context reference\r\n   * @param delta time in milliseconds\r\n   */\r\n  public updateSystems(type: SystemType, context: ContextType, delta: number) {\r\n    if (!this.initialized) {\r\n      this.initialized = true;\r\n      for (const s of this.systems) {\r\n        if (s.initialize) {\r\n          s.initialize(this._world.context);\r\n        }\r\n      }\r\n    }\r\n\r\n    const systems = this.systems.filter((s) => s.systemType === type);\r\n    for (const s of systems) {\r\n      if (s.preupdate) {\r\n        s.preupdate(context, delta);\r\n      }\r\n    }\r\n\r\n    for (const s of systems) {\r\n      // Get entities that match the system types, pre-sort\r\n      const entities = this._world.queryManager.getQuery(s.types).getEntities(s.sort);\r\n      // Initialize entities if needed\r\n      if (context instanceof Scene) {\r\n        for (const entity of entities) {\r\n          entity._initialize(context?.engine);\r\n        }\r\n      }\r\n      s.update(entities, delta);\r\n    }\r\n\r\n    for (const s of systems) {\r\n      if (s.postupdate) {\r\n        s.postupdate(context, delta);\r\n      }\r\n    }\r\n  }\r\n\r\n  public clear(): void {\r\n    for (const system of this.systems) {\r\n      this.removeSystem(system);\r\n    }\r\n  }\r\n}\r\n","import { Entity } from './Entity';\r\nimport { EntityManager } from './EntityManager';\r\nimport { QueryManager } from './QueryManager';\r\nimport { System, SystemType } from './System';\r\nimport { SystemManager } from './SystemManager';\r\n\r\n/**\r\n * The World is a self-contained entity component system for a particular context.\r\n */\r\nexport class World<ContextType> {\r\n  public queryManager: QueryManager = new QueryManager(this);\r\n  public entityManager: EntityManager<ContextType> = new EntityManager<ContextType>(this);\r\n  public systemManager: SystemManager<ContextType> = new SystemManager<ContextType>(this);\r\n\r\n  /**\r\n   * The context type is passed to the system updates\r\n   * @param context\r\n   */\r\n  constructor(public context: ContextType) {}\r\n\r\n  /**\r\n   * Update systems by type and time elapsed in milliseconds\r\n   */\r\n  update(type: SystemType, delta: number) {\r\n    if (type === SystemType.Update) {\r\n      // TODO should this also hand pre and post lifecycle\r\n      this.entityManager.updateEntities(this.context, delta);\r\n    }\r\n    this.systemManager.updateSystems(type, this.context, delta);\r\n    this.entityManager.processComponentRemovals();\r\n    this.entityManager.processEntityRemovals();\r\n  }\r\n\r\n  /**\r\n   * Add an entity to the ECS world\r\n   * @param entity\r\n   */\r\n  add(entity: Entity): void;\r\n  /**\r\n   * Add a system to the ECS world\r\n   * @param system\r\n   */\r\n  add(system: System<any, ContextType>): void;\r\n  add(entityOrSystem: Entity | System<any, ContextType>): void {\r\n    if (entityOrSystem instanceof Entity) {\r\n      this.entityManager.addEntity(entityOrSystem);\r\n    }\r\n\r\n    if (entityOrSystem instanceof System) {\r\n      this.systemManager.addSystem(entityOrSystem);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Remove an entity from the ECS world\r\n   * @param entity\r\n   */\r\n  remove(entity: Entity, deferred?: boolean): void;\r\n  /**\r\n   * Remove a system from the ECS world\r\n   * @param system\r\n   */\r\n  remove(system: System<any, ContextType>): void;\r\n  remove(entityOrSystem: Entity | System<any, ContextType>, deferred = true): void {\r\n    if (entityOrSystem instanceof Entity) {\r\n      this.entityManager.removeEntity(entityOrSystem, deferred);\r\n    }\r\n\r\n    if (entityOrSystem instanceof System) {\r\n      this.systemManager.removeSystem(entityOrSystem);\r\n    }\r\n  }\r\n\r\n  clearEntities(): void {\r\n    this.entityManager.clear();\r\n  }\r\n\r\n  clearSystems(): void {\r\n    this.systemManager.clear();\r\n  }\r\n}\r\n","import { Vector } from '../Math/vector';\nimport { TransformComponent } from '../EntityComponentSystem';\nimport { MotionComponent } from '../EntityComponentSystem/Components/MotionComponent';\n\nexport class EulerIntegrator {\n  static integrate(transform: TransformComponent, motion: MotionComponent, totalAcc: Vector, elapsedMs: number): void {\n    const seconds = elapsedMs / 1000;\n    motion.vel.addEqual(totalAcc.scale(seconds));\n    transform.pos.addEqual(motion.vel.scale(seconds)).addEqual(totalAcc.scale(0.5 * seconds * seconds));\n\n    motion.angularVelocity += motion.torque * (1.0 / motion.inertia) * seconds;\n    transform.rotation += motion.angularVelocity * seconds;\n\n    transform.scale.addEqual(motion.scaleFactor.scale(seconds));\n  }\n}\n","import { Entity } from '../EntityComponentSystem';\r\nimport { MotionComponent } from '../EntityComponentSystem/Components/MotionComponent';\r\nimport { TransformComponent } from '../EntityComponentSystem/Components/TransformComponent';\r\nimport { System, SystemType } from '../EntityComponentSystem/System';\r\nimport { Physics } from './Physics';\r\nimport { BodyComponent } from './BodyComponent';\r\nimport { CollisionType } from './CollisionType';\r\nimport { EulerIntegrator } from './Integrator';\r\n\r\nexport class MotionSystem extends System<TransformComponent | MotionComponent> {\r\n  public readonly types = ['ex.transform', 'ex.motion'] as const;\r\n  public systemType = SystemType.Update;\r\n  public priority = -1;\r\n\r\n  update(_entities: Entity[], elapsedMs: number): void {\r\n    let transform: TransformComponent;\r\n    let motion: MotionComponent;\r\n    for (const entity of _entities) {\r\n      transform = entity.get(TransformComponent);\r\n      motion = entity.get(MotionComponent);\r\n\r\n      const optionalBody = entity.get(BodyComponent);\r\n      if (optionalBody?.sleeping) {\r\n        continue;\r\n      }\r\n\r\n      const totalAcc = motion.acc.clone();\r\n      if (optionalBody?.collisionType === CollisionType.Active && optionalBody?.useGravity) {\r\n        totalAcc.addEqual(Physics.gravity);\r\n      }\r\n      optionalBody?.captureOldTransform();\r\n\r\n      // Update transform and motion based on Euler linear algebra\r\n      EulerIntegrator.integrate(transform, motion, totalAcc, elapsedMs);\r\n    }\r\n  }\r\n\r\n  debugDraw(_ctx: CanvasRenderingContext2D) {\r\n    // pass\r\n  }\r\n}\r\n","import { CollisionContact } from '../Detection/CollisionContact';\r\n\r\n/**\r\n * A collision solver figures out how to position colliders such that they are no longer overlapping\r\n *\r\n * Solvers are executed in the order\r\n *\r\n * 1. preSolve\r\n * 2. solveVelocity\r\n * 3. solvePosition\r\n * 4. postSolve\r\n * @inheritdoc\r\n */\r\nexport abstract class CollisionSolver {\r\n  /**\r\n   * Pre-solve is fired on contacts before any resolution is started. It is used for any setup work before collision resolution\r\n   * can proceed. Optionally contacts can be \"opted out\" of any collision processing by calling `contact.cancel()`\r\n   * @param contacts\r\n   * @inheritdoc\r\n   */\r\n  abstract preSolve(contacts: CollisionContact[]): void;\r\n\r\n  /**\r\n   * Post-solve is fired after all resolution is complete\r\n   * @param contacts\r\n   * @inheritdoc\r\n   */\r\n  abstract postSolve(contacts: CollisionContact[]): void;\r\n\r\n  /**\r\n   * Solve velocity adjusts the velocity of colliders so that they are not overlapping or will not be overlapping from velocity\r\n   * @param contacts\r\n   * @inheritdoc\r\n   */\r\n  abstract solveVelocity(contacts: CollisionContact[]): void;\r\n\r\n  /**\r\n   * Solve position adjust the position of collders so that they are not overlapping\r\n   * @param contacts\r\n   * @inheritdoc\r\n   */\r\n  abstract solvePosition(contacts: CollisionContact[]): void;\r\n\r\n  /**\r\n   * Solves overlapping contact in\r\n   *\r\n   * Solvers are executed in the order\r\n   * 1. preSolve\r\n   * 2. solveVelocity\r\n   * 3. solvePosition\r\n   * 4. postSolve\r\n   * @param contacts\r\n   */\r\n  public solve(contacts: CollisionContact[]): CollisionContact[] {\r\n    // Events and init\r\n    this.preSolve(contacts);\r\n\r\n    // Remove any canceled contacts\r\n    contacts = contacts.filter(c => !c.isCanceled());\r\n\r\n    // Solve velocity first\r\n    this.solveVelocity(contacts);\r\n\r\n    // Solve position last because non-overlap is the most important\r\n    this.solvePosition(contacts);\r\n\r\n    // Events and any contact house-keeping the solver needs\r\n    this.postSolve(contacts);\r\n\r\n    return contacts;\r\n  }\r\n}","import { PostCollisionEvent, PreCollisionEvent } from '../../Events';\r\nimport { CollisionContact } from '../Detection/CollisionContact';\r\nimport { CollisionType } from '../CollisionType';\r\nimport { Side } from '../Side';\r\nimport { CollisionSolver } from './Solver';\r\nimport { BodyComponent } from '../BodyComponent';\r\n\r\n/**\r\n * ArcadeSolver is the default in Excalibur. It solves collisions so that there is no overlap between contacts,\r\n * and negates velocity along the collision normal.\r\n *\r\n * This is usually the type of collisions used for 2D games that don't need a more realistic collision simulation.\r\n *\r\n */\r\nexport class ArcadeSolver extends CollisionSolver {\r\n  public preSolve(contacts: CollisionContact[]) {\r\n    for (const contact of contacts) {\r\n      const side = Side.fromDirection(contact.mtv);\r\n      const mtv = contact.mtv.negate();\r\n      // Publish collision events on both participants\r\n      contact.colliderA.events.emit('precollision', new PreCollisionEvent(contact.colliderA, contact.colliderB, side, mtv));\r\n      contact.colliderB.events.emit(\r\n        'precollision',\r\n        new PreCollisionEvent(contact.colliderB, contact.colliderA, Side.getOpposite(side), mtv.negate())\r\n      );\r\n    }\r\n  }\r\n\r\n  public postSolve(contacts: CollisionContact[]) {\r\n    for (const contact of contacts) {\r\n      const colliderA = contact.colliderA;\r\n      const colliderB = contact.colliderB;\r\n      const bodyA = colliderA.owner?.get(BodyComponent);\r\n      const bodyB = colliderB.owner?.get(BodyComponent);\r\n      if (bodyA && bodyB) {\r\n        if (bodyA.collisionType === CollisionType.Passive || bodyB.collisionType === CollisionType.Passive) {\r\n          continue;\r\n        }\r\n      }\r\n      const side = Side.fromDirection(contact.mtv);\r\n      const mtv = contact.mtv.negate();\r\n      // Publish collision events on both participants\r\n      contact.colliderA.events.emit('postcollision', new PostCollisionEvent(contact.colliderA, contact.colliderB, side, mtv));\r\n      contact.colliderB.events.emit(\r\n        'postcollision',\r\n        new PostCollisionEvent(contact.colliderB, contact.colliderA, Side.getOpposite(side), mtv.negate())\r\n      );\r\n    }\r\n  }\r\n\r\n  public solvePosition(contacts: CollisionContact[]) {\r\n    for (const contact of contacts) {\r\n      let mtv = contact.mtv;\r\n      const colliderA = contact.colliderA;\r\n      const colliderB = contact.colliderB;\r\n      const bodyA = colliderA.owner?.get(BodyComponent);\r\n      const bodyB = colliderB.owner?.get(BodyComponent);\r\n      if (bodyA && bodyB) {\r\n        if (bodyA.collisionType === CollisionType.Passive || bodyB.collisionType === CollisionType.Passive) {\r\n          continue;\r\n        }\r\n\r\n        if (bodyA.collisionType === CollisionType.Active && bodyB.collisionType === CollisionType.Active) {\r\n          // split overlaps if both are Active\r\n          mtv = mtv.scale(0.5);\r\n        }\r\n\r\n        // Resolve overlaps\r\n        if (bodyA.collisionType === CollisionType.Active) {\r\n          bodyA.pos.x -= mtv.x;\r\n          bodyA.pos.y -= mtv.y;\r\n        }\r\n\r\n        if (bodyB.collisionType === CollisionType.Active) {\r\n          bodyB.pos.x += mtv.x;\r\n          bodyB.pos.y += mtv.y;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  public solveVelocity(contacts: CollisionContact[]) {\r\n    for (const contact of contacts) {\r\n      const colliderA = contact.colliderA;\r\n      const colliderB = contact.colliderB;\r\n      const bodyA = colliderA.owner?.get(BodyComponent);\r\n      const bodyB = colliderB.owner?.get(BodyComponent);\r\n\r\n      if (bodyA && bodyB) {\r\n\r\n        if (bodyA.collisionType === CollisionType.Passive || bodyB.collisionType === CollisionType.Passive) {\r\n          continue;\r\n        }\r\n\r\n        const normal = contact.normal;\r\n        const opposite = normal.negate();\r\n\r\n        // Cancel out velocity opposite direction of collision normal\r\n        if (bodyA.collisionType === CollisionType.Active) {\r\n          const velAdj = normal.scale(normal.dot(bodyA.vel.negate()));\r\n          bodyA.vel = bodyA.vel.add(velAdj);\r\n        }\r\n\r\n        if (bodyB.collisionType === CollisionType.Active) {\r\n          const velAdj = opposite.scale(opposite.dot(bodyB.vel.negate()));\r\n          bodyB.vel = bodyB.vel.add(velAdj);\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { Vector } from '../../Math/vector';\nimport { BodyComponent } from '../BodyComponent';\nimport { CollisionContact } from '../Detection/CollisionContact';\n\n/**\n * Holds information about contact points, meant to be reused over multiple frames of contact\n */\nexport class ContactConstraintPoint {\n  constructor(public point: Vector, public local: Vector, public contact: CollisionContact) {\n    this.update();\n  }\n\n  /**\n   * Updates the contact information\n   */\n  update() {\n    const bodyA = this.contact.colliderA.owner?.get(BodyComponent);\n    const bodyB = this.contact.colliderB.owner?.get(BodyComponent);\n\n    if (bodyA && bodyB) {\n      const normal = this.contact.normal;\n      const tangent = this.contact.tangent;\n\n      this.aToContact = this.point.sub(bodyA.pos);\n      this.bToContact = this.point.sub(bodyB.pos);\n\n      const aToContactNormal = this.aToContact.cross(normal);\n      const bToContactNormal = this.bToContact.cross(normal);\n\n      this.normalMass =\n        bodyA.inverseMass +\n        bodyB.inverseMass +\n        bodyA.inverseInertia * aToContactNormal * aToContactNormal +\n        bodyB.inverseInertia * bToContactNormal * bToContactNormal;\n\n      const aToContactTangent = this.aToContact.cross(tangent);\n      const bToContactTangent = this.bToContact.cross(tangent);\n\n      this.tangentMass =\n        bodyA.inverseMass +\n        bodyB.inverseMass +\n        bodyA.inverseInertia * aToContactTangent * aToContactTangent +\n        bodyB.inverseInertia * bToContactTangent * bToContactTangent;\n    }\n\n    return this;\n  }\n\n  /**\n   * Returns the relative velocity betwen bodyA and bodyB\n   */\n  public getRelativeVelocity() {\n    const bodyA = this.contact.colliderA.owner?.get(BodyComponent);\n    const bodyB = this.contact.colliderB.owner?.get(BodyComponent);\n    if (bodyA && bodyB) {\n      // Relative velocity in linear terms\n      // Angular to linear velocity formula -> omega = velocity/radius so omega x radius = velocity\n      const velA = bodyA.vel.add(Vector.cross(bodyA.angularVelocity, this.aToContact));\n      const velB = bodyB.vel.add(Vector.cross(bodyB.angularVelocity, this.bToContact));\n      return velB.sub(velA);\n    }\n    return Vector.Zero;\n  }\n\n  /**\n   * Impulse accumulated over time in normal direction\n   */\n  public normalImpulse: number = 0;\n\n  /**\n   * Impulse accumulated over time in the tangent direction\n   */\n  public tangentImpulse: number = 0;\n\n  /**\n   * Effective mass seen in the normal direction\n   */\n  public normalMass: number = 0;\n\n  /**\n   * Effective mass seen in the tangent direction\n   */\n  public tangentMass: number = 0;\n\n  /**\n   * Direction from center of mass of bodyA to contact point\n   */\n  public aToContact: Vector = new Vector(0, 0);\n\n  /**\n   * Direction from center of mass of bodyB to contact point\n   */\n  public bToContact: Vector = new Vector(0, 0);\n}\n","import { CollisionPostSolveEvent, CollisionPreSolveEvent, PostCollisionEvent, PreCollisionEvent } from '../../Events';\r\nimport { clamp } from '../../Util/Util';\r\nimport { CollisionContact } from '../Detection/CollisionContact';\r\nimport { CollisionType } from '../CollisionType';\r\nimport { ContactConstraintPoint } from './ContactConstraintPoint';\r\nimport { Side } from '../Side';\r\nimport { Physics } from '../Physics';\r\nimport { CollisionSolver } from './Solver';\r\nimport { BodyComponent } from '../BodyComponent';\r\nimport { CollisionJumpTable } from '../Colliders/CollisionJumpTable';\r\n\r\nexport class RealisticSolver extends CollisionSolver {\r\n  lastFrameContacts: Map<string, CollisionContact> = new Map();\r\n\r\n  // map contact id to contact points\r\n  idToContactConstraint: Map<string, ContactConstraintPoint[]> = new Map();\r\n\r\n  getContactConstraints(id: string) {\r\n    return this.idToContactConstraint.get(id) ?? [];\r\n  }\r\n\r\n  preSolve(contacts: CollisionContact[]) {\r\n    for (const contact of contacts) {\r\n      // Publish collision events on both participants\r\n      const side = Side.fromDirection(contact.mtv);\r\n      contact.colliderA.events.emit('precollision', new PreCollisionEvent(contact.colliderA, contact.colliderB, side, contact.mtv));\r\n      contact.colliderA.events.emit(\r\n        'beforecollisionresolve',\r\n        new CollisionPreSolveEvent(contact.colliderA, contact.colliderB, side, contact.mtv, contact) as any\r\n      );\r\n      contact.colliderB.events.emit(\r\n        'precollision',\r\n        new PreCollisionEvent(contact.colliderB, contact.colliderA, Side.getOpposite(side), contact.mtv.negate())\r\n      );\r\n      contact.colliderB.events.emit(\r\n        'beforecollisionresolve',\r\n        new CollisionPreSolveEvent(contact.colliderB, contact.colliderA, Side.getOpposite(side), contact.mtv.negate(), contact) as any\r\n      );\r\n\r\n      // Match awake state for sleeping\r\n      contact.matchAwake();\r\n    }\r\n\r\n    // Keep track of contacts that done\r\n    const finishedContactIds = Array.from(this.idToContactConstraint.keys());\r\n    for (const contact of contacts) {\r\n      // Remove all current contacts that are not done\r\n      const index = finishedContactIds.indexOf(contact.id);\r\n      if (index > -1) {\r\n        finishedContactIds.splice(index, 1);\r\n      }\r\n      const contactPoints = this.idToContactConstraint.get(contact.id) ?? [];\r\n\r\n      let pointIndex = 0;\r\n      const bodyA = contact.colliderA.owner.get(BodyComponent);\r\n      const bodyB = contact.colliderB.owner.get(BodyComponent);\r\n      if (bodyA && bodyB) {\r\n        for (const point of contact.points) {\r\n          const normal = contact.normal;\r\n          const tangent = contact.tangent;\r\n\r\n          const aToContact = point.sub(bodyA.pos);\r\n          const bToContact = point.sub(bodyB.pos);\r\n\r\n          const aToContactNormal = aToContact.cross(normal);\r\n          const bToContactNormal = bToContact.cross(normal);\r\n\r\n          const normalMass =\r\n            bodyA.inverseMass +\r\n            bodyB.inverseMass +\r\n            bodyA.inverseInertia * aToContactNormal * aToContactNormal +\r\n            bodyB.inverseInertia * bToContactNormal * bToContactNormal;\r\n\r\n          const aToContactTangent = aToContact.cross(tangent);\r\n          const bToContactTangent = bToContact.cross(tangent);\r\n\r\n          const tangentMass =\r\n            bodyA.inverseMass +\r\n            bodyB.inverseMass +\r\n            bodyA.inverseInertia * aToContactTangent * aToContactTangent +\r\n            bodyB.inverseInertia * bToContactTangent * bToContactTangent;\r\n\r\n          // Preserve normal/tangent impulse by re-using the contact point if it's close\r\n          if (contactPoints[pointIndex] && contactPoints[pointIndex]?.point?.squareDistance(point) < 4) {\r\n            contactPoints[pointIndex].point = point;\r\n            contactPoints[pointIndex].local = contact.localPoints[pointIndex];\r\n          } else {\r\n            // new contact if it's not close or doesn't exist\r\n            contactPoints[pointIndex] = new ContactConstraintPoint(point, contact.localPoints[pointIndex], contact);\r\n          }\r\n\r\n          // Update contact point calculations\r\n          contactPoints[pointIndex].aToContact = aToContact;\r\n          contactPoints[pointIndex].bToContact = bToContact;\r\n          contactPoints[pointIndex].normalMass = normalMass;\r\n          contactPoints[pointIndex].tangentMass = tangentMass;\r\n\r\n          pointIndex++;\r\n        }\r\n      }\r\n      this.idToContactConstraint.set(contact.id, contactPoints);\r\n    }\r\n\r\n    // Clean up any contacts that did not occur last frame\r\n    for (const id of finishedContactIds) {\r\n      this.idToContactConstraint.delete(id);\r\n    }\r\n\r\n    // Warm contacts with accumulated impulse\r\n    // Useful for tall stacks\r\n    if (Physics.warmStart) {\r\n      this.warmStart(contacts);\r\n    } else {\r\n      for (const contact of contacts) {\r\n        const contactPoints = this.getContactConstraints(contact.id);\r\n        for (const point of contactPoints) {\r\n          point.normalImpulse = 0;\r\n          point.tangentImpulse = 0;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  postSolve(contacts: CollisionContact[]) {\r\n    for (const contact of contacts) {\r\n      const bodyA = contact.colliderA.owner.get(BodyComponent);\r\n      const bodyB = contact.colliderB.owner.get(BodyComponent);\r\n\r\n      if (bodyA && bodyB) {\r\n        // Skip post solve for active+passive collisions\r\n        if (bodyA.collisionType === CollisionType.Passive || bodyB.collisionType === CollisionType.Passive) {\r\n          continue;\r\n        }\r\n\r\n        // Update motion values for sleeping\r\n        bodyA.updateMotion();\r\n        bodyB.updateMotion();\r\n      }\r\n\r\n      // Publish collision events on both participants\r\n      const side = Side.fromDirection(contact.mtv);\r\n      contact.colliderA.events.emit('postcollision', new PostCollisionEvent(contact.colliderA, contact.colliderB, side, contact.mtv));\r\n      contact.colliderA.events.emit(\r\n        'aftercollisionresolve',\r\n        new CollisionPostSolveEvent(contact.colliderA, contact.colliderB, side, contact.mtv, contact) as any\r\n      );\r\n      contact.colliderB.events.emit(\r\n        'postcollision',\r\n        new PostCollisionEvent(contact.colliderB, contact.colliderA, Side.getOpposite(side), contact.mtv.negate())\r\n      );\r\n      contact.colliderB.events.emit(\r\n        'aftercollisionresolve',\r\n        new CollisionPostSolveEvent(contact.colliderB, contact.colliderA, Side.getOpposite(side), contact.mtv.negate(), contact) as any\r\n      );\r\n    }\r\n\r\n    // Store contacts\r\n    this.lastFrameContacts.clear();\r\n    for (const c of contacts) {\r\n      this.lastFrameContacts.set(c.id, c);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Warm up body's based on previous frame contact points\r\n   * @param contacts\r\n   */\r\n  warmStart(contacts: CollisionContact[]) {\r\n    for (const contact of contacts) {\r\n      const bodyA = contact.colliderA.owner?.get(BodyComponent);\r\n      const bodyB = contact.colliderB.owner?.get(BodyComponent);\r\n      if (bodyA && bodyB) {\r\n        const contactPoints = this.idToContactConstraint.get(contact.id) ?? [];\r\n        for (const point of contactPoints) {\r\n          if (Physics.warmStart) {\r\n            const normalImpulse = contact.normal.scale(point.normalImpulse);\r\n            const tangentImpulse = contact.tangent.scale(point.tangentImpulse);\r\n            const impulse = normalImpulse.add(tangentImpulse);\r\n\r\n            bodyA.applyImpulse(point.point, impulse.negate());\r\n            bodyB.applyImpulse(point.point, impulse);\r\n          } else {\r\n            point.normalImpulse = 0;\r\n            point.tangentImpulse = 0;\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Iteratively solve the position overlap constraint\r\n   * @param contacts\r\n   */\r\n  solvePosition(contacts: CollisionContact[]) {\r\n    for (let i = 0; i < Physics.positionIterations; i++) {\r\n      for (const contact of contacts) {\r\n        const bodyA = contact.colliderA.owner?.get(BodyComponent);\r\n        const bodyB = contact.colliderB.owner?.get(BodyComponent);\r\n\r\n        if (bodyA && bodyB) {\r\n          // Skip solving active+passive\r\n          if (bodyA.collisionType === CollisionType.Passive || bodyB.collisionType === CollisionType.Passive) {\r\n            continue;\r\n          }\r\n\r\n          const constraints = this.idToContactConstraint.get(contact.id) ?? [];\r\n          for (const point of constraints) {\r\n            const normal = contact.normal;\r\n            const separation = CollisionJumpTable.FindContactSeparation(contact, point.local);\r\n\r\n            const steeringConstant = Physics.steeringFactor; //0.2;\r\n            const maxCorrection = -5;\r\n            const slop = Physics.slop; //1;\r\n\r\n            // Clamp to avoid over-correction\r\n            // Remember that we are shooting for 0 overlap in the end\r\n            const steeringForce = clamp(steeringConstant * (separation + slop), maxCorrection, 0);\r\n            const impulse = normal.scale(-steeringForce / point.normalMass);\r\n\r\n            // This is a pseudo impulse, meaning we aren't doing a real impulse calculation\r\n            // We adjust position and rotation instead of doing the velocity\r\n            if (bodyA.collisionType === CollisionType.Active) {\r\n              bodyA.pos = bodyA.pos.add(impulse.negate().scale(bodyA.inverseMass));\r\n              bodyA.rotation -= point.aToContact.cross(impulse) * bodyA.inverseInertia;\r\n            }\r\n\r\n            if (bodyB.collisionType === CollisionType.Active) {\r\n              bodyB.pos = bodyB.pos.add(impulse.scale(bodyB.inverseMass));\r\n              bodyB.rotation += point.bToContact.cross(impulse) * bodyB.inverseInertia;\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  solveVelocity(contacts: CollisionContact[]) {\r\n    for (let i = 0; i < Physics.velocityIterations; i++) {\r\n      for (const contact of contacts) {\r\n        const bodyA = contact.colliderA.owner?.get(BodyComponent);\r\n        const bodyB = contact.colliderB.owner?.get(BodyComponent);\r\n\r\n        if (bodyA && bodyB) {\r\n          // Skip solving active+passive\r\n          if (bodyA.collisionType === CollisionType.Passive || bodyB.collisionType === CollisionType.Passive) {\r\n            continue;\r\n          }\r\n\r\n          const restitution = bodyA.bounciness * bodyB.bounciness;\r\n          const friction = Math.min(bodyA.friction, bodyB.friction);\r\n\r\n          const constraints = this.idToContactConstraint.get(contact.id) ?? [];\r\n\r\n          for (const point of constraints) {\r\n            const relativeVelocity = point.getRelativeVelocity();\r\n\r\n            // Negate velocity in tangent direction to simulate friction\r\n            const tangentVelocity = -relativeVelocity.dot(contact.tangent);\r\n            let impulseDelta = tangentVelocity / point.tangentMass;\r\n\r\n            // Clamping based in Erin Catto's GDC 2006 talk\r\n            // Correct clamping https://github.com/erincatto/box2d-lite/blob/master/docs/GDC2006_Catto_Erin_PhysicsTutorial.pdf\r\n            // Accumulated fiction impulse is always between -uMaxFriction < dT < uMaxFriction\r\n            // But deltas can vary\r\n            const maxFriction = friction * point.normalImpulse;\r\n            const newImpulse = clamp(point.tangentImpulse + impulseDelta, -maxFriction, maxFriction);\r\n            impulseDelta = newImpulse - point.tangentImpulse;\r\n            point.tangentImpulse = newImpulse;\r\n\r\n            const impulse = contact.tangent.scale(impulseDelta);\r\n            bodyA.applyImpulse(point.point, impulse.negate());\r\n            bodyB.applyImpulse(point.point, impulse);\r\n          }\r\n\r\n          for (const point of constraints) {\r\n            // Need to recalc relative velocity because the previous step could have changed vel\r\n            const relativeVelocity = point.getRelativeVelocity();\r\n\r\n            // Compute impulse in normal direction\r\n            const normalVelocity = relativeVelocity.dot(contact.normal);\r\n            // See https://en.wikipedia.org/wiki/Collision_response\r\n            let impulseDelta = (-(1 + restitution) * normalVelocity) / point.normalMass;\r\n\r\n            // Clamping based in Erin Catto's GDC 2014 talk\r\n            // Accumulated impulse stored in the contact is always positive (dV > 0)\r\n            // But deltas can be negative\r\n            const newImpulse = Math.max(point.normalImpulse + impulseDelta, 0);\r\n            impulseDelta = newImpulse - point.normalImpulse;\r\n            point.normalImpulse = newImpulse;\r\n\r\n            const impulse = contact.normal.scale(impulseDelta);\r\n            bodyA.applyImpulse(point.point, impulse.negate());\r\n            bodyB.applyImpulse(point.point, impulse);\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { Entity } from '../EntityComponentSystem';\r\nimport { MotionComponent } from '../EntityComponentSystem/Components/MotionComponent';\r\nimport { TransformComponent } from '../EntityComponentSystem/Components/TransformComponent';\r\nimport { AddedEntity, isAddedSystemEntity, RemovedEntity, System, SystemType } from '../EntityComponentSystem/System';\r\nimport { CollisionEndEvent, CollisionStartEvent, ContactEndEvent, ContactStartEvent } from '../Events';\r\nimport { CollisionResolutionStrategy, Physics } from './Physics';\r\nimport { ArcadeSolver } from './Solver/ArcadeSolver';\r\nimport { Collider } from './Colliders/Collider';\r\nimport { CollisionContact } from './Detection/CollisionContact';\r\nimport { DynamicTreeCollisionProcessor } from './Detection/DynamicTreeCollisionProcessor';\r\nimport { RealisticSolver } from './Solver/RealisticSolver';\r\nimport { CollisionSolver } from './Solver/Solver';\r\nimport { ColliderComponent } from './ColliderComponent';\r\nimport { CompositeCollider } from './Colliders/CompositeCollider';\r\nimport { Engine, ExcaliburGraphicsContext, Scene } from '..';\r\n\r\nexport class CollisionSystem extends System<TransformComponent | MotionComponent | ColliderComponent> {\r\n  public readonly types = ['ex.transform', 'ex.motion', 'ex.collider'] as const;\r\n  public systemType = SystemType.Update;\r\n  public priority = -1;\r\n\r\n  private _engine: Engine;\r\n  private _realisticSolver = new RealisticSolver();\r\n  private _arcadeSolver = new ArcadeSolver();\r\n  private _processor = new DynamicTreeCollisionProcessor();\r\n  private _lastFrameContacts = new Map<string, CollisionContact>();\r\n  private _currentFrameContacts = new Map<string, CollisionContact>();\r\n\r\n  private _trackCollider = (c: Collider) => this._processor.track(c);\r\n  private _untrackCollider = (c: Collider) => this._processor.untrack(c);\r\n\r\n  notify(message: AddedEntity | RemovedEntity) {\r\n    if (isAddedSystemEntity(message)) {\r\n      const colliderComponent = message.data.get(ColliderComponent);\r\n      colliderComponent.$colliderAdded.subscribe(this._trackCollider);\r\n      colliderComponent.$colliderRemoved.subscribe(this._untrackCollider);\r\n      const collider = colliderComponent.get();\r\n      if (collider) {\r\n        this._processor.track(collider);\r\n      }\r\n    } else {\r\n      const colliderComponent = message.data.get(ColliderComponent);\r\n      const collider = colliderComponent.get();\r\n      if (colliderComponent && collider) {\r\n        this._processor.untrack(collider);\r\n      }\r\n    }\r\n  }\r\n\r\n  initialize(scene: Scene) {\r\n    this._engine = scene.engine;\r\n  }\r\n\r\n  update(_entities: Entity[], elapsedMs: number): void {\r\n    if (!Physics.enabled) {\r\n      return;\r\n    }\r\n\r\n    // Collect up all the colliders\r\n    let colliders: Collider[] = [];\r\n    for (const entity of _entities) {\r\n      const colliderComp = entity.get(ColliderComponent);\r\n      const collider = colliderComp?.get();\r\n      if (colliderComp && colliderComp.owner?.active && collider) {\r\n        colliderComp.update();\r\n        if (collider instanceof CompositeCollider) {\r\n          colliders = colliders.concat(collider.getColliders());\r\n        } else {\r\n          colliders.push(collider);\r\n        }\r\n      }\r\n    }\r\n\r\n    // Update the spatial partitioning data structures\r\n    // TODO if collider invalid it will break the processor\r\n    // TODO rename \"update\" to something more specific\r\n    this._processor.update(colliders);\r\n\r\n    // Run broadphase on all colliders and locates potential collisions\r\n    const pairs = this._processor.broadphase(colliders, elapsedMs);\r\n\r\n    this._currentFrameContacts.clear();\r\n\r\n    // Given possible pairs find actual contacts\r\n    let contacts = this._processor.narrowphase(pairs, this._engine.debug.stats.currFrame);\r\n\r\n    const solver: CollisionSolver = this.getSolver();\r\n\r\n    // Solve, this resolves the position/velocity so entities arent overlapping\r\n    contacts = solver.solve(contacts);\r\n\r\n    // Record contacts\r\n    contacts.forEach((c) => this._currentFrameContacts.set(c.id, c));\r\n\r\n    // Emit contact start/end events\r\n    this.runContactStartEnd();\r\n\r\n    // reset the last frame cache\r\n    this._lastFrameContacts.clear();\r\n\r\n    // Keep track of collisions contacts that have started or ended\r\n    this._lastFrameContacts = new Map(this._currentFrameContacts);\r\n  }\r\n\r\n  getSolver(): CollisionSolver {\r\n    return Physics.collisionResolutionStrategy === CollisionResolutionStrategy.Realistic ? this._realisticSolver : this._arcadeSolver;\r\n  }\r\n\r\n  debug(ex: ExcaliburGraphicsContext) {\r\n    this._processor.debug(ex);\r\n  }\r\n\r\n  public runContactStartEnd() {\r\n    for (const [id, c] of this._currentFrameContacts) {\r\n      // find all new contacts\r\n      if (!this._lastFrameContacts.has(id)) {\r\n        const colliderA = c.colliderA;\r\n        const colliderB = c.colliderB;\r\n        colliderA.events.emit('collisionstart', new CollisionStartEvent(colliderA, colliderB, c));\r\n        colliderA.events.emit('contactstart', new ContactStartEvent(colliderA, colliderB, c) as any);\r\n        colliderB.events.emit('collisionstart', new CollisionStartEvent(colliderB, colliderA, c));\r\n        colliderB.events.emit('contactstart', new ContactStartEvent(colliderB, colliderA, c) as any);\r\n      }\r\n    }\r\n\r\n    // find all contacts taht have ceased\r\n    for (const [id, c] of this._lastFrameContacts) {\r\n      if (!this._currentFrameContacts.has(id)) {\r\n        const colliderA = c.colliderA;\r\n        const colliderB = c.colliderB;\r\n        colliderA.events.emit('collisionend', new CollisionEndEvent(colliderA, colliderB));\r\n        colliderA.events.emit('contactend', new ContactEndEvent(colliderA, colliderB) as any);\r\n        colliderB.events.emit('collisionend', new CollisionEndEvent(colliderB, colliderA));\r\n        colliderB.events.emit('contactend', new ContactEndEvent(colliderB, colliderA) as any);\r\n      }\r\n    }\r\n  }\r\n}\r\n","export class GraphicsDiagnostics {\r\n  public static DrawCallCount: number = 0;\r\n  public static DrawnImagesCount: number = 0;\r\n  public static clear(): void {\r\n    GraphicsDiagnostics.DrawCallCount = 0;\r\n    GraphicsDiagnostics.DrawnImagesCount = 0;\r\n  }\r\n}\r\n","import { Graphic, GraphicOptions } from './Graphic';\r\nimport { clamp } from '../Util/Util';\r\nimport { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\r\nimport { EventDispatcher } from '../EventDispatcher';\r\nimport { SpriteSheet } from './SpriteSheet';\r\nimport { Logger } from '../Util/Log';\r\nimport { Engine, LegacyDrawing } from '..';\r\nimport { Sprite } from '.';\r\n\r\nexport interface HasTick {\r\n  /**\r\n   *\r\n   * @param elapsedMilliseconds The amount of real world time in milliseconds that has elapsed that must be updated in the animation\r\n   * @param idempotencyToken Optional idempotencyToken prevents a ticking animation from updating twice per frame\r\n   */\r\n  tick(elapsedMilliseconds: number, idempotencyToken?: number): void;\r\n}\r\n\r\nexport enum AnimationStrategy {\r\n  /**\r\n   * Animation ends without displaying anything\r\n   */\r\n  End = 'end',\r\n  /**\r\n   * Animation loops to the first frame after the last frame\r\n   */\r\n  Loop = 'loop',\r\n  /**\r\n   * Animation plays to the last frame, then backwards to the first frame, then repeats\r\n   */\r\n  PingPong = 'pingpong',\r\n\r\n  /**\r\n   * Animation ends stopping on the last frame\r\n   */\r\n  Freeze = 'freeze'\r\n}\r\n\r\n/**\r\n * Frame of animation\r\n */\r\nexport interface Frame {\r\n  /**\r\n   * Optionally specify a graphic to show, no graphic shows an empty frame\r\n   */\r\n  graphic?: Graphic;\r\n  /**\r\n   * Optionally specify the number of ms the frame should be visible, overrids the animation duration (default 100 ms)\r\n   */\r\n  duration?: number;\r\n}\r\n\r\n/**\r\n * Animation options for building an animation via constructor.\r\n */\r\nexport interface AnimationOptions {\r\n  /**\r\n   * List of frames in the order you wish to play them\r\n   */\r\n  frames: Frame[];\r\n  /**\r\n   * Optionally specify a default frame duration in ms (Default is 1000)\r\n   */\r\n  frameDuration?: number;\r\n  /**\r\n   * Optionally specify the [[AnimationStrategy]] for the Animation\r\n   */\r\n  strategy?: AnimationStrategy;\r\n}\r\n\r\n// TODO wire up to new Emitter\r\nexport type AnimationEvents = {\r\n  frame: Frame;\r\n  loop: Animation;\r\n  ended: Animation;\r\n};\r\n\r\n/**\r\n * Create an Animation given a list of [[Frame|frames]] in [[AnimationOptions]]\r\n *\r\n * To create an Animation from a [[SpriteSheet]], use [[Animation.fromSpriteSheet]]\r\n */\r\nexport class Animation extends Graphic implements HasTick {\r\n  private static _LOGGER = Logger.getInstance();\r\n  public events = new EventDispatcher<any>(this); // TODO replace with new Emitter\r\n  public frames: Frame[] = [];\r\n  public strategy: AnimationStrategy = AnimationStrategy.Loop;\r\n  public frameDuration: number = 100;\r\n  public timeScale: number = 1;\r\n\r\n  private _idempotencyToken = -1;\r\n\r\n  private _firstTick = true;\r\n  private _currentFrame = 0;\r\n  private _timeLeftInFrame = 0;\r\n  private _direction = 1;\r\n  private _done = false;\r\n  private _playing = true;\r\n\r\n  constructor(options: GraphicOptions & AnimationOptions) {\r\n    super(options);\r\n    this.frames = options.frames;\r\n    this.strategy = options.strategy ?? this.strategy;\r\n    this.frameDuration = options.frameDuration ?? this.frameDuration;\r\n\r\n    this.goToFrame(0);\r\n  }\r\n\r\n  public clone(): Animation {\r\n    return new Animation({\r\n      frames: this.frames.map((f) => ({ ...f })),\r\n      frameDuration: this.frameDuration,\r\n      strategy: this.strategy,\r\n      ...this.cloneGraphicOptions()\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Create an Animation from a [[SpriteSheet]], a list of indices into the sprite sheet, a duration per frame\r\n   * and optional [[AnimationStrategy]]\r\n   *\r\n   * Example:\r\n   * ```typescript\r\n   * const spriteSheet = SpriteSheet.fromImageSource({...});\r\n   *\r\n   * const anim = Animation.fromSpriteSheet(spriteSheet, range(0, 5), 200, AnimationStrategy.Loop);\r\n   * ```\r\n   *\r\n   * @param spriteSheet\r\n   * @param frameIndices\r\n   * @param durationPerFrameMs\r\n   * @param strategy\r\n   */\r\n  public static fromSpriteSheet(\r\n    spriteSheet: SpriteSheet,\r\n    frameIndices: number[],\r\n    durationPerFrameMs: number,\r\n    strategy: AnimationStrategy = AnimationStrategy.Loop\r\n  ): Animation {\r\n    const maxIndex = spriteSheet.sprites.length - 1;\r\n    const invalidIndices = frameIndices.filter((index) => index < 0 || index > maxIndex);\r\n    if (invalidIndices.length) {\r\n      Animation._LOGGER.warn(\r\n        `Indices into SpriteSheet were provided that don\\'t exist: ${invalidIndices.join(',')} no frame will be shown`\r\n      );\r\n    }\r\n    return new Animation({\r\n      frames: spriteSheet.sprites\r\n        .filter((_, index) => frameIndices.indexOf(index) > -1)\r\n        .map((f) => ({\r\n          graphic: f,\r\n          duration: durationPerFrameMs\r\n        })),\r\n      strategy: strategy\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Converts an animation to a legacy animation\r\n   * @deprecated\r\n   * @param engine\r\n   * @param animation\r\n   * @returns LegacyDrawing.Animation\r\n   */\r\n  public static toLegacyAnimation(engine: Engine, animation: Animation): LegacyDrawing.Animation {\r\n    const legacySprites = animation.frames.map(f => Sprite.toLegacySprite(f.graphic as Sprite));\r\n    return new LegacyDrawing.Animation({\r\n      sprites: legacySprites,\r\n      loop: animation.strategy === AnimationStrategy.Loop,\r\n      freezeFrame: animation.strategy === AnimationStrategy.Freeze ? legacySprites.length - 1 : undefined,\r\n      speed: animation.frameDuration,\r\n      engine: engine\r\n    });\r\n  }\r\n\r\n  public get currentFrame(): Frame | null {\r\n    if (this._currentFrame >= 0 && this._currentFrame < this.frames.length) {\r\n      return this.frames[this._currentFrame];\r\n    }\r\n    return null;\r\n  }\r\n\r\n  public get isPlaying(): boolean {\r\n    return this._playing;\r\n  }\r\n\r\n  public play(): void {\r\n    this._playing = true;\r\n  }\r\n\r\n  public pause(): void {\r\n    this._playing = false;\r\n    this._firstTick = true;\r\n  }\r\n\r\n  public reset(): void {\r\n    this._done = false;\r\n    this._firstTick = true;\r\n    this._currentFrame = 0;\r\n  }\r\n\r\n  public get canFinish(): boolean {\r\n    switch (this.strategy) {\r\n      case AnimationStrategy.End:\r\n      case AnimationStrategy.Freeze: {\r\n        return true;\r\n      }\r\n      default: {\r\n        return false;\r\n      }\r\n    }\r\n  }\r\n\r\n  public get done(): boolean {\r\n    return this._done;\r\n  }\r\n\r\n  public goToFrame(frameNumber: number) {\r\n    this._currentFrame = frameNumber;\r\n    this._timeLeftInFrame = this.frameDuration;\r\n    const maybeFrame = this.frames[this._currentFrame];\r\n    if (maybeFrame && !this._done) {\r\n      this._timeLeftInFrame = maybeFrame?.duration || this.frameDuration;\r\n      this.width = maybeFrame.graphic?.width;\r\n      this.height = maybeFrame.graphic?.height;\r\n      this.events.emit('frame', maybeFrame as any);\r\n    }\r\n  }\r\n\r\n  private _nextFrame(): number {\r\n    const currentFrame = this._currentFrame;\r\n    if (this._done) {\r\n      return currentFrame;\r\n    }\r\n    let next = -1;\r\n\r\n    switch (this.strategy) {\r\n      case AnimationStrategy.Loop: {\r\n        next = (currentFrame + 1) % this.frames.length;\r\n        if (next === 0) {\r\n          this.events.emit('loop', this as any);\r\n        }\r\n        break;\r\n      }\r\n      case AnimationStrategy.End: {\r\n        next = currentFrame + 1;\r\n        if (next >= this.frames.length) {\r\n          this._done = true;\r\n          this._currentFrame = this.frames.length;\r\n          this.events.emit('end', this as any);\r\n        }\r\n        break;\r\n      }\r\n      case AnimationStrategy.Freeze: {\r\n        next = clamp(currentFrame + 1, 0, this.frames.length - 1);\r\n        if (next >= this.frames.length - 1) {\r\n          this._done = true;\r\n          this.events.emit('end', this as any);\r\n        }\r\n        break;\r\n      }\r\n      case AnimationStrategy.PingPong: {\r\n        if (currentFrame + this._direction >= this.frames.length) {\r\n          this._direction = -1;\r\n          this.events.emit('loop', this as any);\r\n        }\r\n\r\n        if (currentFrame + this._direction < 0) {\r\n          this._direction = 1;\r\n          this.events.emit('loop', this as any);\r\n        }\r\n\r\n        next = currentFrame + (this._direction % this.frames.length);\r\n        break;\r\n      }\r\n    }\r\n    return next;\r\n  }\r\n\r\n  public tick(elapsedMilliseconds: number, idempotencyToken: number = 0) {\r\n    if (this._idempotencyToken === idempotencyToken) {\r\n      return;\r\n    }\r\n    this._idempotencyToken = idempotencyToken;\r\n    if (!this._playing) {\r\n      return;\r\n    }\r\n\r\n    // if it's the first frame emit frame event\r\n    if (this._firstTick) {\r\n      this._firstTick = false;\r\n      this.events.emit('frame', this.currentFrame as any);\r\n    }\r\n\r\n    this._timeLeftInFrame -= elapsedMilliseconds * this.timeScale;\r\n    if (this._timeLeftInFrame <= 0) {\r\n      this.goToFrame(this._nextFrame());\r\n    }\r\n    this._updateDimensions();\r\n  }\r\n\r\n  private _updateDimensions() {\r\n    if (this.currentFrame) {\r\n      this.width = this.currentFrame.graphic?.width;\r\n      this.height = this.currentFrame.graphic?.height;\r\n    }\r\n  }\r\n\r\n  protected _drawImage(ctx: ExcaliburGraphicsContext, x: number, y: number) {\r\n    if (this.currentFrame) {\r\n      this.currentFrame.graphic.draw(ctx, x, y);\r\n    }\r\n  }\r\n}\r\n","import { Engine } from './Engine';\nimport { Actor } from './Actor';\nimport { Color } from './Color';\nimport { Vector, vec } from './Math/vector';\nimport * as Util from './Util/Util';\nimport * as DrawUtil from './Util/DrawUtil';\nimport * as Traits from './Traits/Index';\nimport { Configurable } from './Configurable';\nimport { Random } from './Math/Random';\nimport { CollisionType } from './Collision/CollisionType';\nimport { TransformComponent } from './EntityComponentSystem/Components/TransformComponent';\nimport { GraphicsComponent } from './Graphics/GraphicsComponent';\nimport { Entity } from './EntityComponentSystem/Entity';\nimport { CanvasDrawComponent } from './Drawing/Index';\nimport { Sprite } from './Graphics/Sprite';\nimport { LegacyDrawing } from '.';\n\n/**\n * An enum that represents the types of emitter nozzles\n */\nexport enum EmitterType {\n  /**\n   * Constant for the circular emitter type\n   */\n  Circle,\n  /**\n   * Constant for the rectangular emitter type\n   */\n  Rectangle\n}\n\n/**\n * @hidden\n */\nexport class ParticleImpl extends Entity {\n  public position: Vector = new Vector(0, 0);\n  public velocity: Vector = new Vector(0, 0);\n  public acceleration: Vector = new Vector(0, 0);\n  public particleRotationalVelocity: number = 0;\n  public currentRotation: number = 0;\n\n  public focus: Vector = null;\n  public focusAccel: number = 0;\n  public opacity: number = 1;\n  public beginColor: Color = Color.White;\n  public endColor: Color = Color.White;\n\n  // Life is counted in ms\n  public life: number = 300;\n  public fadeFlag: boolean = false;\n\n  // Color transitions\n  private _rRate: number = 1;\n  private _gRate: number = 1;\n  private _bRate: number = 1;\n  private _aRate: number = 0;\n  private _currentColor: Color = Color.White;\n\n  public emitter: ParticleEmitter = null;\n  public particleSize: number = 5;\n  public particleSprite: LegacyDrawing.Sprite = null;\n\n  public startSize: number;\n  public endSize: number;\n  public sizeRate: number = 0;\n  public elapsedMultiplier: number = 0;\n\n  public visible = true;\n  public isOffscreen = false;\n\n  public transform: TransformComponent;\n  public graphics: GraphicsComponent;\n\n  constructor(\n    emitterOrConfig: ParticleEmitter | ParticleArgs,\n    life?: number,\n    opacity?: number,\n    beginColor?: Color,\n    endColor?: Color,\n    position?: Vector,\n    velocity?: Vector,\n    acceleration?: Vector,\n    startSize?: number,\n    endSize?: number\n  ) {\n    super();\n    let emitter = emitterOrConfig;\n    if (emitter && !(emitterOrConfig instanceof ParticleEmitter)) {\n      const config = emitterOrConfig;\n      emitter = config.emitter;\n      life = config.life;\n      opacity = config.opacity;\n      endColor = config.endColor;\n      beginColor = config.beginColor;\n      position = config.position;\n      velocity = config.velocity;\n      acceleration = config.acceleration;\n      startSize = config.startSize;\n      endSize = config.endSize;\n    }\n    this.emitter = <ParticleEmitter>emitter;\n    this.life = life || this.life;\n    this.opacity = opacity || this.opacity;\n    this.endColor = endColor || this.endColor.clone();\n    this.beginColor = beginColor || this.beginColor.clone();\n    this._currentColor = this.beginColor.clone();\n    this.position = (position || this.position).add(this.emitter.pos);\n    this.velocity = velocity || this.velocity;\n    this.acceleration = acceleration || this.acceleration;\n    this._rRate = (this.endColor.r - this.beginColor.r) / this.life;\n    this._gRate = (this.endColor.g - this.beginColor.g) / this.life;\n    this._bRate = (this.endColor.b - this.beginColor.b) / this.life;\n    this._aRate = this.opacity / this.life;\n\n    this.startSize = startSize || 0;\n    this.endSize = endSize || 0;\n\n    if (this.endSize > 0 && this.startSize > 0) {\n      this.sizeRate = (this.endSize - this.startSize) / this.life;\n      this.particleSize = this.startSize;\n    }\n\n    this.addComponent((this.transform = new TransformComponent()));\n    this.addComponent(new CanvasDrawComponent((ctx) => this.draw(ctx)));\n    this.addComponent((this.graphics = new GraphicsComponent()));\n\n    this.transform.pos = this.position;\n    this.transform.rotation = this.currentRotation;\n    this.transform.scale = vec(1, 1); // TODO wut\n    if (this.particleSprite) {\n      this.graphics.opacity = this.opacity;\n      this.graphics.use(Sprite.fromLegacySprite(this.particleSprite));\n    } else {\n      this.graphics.onPostDraw = (ctx) => {\n        ctx.save();\n        this.graphics.opacity = this.opacity;\n        const tmpColor = this._currentColor.clone();\n        tmpColor.a = 1;\n        ctx.debug.drawPoint(vec(0, 0), { color: tmpColor, size: this.particleSize });\n        ctx.restore();\n      };\n    }\n  }\n\n  public kill() {\n    this.emitter.removeParticle(this);\n  }\n\n  public update(_engine: Engine, delta: number) {\n    this.life = this.life - delta;\n    this.elapsedMultiplier = this.elapsedMultiplier + delta;\n\n    if (this.life < 0) {\n      this.kill();\n    }\n\n    if (this.fadeFlag) {\n      this.opacity = Util.clamp(this._aRate * this.life, 0.0001, 1);\n    }\n\n    if (this.startSize > 0 && this.endSize > 0) {\n      this.particleSize = Util.clamp(\n        this.sizeRate * delta + this.particleSize,\n        Math.min(this.startSize, this.endSize),\n        Math.max(this.startSize, this.endSize)\n      );\n    }\n\n    this._currentColor.r = Util.clamp(this._currentColor.r + this._rRate * delta, 0, 255);\n    this._currentColor.g = Util.clamp(this._currentColor.g + this._gRate * delta, 0, 255);\n    this._currentColor.b = Util.clamp(this._currentColor.b + this._bRate * delta, 0, 255);\n    this._currentColor.a = Util.clamp(this.opacity, 0.0001, 1);\n\n    if (this.focus) {\n      const accel = this.focus\n        .sub(this.position)\n        .normalize()\n        .scale(this.focusAccel)\n        .scale(delta / 1000);\n      this.velocity = this.velocity.add(accel);\n    } else {\n      this.velocity = this.velocity.add(this.acceleration.scale(delta / 1000));\n    }\n    this.position = this.position.add(this.velocity.scale(delta / 1000));\n\n    if (this.particleRotationalVelocity) {\n      this.currentRotation = (this.currentRotation + (this.particleRotationalVelocity * delta) / 1000) % (2 * Math.PI);\n    }\n\n    this.transform.pos = this.position;\n    this.transform.rotation = this.currentRotation;\n    this.transform.scale = vec(1, 1); // todo wut\n    this.graphics.opacity = this.opacity;\n  }\n\n  public draw(ctx: CanvasRenderingContext2D) {\n    if (this.particleSprite) {\n      this.particleSprite.opacity(this.opacity);\n      this.particleSprite.draw(ctx, 0, 0);\n      return;\n    }\n\n    ctx.save();\n    this._currentColor.a = Util.clamp(this.opacity, 0.0001, 1);\n    ctx.fillStyle = this._currentColor.toString();\n    ctx.beginPath();\n    ctx.arc(0, 0, this.particleSize, 0, Math.PI * 2);\n    ctx.fill();\n    ctx.closePath();\n    ctx.restore();\n  }\n}\n\nexport interface ParticleArgs extends Partial<ParticleImpl> {\n  emitter: ParticleEmitter;\n  position?: Vector;\n  velocity?: Vector;\n  acceleration?: Vector;\n  particleRotationalVelocity?: number;\n  currentRotation?: number;\n  particleSize?: number;\n  particleSprite?: LegacyDrawing.Sprite;\n}\n\n/**\n * Particle is used in a [[ParticleEmitter]]\n */\nexport class Particle extends Configurable(ParticleImpl) {\n  constructor(config: ParticleArgs);\n  constructor(\n    emitter: ParticleEmitter,\n    life?: number,\n    opacity?: number,\n    beginColor?: Color,\n    endColor?: Color,\n    position?: Vector,\n    velocity?: Vector,\n    acceleration?: Vector,\n    startSize?: number,\n    endSize?: number\n  );\n  constructor(\n    emitterOrConfig: ParticleEmitter | ParticleArgs,\n    life?: number,\n    opacity?: number,\n    beginColor?: Color,\n    endColor?: Color,\n    position?: Vector,\n    velocity?: Vector,\n    acceleration?: Vector,\n    startSize?: number,\n    endSize?: number\n  ) {\n    super(emitterOrConfig, life, opacity, beginColor, endColor, position, velocity, acceleration, startSize, endSize);\n  }\n}\n\nexport interface ParticleEmitterArgs {\n  x?: number;\n  y?: number;\n  pos?: Vector;\n  width?: number;\n  height?: number;\n  isEmitting?: boolean;\n  minVel?: number;\n  maxVel?: number;\n  acceleration?: Vector;\n  minAngle?: number;\n  maxAngle?: number;\n  emitRate?: number;\n  particleLife?: number;\n  opacity?: number;\n  fadeFlag?: boolean;\n  focus?: Vector;\n  focusAccel?: number;\n  startSize?: number;\n  endSize?: number;\n  minSize?: number;\n  maxSize?: number;\n  beginColor?: Color;\n  endColor?: Color;\n  particleSprite?: LegacyDrawing.Sprite;\n  emitterType?: EmitterType;\n  radius?: number;\n  particleRotationalVelocity?: number;\n  randomRotation?: boolean;\n  random?: Random;\n}\n\n/**\n * Using a particle emitter is a great way to create interesting effects\n * in your game, like smoke, fire, water, explosions, etc. `ParticleEmitter`\n * extend [[Actor]] allowing you to use all of the features that come with.\n */\nexport class ParticleEmitter extends Actor {\n  private _particlesToEmit: number = 0;\n\n  public numParticles: number = 0;\n\n  /**\n   * Random number generator\n   */\n  public random: Random;\n\n  /**\n   * Gets or sets the isEmitting flag\n   */\n  public isEmitting: boolean = true;\n  /**\n   * Gets or sets the backing particle collection\n   */\n  public particles: Particle[] = [];\n\n  /**\n   * Gets or sets the backing deadParticle collection\n   */\n  public deadParticles: Particle[] = [];\n\n  /**\n   * Gets or sets the minimum particle velocity\n   */\n  public minVel: number = 0;\n  /**\n   * Gets or sets the maximum particle velocity\n   */\n  public maxVel: number = 0;\n\n  /**\n   * Gets or sets the acceleration vector for all particles\n   */\n  public acceleration: Vector = new Vector(0, 0);\n\n  /**\n   * Gets or sets the minimum angle in radians\n   */\n  public minAngle: number = 0;\n  /**\n   * Gets or sets the maximum angle in radians\n   */\n  public maxAngle: number = 0;\n\n  /**\n   * Gets or sets the emission rate for particles (particles/sec)\n   */\n  public emitRate: number = 1; //particles/sec\n  /**\n   * Gets or sets the life of each particle in milliseconds\n   */\n  public particleLife: number = 2000;\n  /**\n   * Gets the opacity of each particle from 0 to 1.0\n   */\n  public get opacity(): number {\n    return super.graphics.opacity;\n  }\n  /**\n   * Gets the opacity of each particle from 0 to 1.0\n   */\n  public set opacity(opacity: number) {\n    super.graphics.opacity = opacity;\n  }\n  /**\n   * Gets or sets the fade flag which causes particles to gradually fade out over the course of their life.\n   */\n  public fadeFlag: boolean = false;\n\n  /**\n   * Gets or sets the optional focus where all particles should accelerate towards\n   */\n  public focus: Vector = null;\n  /**\n   * Gets or sets the acceleration for focusing particles if a focus has been specified\n   */\n  public focusAccel: number = null;\n  /**\n   * Gets or sets the optional starting size for the particles\n   */\n  public startSize: number = null;\n  /**\n   * Gets or sets the optional ending size for the particles\n   */\n  public endSize: number = null;\n\n  /**\n   * Gets or sets the minimum size of all particles\n   */\n  public minSize: number = 5;\n  /**\n   * Gets or sets the maximum size of all particles\n   */\n  public maxSize: number = 5;\n\n  /**\n   * Gets or sets the beginning color of all particles\n   */\n  public beginColor: Color = Color.White;\n  /**\n   * Gets or sets the ending color of all particles\n   */\n  public endColor: Color = Color.White;\n\n  private _og: LegacyDrawing.Sprite = null;\n  private _sprite: Sprite = null;\n  /**\n   * Gets or sets the sprite that a particle should use\n   */\n  public get particleSprite(): LegacyDrawing.Sprite {\n    return this._og;\n  }\n\n  public set particleSprite(val: LegacyDrawing.Sprite) {\n    this._og = val;\n    if (val) {\n      this._sprite = Sprite.fromLegacySprite(val);\n    }\n  }\n\n  /**\n   * Gets or sets the emitter type for the particle emitter\n   */\n  public emitterType: EmitterType = EmitterType.Rectangle;\n\n  /**\n   * Gets or sets the emitter radius, only takes effect when the [[emitterType]] is [[EmitterType.Circle]]\n   */\n  public radius: number = 0;\n\n  /**\n   * Gets or sets the particle rotational speed velocity\n   */\n  public particleRotationalVelocity: number = 0;\n\n  /**\n   * Indicates whether particles should start with a random rotation\n   */\n  public randomRotation: boolean = false;\n\n  /**\n   * @param config particle emitter options bag\n   */\n  constructor(config: ParticleEmitterArgs) {\n    super({ width: config.width ?? 0, height: config.height ?? 0 });\n\n    const {\n      x,\n      y,\n      pos,\n      isEmitting,\n      minVel,\n      maxVel,\n      acceleration,\n      minAngle,\n      maxAngle,\n      emitRate,\n      particleLife,\n      opacity,\n      fadeFlag,\n      focus,\n      focusAccel,\n      startSize,\n      endSize,\n      minSize,\n      maxSize,\n      beginColor,\n      endColor,\n      particleSprite,\n      emitterType,\n      radius,\n      particleRotationalVelocity,\n      randomRotation,\n      random\n    } = { ...config };\n\n    this.pos = pos ?? vec(x ?? 0, y ?? 0);\n    this.isEmitting = isEmitting ?? this.isEmitting;\n    this.minVel = minVel ?? this.minVel;\n    this.maxVel = maxVel ?? this.maxVel;\n    this.acceleration = acceleration ?? this.acceleration;\n    this.minAngle = minAngle ?? this.minAngle;\n    this.maxAngle = maxAngle ?? this.maxAngle;\n    this.emitRate = emitRate ?? this.emitRate;\n    this.particleLife = particleLife ?? this.particleLife;\n    this.opacity = opacity ?? this.opacity;\n    this.fadeFlag = fadeFlag ?? this.fadeFlag;\n    this.focus = focus ?? this.focus;\n    this.focusAccel = focusAccel ?? this.focusAccel;\n    this.startSize = startSize ?? this.startSize;\n    this.endSize = endSize ?? this.endSize;\n    this.minSize = minSize ?? this.minSize;\n    this.maxSize = maxSize ?? this.maxSize;\n    this.beginColor = beginColor ?? this.beginColor;\n    this.endColor = endColor ?? this.endColor;\n    this.particleSprite = particleSprite ?? this.particleSprite;\n    this.emitterType = emitterType ?? this.emitterType;\n    this.radius = radius ?? this.radius;\n    this.particleRotationalVelocity = particleRotationalVelocity ?? this.particleRotationalVelocity;\n    this.randomRotation = randomRotation ?? this.randomRotation;\n\n    this.body.collisionType = CollisionType.PreventCollision;\n\n    this.random = random ?? new Random();\n\n    // Remove offscreen culling from particle emitters\n    for (let i = 0; i < this.traits.length; i++) {\n      if (this.traits[i] instanceof Traits.OffscreenCulling) {\n        this.traits.splice(i, 1);\n      }\n    }\n  }\n\n  public removeParticle(particle: Particle) {\n    this.deadParticles.push(particle);\n  }\n\n  /**\n   * Causes the emitter to emit particles\n   * @param particleCount  Number of particles to emit right now\n   */\n  public emitParticles(particleCount: number) {\n    for (let i = 0; i < particleCount; i++) {\n      const p = this._createParticle();\n      this.particles.push(p);\n      if (this?.scene?.world) {\n        this.scene.world.add(p);\n      }\n    }\n  }\n\n  public clearParticles() {\n    this.particles.length = 0;\n  }\n\n  // Creates a new particle given the constraints of the emitter\n  private _createParticle(): Particle {\n    // todo implement emitter constraints;\n    let ranX = 0;\n    let ranY = 0;\n\n    const angle = Util.randomInRange(this.minAngle, this.maxAngle, this.random);\n    const vel = Util.randomInRange(this.minVel, this.maxVel, this.random);\n    const size = this.startSize || Util.randomInRange(this.minSize, this.maxSize, this.random);\n    const dx = vel * Math.cos(angle);\n    const dy = vel * Math.sin(angle);\n\n    if (this.emitterType === EmitterType.Rectangle) {\n      ranX = Util.randomInRange(0, this.width, this.random);\n      ranY = Util.randomInRange(0, this.height, this.random);\n    } else if (this.emitterType === EmitterType.Circle) {\n      const radius = Util.randomInRange(0, this.radius, this.random);\n      ranX = radius * Math.cos(angle);\n      ranY = radius * Math.sin(angle);\n    }\n\n    const p = new Particle(\n      this,\n      this.particleLife,\n      this.opacity,\n      this.beginColor,\n      this.endColor,\n      new Vector(ranX, ranY),\n      new Vector(dx, dy),\n      this.acceleration,\n      this.startSize,\n      this.endSize\n    );\n    p.fadeFlag = this.fadeFlag;\n    p.particleSize = size;\n    if (this.particleSprite) {\n      p.particleSprite = this.particleSprite;\n      p.graphics.opacity = this.opacity;\n      p.graphics.use(this._sprite);\n    }\n    p.particleRotationalVelocity = this.particleRotationalVelocity;\n    if (this.randomRotation) {\n      p.currentRotation = Util.randomInRange(0, Math.PI * 2, this.random);\n    }\n    if (this.focus) {\n      p.focus = this.focus.add(new Vector(this.pos.x, this.pos.y));\n      p.focusAccel = this.focusAccel;\n    }\n    return p;\n  }\n\n  public update(engine: Engine, delta: number) {\n    super.update(engine, delta);\n\n    if (this.isEmitting) {\n      this._particlesToEmit += this.emitRate * (delta / 1000);\n      if (this._particlesToEmit > 1.0) {\n        this.emitParticles(Math.floor(this._particlesToEmit));\n        this._particlesToEmit = this._particlesToEmit - Math.floor(this._particlesToEmit);\n      }\n    }\n\n    // deferred removal\n    for (let i = 0; i < this.deadParticles.length; i++) {\n      Util.removeItemFromArray(this.deadParticles[i], this.particles);\n      if (this?.scene?.world) {\n        this.scene.world.remove(this.deadParticles[i], false);\n      }\n    }\n    this.deadParticles.length = 0;\n  }\n\n  public draw(ctx: CanvasRenderingContext2D) {\n    // todo is there a more efficient to draw\n    // possibly use a webgl offscreen canvas and shaders to do particles?\n    this.particles.forEach((p) => p.draw(ctx));\n  }\n\n  public debugDraw(ctx: CanvasRenderingContext2D) {\n    super.debugDraw(ctx);\n    ctx.fillStyle = Color.Black.toString();\n    ctx.fillText('Particles: ' + this.particles.length, this.pos.x, this.pos.y + 20);\n\n    if (this.focus) {\n      ctx.fillRect(this.focus.x + this.pos.x, this.focus.y + this.pos.y, 3, 3);\n      DrawUtil.line(ctx, Color.Yellow, this.focus.x + this.pos.x, this.focus.y + this.pos.y, this.center.x, this.center.y);\n      ctx.fillText('Focus', this.focus.x + this.pos.x, this.focus.y + this.pos.y);\n    }\n  }\n}\n","import { Vector } from '../Math/vector';\nimport { Graphic, GraphicOptions } from './Graphic';\nimport { Animation, HasTick } from './Animation';\nimport { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\nimport { BoundingBox } from '../Collision/Index';\n\nexport interface GraphicsGroupingOptions {\n  members: GraphicsGrouping[];\n}\n\nexport interface GraphicsGrouping {\n  pos: Vector;\n  graphic: Graphic;\n}\n\nexport class GraphicsGroup extends Graphic implements HasTick {\n  public members: GraphicsGrouping[] = [];\n\n  constructor(options: GraphicsGroupingOptions & GraphicOptions) {\n    super(options);\n    this.members = options.members;\n    this._updateDimensions();\n  }\n\n  public clone(): GraphicsGroup {\n    return new GraphicsGroup({\n      members: [...this.members],\n      ...this.cloneGraphicOptions()\n    });\n  }\n\n  private _updateDimensions(): BoundingBox {\n    let bb = new BoundingBox();\n    for (const { graphic, pos } of this.members) {\n      bb = graphic.localBounds.translate(pos).combine(bb);\n    }\n\n    this.width = bb.width;\n    this.height = bb.height;\n\n    return bb;\n  }\n\n  public get localBounds(): BoundingBox {\n    let bb = new BoundingBox();\n    for (const { graphic, pos } of this.members) {\n      bb = graphic.localBounds.translate(pos).combine(bb);\n    }\n    return bb;\n  }\n\n  private _isAnimationOrGroup(graphic: Graphic): graphic is Animation | GraphicsGroup {\n    return graphic instanceof Animation || graphic instanceof GraphicsGroup;\n  }\n\n  public tick(elapsedMilliseconds: number, idempotencyToken?: number) {\n    for (const member of this.members) {\n      const maybeAnimation = member.graphic;\n      if (this._isAnimationOrGroup(maybeAnimation)) {\n        maybeAnimation.tick(elapsedMilliseconds, idempotencyToken);\n      }\n    }\n  }\n\n  public reset() {\n    for (const member of this.members) {\n      const maybeAnimation = member.graphic;\n      if (this._isAnimationOrGroup(maybeAnimation)) {\n        maybeAnimation.reset();\n      }\n    }\n  }\n\n  protected _preDraw(ex: ExcaliburGraphicsContext, x: number, y: number) {\n    this._updateDimensions();\n    super._preDraw(ex, x, y);\n  }\n\n  protected _drawImage(ex: ExcaliburGraphicsContext, x: number, y: number) {\n    for (const member of this.members) {\n      ex.save();\n      ex.translate(x, y);\n      member.graphic.draw(ex, member.pos.x, member.pos.y);\n      if (this.showDebug) {\n        /* istanbul ignore next */\n        ex.debug.drawRect(0, 0, this.width, this.height);\n      }\n      ex.restore();\n    }\n  }\n}\n","import { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\r\nimport { Scene } from '../Scene';\r\nimport { GraphicsComponent } from './GraphicsComponent';\r\nimport { vec } from '../Math/vector';\r\nimport { CoordPlane, TransformComponent } from '../EntityComponentSystem/Components/TransformComponent';\r\nimport { Entity } from '../EntityComponentSystem/Entity';\r\nimport { Camera } from '../Camera';\r\nimport { System, SystemType, TagComponent } from '../EntityComponentSystem';\r\nimport { Engine } from '../Engine';\r\nimport { GraphicsDiagnostics } from './GraphicsDiagnostics';\r\nimport { EnterViewPortEvent, ExitViewPortEvent } from '../Events';\r\nimport { GraphicsGroup } from '.';\r\nimport { Particle } from '../Particles';\r\n\r\nexport class GraphicsSystem extends System<TransformComponent | GraphicsComponent> {\r\n  public readonly types = ['ex.transform', 'ex.graphics'] as const;\r\n  public readonly systemType = SystemType.Draw;\r\n  public priority = 0;\r\n  private _token = 0;\r\n  private _graphicsContext: ExcaliburGraphicsContext;\r\n  private _camera: Camera;\r\n  private _engine: Engine;\r\n\r\n  public initialize(scene: Scene): void {\r\n    this._graphicsContext = scene.engine.graphicsContext;\r\n    this._camera = scene.camera;\r\n    this._engine = scene.engine;\r\n  }\r\n\r\n  public sort(a: Entity, b: Entity) {\r\n    return a.get(TransformComponent).z - b.get(TransformComponent).z;\r\n  }\r\n\r\n  public update(entities: Entity[], delta: number): void {\r\n    this._clearScreen();\r\n    this._token++;\r\n    let transform: TransformComponent;\r\n    let graphics: GraphicsComponent;\r\n\r\n    for (const entity of entities) {\r\n      transform = entity.get(TransformComponent);\r\n      graphics = entity.get(GraphicsComponent);\r\n\r\n      // Figure out if entities are offscreen\r\n      const entityOffscreen = this._isOffscreen(transform, graphics);\r\n      if (entityOffscreen && !entity.hasTag('offscreen')) {\r\n        entity.eventDispatcher.emit('exitviewport', new ExitViewPortEvent(entity));\r\n        entity.addComponent(new TagComponent('offscreen'));\r\n      }\r\n\r\n      if (!entityOffscreen && entity.hasTag('offscreen')) {\r\n        entity.eventDispatcher.emit('enterviewport', new EnterViewPortEvent(entity));\r\n        entity.removeComponent('offscreen');\r\n      }\r\n      // Skip entities that have graphics offscreen\r\n      if (entityOffscreen) {\r\n        continue;\r\n      }\r\n\r\n      // This optionally sets our camera based on the entity coord plan (world vs. screen)\r\n      this._pushCameraTransform(transform);\r\n\r\n      this._graphicsContext.save();\r\n\r\n      // Tick any graphics state (but only once) for animations and graphics groups\r\n      graphics.update(delta, this._token);\r\n\r\n      // Position the entity\r\n      this._applyTransform(entity);\r\n\r\n      // Optionally run the onPreDraw graphics lifecycle draw\r\n      if (graphics.onPreDraw) {\r\n        graphics.onPreDraw(this._graphicsContext, delta);\r\n      }\r\n\r\n      // TODO remove this hack on the particle redo\r\n      const particleOpacity = (entity instanceof Particle) ? entity.opacity : 1;\r\n      this._graphicsContext.opacity = graphics.opacity * particleOpacity;\r\n\r\n      // Draw the graphics component\r\n      this._drawGraphicsComponent(graphics);\r\n\r\n      // Optionally run the onPostDraw graphics lifecycle draw\r\n      if (graphics.onPostDraw) {\r\n        graphics.onPostDraw(this._graphicsContext, delta);\r\n      }\r\n\r\n      this._graphicsContext.restore();\r\n\r\n      // Reset the transform back to the original\r\n      this._popCameraTransform(transform);\r\n    }\r\n\r\n    this._graphicsContext.flush();\r\n    this._engine.stats.currFrame.graphics.drawnImages = GraphicsDiagnostics.DrawnImagesCount;\r\n    this._engine.stats.currFrame.graphics.drawCalls = GraphicsDiagnostics.DrawCallCount;\r\n  }\r\n\r\n  private _clearScreen(): void {\r\n    this._graphicsContext.clear();\r\n  }\r\n\r\n  private _isOffscreen(transform: TransformComponent, graphics: GraphicsComponent) {\r\n    if (transform.coordPlane === CoordPlane.World) {\r\n      const graphicsOffscreen = !this._camera.viewport.intersect(graphics.localBounds.transform(transform.getGlobalMatrix()));\r\n      return graphicsOffscreen;\r\n    } else {\r\n      // TODO sceen coordinates\r\n      return false;\r\n    }\r\n  }\r\n\r\n  private _drawGraphicsComponent(graphicsComponent: GraphicsComponent) {\r\n    if (graphicsComponent.visible) {\r\n      // this should be moved to the graphics system\r\n      for (const layer of graphicsComponent.layers.get()) {\r\n        for (const { graphic, options } of layer.graphics) {\r\n          let anchor = graphicsComponent.anchor;\r\n          let offset = graphicsComponent.offset;\r\n          if (options?.anchor) {\r\n            anchor = options.anchor;\r\n          }\r\n          if (options?.offset) {\r\n            offset = options.offset;\r\n          }\r\n          // See https://github.com/excaliburjs/Excalibur/pull/619 for discussion on this formula\r\n          const offsetX = -graphic.width * anchor.x + offset.x;\r\n          const offsetY = -graphic.height * anchor.y + offset.y;\r\n\r\n          graphic?.draw(this._graphicsContext, offsetX + layer.offset.x, offsetY + layer.offset.y);\r\n\r\n          if (this._engine?.isDebug && this._engine.debug.graphics.showBounds) {\r\n            const offset = vec(offsetX + layer.offset.x, offsetY + layer.offset.y);\r\n            if (graphic instanceof GraphicsGroup) {\r\n              for (const g of graphic.members) {\r\n                g.graphic?.localBounds.translate(offset.add(g.pos)).draw(this._graphicsContext, this._engine.debug.graphics.boundsColor);\r\n              }\r\n            } else {\r\n              /* istanbul ignore next */\r\n              graphic?.localBounds.translate(offset).draw(this._graphicsContext, this._engine.debug.graphics.boundsColor);\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * This applies the current entity transform to the graphics context\r\n   * @param entity\r\n   */\r\n  private _applyTransform(entity: Entity): void {\r\n    const ancestors = entity.getAncestors();\r\n    for (const ancestor of ancestors) {\r\n      const transform = ancestor?.get(TransformComponent);\r\n      if (transform) {\r\n        this._graphicsContext.translate(transform.pos.x, transform.pos.y);\r\n        this._graphicsContext.scale(transform.scale.x, transform.scale.y);\r\n        this._graphicsContext.rotate(transform.rotation);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Applies the current camera transform if in world coordinates\r\n   * @param transform\r\n   */\r\n  private _pushCameraTransform(transform: TransformComponent) {\r\n    // Establish camera offset per entity\r\n    if (transform.coordPlane === CoordPlane.World) {\r\n      this._graphicsContext.save();\r\n      if (this._camera) {\r\n        this._camera.draw(this._graphicsContext);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Resets the current camera transform if in world coordinates\r\n   * @param transform\r\n   */\r\n  private _popCameraTransform(transform: TransformComponent) {\r\n    if (transform.coordPlane === CoordPlane.World) {\r\n      // Apply camera world offset\r\n      this._graphicsContext.restore();\r\n    }\r\n  }\r\n}\r\n","import { Engine } from '../Engine';\r\nimport { Actor } from '../Actor';\r\nimport { Entity, System, SystemType } from '../EntityComponentSystem';\r\nimport { CanvasDrawComponent } from './CanvasDrawComponent';\r\nimport { Scene } from '../Scene';\r\nimport { Camera } from '../Camera';\r\nimport { CoordPlane, TransformComponent } from '../EntityComponentSystem/Components/TransformComponent';\r\nimport { GraphicsDiagnostics } from '../Graphics/GraphicsDiagnostics';\r\n\r\n/**\r\n * Draws anything with a transform and a \"draw\" method\r\n * @deprecated Shim for canvas drawing, will be removed v0.26.0\r\n */\r\nexport class CanvasDrawingSystem extends System<TransformComponent | CanvasDrawComponent> {\r\n  public readonly types = ['ex.transform', 'ex.canvas'] as const;\r\n  public systemType = SystemType.Draw;\r\n  public priority = -1;\r\n\r\n  private _ctx: CanvasRenderingContext2D;\r\n  private _camera: Camera;\r\n  private _engine: Engine;\r\n\r\n  public initialize(scene: Scene): void {\r\n    this._ctx = scene.engine.ctx;\r\n    this._engine = scene.engine;\r\n    this._camera = scene.camera;\r\n  }\r\n\r\n  public sort(a: Entity, b: Entity) {\r\n    return a.get(TransformComponent).z - b.get(TransformComponent).z;\r\n  }\r\n\r\n  public update(entities: Entity[], delta: number) {\r\n    this._clearScreen();\r\n\r\n    let transform: TransformComponent;\r\n    let canvasdraw: CanvasDrawComponent;\r\n    const length = entities.length;\r\n    for (let i = 0; i < length; i++) {\r\n      const visible = (entities[i] as Actor)?.graphics?.visible ?? true;\r\n      const offscreen = (entities[i] as Actor).isOffScreen;\r\n      if (visible && !offscreen) {\r\n        transform = entities[i].get(TransformComponent);\r\n        canvasdraw = entities[i].get(CanvasDrawComponent);\r\n\r\n        this._ctx.save();\r\n        this._pushCameraTransform(transform);\r\n\r\n        this._ctx.save();\r\n        this._applyTransform(entities[i]);\r\n        canvasdraw.draw(this._ctx, delta);\r\n        this._ctx.restore();\r\n\r\n        this._popCameraTransform(transform);\r\n        this._ctx.restore();\r\n      }\r\n\r\n      if (this._engine.isDebug) {\r\n        this._ctx.save();\r\n        this._pushCameraTransform(transform);\r\n        this._ctx.strokeStyle = 'yellow';\r\n        (entities[i] as unknown as Actor).debugDraw(this._ctx);\r\n        this._popCameraTransform(transform);\r\n        this._ctx.restore();\r\n      }\r\n    }\r\n    if (this._engine.isDebug) {\r\n      this._ctx.save();\r\n      this._camera.draw(this._ctx);\r\n      this._camera.debugDraw(this._ctx);\r\n      this._ctx.restore();\r\n    }\r\n\r\n    this._engine.stats.currFrame.graphics.drawnImages = GraphicsDiagnostics.DrawnImagesCount;\r\n    this._engine.stats.currFrame.graphics.drawCalls = GraphicsDiagnostics.DrawCallCount;\r\n  }\r\n\r\n  private _applyTransform(entity: Entity) {\r\n    const ancestors = entity.getAncestors();\r\n    for (const ancestor of ancestors) {\r\n      const transform = ancestor?.get(TransformComponent);\r\n      if (transform) {\r\n        this._ctx.translate(transform.pos.x, transform.pos.y);\r\n        this._ctx.rotate(transform.rotation);\r\n        this._ctx.scale(transform.scale.x, transform.scale.y);\r\n      }\r\n    }\r\n  }\r\n\r\n  private _clearScreen(): void {\r\n    this._ctx.clearRect(0, 0, this._ctx.canvas.width, this._ctx.canvas.height);\r\n    this._ctx.fillStyle = this._engine.backgroundColor.toString();\r\n    this._ctx.fillRect(0, 0, this._ctx.canvas.width, this._ctx.canvas.height);\r\n  }\r\n\r\n  private _pushCameraTransform(transform: TransformComponent) {\r\n    if (transform.coordPlane === CoordPlane.World) {\r\n      // Apply camera transform to place entity in world space\r\n      this._ctx.save();\r\n      if (this._camera) {\r\n        this._camera.draw(this._ctx);\r\n      }\r\n    }\r\n  }\r\n\r\n  private _popCameraTransform(transform: TransformComponent) {\r\n    if (transform.coordPlane === CoordPlane.World) {\r\n      // Restore back to screen space from world space if we were drawing an entity there\r\n      this._ctx.restore();\r\n    }\r\n  }\r\n}\r\n","import { Engine } from '../Engine';\r\nimport { Scene } from '../Scene';\r\nimport { Camera } from '../Camera';\r\nimport { MotionComponent } from '../EntityComponentSystem/Components/MotionComponent';\r\nimport { ColliderComponent } from '../Collision/ColliderComponent';\r\nimport { CoordPlane, Entity, TransformComponent } from '../EntityComponentSystem';\r\nimport { System, SystemType } from '../EntityComponentSystem/System';\r\nimport { ExcaliburGraphicsContext } from '../Graphics/Context/ExcaliburGraphicsContext';\r\nimport { vec, Vector } from '../Math/vector';\r\nimport { BodyComponent, CollisionSystem, CompositeCollider, GraphicsComponent, Particle, Util } from '..';\r\n\r\nexport class DebugSystem extends System<TransformComponent> {\r\n  public readonly types = ['ex.transform'] as const;\r\n  public readonly systemType = SystemType.Draw;\r\n  public priority = 999; // lowest priority\r\n  private _graphicsContext: ExcaliburGraphicsContext;\r\n  private _collisionSystem: CollisionSystem;\r\n  private _camera: Camera;\r\n  private _engine: Engine;\r\n\r\n  public initialize(scene: Scene): void {\r\n    this._graphicsContext = scene.engine.graphicsContext;\r\n    this._camera = scene.camera;\r\n    this._engine = scene.engine;\r\n    this._collisionSystem = scene.world.systemManager.get(CollisionSystem);\r\n  }\r\n\r\n  update(entities: Entity[], _delta: number): void {\r\n    if (!this._engine.isDebug) {\r\n      return;\r\n    }\r\n\r\n    const filterSettings = this._engine.debug.filter;\r\n\r\n    let id: number;\r\n    let name: string;\r\n    const entitySettings = this._engine.debug.entity;\r\n\r\n    let tx: TransformComponent;\r\n    const txSettings = this._engine.debug.transform;\r\n\r\n    let motion: MotionComponent;\r\n    const motionSettings = this._engine.debug.motion;\r\n\r\n    let colliderComp: ColliderComponent;\r\n    const colliderSettings = this._engine.debug.collider;\r\n\r\n    const physicsSettings = this._engine.debug.physics;\r\n\r\n    let graphics: GraphicsComponent;\r\n    const graphicsSettings = this._engine.debug.graphics;\r\n\r\n    let body: BodyComponent;\r\n    const bodySettings = this._engine.debug.body;\r\n\r\n    const cameraSettings = this._engine.debug.camera;\r\n    for (const entity of entities) {\r\n      if (entity.hasTag('offscreen')) {\r\n        // skip offscreen entities\r\n        continue;\r\n      }\r\n      if (entity instanceof Particle) {\r\n        // Particles crush the renderer :(\r\n        continue;\r\n      }\r\n      if (filterSettings.useFilter) {\r\n        const allIds = filterSettings.ids.length === 0;\r\n        const idMatch = allIds || filterSettings.ids.includes(entity.id);\r\n        if (!idMatch) {\r\n          continue;\r\n        }\r\n        const allNames = filterSettings.nameQuery === '';\r\n        const nameMatch = allNames || entity.name.includes(filterSettings.nameQuery);\r\n        if (!nameMatch) {\r\n          continue;\r\n        }\r\n      }\r\n\r\n      let cursor = Vector.Zero;\r\n      const lineHeight = vec(0, 16);\r\n      id = entity.id;\r\n      name = entity.name;\r\n      tx = entity.get(TransformComponent);\r\n\r\n      // This optionally sets our camera based on the entity coord plan (world vs. screen)\r\n      this._pushCameraTransform(tx);\r\n\r\n      this._graphicsContext.save();\r\n\r\n      this._applyTransform(entity);\r\n      if (tx) {\r\n        if (txSettings.showAll || txSettings.showPosition) {\r\n          this._graphicsContext.debug.drawPoint(Vector.Zero, { size: 2, color: txSettings.positionColor });\r\n          this._graphicsContext.debug.drawText(`pos${tx.pos.toString(2)}`, cursor);\r\n          cursor = cursor.add(lineHeight);\r\n        }\r\n\r\n        if (entitySettings.showAll || entitySettings.showId) {\r\n          this._graphicsContext.debug.drawText(`id(${id}) ${tx.parent ? 'child of id(' + tx.parent?.owner?.id + ')' : ''}`, cursor);\r\n          cursor = cursor.add(lineHeight);\r\n        }\r\n\r\n        if (entitySettings.showAll || entitySettings.showName) {\r\n          this._graphicsContext.debug.drawText(`name(${name})`, cursor);\r\n          cursor = cursor.add(lineHeight);\r\n        }\r\n\r\n        if (txSettings.showAll || txSettings.showRotation) {\r\n          this._graphicsContext.drawLine(\r\n            Vector.Zero,\r\n            Vector.fromAngle(tx.rotation).scale(50).add(Vector.Zero),\r\n            txSettings.rotationColor,\r\n            2\r\n          );\r\n          this._graphicsContext.debug.drawText(`rot deg(${Util.toDegrees(tx.rotation).toFixed(2)})`, cursor);\r\n          cursor = cursor.add(lineHeight);\r\n        }\r\n\r\n        if (txSettings.showAll || txSettings.showScale) {\r\n          this._graphicsContext.drawLine(Vector.Zero, tx.scale.add(Vector.Zero), txSettings.scaleColor, 2);\r\n        }\r\n      }\r\n\r\n      graphics = entity.get(GraphicsComponent);\r\n      if (graphics) {\r\n        if (graphicsSettings.showAll || graphicsSettings.showBounds) {\r\n          const bounds = graphics.localBounds;\r\n          bounds.draw(this._graphicsContext, graphicsSettings.boundsColor);\r\n        }\r\n      }\r\n\r\n      body = entity.get(BodyComponent);\r\n      if (body) {\r\n        if (bodySettings.showAll || bodySettings.showCollisionGroup) {\r\n          this._graphicsContext.debug.drawText(`collision group(${body.group.name})`, cursor);\r\n          cursor = cursor.add(lineHeight);\r\n        }\r\n\r\n        if (bodySettings.showAll || bodySettings.showCollisionType) {\r\n          this._graphicsContext.debug.drawText(`collision type(${body.collisionType})`, cursor);\r\n          cursor = cursor.add(lineHeight);\r\n        }\r\n\r\n        if (bodySettings.showAll || bodySettings.showMass) {\r\n          this._graphicsContext.debug.drawText(`mass(${body.mass})`, cursor);\r\n          cursor = cursor.add(lineHeight);\r\n        }\r\n\r\n        if (bodySettings.showAll || bodySettings.showMotion) {\r\n          this._graphicsContext.debug.drawText(`motion(${body.sleepMotion})`, cursor);\r\n          cursor = cursor.add(lineHeight);\r\n        }\r\n\r\n        if (bodySettings.showAll || bodySettings.showSleeping) {\r\n          this._graphicsContext.debug.drawText(`sleeping(${body.canSleep ? body.sleeping: 'cant sleep'})`, cursor);\r\n          cursor = cursor.add(lineHeight);\r\n        }\r\n      }\r\n\r\n      this._graphicsContext.restore();\r\n\r\n      motion = entity.get(MotionComponent);\r\n      if (motion) {\r\n        if (motionSettings.showAll || motionSettings.showVelocity) {\r\n          this._graphicsContext.debug.drawText(`vel${motion.vel.toString(2)}`, cursor.add(tx.globalPos));\r\n          this._graphicsContext.drawLine(tx.globalPos, tx.globalPos.add(motion.vel), motionSettings.velocityColor, 2);\r\n          cursor = cursor.add(lineHeight);\r\n        }\r\n\r\n        if (motionSettings.showAll || motionSettings.showAcceleration) {\r\n          this._graphicsContext.drawLine(tx.globalPos, tx.globalPos.add(motion.acc), motionSettings.accelerationColor, 2);\r\n        }\r\n      }\r\n\r\n      // Colliders live in world space already so after the restore()\r\n      colliderComp = entity.get(ColliderComponent);\r\n      if (colliderComp) {\r\n        const collider = colliderComp.get();\r\n        if (colliderSettings.showAll || colliderSettings.showGeometry) {\r\n          collider.debug(this._graphicsContext, colliderSettings.geometryColor);\r\n        }\r\n        if (colliderSettings.showAll || colliderSettings.showBounds) {\r\n          if (collider instanceof CompositeCollider) {\r\n            const colliders = collider.getColliders();\r\n            for (const collider of colliders) {\r\n              const bounds = collider.bounds;\r\n              const pos = vec(bounds.left, bounds.top);\r\n              this._graphicsContext.debug.drawRect(pos.x, pos.y, bounds.width, bounds.height, { color: colliderSettings.boundsColor });\r\n              if (colliderSettings.showAll || colliderSettings.showOwner) {\r\n                this._graphicsContext.debug.drawText(`owner id(${collider.owner.id})`, pos);\r\n              }\r\n            }\r\n            colliderComp.bounds.draw(this._graphicsContext, colliderSettings.boundsColor);\r\n          } else if (collider) {\r\n            const bounds = colliderComp.bounds;\r\n            const pos = vec(bounds.left, bounds.top);\r\n            this._graphicsContext.debug.drawRect(pos.x, pos.y, bounds.width, bounds.height, { color: colliderSettings.boundsColor });\r\n            if (colliderSettings.showAll || colliderSettings.showOwner) {\r\n              this._graphicsContext.debug.drawText(`owner id(${colliderComp.owner.id})`, pos);\r\n            }\r\n          }\r\n        }\r\n      }\r\n\r\n      this._popCameraTransform(tx);\r\n    }\r\n\r\n    this._graphicsContext.save();\r\n    this._camera.draw(this._graphicsContext);\r\n    if (physicsSettings.showAll || physicsSettings.showBroadphaseSpacePartitionDebug) {\r\n      this._collisionSystem.debug(this._graphicsContext);\r\n    }\r\n    if (physicsSettings.showAll || physicsSettings.showCollisionContacts || physicsSettings.showCollisionNormals) {\r\n      for (const [_, contact] of this._engine.debug.stats.currFrame.physics.contacts) {\r\n        if (physicsSettings.showAll || physicsSettings.showCollisionContacts) {\r\n          for (const point of contact.points) {\r\n            this._graphicsContext.debug.drawPoint(point, { size: 5, color: physicsSettings.collisionContactColor });\r\n          }\r\n        }\r\n\r\n        if (physicsSettings.showAll || physicsSettings.showCollisionNormals) {\r\n          for (const point of contact.points) {\r\n            this._graphicsContext.debug.drawLine(point, contact.normal.scale(30).add(point), {\r\n              color: physicsSettings.collisionNormalColor\r\n            });\r\n          }\r\n        }\r\n      }\r\n    }\r\n    this._graphicsContext.restore();\r\n\r\n    if (cameraSettings) {\r\n      this._graphicsContext.save();\r\n      this._camera.draw(this._graphicsContext);\r\n      if (cameraSettings.showAll || cameraSettings.showFocus) {\r\n        this._graphicsContext.drawCircle(this._camera.pos, 4, cameraSettings.focusColor);\r\n      }\r\n      if (cameraSettings.showAll || cameraSettings.showZoom) {\r\n        this._graphicsContext.debug.drawText(`zoom(${this._camera.zoom})`, this._camera.pos);\r\n      }\r\n      this._graphicsContext.restore();\r\n    }\r\n\r\n    this._graphicsContext.flush();\r\n  }\r\n\r\n  /**\r\n   * This applies the current entity transform to the graphics context\r\n   * @param entity\r\n   */\r\n  private _applyTransform(entity: Entity): void {\r\n    const ancestors = entity.getAncestors();\r\n    for (const ancestor of ancestors) {\r\n      const transform = ancestor?.get(TransformComponent);\r\n      if (transform) {\r\n        this._graphicsContext.translate(transform.pos.x, transform.pos.y);\r\n        this._graphicsContext.scale(transform.scale.x, transform.scale.y);\r\n        this._graphicsContext.rotate(transform.rotation);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Applies the current camera transform if in world coordinates\r\n   * @param transform\r\n   */\r\n  private _pushCameraTransform(transform: TransformComponent) {\r\n    // Establish camera offset per entity\r\n    if (transform.coordPlane === CoordPlane.World) {\r\n      this._graphicsContext.save();\r\n      if (this._camera) {\r\n        this._camera.draw(this._graphicsContext);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Resets the current camera transform if in world coordinates\r\n   * @param transform\r\n   */\r\n  private _popCameraTransform(transform: TransformComponent) {\r\n    if (transform.coordPlane === CoordPlane.World) {\r\n      // Apply camera world offset\r\n      this._graphicsContext.restore();\r\n    }\r\n  }\r\n}\r\n","import { Logger } from '../Util/Log';\r\nimport { Class } from '../Class';\r\nimport * as Events from '../Events';\r\n\r\n/**\r\n * Enum representing physical input key codes\r\n */\r\nexport enum Keys {\r\n  // NUMPAD\r\n  Num0 = 'Numpad0',\r\n  Num1 = 'Numpad1',\r\n  Num2 = 'Numpad2',\r\n  Num3 = 'Numpad3',\r\n  Num4 = 'Numpad4',\r\n  Num5 = 'Numpad5',\r\n  Num6 = 'Numpad6',\r\n  Num7 = 'Numpad7',\r\n  Num8 = 'Numpad8',\r\n  Num9 = 'Numpad9',\r\n  NumAdd = 'NumpadAdd',\r\n  NumSubtract = 'NumpadSubtract',\r\n  NumMultiply = 'NumpadMultiply',\r\n  NumDivide = 'NumpadDivide',\r\n  // NumComma = 'NumpadComma', // not x-browser\r\n  NumDecimal = 'NumpadDecimal',\r\n  Numpad0 = 'Numpad0',\r\n  Numpad1 = 'Numpad1',\r\n  Numpad2 = 'Numpad2',\r\n  Numpad3 = 'Numpad3',\r\n  Numpad4 = 'Numpad4',\r\n  Numpad5 = 'Numpad5',\r\n  Numpad6 = 'Numpad6',\r\n  Numpad7 = 'Numpad7',\r\n  Numpad8 = 'Numpad8',\r\n  Numpad9 = 'Numpad9',\r\n  NumpadAdd = 'NumpadAdd',\r\n  NumpadSubtract = 'NumpadSubtract',\r\n  NumpadMultiply = 'NumpadMultiply',\r\n  NumpadDivide = 'NumpadDivide',\r\n  // NumpadComma = 'NumpadComma', // not x-browser\r\n  NumpadDecimal = 'NumpadDecimal',\r\n\r\n  // MODIFIERS\r\n  NumLock = 'NumLock',\r\n  ShiftLeft = 'ShiftLeft',\r\n  ShiftRight = 'ShiftRight',\r\n  AltLeft = 'AltLeft',\r\n  AltRight = 'AltRight',\r\n\r\n  // NUMBERS\r\n  Key0 = 'Digit0',\r\n  Key1 = 'Digit1',\r\n  Key2 = 'Digit2',\r\n  Key3 = 'Digit3',\r\n  Key4 = 'Digit4',\r\n  Key5 = 'Digit5',\r\n  Key6 = 'Digit6',\r\n  Key7 = 'Digit7',\r\n  Key8 = 'Digit8',\r\n  Key9 = 'Digit9',\r\n  Digit0 = 'Digit0',\r\n  Digit1 = 'Digit1',\r\n  Digit2 = 'Digit2',\r\n  Digit3 = 'Digit3',\r\n  Digit4 = 'Digit4',\r\n  Digit5 = 'Digit5',\r\n  Digit6 = 'Digit6',\r\n  Digit7 = 'Digit7',\r\n  Digit8 = 'Digit8',\r\n  Digit9 = 'Digit9',\r\n\r\n  // LETTERS\r\n  A = 'KeyA',\r\n  B = 'KeyB',\r\n  C = 'KeyC',\r\n  D = 'KeyD',\r\n  E = 'KeyE',\r\n  F = 'KeyF',\r\n  G = 'KeyG',\r\n  H = 'KeyH',\r\n  I = 'KeyI',\r\n  J = 'KeyJ',\r\n  K = 'KeyK',\r\n  L = 'KeyL',\r\n  M = 'KeyM',\r\n  N = 'KeyN',\r\n  O = 'KeyO',\r\n  P = 'KeyP',\r\n  Q = 'KeyQ',\r\n  R = 'KeyR',\r\n  S = 'KeyS',\r\n  T = 'KeyT',\r\n  U = 'KeyU',\r\n  V = 'KeyV',\r\n  W = 'KeyW',\r\n  X = 'KeyX',\r\n  Y = 'KeyY',\r\n  Z = 'KeyZ',\r\n  KeyA = 'KeyA',\r\n  KeyB = 'KeyB',\r\n  KeyC = 'KeyC',\r\n  KeyD = 'KeyD',\r\n  KeyE = 'KeyE',\r\n  KeyF = 'KeyF',\r\n  KeyG = 'KeyG',\r\n  KeyH = 'KeyH',\r\n  KeyI = 'KeyI',\r\n  KeyJ = 'KeyJ',\r\n  KeyK = 'KeyK',\r\n  KeyL = 'KeyL',\r\n  KeyM = 'KeyM',\r\n  KeyN = 'KeyN',\r\n  KeyO = 'KeyO',\r\n  KeyP = 'KeyP',\r\n  KeyQ = 'KeyQ',\r\n  KeyR = 'KeyR',\r\n  KeyS = 'KeyS',\r\n  KeyT = 'KeyT',\r\n  KeyU = 'KeyU',\r\n  KeyV = 'KeyV',\r\n  KeyW = 'KeyW',\r\n  KeyX = 'KeyX',\r\n  KeyY = 'KeyY',\r\n  KeyZ = 'KeyZ',\r\n\r\n  // SYMBOLS\r\n  Semicolon = 'Semicolon',\r\n  Quote = 'Quote',\r\n  Comma = 'Comma',\r\n  Minus = 'Minus',\r\n  Period = 'Period',\r\n  Slash = 'Slash',\r\n  Equal = 'Equal',\r\n  BracketLeft = 'BracketLeft',\r\n  Backslash = 'Backslash',\r\n  BracketRight = 'BracketRight',\r\n  Backquote = 'Backquote',\r\n\r\n  // DIRECTIONS\r\n  Up = 'ArrowUp',\r\n  Down = 'ArrowDown',\r\n  Left = 'ArrowLeft',\r\n  Right = 'ArrowRight',\r\n  ArrowUp = 'ArrowUp',\r\n  ArrowDown = 'ArrowDown',\r\n  ArrowLeft = 'ArrowLeft',\r\n  ArrowRight = 'ArrowRight',\r\n\r\n  // OTHER\r\n  Space = 'Space',\r\n  Esc = 'Escape',\r\n  Escape = 'Escape'\r\n}\r\n\r\n/**\r\n * Event thrown on a game object for a key event\r\n */\r\nexport class KeyEvent extends Events.GameEvent<any> {\r\n  /**\r\n   * @param key  The key responsible for throwing the event\r\n   * @param value The key's typed value the browser detected\r\n   * @param originalEvent The original keyboard event that Excalibur handled\r\n   */\r\n  constructor(public key: Keys, public value?: string, public originalEvent?: KeyboardEvent) {\r\n    super();\r\n  }\r\n}\r\n\r\n/**\r\n * Provides keyboard support for Excalibur.\r\n */\r\nexport class Keyboard extends Class {\r\n  private _keys: Keys[] = [];\r\n  private _keysUp: Keys[] = [];\r\n  private _keysDown: Keys[] = [];\r\n\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  public on(eventName: Events.press, handler: (event: KeyEvent) => void): void;\r\n  public on(eventName: Events.release, handler: (event: KeyEvent) => void): void;\r\n  public on(eventName: Events.hold, handler: (event: KeyEvent) => void): void;\r\n  public on(eventName: string, handler: (event: Events.GameEvent<any>) => void): void;\r\n  public on(eventName: string, handler: (event: any) => void): void {\r\n    super.on(eventName, handler);\r\n  }\r\n\r\n  /**\r\n   * Initialize Keyboard event listeners\r\n   */\r\n  init(global?: GlobalEventHandlers): void {\r\n    if (!global) {\r\n      try {\r\n        // Try and listen to events on top window frame if within an iframe.\r\n        //\r\n        // See https://github.com/excaliburjs/Excalibur/issues/1294\r\n        //\r\n        // Attempt to add an event listener, which triggers a DOMException on\r\n        // cross-origin iframes\r\n        const noop = () => {\r\n          return;\r\n        };\r\n        window.top.addEventListener('blur', noop);\r\n        window.top.removeEventListener('blur', noop);\r\n\r\n        // this will be the same as window if not embedded within an iframe\r\n        global = window.top;\r\n      } catch {\r\n        // fallback to current frame\r\n        global = window;\r\n\r\n        Logger.getInstance().warn(\r\n          'Failed to bind to keyboard events to top frame. ' +\r\n            'If you are trying to embed Excalibur in a cross-origin iframe, keyboard events will not fire.'\r\n        );\r\n      }\r\n    }\r\n\r\n    global.addEventListener('blur', () => {\r\n      this._keys.length = 0; // empties array efficiently\r\n    });\r\n\r\n    // key up is on window because canvas cannot have focus\r\n    global.addEventListener('keyup', (ev: KeyboardEvent) => {\r\n      const code = ev.code as Keys;\r\n      const key = this._keys.indexOf(code);\r\n      this._keys.splice(key, 1);\r\n      this._keysUp.push(code);\r\n      const keyEvent = new KeyEvent(code, ev.key, ev);\r\n\r\n      // alias the old api, we may want to deprecate this in the future\r\n      this.eventDispatcher.emit('up', keyEvent);\r\n      this.eventDispatcher.emit('release', keyEvent);\r\n    });\r\n\r\n    // key down is on window because canvas cannot have focus\r\n    global.addEventListener('keydown', (ev: KeyboardEvent) => {\r\n      const code = ev.code as Keys;\r\n      if (this._keys.indexOf(code) === -1) {\r\n        this._keys.push(code);\r\n        this._keysDown.push(code);\r\n        const keyEvent = new KeyEvent(code, ev.key, ev);\r\n        this.eventDispatcher.emit('down', keyEvent);\r\n        this.eventDispatcher.emit('press', keyEvent);\r\n      }\r\n    });\r\n  }\r\n\r\n  public update() {\r\n    // Reset keysDown and keysUp after update is complete\r\n    this._keysDown.length = 0;\r\n    this._keysUp.length = 0;\r\n\r\n    // Emit synthetic \"hold\" event\r\n    for (let i = 0; i < this._keys.length; i++) {\r\n      this.eventDispatcher.emit('hold', new KeyEvent(this._keys[i]));\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Gets list of keys being pressed down\r\n   */\r\n  public getKeys(): Keys[] {\r\n    return this._keys;\r\n  }\r\n\r\n  /**\r\n   * Tests if a certain key was just pressed this frame. This is cleared at the end of the update frame.\r\n   * @param key Test whether a key was just pressed\r\n   */\r\n  public wasPressed(key: Keys): boolean {\r\n    return this._keysDown.indexOf(key) > -1;\r\n  }\r\n\r\n  /**\r\n   * Tests if a certain key is held down. This is persisted between frames.\r\n   * @param key  Test whether a key is held down\r\n   */\r\n  public isHeld(key: Keys): boolean {\r\n    return this._keys.indexOf(key) > -1;\r\n  }\r\n\r\n  /**\r\n   * Tests if a certain key was just released this frame. This is cleared at the end of the update frame.\r\n   * @param key  Test whether a key was just released\r\n   */\r\n  public wasReleased(key: Keys): boolean {\r\n    return this._keysUp.indexOf(key) > -1;\r\n  }\r\n}\r\n","import { Actor } from '../Actor';\nimport { Vector } from '../Math/vector';\nimport { Class } from '../Class';\nimport * as Actors from '../Util/Actors';\nimport { removeItemFromArray } from '../Util/Util';\nimport { PointerMoveEvent, PointerDownEvent, PointerUpEvent, WheelEvent } from './PointerEvents';\n\nexport interface ActorsUnderPointer {\n  [ActorId: number]: Actor;\n  length: number;\n}\n\n/**\n * The type of pointer for a [[PointerEvent]].\n */\nexport enum PointerType {\n  Touch = 'Touch',\n  Mouse = 'Mouse',\n  Pen = 'Pen',\n  Unknown = 'Unknown'\n}\n\n/**\n * Determines the scope of handling mouse/touch events. See [[Pointers]] for more information.\n */\nexport enum PointerScope {\n  /**\n   * Handle events on the `canvas` element only. Events originating outside the\n   * `canvas` will not be handled.\n   */\n  Canvas = 'Canvas',\n\n  /**\n   * Handles events on the entire document. All events will be handled by Excalibur.\n   */\n  Document = 'Document'\n}\n\n/**\n * Captures and dispatches PointerEvents\n */\nexport class Pointer extends Class {\n  private static _MAX_ID = 0;\n  public readonly id = Pointer._MAX_ID++;\n  private _isDown: boolean = false;\n  private _wasDown: boolean = false;\n\n  private _actorsUnderPointer: ActorsUnderPointer = { length: 0 };\n\n  private _actors: Actor[] = [];\n  private _actorsLastFrame: Actor[] = [];\n  private _actorsNoLongerUnderPointer: Actor[] = [];\n\n  private _actorSortingFcn = (a: Actor, b: Actor) => {\n    if (a.z === b.z) {\n      return b.id - a.id;\n    }\n    return b.z - a.z;\n  };\n\n  /**\n   * Whether the Pointer is currently dragging.\n   */\n  public get isDragging(): boolean {\n    return this._isDown;\n  }\n\n  /**\n   * Whether the Pointer just started dragging.\n   */\n  public get isDragStart(): boolean {\n    return !this._wasDown && this._isDown;\n  }\n\n  /**\n   * Whether the Pointer just ended dragging.\n   */\n  public get isDragEnd(): boolean {\n    return this._wasDown && !this._isDown;\n  }\n\n  /**\n   * Returns true if pointer has any actors under\n   */\n  public get hasActorsUnderPointer(): boolean {\n    return !!this._actorsUnderPointer.length;\n  }\n\n  /**\n   * The last position on the document this pointer was at. Can be `null` if pointer was never active.\n   */\n  public lastPagePos: Vector = null;\n\n  /**\n   * The last position on the screen this pointer was at. Can be `null` if pointer was never active.\n   */\n  public lastScreenPos: Vector = null;\n\n  /**\n   * The last position in the game world coordinates this pointer was at. Can be `null` if pointer was never active.\n   */\n  public lastWorldPos: Vector = null;\n\n  /**\n   * Returns the currently dragging target or null if it isn't exist\n   */\n  public dragTarget: Actor = null;\n\n  constructor() {\n    super();\n\n    this.on('move', this._onPointerMove);\n    this.on('down', this._onPointerDown);\n    this.on('up', this._onPointerUp);\n  }\n\n  on(event: 'move', handler: (event: PointerMoveEvent) => void): void;\n  on(event: 'down', handler: (event: PointerDownEvent) => void): void;\n  on(event: 'up', handler: (event: PointerUpEvent) => void): void;\n  on(event: 'wheel', handler: (event: WheelEvent) => void): void;\n  on(event: string, handler: (event: any) => void): void {\n    super.on(event, handler);\n  }\n\n  once(event: 'move', handler: (event: PointerMoveEvent) => void): void;\n  once(event: 'down', handler: (event: PointerDownEvent) => void): void;\n  once(event: 'up', handler: (event: PointerUpEvent) => void): void;\n  once(event: 'wheel', handler: (event: WheelEvent) => void): void;\n  once(event: string, handler: (event: any) => void): void {\n    super.once(event, handler);\n  }\n\n  off(event: 'move', handler?: (event: PointerMoveEvent) => void): void;\n  off(event: 'down', handler?: (event: PointerDownEvent) => void): void;\n  off(event: 'up', handler?: (event: PointerUpEvent) => void): void;\n  off(event: 'wheel', handler?: (event: WheelEvent) => void): void;\n  off(event: string, handler?: (event: any) => void): void {\n    super.off(event, handler);\n  }\n\n  /**\n   * Update the state of current pointer, meant to be called a the end of frame\n   */\n  public update(): void {\n    if (this._wasDown && !this._isDown) {\n      this._wasDown = false;\n    } else if (!this._wasDown && this._isDown) {\n      this._wasDown = true;\n    }\n    this._actorsLastFrame = [...this._actors];\n    this._actorsNoLongerUnderPointer = [];\n  }\n\n  /**\n   * Adds an Actor to actorsUnderPointer object.\n   * @param actor An Actor to be added;\n   */\n  public addActorUnderPointer(actor: Actor): void {\n    if (!this.isActorAliveUnderPointer(actor)) {\n      this._actorsUnderPointer[actor.id] = actor;\n      this._actorsUnderPointer.length += 1;\n      this._actors.push(actor);\n    }\n\n    // Actors are processed in z-order highest z to lowest\n    // ties are broken by id highest id (newest) to lowest id (oldest)\n    this._actors.sort(this._actorSortingFcn);\n  }\n\n  /**\n   * Removes an Actor from actorsUnderPointer object.\n   * @param actor An Actor to be removed;\n   */\n  public removeActorUnderPointer(actor: Actor): void {\n    if (this.isActorAliveUnderPointer(actor)) {\n      delete this._actorsUnderPointer[actor.id];\n      this._actorsUnderPointer.length -= 1;\n      removeItemFromArray(actor, this._actors);\n      this._actorsNoLongerUnderPointer.push(actor);\n    }\n  }\n\n  /**\n   * Returns all actors under this pointer this frame\n   */\n  public getActorsUnderPointer(): Actor[] {\n    return this._actors;\n  }\n\n  /**\n   * Returns all actors that are no longer under the pointer this frame\n   */\n  public getActorsUnderPointerLastFrame(): Actor[] {\n    return this._actorsLastFrame;\n  }\n\n  /**\n   * Returns all actors relevant for events to pointer this frame\n   */\n  public getActorsForEvents(): Actor[] {\n    return this._actors\n      .concat(this._actorsLastFrame)\n      .filter((actor, i, self) => {\n        return self.indexOf(actor) === i; // de-dup\n      })\n      .sort(this._actorSortingFcn); // sort by z\n  }\n\n  /**\n   * Checks if Pointer location has a specific Actor bounds contained underneath.\n   * @param actor An Actor for check;\n   */\n  public checkActorUnderPointer(actor: Actor): boolean {\n    if (this.lastWorldPos) {\n      return actor.contains(this.lastWorldPos.x, this.lastWorldPos.y, !Actors.isScreenElement(actor));\n    }\n    return false;\n  }\n\n  /**\n   * Checks if an actor was under the pointer last frame\n   * @param actor\n   */\n  public wasActorUnderPointer(actor: Actor): boolean {\n    return this._actorsLastFrame.indexOf(actor) > -1;\n  }\n\n  /**\n   * Checks if Pointer has a specific Actor in ActorsUnderPointer list.\n   * @param actor An Actor for check;\n   */\n  public isActorAliveUnderPointer(actor: Actor): boolean {\n    return !!(!actor.isKilled() && actor.scene && this._actorsUnderPointer.hasOwnProperty(actor.id.toString()));\n  }\n\n  private _onPointerMove(ev: PointerMoveEvent): void {\n    this.lastPagePos = new Vector(ev.pagePos.x, ev.pagePos.y);\n    this.lastScreenPos = new Vector(ev.screenPos.x, ev.screenPos.y);\n    this.lastWorldPos = new Vector(ev.worldPos.x, ev.worldPos.y);\n  }\n\n  private _onPointerDown(ev: PointerDownEvent): void {\n    this.lastPagePos = new Vector(ev.pagePos.x, ev.pagePos.y);\n    this.lastScreenPos = new Vector(ev.screenPos.x, ev.screenPos.y);\n    this.lastWorldPos = new Vector(ev.worldPos.x, ev.worldPos.y);\n    this._isDown = true;\n  }\n\n  private _onPointerUp(_ev: PointerUpEvent): void {\n    this._isDown = false;\n    this.dragTarget = null;\n  }\n}\n","import { Actor } from '../Actor';\nimport { GlobalCoordinates } from '../Math/global-coordinates';\nimport { Vector } from '../Math/vector';\nimport { Pointer, PointerType } from './Pointer';\nimport { GameEvent } from '../Events';\n\n/**\n * Native browser button enumeration\n */\nexport enum NativePointerButton {\n  NoButton = -1,\n  Left = 0,\n  Middle = 1,\n  Right = 2,\n  Unknown = 3\n}\n\n/**\n * The mouse button being pressed.\n */\nexport enum PointerButton {\n  Left = 'Left',\n  Middle = 'Middle',\n  Right = 'Right',\n  Unknown = 'Unknown',\n  NoButton = 'NoButton'\n}\n\nexport enum WheelDeltaMode {\n  Pixel = 'Pixel',\n  Line = 'Line',\n  Page = 'Page'\n}\n\n/**\n * Type that indicates Excalibur's valid synthetic pointer events\n */\nexport type PointerEventName =\n  | 'pointerdragstart'\n  | 'pointerdragend'\n  | 'pointerdragmove'\n  | 'pointerdragenter'\n  | 'pointerdragleave'\n  | 'pointermove'\n  | 'pointerenter'\n  | 'pointerleave'\n  | 'pointerup'\n  | 'pointerdown';\n\n/**\n * Pointer events\n *\n * Represents a mouse, touch, or stylus event. See [[Pointers]] for more information on\n * handling pointer input.\n *\n * For mouse-based events, you can inspect [[PointerEvent.button]] to see what button was pressed.\n */\nexport class PointerEvent extends GameEvent<Actor> {\n  protected _name: string;\n\n  public get name() {\n    return this._name;\n  }\n\n  /** The world coordinates of the event. */\n  public get worldPos(): Vector {\n    return this.coordinates.worldPos.clone();\n  }\n\n  /** The page coordinates of the event. */\n  public get pagePos(): Vector {\n    return this.coordinates.pagePos.clone();\n  }\n\n  /** The screen coordinates of the event. */\n  public get screenPos(): Vector {\n    return this.coordinates.screenPos.clone();\n  }\n\n  /**\n   * @param coordinates         The [[GlobalCoordinates]] of the event\n   * @param pointer             The [[Pointer]] of the event\n   * @param index               The index of the pointer (zero-based)\n   * @param pointerType         The type of pointer\n   * @param button              The button pressed (if [[PointerType.Mouse]])\n   * @param ev                  The raw DOM event being handled\n   */\n  constructor(\n    protected coordinates: GlobalCoordinates,\n    public pointer: Pointer,\n    public index: number,\n    public pointerType: PointerType,\n    public button: PointerButton,\n    public ev: any\n  ) {\n    super();\n  }\n\n  public get pos(): Vector {\n    return this.coordinates.worldPos.clone();\n  }\n\n  public _canceled = false;\n\n  /**\n   * Cancels pointer event propogation, event will not be transmitted to any other actors\n   */\n  public cancel() {\n    this._canceled = true;\n  }\n\n  /**\n   *\n   * @returns If the event is canceled it will no longer be transmitted to any other actors\n   */\n  public isCanceled() {\n    return this._canceled;\n  }\n\n  public propagate(actor: Actor): void {\n    this.doAction(actor);\n\n    if (this.bubbles && !this.isCanceled() && actor.parent) {\n      this.propagate(actor.parent as Actor); // TODO not true\n    }\n  }\n\n  /**\n   * Action, that calls when event happens\n   */\n  public doAction(actor: Actor): void {\n    if (actor) {\n      this._onActionStart(actor);\n      actor.emit(this._name, this);\n      this._onActionEnd(actor);\n    }\n  }\n\n  protected _onActionStart(_actor?: Actor) {\n    // to be rewritten\n  }\n\n  protected _onActionEnd(_actor?: Actor) {\n    // to be rewritten\n  }\n}\n\nexport class PointerEventFactory<T extends PointerEvent> {\n  constructor(\n    protected _pointerEventType: new (\n      coordinates: GlobalCoordinates,\n      pointer: Pointer,\n      index: number,\n      pointerType: PointerType,\n      button: PointerButton,\n      ev: any\n    ) => T\n  ) {}\n\n  /**\n   * Create specific PointerEvent\n   */\n  public create(\n    coordinates: GlobalCoordinates,\n    pointer: Pointer,\n    index: number,\n    pointerType: PointerType,\n    button: PointerButton,\n    ev: any\n  ): T {\n    return new this._pointerEventType(coordinates, pointer, index, pointerType, button, ev);\n  }\n}\n\nexport class PointerDragEvent extends PointerEvent {}\n\nexport class PointerUpEvent extends PointerEvent {\n  protected _name = 'pointerup';\n\n  protected _onActionEnd(actor: Actor) {\n    const pointer = this.pointer;\n\n    if (pointer.isDragEnd && actor.capturePointer.captureDragEvents) {\n      actor.eventDispatcher.emit('pointerdragend', this);\n    }\n  }\n}\n\nexport class PointerDownEvent extends PointerEvent {\n  protected _name = 'pointerdown';\n\n  protected _onActionEnd(actor: Actor) {\n    if (this.pointer.isDragStart && actor.capturePointer.captureDragEvents) {\n      actor.eventDispatcher.emit('pointerdragstart', this);\n    }\n  }\n}\n\nexport class PointerMoveEvent extends PointerEvent {\n  protected _name = 'pointermove';\n\n  public propagate(actor: Actor): void {\n    // If the actor was under the pointer last frame, but not this one it left\n    // if (this.pointer.wasActorUnderPointer(actor) && !this.pointer.isActorUnderPointer(actor)) {\n    //   this._onActorLeave(actor);\n    //   return;\n    // }\n\n    if (this.pointer.isActorAliveUnderPointer(actor)) {\n      this.doAction(actor);\n\n      if (this.bubbles && !this.isCanceled() && actor.parent) {\n        this.propagate(actor.parent as Actor); // TODO not true\n      }\n    }\n  }\n\n  protected _onActionStart(actor: Actor) {\n    if (!actor.capturePointer.captureMoveEvents) {\n      return;\n    }\n\n    // In the case this is new\n    // if (this.pointer.checkActorUnderPointer(actor) && !this.pointer.wasActorUnderPointer(actor)) {\n    //   this._onActorEnter(actor);\n    // }\n\n    if (this.pointer.isDragging && actor.capturePointer.captureDragEvents) {\n      actor.eventDispatcher.emit('pointerdragmove', this);\n    }\n  }\n\n  // private _onActorEnter(actor: Actor) {\n  //   const pe = createPointerEventByName('enter', this.coordinates, this.pointer, this.index, this.pointerType, this.button, this.ev);\n  //   pe.propagate(actor);\n  //   this.pointer.addActorUnderPointer(actor);\n\n  //   if (this.pointer.isDragging) {\n  //     this.pointer.dragTarget = actor;\n  //   }\n  // }\n\n  // private _onActorLeave(actor: Actor) {\n  //   const pe = createPointerEventByName('leave', this.coordinates, this.pointer, this.index, this.pointerType, this.button, this.ev);\n  //   pe.propagate(actor);\n  //   this.pointer.removeActorUnderPointer(actor);\n  // }\n}\n\nexport class PointerEnterEvent extends PointerEvent {\n  protected _name = 'pointerenter';\n\n  protected _onActionStart(actor: Actor) {\n    if (!actor.capturePointer.captureMoveEvents) {\n      return;\n    }\n  }\n\n  protected _onActionEnd(actor: Actor) {\n    const pointer = this.pointer;\n\n    if (pointer.isDragging && actor.capturePointer.captureDragEvents) {\n      actor.eventDispatcher.emit('pointerdragenter', this);\n    }\n  }\n}\n\nexport class PointerLeaveEvent extends PointerEvent {\n  protected _name = 'pointerleave';\n\n  protected _onActionStart(actor: Actor) {\n    if (!actor.capturePointer.captureMoveEvents) {\n      return;\n    }\n  }\n\n  protected _onActionEnd(actor: Actor) {\n    const pointer = this.pointer;\n\n    if (pointer.isDragging && actor.capturePointer.captureDragEvents) {\n      actor.eventDispatcher.emit('pointerdragleave', this);\n    }\n  }\n}\n\nexport class PointerCancelEvent extends PointerEvent {\n  protected _name = 'pointercancel';\n}\n/**\n * Wheel Events\n *\n * Represents a mouse wheel event. See [[Pointers]] for more information on\n * handling point input.\n */\nexport class WheelEvent extends GameEvent<Actor> {\n  /**\n   * @param x            The `x` coordinate of the event (in world coordinates)\n   * @param y            The `y` coordinate of the event (in world coordinates)\n   * @param pageX        The `x` coordinate of the event (in document coordinates)\n   * @param pageY        The `y` coordinate of the event (in document coordinates)\n   * @param screenX      The `x` coordinate of the event (in screen coordinates)\n   * @param screenY      The `y` coordinate of the event (in screen coordinates)\n   * @param index        The index of the pointer (zero-based)\n   * @param deltaX       The type of pointer\n   * @param deltaY       The type of pointer\n   * @param deltaZ       The type of pointer\n   * @param deltaMode    The type of movement [[WheelDeltaMode]]\n   * @param ev           The raw DOM event being handled\n   */\n  constructor(\n    public x: number,\n    public y: number,\n    public pageX: number,\n    public pageY: number,\n    public screenX: number,\n    public screenY: number,\n    public index: number,\n    public deltaX: number,\n    public deltaY: number,\n    public deltaZ: number,\n    public deltaMode: WheelDeltaMode,\n    public ev: any\n  ) {\n    super();\n  }\n\n  private _isCanceled = false;\n\n  /**\n   * Cancels pointer event propogation, event will not be transmitted to any other actors\n   */\n  public cancel() {\n    this._isCanceled = true;\n  }\n\n  /**\n   *\n   * @returns If the event is canceled it will no longer be transmitted to any other actors\n   */\n  public isCanceled() {\n    return this._isCanceled;\n  }\n}\n\n/**\n *\n */\nexport function createPointerEventByName(\n  eventName: string,\n  coordinates: GlobalCoordinates,\n  pointer: Pointer,\n  index: number,\n  pointerType: PointerType,\n  button: PointerButton,\n  ev: any\n) {\n  let factory: PointerEventFactory<PointerEvent>;\n\n  switch (eventName) {\n    case 'up':\n      factory = new PointerEventFactory(<any>PointerUpEvent);\n      break;\n    case 'down':\n      factory = new PointerEventFactory(<any>PointerDownEvent);\n      break;\n    case 'move':\n      factory = new PointerEventFactory(<any>PointerMoveEvent);\n      break;\n    case 'cancel':\n      factory = new PointerEventFactory(<any>PointerCancelEvent);\n      break;\n    case 'enter':\n      factory = new PointerEventFactory(<any>PointerEnterEvent);\n      break;\n    case 'leave':\n      factory = new PointerEventFactory(<any>PointerLeaveEvent);\n      break;\n  }\n\n  return factory.create(coordinates, pointer, index, pointerType, button, ev);\n}\n","import { Class } from './../Class';\r\nimport { GameEvent, GamepadConnectEvent, GamepadDisconnectEvent, GamepadButtonEvent, GamepadAxisEvent } from '../Events';\r\nimport * as Events from '../Events';\r\n\r\n/**\r\n * Excalibur leverages the HTML5 Gamepad API [where it is supported](http://caniuse.com/#feat=gamepad)\r\n * to provide controller support for your games.\r\n */\r\nexport class Gamepads extends Class {\r\n  /**\r\n   * Whether or not to poll for Gamepad input (default: `false`)\r\n   */\r\n  public enabled = false;\r\n\r\n  /**\r\n   * Whether or not Gamepad API is supported\r\n   */\r\n  public supported = !!(<any>navigator).getGamepads;\r\n\r\n  /**\r\n   * The minimum value an axis has to move before considering it a change\r\n   */\r\n  public static MinAxisMoveThreshold = 0.05;\r\n\r\n  private _gamePadTimeStamps = [0, 0, 0, 0];\r\n  private _oldPads: Gamepad[] = [];\r\n  private _pads: Gamepad[] = [];\r\n  private _initSuccess: boolean = false;\r\n  private _navigator: NavigatorGamepads = <any>navigator;\r\n  private _minimumConfiguration: GamepadConfiguration = null;\r\n\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  public init() {\r\n    if (!this.supported) {\r\n      return;\r\n    }\r\n    if (this._initSuccess) {\r\n      return;\r\n    }\r\n\r\n    // In Chrome, this will return 4 undefined items until a button is pressed\r\n    // In FF, this will not return any items until a button is pressed\r\n    this._oldPads = this._clonePads(this._navigator.getGamepads());\r\n    if (this._oldPads.length && this._oldPads[0]) {\r\n      this._initSuccess = true;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Sets the minimum gamepad configuration, for example {axis: 4, buttons: 4} means\r\n   * this game requires at minimum 4 axis inputs and 4 buttons, this is not restrictive\r\n   * all other controllers with more axis or buttons are valid as well. If no minimum\r\n   * configuration is set all pads are valid.\r\n   */\r\n  public setMinimumGamepadConfiguration(config: GamepadConfiguration): void {\r\n    this._enableAndUpdate(); // if config is used, implicitly enable\r\n    this._minimumConfiguration = config;\r\n  }\r\n\r\n  /**\r\n   * When implicitly enabled, set the enabled flag and run an update so information is updated\r\n   */\r\n  private _enableAndUpdate() {\r\n    if (!this.enabled) {\r\n      this.enabled = true;\r\n      this.update();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Checks a navigator gamepad against the minimum configuration if present.\r\n   */\r\n  private _isGamepadValid(pad: NavigatorGamepad): boolean {\r\n    if (!this._minimumConfiguration) {\r\n      return true;\r\n    }\r\n    if (!pad) {\r\n      return false;\r\n    }\r\n    const axesLength = pad.axes.filter((value) => {\r\n      return typeof value !== undefined;\r\n    }).length;\r\n\r\n    const buttonLength = pad.buttons.filter((value) => {\r\n      return typeof value !== undefined;\r\n    }).length;\r\n    return axesLength >= this._minimumConfiguration.axis && buttonLength >= this._minimumConfiguration.buttons && pad.connected;\r\n  }\r\n\r\n  public on(eventName: Events.connect, handler: (event: GamepadConnectEvent) => void): void;\r\n  public on(eventName: Events.disconnect, handler: (event: GamepadDisconnectEvent) => void): void;\r\n  public on(eventName: Events.button, handler: (event: GamepadButtonEvent) => void): void;\r\n  public on(eventName: Events.axis, handler: (event: GamepadAxisEvent) => void): void;\r\n  public on(eventName: string, handler: (event: GameEvent<any>) => void): void;\r\n  public on(eventName: string, handler: (event: any) => void): void {\r\n    this._enableAndUpdate(); // implicitly enable\r\n    super.on(eventName, handler);\r\n  }\r\n\r\n  public off(eventName: string, handler?: (event: GameEvent<any>) => void) {\r\n    this._enableAndUpdate(); // implicitly enable\r\n    super.off(eventName, handler);\r\n  }\r\n\r\n  /**\r\n   * Updates Gamepad state and publishes Gamepad events\r\n   */\r\n  public update() {\r\n    if (!this.enabled || !this.supported) {\r\n      return;\r\n    }\r\n    this.init();\r\n\r\n    const gamepads = this._navigator.getGamepads();\r\n\r\n    for (let i = 0; i < gamepads.length; i++) {\r\n      if (!gamepads[i]) {\r\n        const gamepad = this.at(i);\r\n        // If was connected, but now isn't emit the disconnect event\r\n        if (gamepad.connected) {\r\n          this.eventDispatcher.emit('disconnect', new GamepadDisconnectEvent(i, gamepad));\r\n        }\r\n        // Reset connection status\r\n        gamepad.connected = false;\r\n        continue;\r\n      } else {\r\n        if (!this.at(i).connected && this._isGamepadValid(gamepads[i])) {\r\n          this.eventDispatcher.emit('connect', new GamepadConnectEvent(i, this.at(i)));\r\n        }\r\n        // Set connection status\r\n        this.at(i).connected = true;\r\n      }\r\n\r\n      // Only supported in Chrome\r\n      if (gamepads[i].timestamp && gamepads[i].timestamp === this._gamePadTimeStamps[i]) {\r\n        continue;\r\n      }\r\n\r\n      this._gamePadTimeStamps[i] = gamepads[i].timestamp;\r\n\r\n      // Add reference to navigator gamepad\r\n      this.at(i).navigatorGamepad = gamepads[i];\r\n\r\n      // Buttons\r\n      let b: string, bi: number, a: string, ai: number, value: number;\r\n\r\n      for (b in Buttons) {\r\n        bi = <any>Buttons[b];\r\n        if (typeof bi === 'number') {\r\n          if (gamepads[i].buttons[bi]) {\r\n            value = gamepads[i].buttons[bi].value;\r\n            if (value !== this._oldPads[i].getButton(bi)) {\r\n              if (gamepads[i].buttons[bi].pressed) {\r\n                this.at(i).updateButton(bi, value);\r\n                this.at(i).eventDispatcher.emit('button', new GamepadButtonEvent(bi, value, this.at(i)));\r\n              } else {\r\n                this.at(i).updateButton(bi, 0);\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n\r\n      // Axes\r\n      for (a in Axes) {\r\n        ai = <any>Axes[a];\r\n        if (typeof ai === 'number') {\r\n          value = gamepads[i].axes[ai];\r\n          if (value !== this._oldPads[i].getAxes(ai)) {\r\n            this.at(i).updateAxes(ai, value);\r\n            this.at(i).eventDispatcher.emit('axis', new GamepadAxisEvent(ai, value, this.at(i)));\r\n          }\r\n        }\r\n      }\r\n\r\n      this._oldPads[i] = this._clonePad(gamepads[i]);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Safely retrieves a Gamepad at a specific index and creates one if it doesn't yet exist\r\n   */\r\n  public at(index: number): Gamepad {\r\n    this._enableAndUpdate(); // implicitly enable gamepads when at() is called\r\n    if (index >= this._pads.length) {\r\n      // Ensure there is a pad to retrieve\r\n      for (let i = this._pads.length - 1, max = index; i < max; i++) {\r\n        this._pads.push(new Gamepad());\r\n        this._oldPads.push(new Gamepad());\r\n      }\r\n    }\r\n\r\n    return this._pads[index];\r\n  }\r\n\r\n  /**\r\n   * Returns a list of all valid gamepads that meet the minimum configuration requirement.\r\n   */\r\n  public getValidGamepads(): Gamepad[] {\r\n    this._enableAndUpdate();\r\n    const result: Gamepad[] = [];\r\n    for (let i = 0; i < this._pads.length; i++) {\r\n      if (this._isGamepadValid(this.at(i).navigatorGamepad) && this.at(i).connected) {\r\n        result.push(this.at(i));\r\n      }\r\n    }\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Gets the number of connected gamepads\r\n   */\r\n  public count() {\r\n    return this._pads.filter((p) => p.connected).length;\r\n  }\r\n\r\n  private _clonePads(pads: NavigatorGamepad[]): Gamepad[] {\r\n    const arr = [];\r\n    for (let i = 0, len = pads.length; i < len; i++) {\r\n      arr.push(this._clonePad(pads[i]));\r\n    }\r\n    return arr;\r\n  }\r\n\r\n  /**\r\n   * Fastest way to clone a known object is to do it yourself\r\n   */\r\n  private _clonePad(pad: NavigatorGamepad): Gamepad {\r\n    let i, len;\r\n    const clonedPad = new Gamepad();\r\n\r\n    if (!pad) {\r\n      return clonedPad;\r\n    }\r\n\r\n    for (i = 0, len = pad.buttons.length; i < len; i++) {\r\n      if (pad.buttons[i]) {\r\n        clonedPad.updateButton(i, pad.buttons[i].value);\r\n      }\r\n    }\r\n    for (i = 0, len = pad.axes.length; i < len; i++) {\r\n      clonedPad.updateAxes(i, pad.axes[i]);\r\n    }\r\n\r\n    return clonedPad;\r\n  }\r\n}\r\n\r\n/**\r\n * Gamepad holds state information for a connected controller. See [[Gamepads]]\r\n * for more information on handling controller input.\r\n */\r\nexport class Gamepad extends Class {\r\n  public connected = false;\r\n  public navigatorGamepad: NavigatorGamepad;\r\n  private _buttons: number[] = new Array(16);\r\n  private _axes: number[] = new Array(4);\r\n\r\n  constructor() {\r\n    super();\r\n\r\n    for (let i = 0; i < this._buttons.length; i++) {\r\n      this._buttons[i] = 0;\r\n    }\r\n    for (let i = 0; i < this._axes.length; i++) {\r\n      this._axes[i] = 0;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Whether or not the given button is pressed\r\n   * @param button     The button to query\r\n   * @param threshold  The threshold over which the button is considered to be pressed\r\n   */\r\n  public isButtonPressed(button: Buttons, threshold: number = 1) {\r\n    return this._buttons[button] >= threshold;\r\n  }\r\n\r\n  /**\r\n   * Gets the given button value between 0 and 1\r\n   */\r\n  public getButton(button: Buttons) {\r\n    return this._buttons[button];\r\n  }\r\n\r\n  /**\r\n   * Gets the given axis value between -1 and 1. Values below\r\n   * [[MinAxisMoveThreshold]] are considered 0.\r\n   */\r\n  public getAxes(axes: Axes) {\r\n    const value = this._axes[axes];\r\n\r\n    if (Math.abs(value) < Gamepads.MinAxisMoveThreshold) {\r\n      return 0;\r\n    } else {\r\n      return value;\r\n    }\r\n  }\r\n\r\n  public updateButton(buttonIndex: number, value: number) {\r\n    this._buttons[buttonIndex] = value;\r\n  }\r\n\r\n  public updateAxes(axesIndex: number, value: number) {\r\n    this._axes[axesIndex] = value;\r\n  }\r\n}\r\n\r\n/**\r\n * Gamepad Buttons enumeration\r\n */\r\nexport enum Buttons {\r\n  /**\r\n   * Face 1 button (e.g. A)\r\n   */\r\n  Face1 = 0,\r\n  /**\r\n   * Face 2 button (e.g. B)\r\n   */\r\n  Face2 = 1,\r\n  /**\r\n   * Face 3 button (e.g. X)\r\n   */\r\n  Face3 = 2,\r\n  /**\r\n   * Face 4 button (e.g. Y)\r\n   */\r\n  Face4 = 3,\r\n  /**\r\n   * Left bumper button\r\n   */\r\n  LeftBumper = 4,\r\n  /**\r\n   * Right bumper button\r\n   */\r\n  RightBumper = 5,\r\n  /**\r\n   * Left trigger button\r\n   */\r\n  LeftTrigger = 6,\r\n  /**\r\n   * Right trigger button\r\n   */\r\n  RightTrigger = 7,\r\n  /**\r\n   * Select button\r\n   */\r\n  Select = 8,\r\n  /**\r\n   * Start button\r\n   */\r\n  Start = 9,\r\n  /**\r\n   * Left analog stick press (e.g. L3)\r\n   */\r\n  LeftStick = 10,\r\n  /**\r\n   * Right analog stick press (e.g. R3)\r\n   */\r\n  RightStick = 11,\r\n  /**\r\n   * D-pad up\r\n   */\r\n  DpadUp = 12,\r\n  /**\r\n   * D-pad down\r\n   */\r\n  DpadDown = 13,\r\n  /**\r\n   * D-pad left\r\n   */\r\n  DpadLeft = 14,\r\n  /**\r\n   * D-pad right\r\n   */\r\n  DpadRight = 15\r\n}\r\n\r\n/**\r\n * Gamepad Axes enumeration\r\n */\r\nexport enum Axes {\r\n  /**\r\n   * Left analogue stick X direction\r\n   */\r\n  LeftStickX = 0,\r\n  /**\r\n   * Left analogue stick Y direction\r\n   */\r\n  LeftStickY = 1,\r\n  /**\r\n   * Right analogue stick X direction\r\n   */\r\n  RightStickX = 2,\r\n  /**\r\n   * Right analogue stick Y direction\r\n   */\r\n  RightStickY = 3\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport interface NavigatorGamepads {\r\n  getGamepads(): NavigatorGamepad[];\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport interface NavigatorGamepad {\r\n  axes: number[];\r\n  buttons: NavigatorGamepadButton[];\r\n  connected: boolean;\r\n  id: string;\r\n  index: number;\r\n  mapping: string;\r\n  timestamp: number;\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport interface NavigatorGamepadButton {\r\n  pressed: boolean;\r\n  value: number;\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport interface NavigatorGamepadEvent {\r\n  gamepad: NavigatorGamepad;\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport interface GamepadConfiguration {\r\n  axis: number;\r\n  buttons: number;\r\n}\r\n","import { Matrix } from '../../Math/matrix';\r\nimport { BoundingBox } from '../../Collision/Index';\r\nimport { Color } from '../../Color';\r\nimport { Pool, Poolable } from '../../Util/Pool';\r\nimport { HTMLImageSource } from './ExcaliburGraphicsContext';\r\nimport { vec, Vector } from '../../Math/vector';\r\n\r\nexport enum DrawCommandType {\r\n  Image = 'image',\r\n  Line = 'line',\r\n  Rectangle = 'rectangle',\r\n  Circle = 'circle'\r\n}\r\n\r\nexport class DrawImageCommand implements Poolable {\r\n  _pool: Pool<this> = undefined;\r\n\r\n  public snapToPixel: boolean = true;\r\n  public image: HTMLImageSource;\r\n  public color: Color;\r\n  public type = DrawCommandType.Image;\r\n  public opacity: number = 1;\r\n  public width: number = 0;\r\n  public height: number = 0;\r\n  public dest: [number, number] = [0, 0]; // x, y\r\n  public view: [number, number, number, number] = [0, 0, 0, 0]; // sx, sy, sw, sh\r\n  private _geom: [number, number][] = [\r\n    [0, 0],\r\n    [0, 0],\r\n    [0, 0],\r\n    [0, 0],\r\n    [0, 0],\r\n    [0, 0]\r\n  ];\r\n  constructor();\r\n  constructor(image: HTMLImageSource, x: number, y: number);\r\n  constructor(image: HTMLImageSource, x: number, y: number, width?: number, height?: number);\r\n  constructor(\r\n    image: HTMLImageSource,\r\n    sx: number,\r\n    sy: number,\r\n    swidth?: number,\r\n    sheight?: number,\r\n    dx?: number,\r\n    dy?: number,\r\n    dwidth?: number,\r\n    dheight?: number\r\n  );\r\n  constructor(\r\n    image?: HTMLImageSource,\r\n    sx?: number,\r\n    sy?: number,\r\n    swidth?: number,\r\n    sheight?: number,\r\n    dx?: number,\r\n    dy?: number,\r\n    dwidth?: number,\r\n    dheight?: number\r\n  ) {\r\n    this.init(image, sx, sy, swidth, sheight, dx, dy, dwidth, dheight);\r\n  }\r\n\r\n  public init(\r\n    image?: HTMLImageSource,\r\n    sx?: number,\r\n    sy?: number,\r\n    swidth?: number,\r\n    sheight?: number,\r\n    dx?: number,\r\n    dy?: number,\r\n    dwidth?: number,\r\n    dheight?: number\r\n  ) {\r\n    this.type = DrawCommandType.Image;\r\n    this.image = image;\r\n    this.width = image?.width || swidth || 0;\r\n    this.height = image?.height || sheight || 0;\r\n    this.view = [0, 0, swidth ?? image?.width, sheight ?? image?.height];\r\n    this.dest = [sx, sy];\r\n    // If destination is specified, update view and dest\r\n    if (dx !== undefined && dy !== undefined && dwidth !== undefined && dheight !== undefined) {\r\n      this.view = [sx, sy, swidth ?? image?.width, sheight ?? image?.height];\r\n      this.dest = [dx, dy];\r\n      this.width = dwidth;\r\n      this.height = dheight;\r\n    }\r\n\r\n    let index = 0;\r\n    this._geom[index++] = [this.dest[0], this.dest[1]];\r\n    this._geom[index++] = [this.dest[0], this.dest[1] + this.height];\r\n    this._geom[index++] = [this.dest[0] + this.width, this.dest[1]];\r\n    this._geom[index++] = [this.dest[0] + this.width, this.dest[1]];\r\n    this._geom[index++] = [this.dest[0], this.dest[1] + this.height];\r\n    this._geom[index++] = [this.dest[0] + this.width, this.dest[1] + this.height];\r\n    if (this.snapToPixel) {\r\n      for (const point of this._geom) {\r\n        point[0] = ~~point[0];\r\n        point[1] = ~~point[1];\r\n      }\r\n    }\r\n    return this;\r\n  }\r\n\r\n  public initRect(color: Color, start: Vector, width: number, height: number) {\r\n    this.type = DrawCommandType.Rectangle;\r\n    this.color = color;\r\n    this.width = width;\r\n    this.height = height;\r\n    let index = 0;\r\n    this._geom[index++] = [start.x, start.y];\r\n    this._geom[index++] = [start.x, start.y + this.height];\r\n    this._geom[index++] = [start.x + this.width, start.y];\r\n    this._geom[index++] = [start.x + this.width, start.y];\r\n    this._geom[index++] = [start.x, start.y + this.height];\r\n    this._geom[index++] = [start.x + this.width, start.y + this.height];\r\n\r\n    if (this.snapToPixel) {\r\n      for (const point of this._geom) {\r\n        point[0] = ~~point[0];\r\n        point[1] = ~~point[1];\r\n      }\r\n    }\r\n    return this;\r\n  }\r\n\r\n  public initLine(color: Color, start: Vector, end: Vector, thickness: number) {\r\n    this.type = DrawCommandType.Line;\r\n    this.color = color;\r\n    const dir = end.sub(start).normalize();\r\n    const normal = dir.perpendicular();\r\n    const halfThick = thickness / 2;\r\n    const startTop = normal.scale(halfThick).add(start);\r\n    const startBottom = normal.scale(-halfThick).add(start);\r\n    const endTop = normal.scale(halfThick).add(end);\r\n    const endBottom = normal.scale(-halfThick).add(end);\r\n\r\n    /**\r\n     *    +---------------------^----------------------+\r\n     *    |                     | (normal)             |\r\n     *   (startx, starty)------------------>(endx, endy)\r\n     *    |                                            |\r\n     *    + -------------------------------------------+\r\n     */\r\n\r\n    let index = 0;\r\n    this._geom[index++] = [startTop.x, startTop.y];\r\n    this._geom[index++] = [endTop.x, endTop.y];\r\n    this._geom[index++] = [startBottom.x, startBottom.y];\r\n    this._geom[index++] = [startBottom.x, startBottom.y];\r\n    this._geom[index++] = [endTop.x, endTop.y];\r\n    this._geom[index++] = [endBottom.x, endBottom.y];\r\n\r\n    if (this.snapToPixel) {\r\n      for (const point of this._geom) {\r\n        point[0] = ~~point[0];\r\n        point[1] = ~~point[1];\r\n      }\r\n    }\r\n    return this;\r\n  }\r\n\r\n  public initCircle(pos: Vector, radius: number, color: Color) {\r\n    this.type = DrawCommandType.Circle;\r\n    this.color = color;\r\n    const topLeft = pos.add(vec(-radius, -radius));\r\n    const topRight = pos.add(vec(radius, -radius));\r\n    const bottomRight = pos.add(vec(radius, radius));\r\n    const bottomLeft = pos.add(vec(-radius, radius));\r\n    let index = 0;\r\n    this._geom[index++] = [topLeft.x, topLeft.y];\r\n    this._geom[index++] = [topRight.x, topRight.y];\r\n    this._geom[index++] = [bottomLeft.x, bottomLeft.y];\r\n    this._geom[index++] = [bottomLeft.x, bottomLeft.y];\r\n    this._geom[index++] = [topRight.x, topRight.y];\r\n    this._geom[index++] = [bottomRight.x, bottomRight.y];\r\n\r\n    if (this.snapToPixel) {\r\n      for (const point of this._geom) {\r\n        point[0] = ~~point[0];\r\n        point[1] = ~~point[1];\r\n      }\r\n    }\r\n    return this;\r\n  }\r\n\r\n  public dispose() {\r\n    this.image = null;\r\n    this.width = 0;\r\n    this.height = 0;\r\n    this.view = [0, 0, 0, 0];\r\n    this.dest = [0, 0];\r\n\r\n    let index = 0;\r\n    this._geom[index++] = [this.dest[0], this.dest[1]];\r\n    this._geom[index++] = [this.dest[0], this.dest[1] + this.height];\r\n    this._geom[index++] = [this.dest[0] + this.width, this.dest[1]];\r\n    this._geom[index++] = [this.dest[0] + this.width, this.dest[1]];\r\n    this._geom[index++] = [this.dest[0], this.dest[1] + this.height];\r\n    this._geom[index++] = [this.dest[0] + this.width, this.dest[1] + this.height];\r\n    return this;\r\n  }\r\n\r\n  // todo weird\r\n  applyTransform(transform: Matrix, opacity: number): void {\r\n    if (transform) {\r\n      for (let i = 0; i < this._geom.length; i++) {\r\n        this._geom[i] = transform.multv(this._geom[i]);\r\n        if (this.snapToPixel) {\r\n          this._geom[i] = [~~this._geom[i][0], ~~this._geom[i][1]];\r\n        }\r\n      }\r\n    }\r\n    this.opacity = opacity;\r\n  }\r\n\r\n  public get geometry() {\r\n    return this._geom;\r\n  }\r\n}\r\n\r\nexport class DrawRectCommand {\r\n  public dest: [number, number] = [0, 0];\r\n  public width: number = 0;\r\n  public height: number = 0;\r\n  constructor(x: number, y: number, width: number, height: number) {\r\n    this.dest = [x, y];\r\n    this.width = width;\r\n    this.height = height;\r\n  }\r\n}\r\n\r\nexport class DrawDebugRectCommand {\r\n  constructor(public bounds: BoundingBox, public color: Color) {}\r\n}\r\n","import { ScreenElement } from './ScreenElement';\r\nimport {\r\n  InitializeEvent,\r\n  ActivateEvent,\r\n  DeactivateEvent,\r\n  PreUpdateEvent,\r\n  PostUpdateEvent,\r\n  PreDrawEvent,\r\n  PostDrawEvent,\r\n  PreDebugDrawEvent,\r\n  PostDebugDrawEvent,\r\n  GameEvent\r\n} from './Events';\r\nimport { Logger } from './Util/Log';\r\nimport { Timer } from './Timer';\r\nimport { Engine } from './Engine';\r\nimport { TileMap } from './TileMap';\r\nimport { Camera } from './Camera';\r\nimport { Actor } from './Actor';\r\nimport { Class } from './Class';\r\nimport { CanInitialize, CanActivate, CanDeactivate, CanUpdate, CanDraw } from './Interfaces/LifecycleEvents';\r\nimport * as Util from './Util/Util';\r\nimport * as Events from './Events';\r\nimport * as ActorUtils from './Util/Actors';\r\nimport { Trigger } from './Trigger';\r\nimport { SystemType } from './EntityComponentSystem/System';\r\nimport { obsolete } from './Util/Decorators';\r\nimport { World } from './EntityComponentSystem/World';\r\nimport { MotionSystem } from './Collision/MotionSystem';\r\nimport { CollisionSystem } from './Collision/CollisionSystem';\r\nimport { Entity } from './EntityComponentSystem/Entity';\r\nimport { GraphicsSystem } from './Graphics/GraphicsSystem';\r\nimport { CanvasDrawingSystem } from './Drawing/CanvasDrawingSystem';\r\nimport { Flags, Legacy } from './Flags';\r\nimport { DebugSystem } from './Debug/DebugSystem';\r\n/**\r\n * [[Actor|Actors]] are composed together into groupings called Scenes in\r\n * Excalibur. The metaphor models the same idea behind real world\r\n * actors in a scene. Only actors in scenes will be updated and drawn.\r\n *\r\n * Typical usages of a scene include: levels, menus, loading screens, etc.\r\n */\r\nexport class Scene extends Class implements CanInitialize, CanActivate, CanDeactivate, CanUpdate, CanDraw {\r\n  private _logger: Logger = Logger.getInstance();\r\n  /**\r\n   * Gets or sets the current camera for the scene\r\n   */\r\n  public camera: Camera = new Camera();\r\n\r\n  /**\r\n   * The ECS world for the scene\r\n   */\r\n  public world = new World(this);\r\n\r\n  /**\r\n   * The actors in the current scene\r\n   */\r\n  public get actors(): Actor[] {\r\n    return this.world.entityManager.entities.filter((e) => {\r\n      return e instanceof Actor;\r\n    }) as Actor[];\r\n  }\r\n\r\n  /**\r\n   * The entities in the current scene\r\n   */\r\n  public get entities(): Entity[] {\r\n    return this.world.entityManager.entities;\r\n  }\r\n\r\n  /**\r\n   * The triggers in the current scene\r\n   */\r\n  public get triggers(): Trigger[] {\r\n    return this.world.entityManager.entities.filter((e) => {\r\n      return e instanceof Trigger;\r\n    }) as Trigger[];\r\n  }\r\n\r\n  /**\r\n   * The [[TileMap]]s in the scene, if any\r\n   */\r\n  public get tileMaps(): TileMap[] {\r\n    return this.world.entityManager.entities.filter((e) => {\r\n      return e instanceof TileMap;\r\n    }) as TileMap[];\r\n  }\r\n\r\n  /**\r\n   * Access to the Excalibur engine\r\n   */\r\n  public engine: Engine;\r\n\r\n  /**\r\n   * The [[ScreenElement]]s in a scene, if any; these are drawn last\r\n   * @deprecated Use [[Scene.actors]]\r\n   */\r\n  @obsolete({\r\n    message: 'Will be removed in excalibur v0.26.0',\r\n    alternateMethod: 'ScreenElements now are normal actors with a Transform Coordinate Plane of Screen'\r\n  })\r\n  public get screenElements(): ScreenElement[] {\r\n    return this.actors.filter((a) => a instanceof ScreenElement) as ScreenElement[];\r\n  }\r\n\r\n  private _isInitialized: boolean = false;\r\n  private _timers: Timer[] = [];\r\n  private _cancelQueue: Timer[] = [];\r\n\r\n  constructor() {\r\n    super();\r\n    // TODO how to people do there own systems\r\n    // Initialize systems\r\n    this.world.add(new MotionSystem());\r\n    this.world.add(new CollisionSystem());\r\n    if (Flags.isEnabled(Legacy.LegacyDrawing)) {\r\n      this.world.add(new CanvasDrawingSystem());\r\n    } else {\r\n      this.world.add(new GraphicsSystem());\r\n    }\r\n    this.world.add(new DebugSystem());\r\n  }\r\n\r\n  public on(eventName: Events.initialize, handler: (event: InitializeEvent<Scene>) => void): void;\r\n  public on(eventName: Events.activate, handler: (event: ActivateEvent) => void): void;\r\n  public on(eventName: Events.deactivate, handler: (event: DeactivateEvent) => void): void;\r\n  public on(eventName: Events.preupdate, handler: (event: PreUpdateEvent<Scene>) => void): void;\r\n  public on(eventName: Events.postupdate, handler: (event: PostUpdateEvent<Scene>) => void): void;\r\n  public on(eventName: Events.predraw, handler: (event: PreDrawEvent) => void): void;\r\n  public on(eventName: Events.postdraw, handler: (event: PostDrawEvent) => void): void;\r\n  public on(eventName: Events.predebugdraw, handler: (event: PreDebugDrawEvent) => void): void;\r\n  public on(eventName: Events.postdebugdraw, handler: (event: PostDebugDrawEvent) => void): void;\r\n  public on(eventName: string, handler: (event: GameEvent<any>) => void): void;\r\n  public on(eventName: string, handler: (event: any) => void): void {\r\n    super.on(eventName, handler);\r\n  }\r\n\r\n  public once(eventName: Events.initialize, handler: (event: InitializeEvent<Scene>) => void): void;\r\n  public once(eventName: Events.activate, handler: (event: ActivateEvent) => void): void;\r\n  public once(eventName: Events.deactivate, handler: (event: DeactivateEvent) => void): void;\r\n  public once(eventName: Events.preupdate, handler: (event: PreUpdateEvent<Scene>) => void): void;\r\n  public once(eventName: Events.postupdate, handler: (event: PostUpdateEvent<Scene>) => void): void;\r\n  public once(eventName: Events.predraw, handler: (event: PreDrawEvent) => void): void;\r\n  public once(eventName: Events.postdraw, handler: (event: PostDrawEvent) => void): void;\r\n  public once(eventName: Events.predebugdraw, handler: (event: PreDebugDrawEvent) => void): void;\r\n  public once(eventName: Events.postdebugdraw, handler: (event: PostDebugDrawEvent) => void): void;\r\n  public once(eventName: string, handler: (event: GameEvent<any>) => void): void;\r\n  public once(eventName: string, handler: (event: any) => void): void {\r\n    super.once(eventName, handler);\r\n  }\r\n\r\n  public off(eventName: Events.initialize, handler?: (event: InitializeEvent<Scene>) => void): void;\r\n  public off(eventName: Events.activate, handler?: (event: ActivateEvent) => void): void;\r\n  public off(eventName: Events.deactivate, handler?: (event: DeactivateEvent) => void): void;\r\n  public off(eventName: Events.preupdate, handler?: (event: PreUpdateEvent<Scene>) => void): void;\r\n  public off(eventName: Events.postupdate, handler?: (event: PostUpdateEvent<Scene>) => void): void;\r\n  public off(eventName: Events.predraw, handler?: (event: PreDrawEvent) => void): void;\r\n  public off(eventName: Events.postdraw, handler?: (event: PostDrawEvent) => void): void;\r\n  public off(eventName: Events.predebugdraw, handler?: (event: PreDebugDrawEvent) => void): void;\r\n  public off(eventName: Events.postdebugdraw, handler?: (event: PostDebugDrawEvent) => void): void;\r\n  public off(eventName: string, handler?: (event: GameEvent<any>) => void): void;\r\n  public off(eventName: string, handler?: (event: any) => void): void {\r\n    super.off(eventName, handler);\r\n  }\r\n\r\n  /**\r\n   * This is called before the first update of the [[Scene]]. Initializes scene members like the camera. This method is meant to be\r\n   * overridden. This is where initialization of child actors should take place.\r\n   */\r\n  public onInitialize(_engine: Engine): void {\r\n    // will be overridden\r\n  }\r\n\r\n  /**\r\n   * This is called when the scene is made active and started. It is meant to be overridden,\r\n   * this is where you should setup any DOM UI or event handlers needed for the scene.\r\n   */\r\n  public onActivate(_oldScene: Scene, _newScene: Scene): void {\r\n    // will be overridden\r\n  }\r\n\r\n  /**\r\n   * This is called when the scene is made transitioned away from and stopped. It is meant to be overridden,\r\n   * this is where you should cleanup any DOM UI or event handlers needed for the scene.\r\n   */\r\n  public onDeactivate(_oldScene: Scene, _newScene: Scene): void {\r\n    // will be overridden\r\n  }\r\n\r\n  /**\r\n   * Safe to override onPreUpdate lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\r\n   *\r\n   * `onPreUpdate` is called directly before a scene is updated.\r\n   */\r\n  public onPreUpdate(_engine: Engine, _delta: number): void {\r\n    // will be overridden\r\n  }\r\n\r\n  /**\r\n   * Safe to override onPostUpdate lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\r\n   *\r\n   * `onPostUpdate` is called directly after a scene is updated.\r\n   */\r\n  public onPostUpdate(_engine: Engine, _delta: number): void {\r\n    // will be overridden\r\n  }\r\n\r\n  /**\r\n   * Safe to override onPreDraw lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\r\n   *\r\n   * `onPreDraw` is called directly before a scene is drawn.\r\n   */\r\n  public onPreDraw(_ctx: CanvasRenderingContext2D, _delta: number): void {\r\n    // will be overridden\r\n  }\r\n\r\n  /**\r\n   * Safe to override onPostDraw lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\r\n   *\r\n   * `onPostDraw` is called directly after a scene is drawn.\r\n   */\r\n  public onPostDraw(_ctx: CanvasRenderingContext2D, _delta: number): void {\r\n    // will be overridden\r\n  }\r\n\r\n  /**\r\n   * Initializes actors in the scene\r\n   */\r\n  private _initializeChildren(): void {\r\n    for (const child of this.entities) {\r\n      child._initialize(this.engine);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Gets whether or not the [[Scene]] has been initialized\r\n   */\r\n  public get isInitialized(): boolean {\r\n    return this._isInitialized;\r\n  }\r\n\r\n  /**\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Initializes the scene before the first update, meant to be called by engine not by users of\r\n   * Excalibur\r\n   * @internal\r\n   */\r\n  public _initialize(engine: Engine) {\r\n    if (!this.isInitialized) {\r\n      this.engine = engine;\r\n      // Initialize camera first\r\n      this.camera._initialize(engine);\r\n\r\n      // This order is important! we want to be sure any custom init that add actors\r\n      // fire before the actor init\r\n      this.onInitialize.call(this, engine);\r\n      this._initializeChildren();\r\n\r\n      this._logger.debug('Scene.onInitialize', this, engine);\r\n      this.eventDispatcher.emit('initialize', new InitializeEvent(engine, this));\r\n      this._isInitialized = true;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Activates the scene with the base behavior, then calls the overridable `onActivate` implementation.\r\n   * @internal\r\n   */\r\n  public _activate(oldScene: Scene, newScene: Scene): void {\r\n    this._logger.debug('Scene.onActivate', this);\r\n    this.onActivate(oldScene, newScene);\r\n  }\r\n\r\n  /**\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Deactivates the scene with the base behavior, then calls the overridable `onDeactivate` implementation.\r\n   * @internal\r\n   */\r\n  public _deactivate(oldScene: Scene, newScene: Scene): void {\r\n    this._logger.debug('Scene.onDeactivate', this);\r\n    this.onDeactivate(oldScene, newScene);\r\n  }\r\n\r\n  /**\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Internal _preupdate handler for [[onPreUpdate]] lifecycle event\r\n   * @internal\r\n   */\r\n  public _preupdate(_engine: Engine, delta: number): void {\r\n    this.emit('preupdate', new PreUpdateEvent(_engine, delta, this));\r\n    this.onPreUpdate(_engine, delta);\r\n  }\r\n\r\n  /**\r\n   *  It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Internal _preupdate handler for [[onPostUpdate]] lifecycle event\r\n   * @internal\r\n   */\r\n  public _postupdate(_engine: Engine, delta: number): void {\r\n    this.emit('postupdate', new PostUpdateEvent(_engine, delta, this));\r\n    this.onPostUpdate(_engine, delta);\r\n  }\r\n\r\n  /**\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Internal _predraw handler for [[onPreDraw]] lifecycle event\r\n   *\r\n   * @internal\r\n   */\r\n  public _predraw(_ctx: CanvasRenderingContext2D, _delta: number): void {\r\n    this.emit('predraw', new PreDrawEvent(_ctx, _delta, this));\r\n    this.onPreDraw(_ctx, _delta);\r\n  }\r\n\r\n  /**\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Internal _postdraw handler for [[onPostDraw]] lifecycle event\r\n   *\r\n   * @internal\r\n   */\r\n  public _postdraw(_ctx: CanvasRenderingContext2D, _delta: number): void {\r\n    this.emit('postdraw', new PostDrawEvent(_ctx, _delta, this));\r\n    this.onPostDraw(_ctx, _delta);\r\n  }\r\n\r\n  /**\r\n   * Updates all the actors and timers in the scene. Called by the [[Engine]].\r\n   * @param engine  Reference to the current Engine\r\n   * @param delta   The number of milliseconds since the last update\r\n   */\r\n  public update(engine: Engine, delta: number) {\r\n    this._preupdate(engine, delta);\r\n    if (this.camera) {\r\n      this.camera.update(engine, delta);\r\n    }\r\n    // TODO differed entity removal for timers\r\n    let i: number, len: number;\r\n    // Remove timers in the cancel queue before updating them\r\n    for (i = 0, len = this._cancelQueue.length; i < len; i++) {\r\n      this.removeTimer(this._cancelQueue[i]);\r\n    }\r\n    this._cancelQueue.length = 0;\r\n\r\n    // Cycle through timers updating timers\r\n    for (const timer of this._timers) {\r\n      timer.update(delta);\r\n    }\r\n\r\n    this.world.update(SystemType.Update, delta);\r\n\r\n    this._collectActorStats(engine);\r\n\r\n    engine.input.pointers.dispatchPointerEvents();\r\n\r\n    this._postupdate(engine, delta);\r\n  }\r\n\r\n  /**\r\n   * Draws all the actors in the Scene. Called by the [[Engine]].\r\n   * @param ctx    The current rendering context\r\n   * @param delta  The number of milliseconds since the last draw\r\n   */\r\n  public draw(ctx: CanvasRenderingContext2D, delta: number) {\r\n    this._predraw(ctx, delta);\r\n\r\n    this.world.update(SystemType.Draw, delta);\r\n\r\n    if (this.engine?.isDebug) {\r\n      this.debugDraw(ctx);\r\n    }\r\n    this._postdraw(ctx, delta);\r\n  }\r\n\r\n  /**\r\n   * Draws all the actors' debug information in the Scene. Called by the [[Engine]].\r\n   * @param ctx  The current rendering context\r\n   * @deprecated\r\n   */\r\n  /* istanbul ignore next */\r\n  public debugDraw(ctx: CanvasRenderingContext2D) {\r\n    this.emit('predebugdraw', new PreDebugDrawEvent(ctx, this));\r\n    // pass\r\n    this.emit('postdebugdraw', new PostDebugDrawEvent(ctx, this));\r\n  }\r\n\r\n  /**\r\n   * Checks whether an actor is contained in this scene or not\r\n   */\r\n  public contains(actor: Actor): boolean {\r\n    return this.actors.indexOf(actor) > -1;\r\n  }\r\n\r\n  /**\r\n   * Adds a [[Timer]] to the current [[Scene]].\r\n   * @param timer  The timer to add to the current [[Scene]].\r\n   */\r\n  public add(timer: Timer): void;\r\n\r\n  /**\r\n   * Adds a [[TileMap]] to the [[Scene]], once this is done the [[TileMap]] will be drawn and updated.\r\n   */\r\n  public add(tileMap: TileMap): void;\r\n\r\n  /**\r\n   * Adds a [[Trigger]] to the [[Scene]], once this is done the [[Trigger]] will listen for interactions with other actors.\r\n   * @param trigger\r\n   */\r\n  public add(trigger: Trigger): void;\r\n\r\n  /**\r\n   * Adds an actor to the scene, once this is done the [[Actor]] will be drawn and updated.\r\n   * @param actor  The actor to add to the current scene\r\n   */\r\n  public add(actor: Actor): void;\r\n\r\n  public add(entity: Entity): void;\r\n\r\n  /**\r\n   * Adds a [[ScreenElement]] to the scene.\r\n   * @param screenElement  The ScreenElement to add to the current scene\r\n   */\r\n  public add(screenElement: ScreenElement): void;\r\n  public add(entity: any): void {\r\n    this.emit('entityadded', { target: entity } as any);\r\n    this.world.add(entity);\r\n    entity.scene = this;\r\n    if (entity instanceof Timer) {\r\n      if (!Util.contains(this._timers, entity)) {\r\n        this.addTimer(entity);\r\n      }\r\n      return;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Removes a [[Timer]] from the current scene, it will no longer be updated.\r\n   * @param timer  The timer to remove to the current scene.\r\n   */\r\n  public remove(timer: Timer): void;\r\n\r\n  /**\r\n   * Removes a [[TileMap]] from the scene, it will no longer be drawn or updated.\r\n   * @param tileMap {TileMap}\r\n   */\r\n  public remove(tileMap: TileMap): void;\r\n\r\n  /**\r\n   * Removes an actor from the scene, it will no longer be drawn or updated.\r\n   * @param actor  The actor to remove from the current scene.\r\n   */\r\n  public remove(actor: Actor): void;\r\n\r\n  public remove(entity: Entity): void;\r\n\r\n  /**\r\n   * Removes a [[ScreenElement]] to the scene, it will no longer be drawn or updated\r\n   * @param screenElement  The ScreenElement to remove from the current scene\r\n   */\r\n  public remove(screenElement: ScreenElement): void;\r\n  public remove(entity: any): void {\r\n    if (entity instanceof Entity) {\r\n      this.emit('entityremoved', { target: entity } as any);\r\n      this.world.remove(entity);\r\n    }\r\n    if (entity instanceof Timer) {\r\n      this.removeTimer(entity);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Adds (any) actor to act as a piece of UI, meaning it is always positioned\r\n   * in screen coordinates. UI actors do not participate in collisions.\r\n   * @todo Should this be `ScreenElement` only?\r\n   * @deprecated Use [[Scene.add]]\r\n   */\r\n  @obsolete({ message: 'Will be removed in excalibur v0.26.0', alternateMethod: 'Use Scene.add' })\r\n  public addScreenElement(actor: Actor) {\r\n    this.add(actor);\r\n  }\r\n\r\n  /**\r\n   * Removes an actor as a piece of UI\r\n   * @deprecated Use [[Scene.remove]]\r\n   */\r\n  @obsolete({ message: 'Will be removed in excalibur v0.26.0', alternateMethod: 'Use Scene.remove' })\r\n  public removeScreenElement(actor: Actor) {\r\n    this.remove(actor);\r\n  }\r\n\r\n  /**\r\n   * Adds a [[TileMap]] to the scene, once this is done the TileMap will be drawn and updated.\r\n   * @deprecated Use [[Scene.add]]\r\n   */\r\n  @obsolete({ message: 'Will be removed in excalibur v0.26.0', alternateMethod: 'Use Scene.add' })\r\n  public addTileMap(tileMap: TileMap) {\r\n    this.world.add(tileMap);\r\n  }\r\n\r\n  /**\r\n   * Removes a [[TileMap]] from the scene, it will no longer be drawn or updated.\r\n   * @deprecated Use [[Scene.remove]]\r\n   */\r\n  @obsolete({ message: 'Will be removed in excalibur v0.26.0', alternateMethod: 'Use Scene.remove' })\r\n  public removeTileMap(tileMap: TileMap) {\r\n    this.world.remove(tileMap);\r\n  }\r\n\r\n  /**\r\n   * Adds a [[Timer]] to the scene\r\n   * @param timer  The timer to add\r\n   */\r\n  public addTimer(timer: Timer): Timer {\r\n    this._timers.push(timer);\r\n    timer.scene = this;\r\n    return timer;\r\n  }\r\n\r\n  /**\r\n   * Removes a [[Timer]] from the scene.\r\n   * @warning Can be dangerous, use [[cancelTimer]] instead\r\n   * @param timer  The timer to remove\r\n   */\r\n  public removeTimer(timer: Timer): Timer {\r\n    const i = this._timers.indexOf(timer);\r\n    if (i !== -1) {\r\n      this._timers.splice(i, 1);\r\n    }\r\n    return timer;\r\n  }\r\n\r\n  /**\r\n   * Cancels a [[Timer]], removing it from the scene nicely\r\n   * @param timer  The timer to cancel\r\n   */\r\n  public cancelTimer(timer: Timer): Timer {\r\n    this._cancelQueue.push(timer);\r\n    return timer;\r\n  }\r\n\r\n  /**\r\n   * Tests whether a [[Timer]] is active in the scene\r\n   */\r\n  public isTimerActive(timer: Timer): boolean {\r\n    return this._timers.indexOf(timer) > -1 && !timer.complete;\r\n  }\r\n\r\n  public isCurrentScene(): boolean {\r\n    if (this.engine) {\r\n      return this.engine.currentScene === this;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  private _collectActorStats(engine: Engine) {\r\n    const screenElements = this.actors.filter((a) => a instanceof ScreenElement) as ScreenElement[];\r\n    for (const _ui of screenElements) {\r\n      engine.stats.currFrame.actors.ui++;\r\n    }\r\n\r\n    for (const actor of this.actors) {\r\n      engine.stats.currFrame.actors.alive++;\r\n      for (const child of actor.children) {\r\n        if (ActorUtils.isScreenElement(child as Actor)) {\r\n          // TODO not true\r\n          engine.stats.currFrame.actors.ui++;\r\n        } else {\r\n          engine.stats.currFrame.actors.alive++;\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { Logger } from './../Util/Log';\r\nimport { PostProcessor } from './PostProcessor';\r\nimport { Engine } from '../Engine';\r\n\r\nexport enum ColorBlindness {\r\n  Protanope,\r\n  Deuteranope,\r\n  Tritanope\r\n}\r\n\r\n/**\r\n * This post processor can correct colors and simulate color blindness.\r\n * It is possible to use this on every game, but the game's performance\r\n * will suffer measurably. It's better to use it as a helpful tool while developing your game.\r\n * Remember, the best practice is to design with color blindness in mind.\r\n */\r\nexport class ColorBlindCorrector implements PostProcessor {\r\n  /*eslint-disable */\r\n  private _vertexShader =\r\n    '' +\r\n    'attribute vec2 a_position;' +\r\n    'attribute vec2 a_texCoord;' +\r\n    'uniform vec2 u_resolution;' +\r\n    'varying vec2 v_texCoord;' +\r\n    'void main() {' +\r\n    // convert the rectangle from pixels to 0.0 to 1.0\r\n    'vec2 zeroToOne = a_position / u_resolution;' +\r\n    // convert from 0->1 to 0->2\r\n    'vec2 zeroToTwo = zeroToOne * 2.0;' +\r\n    // convert from 0->2 to -1->+1 (clipspace)\r\n    'vec2 clipSpace = zeroToTwo - 1.0;' +\r\n    'gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);' +\r\n    // pass the texCoord to the fragment shader\r\n    // The GPU will interpolate this value between points.\r\n    'v_texCoord = a_texCoord;' +\r\n    '}';\r\n\r\n  private _fragmentShader =\r\n    'precision mediump float;' +\r\n    // our texture\r\n    'uniform sampler2D u_image;' +\r\n    // the texCoords passed in from the vertex shader.\r\n    'varying vec2 v_texCoord;' +\r\n    // Color blind conversions\r\n    /*'mat3 m[9] =' +\r\n   '{' +\r\n      'mat3(1.0, 0.0, 0.0,  0.0, 1.0, 0.0,  0.0, 0.0, 1.0  ),' + // normal\r\n      'mat3(0.567, 0.433, 0.0,  0.558, 0.442, 0.0,  0.0, 0.242, 0.758),' + // protanopia\r\n      'mat3(0.817, 0.183, 0.0,  0.333, 0.667, 0.0,  0.0, 0.125,0.875),' + // protanomaly\r\n      'mat3(0.625, 0.375, 0.0,  0.7, 0.3, 0.0,  0.0, 0.3,0.7  ),' + // deuteranopia\r\n      'mat3(0.8, 0.2, 0.0,  0.258, 0.742, 0.0,  0.0, 0.142,0.858),' + // deuteranomaly\r\n      'mat3(0.95, 0.05, 0.0,  0.0, 0.433, 0.567,  0.0, 0.475,0.525),' + // tritanopia\r\n      'mat3(0.967, 0.033, 0.0,  0.0, 0.733, 0.267,  0.0, 0.183,0.817),' + // tritanomaly\r\n      'mat3(0.299, 0.587, 0.114,  0.299, 0.587, 0.114,  0.299, 0.587,0.114),' + // achromatopsia\r\n      'mat3(0.618, 0.320, 0.062,  0.163, 0.775, 0.062,  0.163, 0.320,0.516)' +  // achromatomaly\r\n   '};' +*/\r\n\r\n    'void main() {' +\r\n    'vec4 o =  texture2D(u_image, v_texCoord);' +\r\n    // RGB to LMS matrix conversion\r\n    'float L = (17.8824 * o.r) + (43.5161 * o.g) + (4.11935 * o.b);' +\r\n    'float M = (3.45565 * o.r) + (27.1554 * o.g) + (3.86714 * o.b);' +\r\n    'float S = (0.0299566 * o.r) + (0.184309 * o.g) + (1.46709 * o.b);' +\r\n    // Simulate color blindness\r\n\r\n    '//MODE CODE//' +\r\n    /* Deuteranope for testing\r\n      'float l = 1.0 * L + 0.0 * M + 0.0 * S;' +\r\n            'float m = 0.494207 * L + 0.0 * M + 1.24827 * S;' +\r\n            'float s = 0.0 * L + 0.0 * M + 1.0 * S;' +*/\r\n\r\n    // LMS to RGB matrix conversion\r\n    'vec4 error;' +\r\n    'error.r = (0.0809444479 * l) + (-0.130504409 * m) + (0.116721066 * s);' +\r\n    'error.g = (-0.0102485335 * l) + (0.0540193266 * m) + (-0.113614708 * s);' +\r\n    'error.b = (-0.000365296938 * l) + (-0.00412161469 * m) + (0.693511405 * s);' +\r\n    'error.a = 1.0;' +\r\n    'vec4 diff = o - error;' +\r\n    'vec4 correction;' +\r\n    'correction.r = 0.0;' +\r\n    'correction.g =  (diff.r * 0.7) + (diff.g * 1.0);' +\r\n    'correction.b =  (diff.r * 0.7) + (diff.b * 1.0);' +\r\n    'correction = o + correction;' +\r\n    'correction.a = o.a;' +\r\n    '//SIMULATE//' +\r\n    '}';\r\n\r\n  /*eslint-enable */\r\n  private _internalCanvas: HTMLCanvasElement;\r\n  private _gl: WebGLRenderingContext;\r\n  private _program: WebGLProgram;\r\n\r\n  constructor(public engine: Engine, public simulate: boolean = false, public colorMode: ColorBlindness = ColorBlindness.Protanope) {\r\n    this._internalCanvas = document.createElement('canvas');\r\n    this._internalCanvas.width = engine.drawWidth;\r\n    this._internalCanvas.height = engine.drawHeight;\r\n\r\n    // eslint-disable-next-line\r\n    this._gl = <WebGLRenderingContext>this._internalCanvas.getContext('webgl', { preserveDrawingBuffer: true });\r\n\r\n    this._program = this._gl.createProgram();\r\n    const fragmentShader = this._getShader('Fragment', this._getFragmentShaderByMode(colorMode));\r\n    const vertextShader = this._getShader('Vertex', this._vertexShader);\r\n\r\n    this._gl.attachShader(this._program, vertextShader);\r\n    this._gl.attachShader(this._program, fragmentShader);\r\n    this._gl.linkProgram(this._program);\r\n\r\n    if (!this._gl.getProgramParameter(this._program, this._gl.LINK_STATUS)) {\r\n      Logger.getInstance().error('Unable to link shader program!');\r\n    }\r\n\r\n    this._gl.useProgram(this._program);\r\n  }\r\n\r\n  private _getFragmentShaderByMode(colorMode: ColorBlindness) {\r\n    let code = '';\r\n    if (colorMode === ColorBlindness.Protanope) {\r\n      code =\r\n        'float l = 0.0 * L + 2.02344 * M + -2.52581 * S;' +\r\n        'float m = 0.0 * L + 1.0 * M + 0.0 * S;' +\r\n        'float s = 0.0 * L + 0.0 * M + 1.0 * S;';\r\n    } else if (colorMode === ColorBlindness.Deuteranope) {\r\n      code =\r\n        'float l = 1.0 * L + 0.0 * M + 0.0 * S;' +\r\n        'float m = 0.494207 * L + 0.0 * M + 1.24827 * S;' +\r\n        'float s = 0.0 * L + 0.0 * M + 1.0 * S;';\r\n    } else if (colorMode === ColorBlindness.Tritanope) {\r\n      code =\r\n        'float l = 1.0 * L + 0.0 * M + 0.0 * S;' +\r\n        'float m = 0.0 * L + 1.0 * M + 0.0 * S;' +\r\n        'float s = -0.395913 * L + 0.801109 * M + 0.0 * S;';\r\n    }\r\n\r\n    if (this.simulate) {\r\n      this._fragmentShader = this._fragmentShader.replace('//SIMULATE//', 'gl_FragColor = error.rgba;');\r\n    } else {\r\n      this._fragmentShader = this._fragmentShader.replace('//SIMULATE//', 'gl_FragColor = correction.rgba;');\r\n    }\r\n\r\n    return this._fragmentShader.replace('//MODE CODE//', code);\r\n  }\r\n\r\n  private _setRectangle(x: number, y: number, width: number, height: number) {\r\n    const x1 = x;\r\n    const x2 = x + width;\r\n    const y1 = y;\r\n    const y2 = y + height;\r\n    this._gl.bufferData(this._gl.ARRAY_BUFFER, new Float32Array([x1, y1, x2, y1, x1, y2, x1, y2, x2, y1, x2, y2]), this._gl.STATIC_DRAW);\r\n  }\r\n\r\n  private _getShader(type: string, program: string): WebGLShader {\r\n    let shader: WebGLShader;\r\n    if (type === 'Fragment') {\r\n      shader = this._gl.createShader(this._gl.FRAGMENT_SHADER);\r\n    } else if (type === 'Vertex') {\r\n      shader = this._gl.createShader(this._gl.VERTEX_SHADER);\r\n    } else {\r\n      Logger.getInstance().error('Error unknown shader type', type);\r\n    }\r\n\r\n    this._gl.shaderSource(shader, program);\r\n    this._gl.compileShader(shader);\r\n\r\n    if (!this._gl.getShaderParameter(shader, this._gl.COMPILE_STATUS)) {\r\n      Logger.getInstance().error('Unable to compile shader!', this._gl.getShaderInfoLog(shader));\r\n      return null;\r\n    }\r\n\r\n    return shader;\r\n  }\r\n\r\n  public process(image: ImageData, out: CanvasRenderingContext2D) {\r\n    // look up where the vertex data needs to go.\r\n    const positionLocation = this._gl.getAttribLocation(this._program, 'a_position');\r\n    const texCoordLocation = this._gl.getAttribLocation(this._program, 'a_texCoord');\r\n\r\n    const texCoordBuffer = this._gl.createBuffer();\r\n    this._gl.bindBuffer(this._gl.ARRAY_BUFFER, texCoordBuffer);\r\n    this._gl.bufferData(\r\n      this._gl.ARRAY_BUFFER,\r\n      new Float32Array([0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 1.0, 1.0, 0.0, 1.0, 1.0]),\r\n      this._gl.STATIC_DRAW\r\n    );\r\n    this._gl.enableVertexAttribArray(texCoordLocation);\r\n    this._gl.vertexAttribPointer(texCoordLocation, 2, this._gl.FLOAT, false, 0, 0);\r\n\r\n    // Create a texture.\r\n    const texture = this._gl.createTexture();\r\n    this._gl.bindTexture(this._gl.TEXTURE_2D, texture);\r\n\r\n    // Set the parameters so we can render any size image.\r\n    this._gl.texParameteri(this._gl.TEXTURE_2D, this._gl.TEXTURE_WRAP_S, this._gl.CLAMP_TO_EDGE);\r\n    this._gl.texParameteri(this._gl.TEXTURE_2D, this._gl.TEXTURE_WRAP_T, this._gl.CLAMP_TO_EDGE);\r\n    this._gl.texParameteri(this._gl.TEXTURE_2D, this._gl.TEXTURE_MIN_FILTER, this._gl.NEAREST);\r\n    this._gl.texParameteri(this._gl.TEXTURE_2D, this._gl.TEXTURE_MAG_FILTER, this._gl.NEAREST);\r\n    // Flip the texture when unpacking into the gl context, gl reads textures in the opposite order as everything else :/\r\n    this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL, 1);\r\n    // Upload the image into the texture.\r\n    this._gl.texImage2D(this._gl.TEXTURE_2D, 0, this._gl.RGBA, this._gl.RGBA, this._gl.UNSIGNED_BYTE, image);\r\n\r\n    // lookup uniforms\r\n    const resolutionLocation = this._gl.getUniformLocation(this._program, 'u_resolution');\r\n\r\n    // set the resolution\r\n    this._gl.uniform2f(resolutionLocation, this._internalCanvas.width, this._internalCanvas.height);\r\n\r\n    // Create a buffer for the position of the rectangle corners.\r\n    const positionBuffer = this._gl.createBuffer();\r\n    this._gl.bindBuffer(this._gl.ARRAY_BUFFER, positionBuffer);\r\n    this._gl.enableVertexAttribArray(positionLocation);\r\n    this._gl.vertexAttribPointer(positionLocation, 2, this._gl.FLOAT, false, 0, 0);\r\n\r\n    // Set a rectangle the same size as the image.\r\n    this._setRectangle(0, 0, image.width, image.height);\r\n\r\n    // Draw the rectangle.\r\n    this._gl.drawArrays(this._gl.TRIANGLES, 0, 6);\r\n\r\n    // Grab transformed image from internal canvas\r\n    const pixelData = new Uint8Array(image.width * image.height * 4);\r\n    this._gl.readPixels(0, 0, image.width, image.height, this._gl.RGBA, this._gl.UNSIGNED_BYTE, pixelData);\r\n\r\n    (<any>image.data).set(pixelData);\r\n\r\n    out.putImageData(image, 0, 0);\r\n  }\r\n}\r\n","import { Engine } from '../Engine';\r\nimport { ColorBlindCorrector, ColorBlindness } from '../PostProcessing/Index';\r\n\r\nexport interface DebugFlags {\r\n  colorBlindMode: ColorBlindFlags;\r\n}\r\n\r\nexport class ColorBlindFlags {\r\n  private _engine: Engine;\r\n\r\n  constructor(engine: Engine) {\r\n    this._engine = engine;\r\n  }\r\n\r\n  public correct(colorBlindness: ColorBlindness) {\r\n    this._engine.postProcessors.push(new ColorBlindCorrector(this._engine, false, colorBlindness));\r\n  }\r\n\r\n  public simulate(colorBlindness: ColorBlindness) {\r\n    this._engine.postProcessors.push(new ColorBlindCorrector(this._engine, true, colorBlindness));\r\n  }\r\n}\r\n","import { DebugFlags, ColorBlindFlags } from './DebugFlags';\r\nimport { Engine } from '../Engine';\r\nimport { Color } from '../Color';\r\nimport { CollisionContact } from '../Collision/Detection/CollisionContact';\r\n\r\n/**\r\n * Debug stats containing current and previous frame statistics\r\n */\r\nexport interface DebugStats {\r\n  currFrame: FrameStats;\r\n  prevFrame: FrameStats;\r\n}\r\n\r\n/**\r\n * Represents a frame's individual statistics\r\n */\r\nexport interface FrameStatistics {\r\n  /**\r\n   * The number of the frame\r\n   */\r\n  id: number;\r\n\r\n  /**\r\n   * Gets the frame's delta (time since last frame scaled by [[Engine.timescale]]) (in ms)\r\n   */\r\n  delta: number;\r\n\r\n  /**\r\n   * Gets the frame's frames-per-second (FPS)\r\n   */\r\n  fps: number;\r\n\r\n  /**\r\n   * Duration statistics (in ms)\r\n   */\r\n  duration: FrameDurationStats;\r\n\r\n  /**\r\n   * Actor statistics\r\n   */\r\n  actors: FrameActorStats;\r\n\r\n  /**\r\n   * Physics statistics\r\n   */\r\n  physics: PhysicsStatistics;\r\n\r\n  /**\r\n   * Graphics statistics\r\n   */\r\n  graphics: GraphicsStatistics;\r\n}\r\n\r\n/**\r\n * Represents actor stats for a frame\r\n */\r\nexport interface FrameActorStats {\r\n  /**\r\n   * Gets the frame's number of actors (alive)\r\n   */\r\n  alive: number;\r\n\r\n  /**\r\n   * Gets the frame's number of actors (killed)\r\n   */\r\n  killed: number;\r\n\r\n  /**\r\n   * Gets the frame's number of remaining actors (alive - killed)\r\n   */\r\n  remaining: number;\r\n\r\n  /**\r\n   * Gets the frame's number of UI actors\r\n   */\r\n  ui: number;\r\n\r\n  /**\r\n   * Gets the frame's number of total actors (remaining + UI)\r\n   */\r\n  total: number;\r\n}\r\n\r\n/**\r\n * Represents duration stats for a frame\r\n */\r\nexport interface FrameDurationStats {\r\n  /**\r\n   * Gets the frame's total time to run the update function (in ms)\r\n   */\r\n  update: number;\r\n\r\n  /**\r\n   * Gets the frame's total time to run the draw function (in ms)\r\n   */\r\n  draw: number;\r\n\r\n  /**\r\n   * Gets the frame's total render duration (update + draw duration) (in ms)\r\n   */\r\n  total: number;\r\n}\r\n\r\n/**\r\n * Represents physics stats for the current frame\r\n */\r\nexport interface PhysicsStatistics {\r\n  /**\r\n   * Gets the number of broadphase collision pairs which\r\n   */\r\n  pairs: number;\r\n\r\n  /**\r\n   * Gets the number of actual collisions\r\n   */\r\n  collisions: number;\r\n\r\n  /**\r\n   * Copy of the current frame contacts (only updated if debug is toggled on)\r\n   */\r\n  contacts: Map<string, CollisionContact>;\r\n\r\n  /**\r\n   * Gets the number of fast moving bodies using raycast continuous collisions in the scene\r\n   */\r\n  fastBodies: number;\r\n\r\n  /**\r\n   * Gets the number of bodies that had a fast body collision resolution\r\n   */\r\n  fastBodyCollisions: number;\r\n\r\n  /**\r\n   * Gets the time it took to calculate the broadphase pairs\r\n   */\r\n  broadphase: number;\r\n\r\n  /**\r\n   * Gets the time it took to calculate the narrowphase\r\n   */\r\n  narrowphase: number;\r\n}\r\n\r\nexport interface GraphicsStatistics {\r\n  drawCalls: number;\r\n  drawnImages: number;\r\n}\r\n\r\n/**\r\n * Debug statistics and flags for Excalibur. If polling these values, it would be\r\n * best to do so on the `postupdate` event for [[Engine]], after all values have been\r\n * updated during a frame.\r\n */\r\nexport class Debug implements DebugFlags {\r\n  private _engine: Engine;\r\n\r\n  constructor(engine: Engine) {\r\n    this._engine = engine;\r\n\r\n    this.colorBlindMode = new ColorBlindFlags(this._engine);\r\n  }\r\n\r\n  /**\r\n   * Performance statistics\r\n   */\r\n  public stats: DebugStats = {\r\n    /**\r\n     * Current frame statistics. Engine reuses this instance, use [[FrameStats.clone]] to copy frame stats.\r\n     * Best accessed on [[postframe]] event. See [[FrameStats]]\r\n     */\r\n    currFrame: new FrameStats(),\r\n\r\n    /**\r\n     * Previous frame statistics. Engine reuses this instance, use [[FrameStats.clone]] to copy frame stats.\r\n     * Best accessed on [[preframe]] event. Best inspected on engine event `preframe`. See [[FrameStats]]\r\n     */\r\n    prevFrame: new FrameStats()\r\n  };\r\n\r\n  /**\r\n   * Correct or simulate color blindness using [[ColorBlindness]] post processor.\r\n   * @warning Will reduce FPS.\r\n   */\r\n  public colorBlindMode: ColorBlindFlags;\r\n\r\n  /**\r\n   * Filter debug context to named entities or entity ids\r\n   */\r\n  public filter: { useFilter: boolean; nameQuery: string; ids: number[] } = {\r\n    /**\r\n     * Toggle filter on or off (default off) must be on for DebugDraw to use filters\r\n     */\r\n    useFilter: false,\r\n    /**\r\n     * Query for entities by name, if the entity name contains `nameQuery` it will be included\r\n     */\r\n    nameQuery: '',\r\n    /**\r\n     * Query for Entity ids, if the id matches it will be included\r\n     */\r\n    ids: []\r\n  };\r\n\r\n  /**\r\n   * Entity debug settings\r\n   */\r\n  public entity = {\r\n    showAll: false,\r\n    showId: true,\r\n    showName: false\r\n  };\r\n\r\n  /**\r\n   * Transform component debug settings\r\n   */\r\n  public transform = {\r\n    showAll: false,\r\n\r\n    showPosition: false,\r\n    positionColor: Color.Yellow,\r\n\r\n    showScale: false,\r\n    scaleColor: Color.Green,\r\n\r\n    showRotation: false,\r\n    rotationColor: Color.Blue\r\n  };\r\n\r\n  /**\r\n   * Graphics component debug settings\r\n   */\r\n  public graphics = {\r\n    showAll: false,\r\n\r\n    showBounds: true,\r\n    boundsColor: Color.Yellow\r\n  };\r\n\r\n  /**\r\n   * Collider component debug settings\r\n   */\r\n  public collider = {\r\n    showAll: false,\r\n\r\n    showBounds: true,\r\n    boundsColor: Color.Blue,\r\n\r\n    showOwner: false,\r\n\r\n    showGeometry: true,\r\n    geometryColor: Color.Green\r\n  };\r\n\r\n  /**\r\n   * Physics simulation debug settings\r\n   */\r\n  public physics = {\r\n    showAll: false,\r\n\r\n    showBroadphaseSpacePartitionDebug: false,\r\n\r\n    showCollisionNormals: false,\r\n    collisionNormalColor: Color.Cyan,\r\n\r\n    showCollisionContacts: true,\r\n    collisionContactColor: Color.Red\r\n  };\r\n\r\n  /**\r\n   * Motion component debug settings\r\n   */\r\n  public motion = {\r\n    showAll: false,\r\n\r\n    showVelocity: false,\r\n    velocityColor: Color.Yellow,\r\n\r\n    showAcceleration: false,\r\n    accelerationColor: Color.Red\r\n  };\r\n\r\n  /**\r\n   * Body component debug settings\r\n   */\r\n  public body = {\r\n    showAll: false,\r\n\r\n    showCollisionGroup: false,\r\n    showCollisionType: false,\r\n    showSleeping: false,\r\n    showMotion: false,\r\n    showMass: false\r\n  };\r\n\r\n  /**\r\n   * Camera debug settings\r\n   */\r\n  public camera = {\r\n    showAll: false,\r\n\r\n    showFocus: false,\r\n    focusColor: Color.Red,\r\n\r\n    showZoom: false\r\n  };\r\n}\r\n\r\n/**\r\n * Implementation of a frame's stats. Meant to have values copied via [[FrameStats.reset]], avoid\r\n * creating instances of this every frame.\r\n */\r\nexport class FrameStats implements FrameStatistics {\r\n  private _id: number = 0;\r\n  private _delta: number = 0;\r\n  private _fps: number = 0;\r\n  private _actorStats: FrameActorStats = {\r\n    alive: 0,\r\n    killed: 0,\r\n    ui: 0,\r\n    get remaining() {\r\n      return this.alive - this.killed;\r\n    },\r\n    get total() {\r\n      return this.remaining + this.ui;\r\n    }\r\n  };\r\n  private _durationStats: FrameDurationStats = {\r\n    update: 0,\r\n    draw: 0,\r\n    get total() {\r\n      return this.update + this.draw;\r\n    }\r\n  };\r\n\r\n  private _physicsStats: PhysicsStats = new PhysicsStats();\r\n\r\n  private _graphicsStats: GraphicsStatistics = {\r\n    drawCalls: 0,\r\n    drawnImages: 0\r\n  };\r\n\r\n  /**\r\n   * Zero out values or clone other IFrameStat stats. Allows instance reuse.\r\n   *\r\n   * @param [otherStats] Optional stats to clone\r\n   */\r\n  public reset(otherStats?: FrameStatistics) {\r\n    if (otherStats) {\r\n      this.id = otherStats.id;\r\n      this.delta = otherStats.delta;\r\n      this.fps = otherStats.fps;\r\n      this.actors.alive = otherStats.actors.alive;\r\n      this.actors.killed = otherStats.actors.killed;\r\n      this.actors.ui = otherStats.actors.ui;\r\n      this.duration.update = otherStats.duration.update;\r\n      this.duration.draw = otherStats.duration.draw;\r\n      this._physicsStats.reset(otherStats.physics);\r\n      this.graphics.drawCalls = otherStats.graphics.drawCalls;\r\n      this.graphics.drawnImages = otherStats.graphics.drawnImages;\r\n    } else {\r\n      this.id = this.delta = this.fps = 0;\r\n      this.actors.alive = this.actors.killed = this.actors.ui = 0;\r\n      this.duration.update = this.duration.draw = 0;\r\n      this._physicsStats.reset();\r\n      this.graphics.drawnImages = this.graphics.drawCalls = 0;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Provides a clone of this instance.\r\n   */\r\n  public clone(): FrameStats {\r\n    const fs = new FrameStats();\r\n\r\n    fs.reset(this);\r\n\r\n    return fs;\r\n  }\r\n\r\n  /**\r\n   * Gets the frame's id\r\n   */\r\n  public get id() {\r\n    return this._id;\r\n  }\r\n\r\n  /**\r\n   * Sets the frame's id\r\n   */\r\n  public set id(value: number) {\r\n    this._id = value;\r\n  }\r\n\r\n  /**\r\n   * Gets the frame's delta (time since last frame)\r\n   */\r\n  public get delta() {\r\n    return this._delta;\r\n  }\r\n\r\n  /**\r\n   * Sets the frame's delta (time since last frame). Internal use only.\r\n   * @internal\r\n   */\r\n  public set delta(value: number) {\r\n    this._delta = value;\r\n  }\r\n\r\n  /**\r\n   * Gets the frame's frames-per-second (FPS)\r\n   */\r\n  public get fps() {\r\n    return this._fps;\r\n  }\r\n\r\n  /**\r\n   * Sets the frame's frames-per-second (FPS). Internal use only.\r\n   * @internal\r\n   */\r\n  public set fps(value: number) {\r\n    this._fps = value;\r\n  }\r\n\r\n  /**\r\n   * Gets the frame's actor statistics\r\n   */\r\n  public get actors() {\r\n    return this._actorStats;\r\n  }\r\n\r\n  /**\r\n   * Gets the frame's duration statistics\r\n   */\r\n  public get duration() {\r\n    return this._durationStats;\r\n  }\r\n\r\n  /**\r\n   * Gets the frame's physics statistics\r\n   */\r\n  public get physics() {\r\n    return this._physicsStats;\r\n  }\r\n\r\n  /**\r\n   * Gets the frame's graphics statistics\r\n   */\r\n  public get graphics() {\r\n    return this._graphicsStats;\r\n  }\r\n}\r\n\r\nexport class PhysicsStats implements PhysicsStatistics {\r\n  private _pairs: number = 0;\r\n  private _collisions: number = 0;\r\n  private _contacts: Map<string, CollisionContact> = new Map();\r\n  private _fastBodies: number = 0;\r\n  private _fastBodyCollisions: number = 0;\r\n  private _broadphase: number = 0;\r\n  private _narrowphase: number = 0;\r\n\r\n  /**\r\n   * Zero out values or clone other IPhysicsStats stats. Allows instance reuse.\r\n   *\r\n   * @param [otherStats] Optional stats to clone\r\n   */\r\n  public reset(otherStats?: PhysicsStatistics) {\r\n    if (otherStats) {\r\n      this.pairs = otherStats.pairs;\r\n      this.collisions = otherStats.collisions;\r\n      this.contacts = otherStats.contacts;\r\n      this.fastBodies = otherStats.fastBodies;\r\n      this.fastBodyCollisions = otherStats.fastBodyCollisions;\r\n      this.broadphase = otherStats.broadphase;\r\n      this.narrowphase = otherStats.narrowphase;\r\n    } else {\r\n      this.pairs = this.collisions = this.fastBodies = 0;\r\n      this.fastBodyCollisions = this.broadphase = this.narrowphase = 0;\r\n      this.contacts.clear();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Provides a clone of this instance.\r\n   */\r\n  public clone(): PhysicsStatistics {\r\n    const ps = new PhysicsStats();\r\n\r\n    ps.reset(this);\r\n\r\n    return ps;\r\n  }\r\n\r\n  public get pairs(): number {\r\n    return this._pairs;\r\n  }\r\n\r\n  public set pairs(value: number) {\r\n    this._pairs = value;\r\n  }\r\n\r\n  public get collisions(): number {\r\n    return this._collisions;\r\n  }\r\n\r\n  public set collisions(value: number) {\r\n    this._collisions = value;\r\n  }\r\n\r\n  public get contacts(): Map<string, CollisionContact> {\r\n    return this._contacts;\r\n  }\r\n\r\n  public set contacts(contacts: Map<string, CollisionContact>) {\r\n    this._contacts = contacts;\r\n  }\r\n\r\n  public get fastBodies(): number {\r\n    return this._fastBodies;\r\n  }\r\n\r\n  public set fastBodies(value: number) {\r\n    this._fastBodies = value;\r\n  }\r\n\r\n  public get fastBodyCollisions(): number {\r\n    return this._fastBodyCollisions;\r\n  }\r\n\r\n  public set fastBodyCollisions(value: number) {\r\n    this._fastBodyCollisions = value;\r\n  }\r\n\r\n  public get broadphase(): number {\r\n    return this._broadphase;\r\n  }\r\n\r\n  public set broadphase(value: number) {\r\n    this._broadphase = value;\r\n  }\r\n\r\n  public get narrowphase(): number {\r\n    return this._narrowphase;\r\n  }\r\n\r\n  public set narrowphase(value: number) {\r\n    this._narrowphase = value;\r\n  }\r\n}\r\n","import { Engine } from '../Engine';\nimport { Vector } from './vector';\n\nexport class GlobalCoordinates {\n  public static fromPagePosition(x: number, y: number, engine: Engine): GlobalCoordinates;\n  public static fromPagePosition(pos: Vector, engine: Engine): GlobalCoordinates;\n  public static fromPagePosition(xOrPos: number | Vector, yOrEngine: number | Engine, engineOrUndefined?: Engine): GlobalCoordinates {\n    let pageX: number;\n    let pageY: number;\n    let pagePos: Vector;\n    let engine: Engine;\n\n    if (arguments.length === 3) {\n      pageX = <number>xOrPos;\n      pageY = <number>yOrEngine;\n      pagePos = new Vector(pageX, pageY);\n      engine = engineOrUndefined;\n    } else {\n      pagePos = <Vector>xOrPos;\n      pageX = pagePos.x;\n      pageY = pagePos.y;\n      engine = <Engine>yOrEngine;\n    }\n\n    const screenPos = engine.screen.pageToScreenCoordinates(pagePos);\n    const worldPos = engine.screen.screenToWorldCoordinates(screenPos);\n\n    return new GlobalCoordinates(worldPos, pagePos, screenPos);\n  }\n\n  constructor(public worldPos: Vector, public pagePos: Vector, public screenPos: Vector) {}\n}\n","import { Class } from '../Class';\nimport { Engine, ScrollPreventionMode } from '../Engine';\nimport { Pointer, PointerType } from './Pointer';\nimport {\n  PointerEvent,\n  WheelEvent,\n  NativePointerButton,\n  PointerButton,\n  WheelDeltaMode,\n  createPointerEventByName,\n  PointerLeaveEvent,\n  PointerEnterEvent\n} from './PointerEvents';\nimport { GameEvent } from '../Events';\n\nimport * as Events from '../Events';\nimport * as Util from '../Util/Util';\nimport { vec } from '../Math/vector';\nimport { GlobalCoordinates } from '../Math/global-coordinates';\nimport { Vector } from '../Math/vector';\nimport { CapturePointer } from '../Traits/CapturePointer';\nimport { Actor } from '../Actor';\n\nexport type DOMPointerEvent = globalThis.PointerEvent;\nexport type DOMWheelEvent = globalThis.WheelEvent;\n\ninterface TouchEvent extends Event {\n  altKey: boolean;\n  changedTouches: Touch[];\n  ctrlKey: boolean;\n  metaKey: boolean;\n  shiftKey: boolean;\n  targetTouches: Touch[];\n  touches: Touch[];\n  type: string;\n  target: Element;\n}\n\ninterface Touch {\n  identifier: number;\n  screenX: number;\n  screenY: number;\n  clientX: number;\n  clientY: number;\n  pageX: number;\n  pageY: number;\n  radiusX: number;\n  radiusY: number;\n  rotationAngle: number;\n  force: number;\n  target: Element;\n}\n\n/**\n * A constant used to normalize wheel events across different browsers\n *\n * This normalization factor is pulled from https://developer.mozilla.org/en-US/docs/Web/Events/wheel#Listening_to_this_event_across_browser\n */\nconst ScrollWheelNormalizationFactor = -1 / 40;\n\n/**\n * Handles pointer events (mouse, touch, stylus, etc.) and normalizes to\n * [W3C Pointer Events](http://www.w3.org/TR/pointerevents/).\n */\nexport class Pointers extends Class {\n  private _engine: Engine;\n\n  private _pointerDown: PointerEvent[] = [];\n  private _pointerUp: PointerEvent[] = [];\n  private _pointerMove: PointerEvent[] = [];\n  private _pointerCancel: PointerEvent[] = [];\n  private _wheel: WheelEvent[] = [];\n  private _pointers: Pointer[] = [];\n  private _activePointers: number[] = [];\n\n  constructor(engine: Engine) {\n    super();\n\n    this._engine = engine;\n    this._pointers.push(new Pointer());\n    this._activePointers = [-1];\n    this.primary = this._pointers[0];\n  }\n\n  public on(eventName: Events.up, handler: (event: PointerEvent) => void): void;\n  public on(eventName: Events.down, handler: (event: PointerEvent) => void): void;\n  public on(eventName: Events.move, handler: (event: PointerEvent) => void): void;\n  public on(eventName: Events.enter, handler: (event: PointerEvent) => void): void;\n  public on(eventName: Events.leave, handler: (event: PointerEvent) => void): void;\n  public on(eventName: Events.cancel, handler: (event: PointerEvent) => void): void;\n  public on(eventName: Events.wheel, handler: (event: WheelEvent) => void): void;\n  public on(eventName: string, handler: (event: GameEvent<any>) => void): void;\n  public on(eventName: string, handler: (event: any) => void): void {\n    super.on(eventName, handler);\n  }\n\n  /**\n   * Primary pointer (mouse, 1 finger, stylus, etc.)\n   */\n  public primary: Pointer;\n\n  /**\n   * Initializes pointer event listeners\n   */\n  public init(target?: GlobalEventHandlers): void {\n    target = target || this._engine.canvas;\n\n    // Touch Events\n    target.addEventListener('touchstart', this._handleTouchEvent('down', this._pointerDown));\n    target.addEventListener('touchend', this._handleTouchEvent('up', this._pointerUp));\n    target.addEventListener('touchmove', this._handleTouchEvent('move', this._pointerMove));\n    target.addEventListener('touchcancel', this._handleTouchEvent('cancel', this._pointerCancel));\n\n    // W3C Pointer Events\n    // Current: IE11, IE10\n    if ((<any>window).PointerEvent) {\n      // IE11\n      this._engine.canvas.style.touchAction = 'none';\n      target.addEventListener('pointerdown', this._handlePointerEvent('down', this._pointerDown));\n      target.addEventListener('pointerup', this._handlePointerEvent('up', this._pointerUp));\n      target.addEventListener('pointermove', this._handlePointerEvent('move', this._pointerMove));\n      target.addEventListener('pointercancel', this._handlePointerEvent('cancel', this._pointerCancel));\n    } else if ((<any>window).MSPointerEvent) {\n      // IE10\n      (this._engine.canvas.style as any).msTouchAction = 'none';\n      target.addEventListener('MSPointerDown', this._handlePointerEvent('down', this._pointerDown));\n      target.addEventListener('MSPointerUp', this._handlePointerEvent('up', this._pointerUp));\n      target.addEventListener('MSPointerMove', this._handlePointerEvent('move', this._pointerMove));\n      target.addEventListener('MSPointerCancel', this._handlePointerEvent('cancel', this._pointerCancel));\n    } else {\n      // Mouse Events\n      target.addEventListener('mousedown', this._handleMouseEvent('down', this._pointerDown));\n      target.addEventListener('mouseup', this._handleMouseEvent('up', this._pointerUp));\n      target.addEventListener('mousemove', this._handleMouseEvent('move', this._pointerMove));\n    }\n\n    // MDN MouseWheelEvent\n    const wheelOptions = {\n      passive: !(\n        this._engine.pageScrollPreventionMode === ScrollPreventionMode.All ||\n        this._engine.pageScrollPreventionMode === ScrollPreventionMode.Canvas\n      )\n    };\n    if ('onwheel' in document.createElement('div')) {\n      // Modern Browsers\n      target.addEventListener('wheel', this._handleWheelEvent('wheel', this._wheel), wheelOptions);\n    } else if (document.onmousewheel !== undefined) {\n      // Webkit and IE\n      target.addEventListener('mousewheel', this._handleWheelEvent('wheel', this._wheel), wheelOptions);\n    } else {\n      // Remaining browser and older Firefox\n      target.addEventListener('MozMousePixelScroll', this._handleWheelEvent('wheel', this._wheel), wheelOptions);\n    }\n  }\n\n  /**\n   * Synthesize a pointer event that looks like a real browser event to excalibur\n   * @param eventName\n   * @param pos\n   */\n  public triggerEvent(\n    eventName: 'up' | 'down' | 'move' | 'cancel' | 'wheel',\n    pos: Vector | GlobalCoordinates,\n    button: NativePointerButton = NativePointerButton.Left,\n    pointerType: 'mouse' | 'touch' | 'pen' = 'mouse',\n    pointerId: number = 0\n  ): void {\n    let x = 0;\n    let y = 0;\n    let coords: GlobalCoordinates;\n    if (pos instanceof GlobalCoordinates) {\n      x = pos.pagePos.x;\n      y = pos.pagePos.y;\n      coords = pos;\n    } else {\n      x = pos.x;\n      y = pos.y;\n      coords = new GlobalCoordinates(pos.clone(), pos.clone(), pos.clone());\n    }\n\n    const eventish = {\n      pageX: x,\n      pageY: y,\n      pointerId: pointerId,\n      pointerType: pointerType,\n      button: button,\n      preventDefault: () => {\n        /* do nothing */\n      }\n    };\n\n    switch (eventName) {\n      case 'move':\n        this._handlePointerEvent(eventName, this._pointerMove, coords)(eventish as DOMPointerEvent);\n        break;\n      case 'down':\n        this._handlePointerEvent(eventName, this._pointerDown, coords)(eventish as DOMPointerEvent);\n        break;\n      case 'up':\n        this._handlePointerEvent(eventName, this._pointerUp, coords)(eventish as DOMPointerEvent);\n        break;\n      case 'cancel':\n        this._handlePointerEvent(eventName, this._pointerCancel, coords)(eventish as DOMPointerEvent);\n        break;\n    }\n    for (const actor of this._engine.currentScene.actors) {\n      const capturePointer = actor.traits.filter((t) => t instanceof CapturePointer)[0];\n      if (capturePointer) {\n        capturePointer.update(actor, this._engine, 1);\n      }\n    }\n    this.dispatchPointerEvents();\n    this.update();\n  }\n\n  /**\n   * Update all pointer events and pointers, meant to be called at the end of frame\n   */\n  public update(): void {\n    this._pointerUp.length = 0;\n    this._pointerDown.length = 0;\n    this._pointerMove.length = 0;\n    this._pointerCancel.length = 0;\n    this._wheel.length = 0;\n\n    for (let i = 0; i < this._pointers.length; i++) {\n      this._pointers[i].update();\n    }\n  }\n\n  /**\n   * Safely gets a Pointer at a specific index and initializes one if it doesn't yet exist\n   * @param index  The pointer index to retrieve\n   */\n  public at(index: number): Pointer {\n    if (index >= this._pointers.length) {\n      // Ensure there is a pointer to retrieve\n      for (let i = this._pointers.length - 1, max = index; i < max; i++) {\n        this._pointers.push(new Pointer());\n        this._activePointers.push(-1);\n      }\n    }\n\n    return this._pointers[index];\n  }\n\n  /**\n   * Get number of pointers being watched\n   */\n  public count(): number {\n    return this._pointers.length;\n  }\n\n  public checkAndUpdateActorUnderPointer(actor: Actor) {\n    for (const pointer of this._pointers) {\n      if (pointer.checkActorUnderPointer(actor)) {\n        pointer.addActorUnderPointer(actor);\n      } else {\n        pointer.removeActorUnderPointer(actor);\n      }\n    }\n  }\n\n  private _dispatchWithBubble(events: PointerEvent[]) {\n    for (const evt of events) {\n      for (const actor of evt.pointer.getActorsForEvents()) {\n        if (!evt.isCanceled()) {\n          evt.propagate(actor);\n        }\n        if (!evt.bubbles || evt.isCanceled()) {\n          // if the event stops bubbling part way stop processing\n          break;\n        }\n      }\n    }\n  }\n\n  private _dispatchPointerLeaveEvents() {\n    const lastMoveEventPerPointerPerActor: { [pointerId: string]: PointerEvent } = {};\n    const pointerLeave: PointerLeaveEvent[] = [];\n\n    for (const evt of this._pointerMove) {\n      for (const actor of evt.pointer.getActorsForEvents()) {\n        // If the actor was under the pointer last frame, but not this this frame, pointer left\n        if (\n          !lastMoveEventPerPointerPerActor[evt.pointer.id + '+' + actor.id] &&\n          evt.pointer.wasActorUnderPointer(actor) &&\n          !evt.pointer.isActorAliveUnderPointer(actor) &&\n          !evt.isCanceled()\n        ) {\n          lastMoveEventPerPointerPerActor[evt.pointer.id + '+' + actor.id] = evt;\n          const pe = createPointerEventByName(\n            'leave',\n            new GlobalCoordinates(evt.worldPos, evt.pagePos, evt.screenPos),\n            evt.pointer,\n            evt.index,\n            evt.pointerType,\n            evt.button,\n            evt.ev\n          );\n\n          pe.propagate(actor);\n          pointerLeave.push(<PointerLeaveEvent>pe);\n        }\n      }\n    }\n    return pointerLeave;\n  }\n\n  private _dispatchPointerEnterEvents() {\n    const lastMoveEventPerPointer: { [pointerId: number]: PointerEvent } = {};\n    const pointerEnter: PointerEnterEvent[] = [];\n\n    for (const evt of this._pointerMove) {\n      for (const actor of evt.pointer.getActorsForEvents()) {\n        // If the actor was not under the pointer last frame, but it is this frame, pointer entered\n        if (\n          !lastMoveEventPerPointer[evt.pointer.id] &&\n          !evt.pointer.wasActorUnderPointer(actor) &&\n          evt.pointer.isActorAliveUnderPointer(actor) &&\n          !evt.isCanceled()\n        ) {\n          lastMoveEventPerPointer[evt.pointer.id] = evt;\n          const pe = createPointerEventByName(\n            'enter',\n            new GlobalCoordinates(evt.worldPos, evt.pagePos, evt.screenPos),\n            evt.pointer,\n            evt.index,\n            evt.pointerType,\n            evt.button,\n            evt.ev\n          );\n          pe.propagate(actor);\n          pointerEnter.push(<PointerEnterEvent>pe);\n          // if pointer is dragging set the drag target\n          if (evt.pointer.isDragging) {\n            evt.pointer.dragTarget = actor;\n          }\n        }\n      }\n    }\n    return pointerEnter;\n  }\n\n  public dispatchPointerEvents() {\n    this._dispatchWithBubble(this._pointerDown);\n    this._dispatchWithBubble(this._pointerUp);\n    this._dispatchWithBubble(this._pointerMove);\n    this._dispatchPointerLeaveEvents();\n    this._dispatchPointerEnterEvents();\n    this._dispatchWithBubble(this._pointerCancel);\n\n    // TODO some duplication here\n    for (const evt of this._wheel) {\n      for (const actor of this._pointers[evt.index].getActorsUnderPointer()) {\n        this._propagateWheelPointerEvent(actor, evt);\n        if (!evt.bubbles || evt.isCanceled()) {\n          // if the event stops bubbling part way stop processing\n          break;\n        }\n      }\n    }\n  }\n\n  private _propagateWheelPointerEvent(actor: Actor, wheelEvent: WheelEvent) {\n    actor.emit('pointerwheel', wheelEvent);\n\n    // Recurse and propagate\n    if (wheelEvent.bubbles && !wheelEvent.isCanceled() && actor.parent) {\n      this._propagateWheelPointerEvent(actor.parent as Actor, wheelEvent); // TODO not true\n    }\n  }\n\n  private _handleMouseEvent(eventName: string, eventArr: PointerEvent[]) {\n    return (e: MouseEvent) => {\n      e.preventDefault();\n\n      const pointer = this.at(0);\n      const coordinates = GlobalCoordinates.fromPagePosition(e.pageX, e.pageY, this._engine);\n      const pe = createPointerEventByName(\n        eventName,\n        coordinates,\n        pointer,\n        0,\n        PointerType.Mouse,\n        this._nativeButtonToPointerButton(e.button),\n        e\n      );\n\n      eventArr.push(pe);\n      pointer.eventDispatcher.emit(eventName, pe);\n    };\n  }\n\n  private _handleTouchEvent(eventName: string, eventArr: PointerEvent[]) {\n    return (e: TouchEvent) => {\n      e.preventDefault();\n      for (let i = 0, len = e.changedTouches.length; i < len; i++) {\n        const index = this._pointers.length > 1 ? this._getPointerIndex(e.changedTouches[i].identifier) : 0;\n        if (index === -1) {\n          continue;\n        }\n\n        const pointer = this.at(index);\n        const coordinates = GlobalCoordinates.fromPagePosition(e.changedTouches[i].pageX, e.changedTouches[i].pageY, this._engine);\n        const pe = createPointerEventByName(eventName, coordinates, pointer, index, PointerType.Touch, PointerButton.Unknown, e);\n\n        eventArr.push(pe);\n        pointer.eventDispatcher.emit(eventName, pe);\n        this.emit(eventName, pe);\n        // only with multi-pointer\n        if (this._pointers.length > 1) {\n          if (eventName === 'up') {\n            // remove pointer ID from pool when pointer is lifted\n            this._activePointers[index] = -1;\n          } else if (eventName === 'down') {\n            // set pointer ID to given index\n            this._activePointers[index] = e.changedTouches[i].identifier;\n          }\n        }\n      }\n    };\n  }\n\n  private _handlePointerEvent(eventName: string, eventArr: PointerEvent[], coords?: GlobalCoordinates) {\n    return (e: DOMPointerEvent) => {\n      e.preventDefault();\n\n      // get the index for this pointer ID if multi-pointer is asked for\n      const index = this._pointers.length > 1 ? this._getPointerIndex(e.pointerId) : 0;\n      if (index === -1) {\n        return;\n      }\n\n      const pointer = this.at(index);\n      const coordinates = coords || GlobalCoordinates.fromPagePosition(e.pageX, e.pageY, this._engine);\n      const pe = createPointerEventByName(\n        eventName,\n        coordinates,\n        pointer,\n        index,\n        this._stringToPointerType(e.pointerType),\n        this._nativeButtonToPointerButton(e.button),\n        e\n      );\n\n      eventArr.push(pe);\n      pointer.eventDispatcher.emit(eventName, pe);\n      this.emit(eventName, pe);\n\n      // only with multi-pointer\n      if (this._pointers.length > 1) {\n        if (eventName === 'up') {\n          // remove pointer ID from pool when pointer is lifted\n          this._activePointers[index] = -1;\n        } else if (eventName === 'down') {\n          // set pointer ID to given index\n          this._activePointers[index] = e.pointerId;\n        }\n      }\n    };\n  }\n\n  private _handleWheelEvent(eventName: string, eventArr: WheelEvent[]) {\n    return (e: DOMWheelEvent) => {\n      // Should we prevent page scroll because of this event\n      if (\n        this._engine.pageScrollPreventionMode === ScrollPreventionMode.All ||\n        (this._engine.pageScrollPreventionMode === ScrollPreventionMode.Canvas && e.target === this._engine.canvas)\n      ) {\n        e.preventDefault();\n      }\n      const screen = this._engine.screen.pageToScreenCoordinates(vec(e.pageX, e.pageY));\n      const world = this._engine.screen.screenToWorldCoordinates(screen);\n\n      // deltaX, deltaY, and deltaZ are the standard modern properties\n      // wheelDeltaX, wheelDeltaY, are legacy properties in webkit browsers and older IE\n      // e.detail is only used in opera\n\n      const deltaX = e.deltaX || e.wheelDeltaX * ScrollWheelNormalizationFactor || 0;\n      const deltaY =\n        e.deltaY || e.wheelDeltaY * ScrollWheelNormalizationFactor || e.wheelDelta * ScrollWheelNormalizationFactor || e.detail || 0;\n      const deltaZ = e.deltaZ || 0;\n      let deltaMode = WheelDeltaMode.Pixel;\n\n      if (e.deltaMode) {\n        if (e.deltaMode === 1) {\n          deltaMode = WheelDeltaMode.Line;\n        } else if (e.deltaMode === 2) {\n          deltaMode = WheelDeltaMode.Page;\n        }\n      }\n\n      const we = new WheelEvent(world.x, world.y, e.pageX, e.pageY, screen.x, screen.y, 0, deltaX, deltaY, deltaZ, deltaMode, e);\n\n      eventArr.push(we);\n      this.at(0).eventDispatcher.emit(eventName, we);\n      this.emit(eventName, we);\n    };\n  }\n\n  /**\n   * Gets the index of the pointer specified for the given pointer ID or finds the next empty pointer slot available.\n   * This is required because IE10/11 uses incrementing pointer IDs so we need to store a mapping of ID => idx\n   */\n  private _getPointerIndex(pointerId: number) {\n    let idx;\n    if ((idx = this._activePointers.indexOf(pointerId)) > -1) {\n      return idx;\n    }\n\n    for (let i = 0; i < this._activePointers.length; i++) {\n      if (this._activePointers[i] === -1) {\n        return i;\n      }\n    }\n\n    // ignore pointer because game isn't watching\n    return -1;\n  }\n\n  private _nativeButtonToPointerButton(s: NativePointerButton): PointerButton {\n    switch (s) {\n      case NativePointerButton.NoButton:\n        return PointerButton.NoButton;\n      case NativePointerButton.Left:\n        return PointerButton.Left;\n      case NativePointerButton.Middle:\n        return PointerButton.Middle;\n      case NativePointerButton.Right:\n        return PointerButton.Right;\n      case NativePointerButton.Unknown:\n        return PointerButton.Unknown;\n      default:\n        return Util.fail(s);\n    }\n  }\n\n  private _stringToPointerType(s: string) {\n    switch (s) {\n      case 'touch':\n        return PointerType.Touch;\n      case 'mouse':\n        return PointerType.Mouse;\n      case 'pen':\n        return PointerType.Pen;\n      default:\n        return PointerType.Unknown;\n    }\n  }\n}\n","export interface NativeEventable {\r\n  addEventListener(name: string, handler: (...any: any[]) => any): any;\r\n  removeEventListener(name: string, handler: (...any: any[]) => any): any;\r\n}\r\n\r\nexport class BrowserComponent<T extends NativeEventable> {\r\n  private _paused = false;\r\n  private _nativeHandlers: { [key: string]: (handler: any) => void } = {};\r\n\r\n  on(eventName: string, handler: (evt: any) => void): void {\r\n    if (this._nativeHandlers[eventName]) {\r\n      this.off(eventName, this._nativeHandlers[eventName]);\r\n    }\r\n    this._nativeHandlers[eventName] = this._decorate(handler);\r\n    this.nativeComponent.addEventListener(eventName, this._nativeHandlers[eventName]);\r\n  }\r\n  off(eventName: string, handler?: (event: any) => void): void {\r\n    if (!handler) {\r\n      handler = this._nativeHandlers[eventName];\r\n    }\r\n    this.nativeComponent.removeEventListener(eventName, handler);\r\n    this._nativeHandlers[eventName] = null;\r\n  }\r\n\r\n  private _decorate(handler: (evt: any) => void): (evt: any) => void {\r\n    return (evt: any) => {\r\n      if (!this._paused) {\r\n        handler(evt);\r\n      }\r\n    };\r\n  }\r\n\r\n  public pause() {\r\n    this._paused = true;\r\n  }\r\n\r\n  public resume() {\r\n    this._paused = false;\r\n  }\r\n\r\n  public clear() {\r\n    for (const event in this._nativeHandlers) {\r\n      this.off(event);\r\n    }\r\n  }\r\n\r\n  constructor(public nativeComponent: T) {}\r\n}\r\n\r\nexport class BrowserEvents {\r\n  private _windowComponent: BrowserComponent<Window>;\r\n  private _documentComponent: BrowserComponent<Document>;\r\n  constructor(private _windowGlobal: Window, private _documentGlobal: Document) {\r\n    this._windowComponent = new BrowserComponent(this._windowGlobal);\r\n    this._documentComponent = new BrowserComponent(this._documentGlobal);\r\n  }\r\n\r\n  public get window(): BrowserComponent<Window> {\r\n    return this._windowComponent;\r\n  }\r\n\r\n  public get document(): BrowserComponent<Document> {\r\n    return this._documentComponent;\r\n  }\r\n\r\n  public pause() {\r\n    this.window.pause();\r\n    this.document.pause();\r\n  }\r\n\r\n  public resume() {\r\n    this.window.resume();\r\n    this.document.resume();\r\n  }\r\n\r\n  public clear() {\r\n    this.window.clear();\r\n    this.document.clear();\r\n  }\r\n}\r\n","import { ExcaliburGraphicsContextState } from './ExcaliburGraphicsContext';\r\n\r\nexport class StateStack {\r\n  private _states: ExcaliburGraphicsContextState[] = [];\r\n  private _currentState: ExcaliburGraphicsContextState = this._getDefaultState();\r\n\r\n  private _getDefaultState() {\r\n    return {\r\n      opacity: 1\r\n    };\r\n  }\r\n\r\n  private _cloneState() {\r\n    return {\r\n      opacity: this._currentState.opacity\r\n    };\r\n  }\r\n\r\n  public save(): void {\r\n    this._states.push(this._currentState);\r\n    this._currentState = this._cloneState();\r\n  }\r\n\r\n  public restore(): void {\r\n    this._currentState = this._states.pop();\r\n  }\r\n\r\n  public get current(): ExcaliburGraphicsContextState {\r\n    return this._currentState;\r\n  }\r\n}\r\n","import { Vector } from '../Math/vector';\nimport { SpriteFont as LegacySpriteFont } from '../Drawing/Index';\nimport { Logger } from '../Util/Log';\nimport { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\nimport { FontRenderer } from './FontCommon';\nimport { Graphic, GraphicOptions } from './Graphic';\nimport { Sprite } from './Sprite';\nimport { SpriteSheet } from './SpriteSheet';\n\nexport interface SpriteFontOptions {\n  /**\n   * Alphabet string in spritsheet order (default is row column order)\n   * example: 'abcdefghijklmnopqrstuvwxyz'\n   */\n  alphabet: string;\n  /**\n   * [[SpriteSheet]] to source character sprites from\n   */\n  spriteSheet: SpriteSheet;\n  /**\n   * Optionally ignore case in the supplied text;\n   */\n  caseInsensitive?: boolean;\n  /**\n   * Optionally adjust the spacing between character sprites\n   */\n  spacing?: number;\n  /**\n   * Optionally specify a \"shadow\"\n   */\n  shadow?: { offset: Vector };\n}\n\nexport class SpriteFont extends Graphic implements FontRenderer {\n  private _text = '';\n  private _dirty = true;\n  public alphabet: string = '';\n  public spriteSheet: SpriteSheet;\n\n  public shadow: { offset: Vector } = null;\n  public caseInsensitive = false;\n  public spacing: number = 0;\n\n  private _logger = Logger.getInstance();\n\n  static fromLegacySpriteFont(spriteFont: LegacySpriteFont): SpriteFont {\n    const sprites = spriteFont.sprites.map(Sprite.fromLegacySprite);\n    return new SpriteFont({\n      alphabet: spriteFont.alphabet,\n      spacing: 0,\n      caseInsensitive: spriteFont.caseInsensitive,\n      spriteSheet: new SpriteSheet({\n        sprites\n      })\n    });\n  }\n\n  constructor(options: SpriteFontOptions & GraphicOptions) {\n    super(options);\n    const { alphabet, spriteSheet, caseInsensitive, spacing, shadow } = options;\n    this.alphabet = alphabet;\n    this.spriteSheet = spriteSheet;\n    this.caseInsensitive = caseInsensitive ?? this.caseInsensitive;\n    this.spacing = spacing ?? this.spacing;\n    this.shadow = shadow ?? this.shadow;\n\n    this.spriteSheet.sprites[0].image.ready.then(() => {\n      this._updateDimensions();\n    });\n  }\n\n  private _sprites: Sprite[] = [];\n  private _getCharacterSprites(text: string): Sprite[] {\n    if (!this._dirty) {\n      return this._sprites;\n    }\n\n    const results: Sprite[] = [];\n    // handle case insenstive\n    const textToRender = this.caseInsensitive ? text.toLocaleLowerCase() : text;\n    const alphabet = this.caseInsensitive ? this.alphabet.toLocaleLowerCase() : this.alphabet;\n\n    // for each letter in text\n    for (let letterIndex = 0; letterIndex < textToRender.length; letterIndex++) {\n      // find the sprite index in alphabet , if there is an error pick the first\n      const letter = textToRender[letterIndex];\n      let spriteIndex = alphabet.indexOf(letter);\n      if (spriteIndex === -1) {\n        spriteIndex = 0;\n        this._logger.warn(`SpriteFont - Cannot find letter '${letter}' in configured alphabet '${alphabet}'`);\n      }\n\n      const letterSprite = this.spriteSheet.sprites[spriteIndex];\n      if (letterSprite) {\n        results.push(letterSprite);\n      } else {\n        this._logger.warn(`SpriteFont - Cannot find sprite for '${letter}' at index '${spriteIndex}' in configured SpriteSheet`);\n      }\n    }\n    this._dirty = false;\n    return (this._sprites = results);\n  }\n\n  private _updateDimensions() {\n    const sprites = this._getCharacterSprites(this._text);\n    let width = 0;\n    let height = 0;\n    for (const sprite of sprites) {\n      width += sprite.width + this.spacing;\n      height = Math.max(height, sprite.height);\n    }\n    this.width = width;\n    this.height = height;\n  }\n\n  public updateText(text: string) {\n    if (this._text !== text) {\n      this._dirty = true;\n      this._text = text;\n      this._updateDimensions();\n    }\n  }\n\n  protected _preDraw(ex: ExcaliburGraphicsContext, x: number, y: number): void {\n    this._updateDimensions();\n    super._preDraw(ex, x, y);\n  }\n\n  protected _drawImage(ex: ExcaliburGraphicsContext, x: number, y: number): void {\n    let cursor = 0;\n    for (const sprite of this._getCharacterSprites(this._text)) {\n      // draw it in the right spot and increase the cursor by sprite width\n      sprite.draw(ex, x + cursor, y);\n      cursor += sprite.width + this.spacing;\n    }\n  }\n\n  render(ex: ExcaliburGraphicsContext, text: string, x: number, y: number) {\n    if (this._text !== text) {\n      this._dirty = true;\n      this._text = text;\n    }\n\n    if (this.shadow) {\n      ex.save();\n      ex.translate(this.shadow.offset.x, this.shadow.offset.y);\n      this.draw(ex, x, y);\n      ex.restore();\n    }\n\n    this.draw(ex, x, y);\n  }\n\n  clone(): SpriteFont {\n    return new SpriteFont({\n      alphabet: this.alphabet,\n      spriteSheet: this.spriteSheet,\n      spacing: this.spacing\n    });\n  }\n}\n","import { ExcaliburGraphicsContext, ImageSource, SpriteFont, SpriteSheet } from '..';\r\nimport { Vector } from '../..';\r\nimport debugFont from './debug-font.png';\r\n\r\n/**\r\n * Internal debugtext helper\r\n */\r\nexport class DebugText {\r\n  constructor() {\r\n    this.load();\r\n  }\r\n\r\n  /**\r\n   * base64 font\r\n   */\r\n  public readonly fontSheet = debugFont;\r\n  public size: number = 16;\r\n  private _imageSource: ImageSource;\r\n  private _spriteSheet: SpriteSheet;\r\n  private _spriteFont: SpriteFont;\r\n  public load() {\r\n    this._imageSource = new ImageSource(this.fontSheet);\r\n    return this._imageSource.load().then(() => {\r\n      this._spriteSheet = SpriteSheet.fromImageSource({\r\n        image: this._imageSource,\r\n        grid: {\r\n          rows: 3,\r\n          columns: 16,\r\n          spriteWidth: 16,\r\n          spriteHeight: 16\r\n        }\r\n      });\r\n      this._spriteFont = new SpriteFont({\r\n        alphabet: '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ,!\\'&.\"?-()+ ',\r\n        caseInsensitive: true,\r\n        spriteSheet: this._spriteSheet,\r\n        spacing: -6\r\n      });\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Writes debug text using the built in sprint font\r\n   * @param ctx\r\n   * @param text\r\n   * @param pos\r\n   */\r\n  public write(ctx: ExcaliburGraphicsContext, text: string, pos: Vector) {\r\n    if (this._imageSource.isLoaded()) {\r\n      this._spriteFont.render(ctx, text, pos.x, pos.y);\r\n    }\r\n  }\r\n}\r\n","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAAwCAYAAAD+f6R/AAAAAXNSR0IArs4c6QAABcJJREFUeJztnemu7CgMhGE07//KmT9NhrAFVzkQndQntXRP3/bCZkwCSQhCCCGEEEIIIYQQQog/TRz953Ecx/nDGIe/vdNhlc9tIz605Fk/ZmWfsO1hn9Gxuv1KHbvb3iL/VN+d1WORbyr7yR/5b9M4vjNeqko6jPJHq5wGHU151o9J2Udse9hndCxuv0rH7rY3yD/Wdyf13MrnQeDfkZIUSGKM4ff3cWN82pEZuTyQGX2IxeyR63va//8VNCYCq+1yEkLtWyagXv1P1r1H+110gP3PzT4gT8uW/mdQ8mUG8E9DqOz4MS9ICKGbXpS2BpnIrRzYeS96cll08INlCMl2/glzdcfazuuPqQO03lmqrBHsf272Q6NODXj6zzZIJd/LAHYTg3Mays5gBi7ZR27fOgs0yj8rm36DLMFiPgkAdXHKOwUQeMCQ/adSh/qBQrT/tPxbAwA9+DOZEILPAATSuHMgTv7+Auk/df2lHPCZLvMSLJe34LkEQ9PwXF1SRTllMYgvIaflqyVAjLGbsiCDcOK76jflxZ+sINPyROc5071yKWK5CJTV3dMp6+tBlyCtNlhAq/+XbWoBDcRNXYBMzD4VvQygSuPYC2jGGaSSOxXfy3dTUEsanIvNeepm38N/hssSALTPZnAXfwIYRJn2b7UBcw0FKX+nDdAMpm2j9WVnxrUa7TXaVAca/B+TgaAVh6R/rH0P/5m01dt/RLYViJn+w/bhVX2P7f/duqom5qb02pRLCLGIMgBU1wCEEN9BAUCID6MAIMSHUQAQ4sMoAAjxYRQAhPgwd1uB0fuZ7H3cnn2P+9mr/Pe4B8/eB/fwP4eRtci/0f6OfTCPt/9oHwC6G6y19RHZDumxmwzR4eE/s/2Tte/q/+XLdc9DeJ19diesQc/j7Z8fCe4tAS4CxZ7sp7eiJi7HiZmjmOTGJs+93CbS3nP0XIPH3vW8/qz6QPnX2QdsV/1uw/iZYvg8ACeHd28rpPzfNfhL+7vkw/4Ou9s+Onhbv91elpKZ48Dl6bzpwwibHigRArf+Ptk9+L3Y1Q5OB4LgCeSBw1iuB3GeJh1/HrX/zF0A9Mk+u45zMkc3r4rWPomma5+p/514LB+Zo93MErJ1JHxXPzByGa/licRYVKbpeQCoQ6Q8yxuCwJF9IPsoDkHAo/3Tx26cvA4EtJ/n04w8QOq/mrR7ddfLAC5BYFNlVI/0CnOVUflOpvJUQMx9AIMIW/nWDM67/qw0+95v9goBqD9j+72u/KD9U89IbnQbMIR2Zbneh5zUY7Hdk7XIP3UffVb+r+wDYAZLq+1n1+C7y3/ny2r7p5yeByDEh9HzAIQQJwoAQnwYBQAhPowCgBBjoNu3hNxSFACE6INuKvPajPZ4EFEAEKINcybGYzOd247WEd3TgA2jlmjEyrd+j9hvfVbD2PWQ3ZmGlu2HyO8og8eBuNUvNYWoDgMVpwHTJoLWdz1Y+ZYOy5uF7t6PPruZxANrud1lQXkP0jsGz/Yz+vGGMuygFyhSPcJnc1pMnQZElc+cRnoAlxdTvoDuK7puqF7uCQy+3fyFMiA02/vJQHh7DQDogMPTSGFNA56HTzbZ9yAfBOb1Zyo3qGM3MfMZ3f76huXf6xlmAHknMlLNXsBBBvbljIz9Uyz5Y5TzIBLR/qy/rNyrZ8+L/0BZ0m+tgXD0OK5XZxC/9P7I/g4hVFvzXf1/6i5A7+3AlijMPBLMZfCvuAp7A9rY56ApHitmLQc7c8bOv6ftAxlM9Xp35nkEK7nJetBsaMhtAAAuOLQGXwhh2dXQnn1rZ/a42BI3dL7L+jkFAbQddwdA9Ah35yMKhgEgVT46EFh5D4jz+OgavNKxeBCd1wDSJ/97oR8eoJkLi9t9/BDgDHTJ5NE7Dnzechh914OVv9M1K9PCqsfqb88XVg9qN9lm6nG176UPu+zn17GOxuO0vOWEEC/j+LFKTgghlvEfYJaLS+SA2O0AAAAASUVORK5CYII=\"","import {\r\n  ExcaliburGraphicsContext,\r\n  LineGraphicsOptions,\r\n  PointGraphicsOptions,\r\n  ExcaliburGraphicsContextOptions,\r\n  DebugDraw,\r\n  HTMLImageSource\r\n} from './ExcaliburGraphicsContext';\r\nimport { Vector } from '../../Math/vector';\r\nimport { Color } from '../../Color';\r\nimport { StateStack } from './state-stack';\r\nimport { GraphicsDiagnostics } from '../GraphicsDiagnostics';\r\nimport { DebugText } from './debug-text';\r\n\r\nclass ExcaliburGraphicsContext2DCanvasDebug implements DebugDraw {\r\n  private _debugText = new DebugText();\r\n  constructor(private _ex: ExcaliburGraphicsContext2DCanvas) {}\r\n  /**\r\n   * Draw a debug rectangle to the context\r\n   * @param x\r\n   * @param y\r\n   * @param width\r\n   * @param height\r\n   */\r\n  drawRect(x: number, y: number, width: number, height: number): void {\r\n    this._ex.__ctx.save();\r\n    this._ex.__ctx.strokeStyle = 'red';\r\n    this._ex.__ctx.strokeRect(\r\n      this._ex.snapToPixel ? ~~x : x,\r\n      this._ex.snapToPixel ? ~~y : y,\r\n      this._ex.snapToPixel ? ~~width : width,\r\n      this._ex.snapToPixel ? ~~height : height\r\n    );\r\n    this._ex.__ctx.restore();\r\n  }\r\n\r\n  drawLine(start: Vector, end: Vector, lineOptions: LineGraphicsOptions = { color: Color.Black }): void {\r\n    this._ex.__ctx.save();\r\n    this._ex.__ctx.beginPath();\r\n    this._ex.__ctx.strokeStyle = lineOptions.color.toString();\r\n    this._ex.__ctx.moveTo(this._ex.snapToPixel ? ~~start.x : start.x, this._ex.snapToPixel ? ~~start.y : start.y);\r\n    this._ex.__ctx.lineTo(this._ex.snapToPixel ? ~~end.x : end.x, this._ex.snapToPixel ? ~~end.y : end.y);\r\n    this._ex.__ctx.lineWidth = 2;\r\n    this._ex.__ctx.stroke();\r\n    this._ex.__ctx.closePath();\r\n    this._ex.__ctx.restore();\r\n  }\r\n\r\n  drawPoint(point: Vector, pointOptions: PointGraphicsOptions = { color: Color.Black, size: 5 }): void {\r\n    this._ex.__ctx.save();\r\n    this._ex.__ctx.beginPath();\r\n    this._ex.__ctx.fillStyle = pointOptions.color.toString();\r\n    this._ex.__ctx.arc(\r\n      this._ex.snapToPixel ? ~~point.x : point.x,\r\n      this._ex.snapToPixel ? ~~point.y : point.y,\r\n      pointOptions.size,\r\n      0,\r\n      Math.PI * 2\r\n    );\r\n    this._ex.__ctx.fill();\r\n    this._ex.__ctx.closePath();\r\n    this._ex.__ctx.restore();\r\n  }\r\n\r\n  drawText(text: string, pos: Vector) {\r\n    this._debugText.write(this._ex, text, pos);\r\n  }\r\n}\r\n\r\nexport class ExcaliburGraphicsContext2DCanvas implements ExcaliburGraphicsContext {\r\n  /**\r\n   * Meant for internal use only. Access the internal context at your own risk and no guarantees this will exist in the future.\r\n   * @internal\r\n   */\r\n  public __ctx: CanvasRenderingContext2D;\r\n  public get width() {\r\n    return this.__ctx.canvas.width;\r\n  }\r\n\r\n  public get height() {\r\n    return this.__ctx.canvas.height;\r\n  }\r\n\r\n  public backgroundColor: Color = Color.ExcaliburBlue;\r\n\r\n  private _state = new StateStack();\r\n\r\n  public get opacity(): number {\r\n    return this._state.current.opacity;\r\n  }\r\n\r\n  public set opacity(value: number) {\r\n    this._state.current.opacity = value;\r\n  }\r\n\r\n  public snapToPixel: boolean = true;\r\n\r\n  public get smoothing(): boolean {\r\n    return this.__ctx.imageSmoothingEnabled;\r\n  }\r\n\r\n  public set smoothing(value: boolean) {\r\n    this.__ctx.imageSmoothingEnabled = value;\r\n  }\r\n\r\n  constructor(options: ExcaliburGraphicsContextOptions) {\r\n    const { canvasElement, enableTransparency, snapToPixel, smoothing, backgroundColor } = options;\r\n    this.__ctx = canvasElement.getContext('2d', {\r\n      alpha: enableTransparency ?? true\r\n    });\r\n    this.backgroundColor = backgroundColor ?? this.backgroundColor;\r\n    this.snapToPixel = snapToPixel ?? this.snapToPixel;\r\n    this.smoothing = smoothing ?? this.smoothing;\r\n  }\r\n\r\n  public resetTransform(): void {\r\n    this.__ctx.resetTransform();\r\n  }\r\n\r\n  public updateViewport(): void {\r\n    // pass\r\n  }\r\n\r\n  /**\r\n   * Draw an image to the Excalibur Graphics context at an x and y coordinate using the images width and height\r\n   */\r\n  drawImage(image: HTMLImageSource, x: number, y: number): void;\r\n  /**\r\n   *\r\n   * Draw an image to the Excalibur Graphics context at an x and y coordinate with a specific width and height\r\n   */\r\n  drawImage(image: HTMLImageSource, x: number, y: number, width: number, height: number): void;\r\n  /**\r\n   *\r\n   * Draw an image to the Excalibur Graphics context specifying the source image coordinates (sx, sy, swidth, sheight)\r\n   * and to a specific destination on the context (dx, dy, dwidth, dheight)\r\n   */\r\n  drawImage(\r\n    image: HTMLImageSource,\r\n    sx: number,\r\n    sy: number,\r\n    swidth?: number,\r\n    sheight?: number,\r\n    dx?: number,\r\n    dy?: number,\r\n    dwidth?: number,\r\n    dheight?: number\r\n  ): void;\r\n\r\n  drawImage(\r\n    image: HTMLImageSource,\r\n    sx: number,\r\n    sy: number,\r\n    swidth?: number,\r\n    sheight?: number,\r\n    dx?: number,\r\n    dy?: number,\r\n    dwidth?: number,\r\n    dheight?: number\r\n  ): void {\r\n    if (swidth === 0 || sheight === 0) {\r\n      return; // zero dimension dest exit early\r\n    } else if (dwidth === 0 || dheight === 0) {\r\n      return; // zero dimension dest exit early\r\n    } else if (image.width === 0 || image.height === 0) {\r\n      return; // zero dimension source exit early\r\n    }\r\n\r\n    this.__ctx.globalAlpha = this.opacity;\r\n    const args = [image, sx, sy, swidth, sheight, dx, dy, dwidth, dheight]\r\n      .filter((a) => a !== undefined)\r\n      .map((a) => (typeof a === 'number' && this.snapToPixel ? ~~a : a));\r\n    this.__ctx.drawImage.apply(this.__ctx, args);\r\n    GraphicsDiagnostics.DrawCallCount++;\r\n    GraphicsDiagnostics.DrawnImagesCount = 1;\r\n  }\r\n\r\n  public drawLine(start: Vector, end: Vector, color: Color, thickness = 1) {\r\n    this.__ctx.save();\r\n    this.__ctx.beginPath();\r\n    this.__ctx.strokeStyle = color.toString();\r\n    this.__ctx.moveTo(this.snapToPixel ? ~~start.x : start.x, this.snapToPixel ? ~~start.y : start.y);\r\n    this.__ctx.lineTo(this.snapToPixel ? ~~end.x : end.x, this.snapToPixel ? ~~end.y : end.y);\r\n    this.__ctx.lineWidth = thickness;\r\n    this.__ctx.stroke();\r\n    this.__ctx.closePath();\r\n    this.__ctx.restore();\r\n  }\r\n\r\n  public drawRectangle(pos: Vector, width: number, height: number, color: Color) {\r\n    this.__ctx.save();\r\n    this.__ctx.fillStyle = color.toString();\r\n    this.__ctx.fillRect(\r\n      this.snapToPixel ? ~~pos.x : pos.x,\r\n      this.snapToPixel ? ~~pos.y : pos.y,\r\n      this.snapToPixel ? ~~width : width,\r\n      this.snapToPixel ? ~~height : height\r\n    );\r\n    this.__ctx.restore();\r\n  }\r\n\r\n  public drawCircle(pos: Vector, radius: number, color: Color) {\r\n    this.__ctx.save();\r\n    this.__ctx.beginPath();\r\n    this.__ctx.fillStyle = color.toString();\r\n    this.__ctx.arc(this.snapToPixel ? ~~pos.x : pos.x, this.snapToPixel ? ~~pos.y : pos.y, radius, 0, Math.PI * 2);\r\n    this.__ctx.fill();\r\n    this.__ctx.closePath();\r\n    this.__ctx.restore();\r\n  }\r\n\r\n  debug = new ExcaliburGraphicsContext2DCanvasDebug(this);\r\n\r\n  /**\r\n   * Save the current state of the canvas to the stack (transforms and opacity)\r\n   */\r\n  save(): void {\r\n    this.__ctx.save();\r\n  }\r\n\r\n  /**\r\n   * Restore the state of the canvas from the stack\r\n   */\r\n  restore(): void {\r\n    this.__ctx.restore();\r\n  }\r\n\r\n  /**\r\n   * Translate the origin of the context by an x and y\r\n   * @param x\r\n   * @param y\r\n   */\r\n  translate(x: number, y: number): void {\r\n    this.__ctx.translate(this.snapToPixel ? ~~x : x, this.snapToPixel ? ~~y : y);\r\n  }\r\n\r\n  /**\r\n   * Rotate the context about the current origin\r\n   */\r\n  rotate(angle: number): void {\r\n    this.__ctx.rotate(angle);\r\n  }\r\n\r\n  /**\r\n   * Scale the context by an x and y factor\r\n   * @param x\r\n   * @param y\r\n   */\r\n  scale(x: number, y: number): void {\r\n    this.__ctx.scale(x, y);\r\n  }\r\n\r\n  clear(): void {\r\n    // Clear frame\r\n    this.__ctx.clearRect(0, 0, this.width, this.height);\r\n    this.__ctx.fillStyle = this.backgroundColor.toString();\r\n    this.__ctx.fillRect(0, 0, this.width, this.height);\r\n    GraphicsDiagnostics.clear();\r\n  }\r\n\r\n  /**\r\n   * Flushes the batched draw calls to the screen\r\n   */\r\n  flush(): void {\r\n    // pass\r\n  }\r\n}\r\n","import { Matrix } from '../../Math/matrix';\r\n\r\nexport class TransformStack {\r\n  private _transforms: Matrix[] = [];\r\n  private _currentTransform: Matrix = Matrix.identity();\r\n\r\n  public save(): void {\r\n    this._transforms.push(this._currentTransform);\r\n    this._currentTransform = this._currentTransform.clone();\r\n  }\r\n\r\n  public restore(): void {\r\n    this._currentTransform = this._transforms.pop();\r\n  }\r\n\r\n  public translate(x: number, y: number): Matrix {\r\n    return this._currentTransform.translate(x, y);\r\n  }\r\n\r\n  public rotate(angle: number): Matrix {\r\n    return this._currentTransform.rotate(angle);\r\n  }\r\n\r\n  public scale(x: number, y: number): Matrix {\r\n    return this._currentTransform.scale(x, y);\r\n  }\r\n\r\n  public set current(matrix: Matrix) {\r\n    this._currentTransform = matrix;\r\n  }\r\n\r\n  public get current(): Matrix {\r\n    return this._currentTransform;\r\n  }\r\n}\r\n","export interface VertexAttributeDefinition {\r\n  name: string;\r\n  size: number;\r\n  glType: number;\r\n  normalized: boolean;\r\n  location: number;\r\n}\r\n\r\nexport interface UniformDefinition {\r\n  name: string;\r\n  location: WebGLUniformLocation;\r\n  type: string;\r\n  data: any;\r\n}\r\n\r\n/**\r\n * Create a shader program for the Excalibur WebGL Graphics Context\r\n */\r\nexport class Shader {\r\n  public program: WebGLProgram | null = null;\r\n\r\n  public uniforms: { [variableName: string]: UniformDefinition } = {};\r\n  public attributes: { [variableName: string]: VertexAttributeDefinition } = {};\r\n  public layout: VertexAttributeDefinition[] = [];\r\n\r\n  /**\r\n   * Create a shader program in excalibur\r\n   * @param _gl WebGL graphics context\r\n   * @param _vertexSource Vertex shader source as a string\r\n   * @param _fragmentSource Fragment shader source as a string\r\n   */\r\n  constructor(private _gl: WebGLRenderingContext, private _vertexSource: string, private _fragmentSource: string) {\r\n    this.compile(_gl);\r\n  }\r\n\r\n  private _createProgram(gl: WebGLRenderingContext, vertexShader: WebGLShader, fragmentShader: WebGLShader): WebGLProgram {\r\n    const program = gl.createProgram();\r\n    if (program === null) {\r\n      throw Error('Could not create graphics shader program');\r\n    }\r\n\r\n    // attach the shaders.\r\n    gl.attachShader(program, vertexShader);\r\n    gl.attachShader(program, fragmentShader);\r\n\r\n    // link the program.\r\n    gl.linkProgram(program);\r\n\r\n    const success = gl.getProgramParameter(program, gl.LINK_STATUS);\r\n    if (!success) {\r\n      throw Error(`Could not link the program: [${gl.getProgramInfoLog(program)}]`);\r\n    }\r\n\r\n    return program;\r\n  }\r\n\r\n  private _compileShader(gl: WebGLRenderingContext, source: string, type: number): WebGLShader {\r\n    const shader = gl.createShader(type);\r\n    if (shader === null) {\r\n      throw Error(`Could not build shader: [${source}]`);\r\n    }\r\n\r\n    gl.shaderSource(shader, source);\r\n    gl.compileShader(shader);\r\n\r\n    const success = gl.getShaderParameter(shader, gl.COMPILE_STATUS);\r\n    if (!success) {\r\n      throw Error(`Could not compile shader [${gl.getShaderInfoLog(shader)}]`);\r\n    }\r\n    return shader;\r\n  }\r\n\r\n  /**\r\n   * Compile the current shader against a webgl context\r\n   * @param gl WebGL context\r\n   */\r\n  compile(gl: WebGLRenderingContext): WebGLProgram {\r\n    const vertexShader = this._compileShader(gl, this._vertexSource, gl.VERTEX_SHADER);\r\n    const fragmentShader = this._compileShader(gl, this._fragmentSource, gl.FRAGMENT_SHADER);\r\n    const program = this._createProgram(gl, vertexShader, fragmentShader);\r\n    return (this.program = program);\r\n  }\r\n\r\n  /**\r\n   * Add a uniform [[Matrix]] to the shader\r\n   * @param name Name of the uniform in the shader source\r\n   * @param data (4x4) matrix in column major order\r\n   */\r\n  public addUniformMatrix(name: string, data: Float32Array) {\r\n    if (!data) {\r\n      throw Error(`Shader Uniform Matrix '${name}' was set to null or undefined`);\r\n    }\r\n    const gl = this._gl;\r\n    this.uniforms[name] = {\r\n      name,\r\n      type: 'matrix',\r\n      location: gl.getUniformLocation(this.program, name),\r\n      data: data\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Add a uniform array of numbers to the shader\r\n   * @param name Name of the uniform in the shader source\r\n   * @param data List of numbers\r\n   */\r\n  public addUniformIntegerArray(name: string, data: number[]) {\r\n    if (!data) {\r\n      throw Error(`Shader Uniform Integery Array '${name}' was set to null or undefined`);\r\n    }\r\n    const gl = this._gl;\r\n    this.uniforms[name] = {\r\n      name,\r\n      type: 'numbers',\r\n      location: gl.getUniformLocation(this.program, name),\r\n      data: data\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Add attributes in the order they appear in the VBO\r\n   * @param name Name of the attribute in the shader source\r\n   * @param size The size of the attribute in gl.Type units, for example `vec2 a_pos` would be 2 gl.FLOAT\r\n   * @param glType The gl.Type of the attribute\r\n   */\r\n  public addAttribute(name: string, size: number, glType: number, normalized = false) {\r\n    const gl = this._gl;\r\n    // TODO needs to be compiled first\r\n    const location = gl.getAttribLocation(this.program, name);\r\n    this.attributes[name] = {\r\n      name,\r\n      size,\r\n      glType,\r\n      normalized,\r\n      location\r\n    };\r\n    this.layout.push(this.attributes[name]);\r\n  }\r\n\r\n  /**\r\n   * Number of javascript floats a vertex will take up\r\n   */\r\n  public get vertexAttributeSize(): number {\r\n    let vertexSize = 0;\r\n    for (const vert of this.layout) {\r\n      vertexSize += vert.size;\r\n    }\r\n    return vertexSize;\r\n  }\r\n\r\n  /**\r\n   * Total number of bytes that the vertex will take up\r\n   */\r\n  public get totalVertexSizeBytes(): number {\r\n    let vertexSize = 0;\r\n    for (const vert of this.layout) {\r\n      let typeSize = 1;\r\n      switch (vert.glType) {\r\n        case this._gl.FLOAT: {\r\n          typeSize = 4;\r\n          break;\r\n        }\r\n        default: {\r\n          typeSize = 1;\r\n        }\r\n      }\r\n      vertexSize += typeSize * vert.size;\r\n    }\r\n\r\n    return vertexSize;\r\n  }\r\n\r\n  /**\r\n   * Get a previously defined attribute size in bytes\r\n   * @param name\r\n   */\r\n  public getAttributeSize(name: string) {\r\n    let typeSize = 1;\r\n    switch (this.attributes[name].glType) {\r\n      case this._gl.FLOAT: {\r\n        typeSize = 4;\r\n        break;\r\n      }\r\n      default: {\r\n        typeSize = 1;\r\n      }\r\n    }\r\n    return typeSize * this.attributes[name].size;\r\n  }\r\n\r\n  /**\r\n   * Sets this shader program as the current in the underlying webgl context\r\n   *\r\n   * **Must** specify all attributes and uniforms before calling this\r\n   */\r\n  public use() {\r\n    const gl = this._gl;\r\n    gl.useProgram(this.program);\r\n    let offset = 0;\r\n    for (const vert of this.layout) {\r\n      gl.vertexAttribPointer(vert.location, vert.size, vert.glType, vert.normalized, this.totalVertexSizeBytes, offset);\r\n      gl.enableVertexAttribArray(vert.location);\r\n      offset += this.getAttributeSize(vert.name);\r\n    }\r\n\r\n    for (const key in this.uniforms) {\r\n      const uniform = this.uniforms[key];\r\n      switch (uniform.type) {\r\n        case 'matrix': {\r\n          gl.uniformMatrix4fv(uniform.location, false, uniform.data);\r\n          break;\r\n        }\r\n        case 'numbers': {\r\n          gl.uniform1iv(uniform.location, uniform.data);\r\n          break;\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { Pool, Poolable } from '../../Util/Pool';\r\n\r\nexport class BatchCommand<T> implements Poolable {\r\n  _pool: Pool<this> = undefined;\r\n  public commands: T[] = [];\r\n  constructor(public max: number) {}\r\n\r\n  isFull() {\r\n    if (this.commands.length >= this.max) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  canAdd() {\r\n    return !this.isFull();\r\n  }\r\n\r\n  add(cmd: T) {\r\n    this.commands.push(cmd);\r\n  }\r\n\r\n  dispose() {\r\n    this.commands.length = 0;\r\n    return this;\r\n  }\r\n}\r\n","import { Logger } from '..';\r\n\r\nexport interface Poolable {\r\n  /**\r\n   * Any type that is a member of a an object pool will have a reference to teh pool\r\n   * @internal\r\n   */\r\n  _pool?: Pool<this>;\r\n  dispose(): this;\r\n}\r\n\r\nexport class Pool<Type extends Poolable> {\r\n  public totalAllocations = 0;\r\n  public index = 0;\r\n  public objects: Type[] = [];\r\n  private _logger = Logger.getInstance();\r\n\r\n  constructor(\r\n    public builder: (...args: any[]) => Type,\r\n    public recycler: (instance: Type, ...args: any[]) => Type,\r\n    public maxObjects: number = 100\r\n  ) {}\r\n\r\n  /**\r\n   * Use many instances out of the in the context and return all to the pool.\r\n   *\r\n   * By returning values out of the contex they will be un-hooked from the pool and are free to be passed to consumers\r\n   * @param context\r\n   */\r\n  using(context: (pool: Pool<Type>) => Type[] | void) {\r\n    const result = context(this);\r\n    if (result) {\r\n      return this.done(...result);\r\n    }\r\n    return this.done();\r\n  }\r\n\r\n  /**\r\n   * Use a single instance out of th pool and immediately return it to the pool\r\n   * @param context\r\n   */\r\n  borrow(context: (object: Type) => void) {\r\n    const object = this.get();\r\n    context(object);\r\n    this.index--;\r\n  }\r\n\r\n  /**\r\n   * Retrieve a value from the pool, will allocate a new instance if necessary or recycle from the pool\r\n   * @param args\r\n   */\r\n  get(...args: any[]): Type {\r\n    if (this.index === this.maxObjects) {\r\n      // TODO implement hard or soft cap\r\n      this._logger.warn('Max pooled objects reached, possible memory leak? Doubling');\r\n      this.maxObjects = this.maxObjects * 2;\r\n      // throw new Error('Max pooled objects reached, possible memory leak?');\r\n    }\r\n\r\n    if (this.objects[this.index]) {\r\n      // Pool has an available object already constructed\r\n      return this.recycler(this.objects[this.index++], ...args);\r\n    } else {\r\n      // New allocation\r\n      this.totalAllocations++;\r\n      const object = (this.objects[this.index++] = this.builder(...args));\r\n      object._pool = this;\r\n      return object;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Signals we are done with the pool objects for now, Reclaims all objects in the pool.\r\n   *\r\n   * If a list of pooled objects is passed to done they are un-hooked from the pool and are free\r\n   * to be passed to consumers\r\n   * @param objects A list of object to separate from the pool\r\n   */\r\n  done(...objects: Type[]): Type[];\r\n  done(): void;\r\n  done(...objects: Type[]): Type[] | void {\r\n    // All objects in pool now considered \"free\"\r\n    this.index = 0;\r\n    for (const object of objects) {\r\n      const poolIndex = this.objects.indexOf(object);\r\n      // Build a new object to take the pool place\r\n      this.objects[poolIndex] = (this as any).builder(); // TODO problematic 0-arg only support\r\n      this.objects[poolIndex]._pool = this;\r\n      this.totalAllocations++;\r\n      // Unhook object from the pool\r\n      object._pool = undefined;\r\n    }\r\n    return objects;\r\n  }\r\n}\r\n","import { BatchCommand } from './batch';\r\nimport { Shader } from './shader';\r\n// import { Pool, Poolable } from './pool';\r\nimport { GraphicsDiagnostics } from '../GraphicsDiagnostics';\r\nimport { Pool, Poolable } from '../../Util/Pool';\r\n\r\nexport interface Renderer {\r\n  render(): void;\r\n}\r\n\r\nexport interface Ctor<T> {\r\n  new (): T;\r\n}\r\n\r\nexport interface BatchRendererOptions<T extends Poolable> {\r\n  gl: WebGLRenderingContext;\r\n  /**\r\n   * Draw command constructor\r\n   */\r\n  command: Ctor<T>;\r\n  /**\r\n   * Number of vertices that are generated per draw command\r\n   */\r\n  verticesPerCommand?: number;\r\n  /**\r\n   * Maximum commands to batch before drawing\r\n   */\r\n  maxCommandsPerBatch?: number;\r\n  /**\r\n   * Override the built in command batching mechanism\r\n   */\r\n  batchFactory?: () => BatchCommand<T>;\r\n}\r\n\r\nexport abstract class BatchRenderer<T extends Poolable> implements Renderer {\r\n  priority = 0;\r\n  private _gl: WebGLRenderingContext;\r\n  private _vertices: Float32Array;\r\n  private _verticesPerCommand: number;\r\n  private _buffer: WebGLBuffer | null = null;\r\n  private _maxCommandsPerBatch: number = 2000;\r\n\r\n  public shader: Shader;\r\n\r\n  public commands: Pool<T>;\r\n  private _batchPool: Pool<BatchCommand<T>>;\r\n  private _batches: BatchCommand<T>[] = [];\r\n  constructor(options: BatchRendererOptions<T>) {\r\n    this._gl = options.gl;\r\n    const command = options.command;\r\n    this._verticesPerCommand = options?.verticesPerCommand ?? 1;\r\n    this._maxCommandsPerBatch = options?.maxCommandsPerBatch ?? this._maxCommandsPerBatch;\r\n    const batchFactory = options?.batchFactory ?? (() => new BatchCommand<T>(this._maxCommandsPerBatch));\r\n\r\n    this.commands = new Pool<T>(\r\n      () => new command(),\r\n      (c) => c.dispose(),\r\n      this._maxCommandsPerBatch\r\n    );\r\n    this._batchPool = new Pool<BatchCommand<T>>(batchFactory, (b) => b.dispose(), 100);\r\n  }\r\n\r\n  /**\r\n   * Initialize render, builds shader and initialized webgl buffers\r\n   */\r\n  public init() {\r\n    const gl = this._gl;\r\n    this.shader = this.buildShader(gl);\r\n    // Initialize VBO\r\n    // https://groups.google.com/forum/#!topic/webgl-dev-list/vMNXSNRAg8M\r\n    this._vertices = new Float32Array(this.shader.vertexAttributeSize * this._verticesPerCommand * this._maxCommandsPerBatch);\r\n    this._buffer = gl.createBuffer();\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, this._buffer);\r\n    gl.bufferData(gl.ARRAY_BUFFER, this._vertices, gl.DYNAMIC_DRAW);\r\n  }\r\n\r\n  public get vertexSize(): number {\r\n    return this.shader.vertexAttributeSize;\r\n  }\r\n\r\n  public addCommand(cmd: T) {\r\n    if (this._batches.length === 0) {\r\n      this._batches.push(this._batchPool.get());\r\n    }\r\n\r\n    const lastBatch = this._batches[this._batches.length - 1];\r\n    if (lastBatch.canAdd()) {\r\n      lastBatch.add(cmd);\r\n    } else {\r\n      const newBatch = this._batchPool.get();\r\n      newBatch.add(cmd);\r\n      this._batches.push(newBatch);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Construct or return the Shader to be used in this batch renderer\r\n   * @param gl\r\n   */\r\n  abstract buildShader(gl: WebGLRenderingContext): Shader;\r\n\r\n  /**\r\n   * Implement populating the vertex buffer, return the number of vertices added to the buffer\r\n   * @param vertices\r\n   * @param batch\r\n   */\r\n  abstract buildBatchVertices(vertexBuffer: Float32Array, batch: BatchCommand<T>): number;\r\n\r\n  /**\r\n   * Implement gl draw call to render batch. The vertextBuffer from buildBatchVertices is already bound and the data has been updated.\r\n   */\r\n  abstract renderBatch(gl: WebGLRenderingContext, batch: BatchCommand<T>, vertexCount: number): void;\r\n\r\n  /**\r\n   * Build batch geometry, submit to the gpu, and issue draw command to underlying webgl\r\n   */\r\n  public render(): void {\r\n    const gl = this._gl;\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, this._buffer);\r\n    this.shader.use();\r\n    let drawCallCount = 0;\r\n    let drawnImagesCount = 0;\r\n    for (const batch of this._batches) {\r\n      // Build all geometry and ship to GPU\r\n      // interleave VBOs https://goharsha.com/lwjgl-tutorial-series/interleaving-buffer-objects/\r\n      const vertexCount = this.buildBatchVertices(this._vertices, batch);\r\n      gl.bufferSubData(gl.ARRAY_BUFFER, 0, this._vertices);\r\n\r\n      this.renderBatch(gl, batch, vertexCount);\r\n      drawnImagesCount += batch.commands.length;\r\n      drawCallCount++;\r\n    }\r\n    this.commands.done();\r\n    this._batchPool.done();\r\n    this._batches.length = 0;\r\n    GraphicsDiagnostics.DrawCallCount += drawCallCount;\r\n    GraphicsDiagnostics.DrawnImagesCount += drawnImagesCount;\r\n  }\r\n}\r\n","import { Vector } from '../../Math/vector';\r\nimport { Color } from '../../Color';\r\nimport { Shader } from './shader';\r\nimport lineVertexSource from './shaders/line-vertex.glsl';\r\nimport lineFragmentSource from './shaders/line-fragment.glsl';\r\nimport { BatchRenderer } from './renderer';\r\nimport { BatchCommand } from './batch';\r\nimport { WebGLGraphicsContextInfo } from './ExcaliburGraphicsContextWebGL';\r\nimport { Pool, Poolable } from '../../Util/Pool';\r\n\r\nexport class DrawLine implements Poolable {\r\n  _pool?: Pool<this>;\r\n  public color: Color = Color.Black;\r\n  public start: Vector = Vector.Zero;\r\n  public end: Vector = Vector.Zero;\r\n  public dispose() {\r\n    this.color.r = 0;\r\n    this.color.g = 0;\r\n    this.color.b = 0;\r\n    this.color.a = 1;\r\n    this.start.setTo(0, 0);\r\n    this.end.setTo(0, 0);\r\n    return this;\r\n  }\r\n}\r\n\r\nexport class LineRenderer extends BatchRenderer<DrawLine> {\r\n  constructor(gl: WebGLRenderingContext, private _contextInfo: WebGLGraphicsContextInfo) {\r\n    super({ gl, command: DrawLine, verticesPerCommand: 2 });\r\n    this.init();\r\n  }\r\n\r\n  buildShader(gl: WebGLRenderingContext) {\r\n    const shader = new Shader(gl, lineVertexSource, lineFragmentSource);\r\n\r\n    shader.addAttribute('a_position', 2, gl.FLOAT);\r\n    shader.addAttribute('a_color', 4, gl.FLOAT);\r\n    shader.addUniformMatrix('u_matrix', this._contextInfo.matrix.data);\r\n    return shader;\r\n  }\r\n\r\n  addLine(start: Vector, end: Vector, color: Color) {\r\n    const cmd = this.commands.get();\r\n    cmd.start = this._contextInfo.transform.current.multv(start);\r\n    cmd.end = this._contextInfo.transform.current.multv(end);\r\n    cmd.color.r = color.r;\r\n    cmd.color.g = color.g;\r\n    cmd.color.b = color.b;\r\n    cmd.color.a = cmd.color.a * this._contextInfo.state.current.opacity;\r\n    this.addCommand(cmd);\r\n  }\r\n\r\n  buildBatchVertices(vertexBuffer: Float32Array, batch: BatchCommand<DrawLine>): number {\r\n    let index = 0;\r\n    for (const command of batch.commands) {\r\n      // Start\r\n      vertexBuffer[index++] = command.start.x;\r\n      vertexBuffer[index++] = command.start.y;\r\n      vertexBuffer[index++] = command.color.r / 255;\r\n      vertexBuffer[index++] = command.color.g / 255;\r\n      vertexBuffer[index++] = command.color.b / 255;\r\n      vertexBuffer[index++] = command.color.a;\r\n\r\n      // End\r\n      vertexBuffer[index++] = command.end.x;\r\n      vertexBuffer[index++] = command.end.y;\r\n      vertexBuffer[index++] = command.color.r / 255;\r\n      vertexBuffer[index++] = command.color.g / 255;\r\n      vertexBuffer[index++] = command.color.b / 255;\r\n      vertexBuffer[index++] = command.color.a;\r\n    }\r\n    return index / this.vertexSize;\r\n  }\r\n\r\n  renderBatch(gl: WebGLRenderingContext, _batch: BatchCommand<DrawLine>, vertexCount: number) {\r\n    gl.drawArrays(gl.LINES, 0, vertexCount);\r\n  }\r\n}\r\n","export default \"attribute vec4 a_position;\\r\\nattribute vec4 a_color;\\r\\n\\r\\nvarying lowp vec4 v_color;\\r\\n\\r\\nuniform mat4 u_matrix;\\r\\n\\r\\n\\r\\nvoid main() {\\r\\n   // Set the vertex position using the ortho transform matrix\\r\\n   gl_Position = u_matrix * a_position;\\r\\n\\r\\n   // Passthrough the color\\r\\n   v_color = a_color;\\r\\n}\";","export default \"precision mediump float;\\r\\n\\r\\n// Color\\r\\nvarying lowp vec4 v_color;\\r\\n\\r\\n\\r\\nvoid main() {\\r\\n  gl_FragColor = v_color;\\r\\n}\";","import { Shader } from './shader';\r\nimport imageVertexSource from './shaders/image-vertex.glsl';\r\nimport imageFragmentSource from './shaders/image-fragment.glsl';\r\nimport { BatchCommand } from './batch';\r\nimport { DrawCommandType, DrawImageCommand } from './draw-image-command';\r\nimport { Graphic } from '../Graphic';\r\nimport { ensurePowerOfTwo } from './webgl-util';\r\nimport { BatchRenderer } from './renderer';\r\nimport { WebGLGraphicsContextInfo } from './ExcaliburGraphicsContextWebGL';\r\nimport { TextureLoader } from './texture-loader';\r\nimport { HTMLImageSource } from './ExcaliburGraphicsContext';\r\nimport { Color } from '../../Color';\r\nimport { Vector } from '../..';\r\n\r\nexport class BatchImage extends BatchCommand<DrawImageCommand> {\r\n  public textures: WebGLTexture[] = [];\r\n  public commands: DrawImageCommand[] = [];\r\n  private _graphicMap: { [id: string]: Graphic } = {};\r\n\r\n  constructor(public maxDraws: number, public maxTextures: number) {\r\n    super(maxDraws);\r\n  }\r\n\r\n  isFull() {\r\n    if (this.commands.length >= this.maxDraws) {\r\n      return true;\r\n    }\r\n    if (this.textures.length >= this.maxTextures) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  canAdd() {\r\n    if (this.commands.length >= this.maxDraws) {\r\n      return false;\r\n    }\r\n\r\n    if (this.textures.length < this.maxTextures) {\r\n      return true;\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  private _isCommandFull() {\r\n    return this.commands.length >= this.maxDraws;\r\n  }\r\n\r\n  private _isTextureFull() {\r\n    return this.textures.length >= this.maxTextures;\r\n  }\r\n\r\n  private _wouldAddTexture(command: DrawImageCommand) {\r\n    return !this._graphicMap[command.image.id];\r\n  }\r\n\r\n  maybeAdd(command: DrawImageCommand): boolean {\r\n    if ((this._isCommandFull() || this._isTextureFull()) && this._wouldAddTexture(command)) {\r\n      return false;\r\n    }\r\n\r\n    this.add(command);\r\n    return true;\r\n  }\r\n\r\n  add(command: DrawImageCommand) {\r\n    if (command.type === DrawCommandType.Image) {\r\n      const texture = TextureLoader.load(command.image);\r\n      if (this.textures.indexOf(texture) === -1) {\r\n        this.textures.push(texture);\r\n      }\r\n    }\r\n\r\n    this.commands.push(command);\r\n  }\r\n\r\n  bindTextures(gl: WebGLRenderingContext) {\r\n    // Bind textures in the correct order\r\n    for (let i = 0; i < this.maxTextures; i++) {\r\n      gl.activeTexture(gl.TEXTURE0 + i);\r\n      gl.bindTexture(gl.TEXTURE_2D, this.textures[i] || this.textures[0]);\r\n    }\r\n  }\r\n\r\n  getBatchTextureId(command: DrawImageCommand) {\r\n    if (command.image) {\r\n      return this.textures.indexOf(TextureLoader.get(command.image));\r\n    }\r\n    return -1;\r\n  }\r\n\r\n  dispose() {\r\n    this.clear();\r\n    return this;\r\n  }\r\n\r\n  clear() {\r\n    this.commands.length = 0;\r\n    this.textures.length = 0;\r\n    this._graphicMap = {};\r\n  }\r\n}\r\n\r\nexport class ImageRenderer extends BatchRenderer<DrawImageCommand> {\r\n  constructor(gl: WebGLRenderingContext, private _contextInfo: WebGLGraphicsContextInfo) {\r\n    super({\r\n      gl,\r\n      command: DrawImageCommand,\r\n      // 6 verts per quad\r\n      verticesPerCommand: 6,\r\n      maxCommandsPerBatch: 2000,\r\n      batchFactory: () => new BatchImage(2000, gl.getParameter(gl.MAX_TEXTURE_IMAGE_UNITS))\r\n    });\r\n    TextureLoader.registerContext(gl);\r\n    this.init();\r\n  }\r\n\r\n  buildShader(gl: WebGLRenderingContext): Shader {\r\n    // Initialilze default batch rendering shader\r\n    const maxGPUTextures = gl.getParameter(gl.MAX_TEXTURE_IMAGE_UNITS);\r\n    const shader = new Shader(gl, imageVertexSource, this._transformFragmentSource(imageFragmentSource, maxGPUTextures));\r\n    shader.addAttribute('a_position', 3, gl.FLOAT);\r\n    shader.addAttribute('a_texcoord', 2, gl.FLOAT);\r\n    shader.addAttribute('a_textureIndex', 1, gl.FLOAT);\r\n    shader.addAttribute('a_opacity', 1, gl.FLOAT);\r\n    shader.addAttribute('a_color', 4, gl.FLOAT);\r\n    shader.addUniformMatrix('u_matrix', this._contextInfo.matrix.data);\r\n    // Initialize texture slots to [0, 1, 2, 3, 4, .... maxGPUTextures]\r\n    shader.addUniformIntegerArray(\r\n      'u_textures',\r\n      [...Array(maxGPUTextures)].map((_, i) => i)\r\n    );\r\n    return shader;\r\n  }\r\n\r\n  private _transformFragmentSource(source: string, maxTextures: number): string {\r\n    let newSource = source.replace('%%count%%', maxTextures.toString());\r\n    let texturePickerBuilder = '';\r\n    for (let i = 0; i < maxTextures; i++) {\r\n      if (i === 0) {\r\n        texturePickerBuilder += `if (v_textureIndex <= ${i}.5) {\\n`;\r\n      } else {\r\n        texturePickerBuilder += `   else if (v_textureIndex <= ${i}.5) {\\n`;\r\n      }\r\n      texturePickerBuilder += `      color = texture2D(u_textures[${i}], v_texcoord);\\n`;\r\n      texturePickerBuilder += `   }\\n`;\r\n    }\r\n    newSource = newSource.replace('%%texture_picker%%', texturePickerBuilder);\r\n    return newSource;\r\n  }\r\n\r\n  public addCircle(pos: Vector, radius: number, color: Color) {\r\n    const command = this.commands.get().initCircle(pos, radius, color);\r\n    command.applyTransform(this._contextInfo.transform.current, this._contextInfo.state.current.opacity);\r\n    this.addCommand(command);\r\n  }\r\n\r\n  public addRectangle(color: Color, pos: Vector, width: number, height: number) {\r\n    const command = this.commands.get().initRect(color, pos, width, height);\r\n    command.applyTransform(this._contextInfo.transform.current, this._contextInfo.state.current.opacity);\r\n    this.addCommand(command);\r\n  }\r\n\r\n  public addLine(color: Color, start: Vector, end: Vector, thickness = 1) {\r\n    const command = this.commands.get().initLine(color, start, end, thickness);\r\n    command.applyTransform(this._contextInfo.transform.current, this._contextInfo.state.current.opacity);\r\n    this.addCommand(command);\r\n  }\r\n\r\n  public addImage(\r\n    graphic: HTMLImageSource,\r\n    sx: number,\r\n    sy: number,\r\n    swidth?: number,\r\n    sheight?: number,\r\n    dx?: number,\r\n    dy?: number,\r\n    dwidth?: number,\r\n    dheight?: number\r\n  ) {\r\n    const command = this.commands.get().init(graphic, sx, sy, swidth, sheight, dx, dy, dwidth, dheight);\r\n    command.applyTransform(this._contextInfo.transform.current, this._contextInfo.state.current.opacity);\r\n    this.addCommand(command);\r\n  }\r\n\r\n  public renderBatch(gl: WebGLRenderingContext, batch: BatchImage, vertexCount: number) {\r\n    // Bind textures in the correct order\r\n    batch.bindTextures(gl);\r\n    // draw the quads\r\n    gl.drawArrays(gl.TRIANGLES, 0, vertexCount);\r\n  }\r\n\r\n  buildBatchVertices(vertexBuffer: Float32Array, batch: BatchImage): number {\r\n    let vertIndex = 0;\r\n    let sx: number = 0;\r\n    let sy: number = 0;\r\n    let sw: number = 0;\r\n    let sh: number = 0;\r\n    let potWidth: number = 1;\r\n    let potHeight: number = 1;\r\n    let textureId = 0;\r\n    let commandColor = Color.Transparent;\r\n    for (const command of batch.commands) {\r\n      sx = command.view[0];\r\n      sy = command.view[1];\r\n      sw = command.view[2];\r\n      sh = command.view[3];\r\n\r\n      potWidth = ensurePowerOfTwo(command.image?.width || command.width);\r\n      potHeight = ensurePowerOfTwo(command.image?.height || command.height);\r\n\r\n      textureId = batch.getBatchTextureId(command);\r\n      if (command.type === DrawCommandType.Line || command.type === DrawCommandType.Rectangle) {\r\n        textureId = -1; // sentinel for no image rect\r\n        commandColor = command.color;\r\n      }\r\n      if (command.type === DrawCommandType.Circle) {\r\n        textureId = -2; // sentinel for circle\r\n        commandColor = command.color;\r\n      }\r\n\r\n      // potential optimization when divding by 2 (bitshift)\r\n      // Modifying the images to poweroftwo images warp the UV coordinates\r\n      let uvx0 = sx / potWidth;\r\n      let uvy0 = sy / potHeight;\r\n      let uvx1 = (sx + sw) / potWidth;\r\n      let uvy1 = (sy + sh) / potHeight;\r\n      if (textureId === -2) {\r\n        uvx0 = 0;\r\n        uvy0 = 0;\r\n        uvx1 = 1;\r\n        uvy1 = 1;\r\n      }\r\n\r\n      // Quad update\r\n      // (0, 0, z) z-index doesn't work in batch rendering between batches\r\n      vertexBuffer[vertIndex++] = command.geometry[0][0]; // x + 0 * width;\r\n      vertexBuffer[vertIndex++] = command.geometry[0][1]; //y + 0 * height;\r\n      vertexBuffer[vertIndex++] = 0;\r\n\r\n      // UV coords\r\n      vertexBuffer[vertIndex++] = uvx0; // 0;\r\n      vertexBuffer[vertIndex++] = uvy0; // 0;\r\n      // texture id\r\n      vertexBuffer[vertIndex++] = textureId;\r\n      // opacity\r\n      vertexBuffer[vertIndex++] = command.opacity;\r\n      // color\r\n      vertexBuffer[vertIndex++] = commandColor.r / 255;\r\n      vertexBuffer[vertIndex++] = commandColor.g / 255;\r\n      vertexBuffer[vertIndex++] = commandColor.b / 255;\r\n      vertexBuffer[vertIndex++] = commandColor.a;\r\n\r\n      // (0, 1)\r\n      vertexBuffer[vertIndex++] = command.geometry[1][0]; // x + 0 * width;\r\n      vertexBuffer[vertIndex++] = command.geometry[1][1]; // y + 1 * height;\r\n      vertexBuffer[vertIndex++] = 0;\r\n\r\n      // UV coords\r\n      vertexBuffer[vertIndex++] = uvx0; // 0;\r\n      vertexBuffer[vertIndex++] = uvy1; // 1;\r\n      // texture id\r\n      vertexBuffer[vertIndex++] = textureId;\r\n      // opacity\r\n      vertexBuffer[vertIndex++] = command.opacity;\r\n      // color\r\n      vertexBuffer[vertIndex++] = commandColor.r / 255;\r\n      vertexBuffer[vertIndex++] = commandColor.g / 255;\r\n      vertexBuffer[vertIndex++] = commandColor.b / 255;\r\n      vertexBuffer[vertIndex++] = commandColor.a;\r\n\r\n      // (1, 0)\r\n      vertexBuffer[vertIndex++] = command.geometry[2][0]; // x + 1 * width;\r\n      vertexBuffer[vertIndex++] = command.geometry[2][1]; // y + 0 * height;\r\n      vertexBuffer[vertIndex++] = 0;\r\n\r\n      // UV coords\r\n      vertexBuffer[vertIndex++] = uvx1; //1;\r\n      vertexBuffer[vertIndex++] = uvy0; //0;\r\n      // texture id\r\n      vertexBuffer[vertIndex++] = textureId;\r\n      // opacity\r\n      vertexBuffer[vertIndex++] = command.opacity;\r\n      // color\r\n      vertexBuffer[vertIndex++] = commandColor.r / 255;\r\n      vertexBuffer[vertIndex++] = commandColor.g / 255;\r\n      vertexBuffer[vertIndex++] = commandColor.b / 255;\r\n      vertexBuffer[vertIndex++] = commandColor.a;\r\n\r\n      // (1, 0)\r\n      vertexBuffer[vertIndex++] = command.geometry[3][0]; // x + 1 * width;\r\n      vertexBuffer[vertIndex++] = command.geometry[3][1]; // y + 0 * height;\r\n      vertexBuffer[vertIndex++] = 0;\r\n\r\n      // UV coords\r\n      vertexBuffer[vertIndex++] = uvx1; //1;\r\n      vertexBuffer[vertIndex++] = uvy0; //0;\r\n      // texture id\r\n      vertexBuffer[vertIndex++] = textureId;\r\n      // opacity\r\n      vertexBuffer[vertIndex++] = command.opacity;\r\n      // color\r\n      vertexBuffer[vertIndex++] = commandColor.r / 255;\r\n      vertexBuffer[vertIndex++] = commandColor.g / 255;\r\n      vertexBuffer[vertIndex++] = commandColor.b / 255;\r\n      vertexBuffer[vertIndex++] = commandColor.a;\r\n\r\n      // (0, 1)\r\n      vertexBuffer[vertIndex++] = command.geometry[4][0]; // x + 0 * width;\r\n      vertexBuffer[vertIndex++] = command.geometry[4][1]; // y + 1 * height\r\n      vertexBuffer[vertIndex++] = 0;\r\n\r\n      // UV coords\r\n      vertexBuffer[vertIndex++] = uvx0; // 0;\r\n      vertexBuffer[vertIndex++] = uvy1; // 1;\r\n      // texture id\r\n      vertexBuffer[vertIndex++] = textureId;\r\n      // opacity\r\n      vertexBuffer[vertIndex++] = command.opacity;\r\n      // color\r\n      vertexBuffer[vertIndex++] = commandColor.r / 255;\r\n      vertexBuffer[vertIndex++] = commandColor.g / 255;\r\n      vertexBuffer[vertIndex++] = commandColor.b / 255;\r\n      vertexBuffer[vertIndex++] = commandColor.a;\r\n\r\n      // (1, 1)\r\n      vertexBuffer[vertIndex++] = command.geometry[5][0]; // x + 1 * width;\r\n      vertexBuffer[vertIndex++] = command.geometry[5][1]; // y + 1 * height;\r\n      vertexBuffer[vertIndex++] = 0;\r\n\r\n      // UV coords\r\n      vertexBuffer[vertIndex++] = uvx1; // 1;\r\n      vertexBuffer[vertIndex++] = uvy1; // 1;\r\n      // texture id\r\n      vertexBuffer[vertIndex++] = textureId;\r\n      // opacity\r\n      vertexBuffer[vertIndex++] = command.opacity;\r\n      // color\r\n      vertexBuffer[vertIndex++] = commandColor.r / 255;\r\n      vertexBuffer[vertIndex++] = commandColor.g / 255;\r\n      vertexBuffer[vertIndex++] = commandColor.b / 255;\r\n      vertexBuffer[vertIndex++] = commandColor.a;\r\n    }\r\n\r\n    return vertIndex / this.vertexSize;\r\n  }\r\n}\r\n","export default \"attribute vec4 a_position;\\r\\n\\r\\n// Opacity \\r\\nattribute float a_opacity;\\r\\nvarying float v_opacity;\\r\\n\\r\\nattribute vec4 a_color;\\r\\nvarying vec4 v_color;\\r\\n\\r\\n// UV coordinate\\r\\nattribute vec2 a_texcoord;\\r\\nvarying vec2 v_texcoord;\\r\\n\\r\\n// Texture number\\r\\nattribute lowp float a_textureIndex;\\r\\nvarying lowp float v_textureIndex;\\r\\n\\r\\nuniform mat4 u_matrix;\\r\\n\\r\\n\\r\\nvoid main() {\\r\\n   // Set the vertex position using the ortho transform matrix\\r\\n   gl_Position = u_matrix * a_position;\\r\\n\\r\\n   // Pass through the Opacity to the fragment shader\\r\\n   v_opacity = a_opacity;\\r\\n   // Pass through the UV coord to the fragment shader\\r\\n   v_texcoord = a_texcoord;\\r\\n   // Pass through the texture number to the fragment shader\\r\\n   v_textureIndex = a_textureIndex;\\r\\n   // Pass through the color to the fragment shader\\r\\n   v_color = a_color;\\r\\n}\";","export default \"#ifdef GL_OES_standard_derivatives\\r\\n#extension GL_OES_standard_derivatives : enable\\r\\n#endif\\r\\nprecision mediump float;\\r\\n\\r\\n// UV coord\\r\\nvarying vec2 v_texcoord;\\r\\n\\r\\n// Texture index\\r\\nvarying lowp float v_textureIndex;\\r\\n\\r\\n// Color coord to blend with image\\r\\nvarying lowp vec4 v_color;\\r\\n\\r\\n// Opacity\\r\\nvarying float v_opacity;\\r\\n\\r\\nuniform sampler2D u_textures[%%count%%];\\r\\n\\r\\nfloat circle(in vec2 st, in float radius) {\\r\\n  vec2 dist = st - vec2(0.5);\\r\\n  float r = dot(dist, dist) * 4.0;\\r\\n  float delta = fwidth(r);\\r\\n  return 1.0 - smoothstep(radius - delta, radius + delta, r);\\r\\n}\\r\\n\\r\\nvoid main() {\\r\\n  float r = 0.0, delta = 0.0, alpha = 1.0;\\r\\n   // In order to support the most efficient sprite batching, we have multiple\\r\\n   // textures loaded into the gpu (usually 8) this picker logic skips over textures\\r\\n   // that do not apply to a particular sprite.\\r\\n\\r\\n   vec4 color;\\r\\n   // -1 If there is no texture to sample we are drawing a solid geometry (rectangles)\\r\\n   if (v_textureIndex == -1.0) {\\r\\n     color = v_color;\\r\\n     color.w = color.w * v_opacity;\\r\\n   // -2 If there is no texture we are drawing a circle\\r\\n   } else if (v_textureIndex == -2.0) {\\r\\n     color = v_color;\\r\\n     color.a = color.a * circle(v_texcoord, .95);\\r\\n   } else {\\r\\n     // GLSL is templated out to pick the right texture and set the vec4 color\\r\\n      %%texture_picker%%\\r\\n   }\\r\\n   color.w = color.w * v_opacity;\\r\\n   gl_FragColor = color;\\r\\n}\";","import { Shader } from './shader';\nimport pointVertexSource from './shaders/point-vertex.glsl';\nimport pointFragmentSource from './shaders/point-fragment.glsl';\nimport { Vector } from '../../Math/vector';\nimport { Color } from '../../Color';\nimport { BatchRenderer } from './renderer';\nimport { BatchCommand } from './batch';\nimport { WebGLGraphicsContextInfo } from './ExcaliburGraphicsContextWebGL';\nimport { Pool, Poolable } from '../../Util/Pool';\n// import { Random } from '../../Math/Index';\n\nexport class DrawPoint implements Poolable {\n  _pool?: Pool<this>;\n  public point: Vector = Vector.Zero;\n  public color: Color = Color.Black;\n  public size: number = 1;\n  public dispose() {\n    this.point.setTo(0, 0);\n    this.color.r = 0;\n    this.color.g = 0;\n    this.color.b = 0;\n    this.color.a = 1;\n    this.size = 1;\n    return this;\n  }\n}\n\nexport class PointRenderer extends BatchRenderer<DrawPoint> {\n  constructor(gl: WebGLRenderingContext, private _contextInfo: WebGLGraphicsContextInfo) {\n    super({ gl, command: DrawPoint, verticesPerCommand: 1 });\n    this.init();\n  }\n\n  buildShader(gl: WebGLRenderingContext): Shader {\n    gl.getExtension('OES_standard_derivatives');\n    const shader = new Shader(gl, pointVertexSource, pointFragmentSource);\n    shader.addAttribute('a_position', 2, gl.FLOAT);\n    shader.addAttribute('a_color', 4, gl.FLOAT);\n    shader.addAttribute('a_size', 1, gl.FLOAT);\n    shader.addUniformMatrix('u_matrix', this._contextInfo.matrix.data);\n    return shader;\n  }\n\n  addPoint(point: Vector, color: Color, size: number) {\n    const cmd = this.commands.get();\n    cmd.point = this._contextInfo.transform.current.multv(point);\n    cmd.color.r = color.r;\n    cmd.color.g = color.g;\n    cmd.color.b = color.b;\n    cmd.color.a = color.a * this._contextInfo.state.current.opacity;\n    cmd.size = size * Math.max(this._contextInfo.transform.current.getScaleX(), this._contextInfo.transform.current.getScaleY());\n    this.addCommand(cmd);\n  }\n\n  buildBatchVertices(vertexBuffer: Float32Array, batch: BatchCommand<DrawPoint>): number {\n    let index = 0;\n    for (const command of batch.commands) {\n      vertexBuffer[index++] = command.point.x;\n      vertexBuffer[index++] = command.point.y;\n      // normalize to [0, 1] for webgl\n      vertexBuffer[index++] = command.color.r / 255;\n      vertexBuffer[index++] = command.color.g / 255;\n      vertexBuffer[index++] = command.color.b / 255;\n      vertexBuffer[index++] = command.color.a;\n\n      vertexBuffer[index++] = command.size;\n    }\n    return index / this.vertexSize;\n  }\n\n  renderBatch(gl: WebGLRenderingContext, _batch: BatchCommand<DrawPoint>, vertexCount: number): void {\n    gl.drawArrays(gl.POINTS, 0, vertexCount);\n  }\n}\n","export default \"attribute vec4 a_position;\\r\\nattribute vec4 a_color;\\r\\nattribute float a_size;\\r\\nvarying lowp vec4 v_color;\\r\\nuniform mat4 u_matrix;\\r\\n\\r\\nvoid main() {\\r\\n  gl_Position = u_matrix * a_position;\\r\\n  gl_PointSize = a_size * 2.0;\\r\\n  v_color = a_color;\\r\\n}\";","export default \"#ifdef GL_OES_standard_derivatives\\r\\n#extension GL_OES_standard_derivatives : enable\\r\\n#endif\\r\\n\\r\\nprecision mediump float;\\r\\nvarying lowp vec4 v_color;\\r\\n\\r\\nvoid main() {\\r\\n  float r = 0.0, delta = 0.0, alpha = 1.0;\\r\\n  vec2 cxy = 2.0 * gl_PointCoord - 1.0;\\r\\n  r = dot(cxy, cxy);\\r\\n  \\r\\n#ifdef GL_OES_standard_derivatives\\r\\n  delta = fwidth(r);\\r\\n  alpha = 1.0 - smoothstep(1.0 - delta, 1.0 + delta, r);\\r\\n#else\\r\\n  if (r > 1.0) {\\r\\n    discard;\\r\\n  }\\r\\n#endif\\r\\n  gl_FragColor = vec4(v_color.rgb, v_color.a * alpha);\\r\\n}\";","import {\r\n  ExcaliburGraphicsContext,\r\n  LineGraphicsOptions,\r\n  RectGraphicsOptions,\r\n  PointGraphicsOptions,\r\n  ExcaliburGraphicsContextOptions,\r\n  DebugDraw,\r\n  HTMLImageSource\r\n} from './ExcaliburGraphicsContext';\r\n\r\nimport { Matrix } from '../../Math/matrix';\r\nimport { TransformStack } from './transform-stack';\r\nimport { Vector, vec } from '../../Math/vector';\r\nimport { Color } from '../../Color';\r\nimport { StateStack } from './state-stack';\r\nimport { Logger } from '../../Util/Log';\r\nimport { LineRenderer } from './line-renderer';\r\nimport { ImageRenderer } from './image-renderer';\r\nimport { PointRenderer } from './point-renderer';\r\nimport { Canvas } from '../Canvas';\r\nimport { GraphicsDiagnostics } from '../GraphicsDiagnostics';\r\nimport { DebugText } from './debug-text';\r\n\r\nclass ExcaliburGraphicsContextWebGLDebug implements DebugDraw {\r\n  private _debugText = new DebugText();\r\n  constructor(private _webglCtx: ExcaliburGraphicsContextWebGL) {}\r\n\r\n  /**\r\n   * Draw a debugging rectangle to the context\r\n   * @param x\r\n   * @param y\r\n   * @param width\r\n   * @param height\r\n   */\r\n  drawRect(x: number, y: number, width: number, height: number, rectOptions: RectGraphicsOptions = { color: Color.Black }): void {\r\n    this.drawLine(vec(x, y), vec(x + width, y), { ...rectOptions });\r\n    this.drawLine(vec(x + width, y), vec(x + width, y + height), { ...rectOptions });\r\n    this.drawLine(vec(x + width, y + height), vec(x, y + height), { ...rectOptions });\r\n    this.drawLine(vec(x, y + height), vec(x, y), { ...rectOptions });\r\n  }\r\n\r\n  /**\r\n   * Draw a debugging line to the context\r\n   * @param start\r\n   * @param end\r\n   * @param lineOptions\r\n   */\r\n  drawLine(start: Vector, end: Vector, lineOptions: LineGraphicsOptions = { color: Color.Black }): void {\r\n    this._webglCtx.__lineRenderer.addLine(start, end, lineOptions.color);\r\n  }\r\n\r\n  /**\r\n   * Draw a debugging point to the context\r\n   * @param point\r\n   * @param pointOptions\r\n   */\r\n  drawPoint(point: Vector, pointOptions: PointGraphicsOptions = { color: Color.Black, size: 5 }): void {\r\n    this._webglCtx.__pointRenderer.addPoint(point, pointOptions.color, pointOptions.size);\r\n  }\r\n\r\n  drawText(text: string, pos: Vector) {\r\n    this._debugText.write(this._webglCtx, text, pos);\r\n  }\r\n}\r\n\r\nexport interface WebGLGraphicsContextInfo {\r\n  transform: TransformStack;\r\n  state: StateStack;\r\n  matrix: Matrix;\r\n}\r\n\r\nexport class ExcaliburGraphicsContextWebGL implements ExcaliburGraphicsContext {\r\n  /**\r\n   * Meant for internal use only. Access the internal context at your own risk and no guarantees this will exist in the future.\r\n   * @internal\r\n   */\r\n  public __gl: WebGLRenderingContext;\r\n\r\n  /**\r\n   * Holds the 2d context shim\r\n   */\r\n  private _canvas: Canvas; // Configure z for shim?\r\n  /**\r\n   * Meant for internal use only. Access the internal context at your own risk and no guarantees this will exist in the future.\r\n   * @internal\r\n   */\r\n  public __ctx: CanvasRenderingContext2D;\r\n\r\n  private _transform = new TransformStack();\r\n  private _state = new StateStack();\r\n  private _ortho!: Matrix;\r\n\r\n  /**\r\n   * Meant for internal use only. Access the internal context at your own risk and no guarantees this will exist in the future.\r\n   * @internal\r\n   */\r\n  public __pointRenderer: PointRenderer;\r\n\r\n  /**\r\n   * Meant for internal use only. Access the internal context at your own risk and no guarantees this will exist in the future.\r\n   * @internal\r\n   */\r\n  public __lineRenderer: LineRenderer;\r\n\r\n  /**\r\n   * Meant for internal use only. Access the internal context at your own risk and no guarantees this will exist in the future.\r\n   * @internal\r\n   */\r\n  public __imageRenderer: ImageRenderer;\r\n\r\n  public snapToPixel: boolean = true;\r\n\r\n  public smoothing: boolean = false;\r\n\r\n  public backgroundColor: Color = Color.ExcaliburBlue;\r\n\r\n  public get opacity(): number {\r\n    return this._state.current.opacity;\r\n  }\r\n\r\n  public set opacity(value: number) {\r\n    this._state.current.opacity = value;\r\n  }\r\n\r\n  public get width() {\r\n    return this.__gl.canvas.width;\r\n  }\r\n\r\n  public get height() {\r\n    return this.__gl.canvas.height;\r\n  }\r\n\r\n  constructor(options: ExcaliburGraphicsContextOptions) {\r\n    const { canvasElement, enableTransparency, smoothing, snapToPixel, backgroundColor } = options;\r\n    this.__gl = canvasElement.getContext('webgl', {\r\n      antialias: smoothing ?? this.smoothing,\r\n      premultipliedAlpha: false,\r\n      alpha: enableTransparency ?? true,\r\n      depth: true,\r\n      powerPreference: 'high-performance'\r\n    });\r\n    this.snapToPixel = snapToPixel ?? this.snapToPixel;\r\n    this.smoothing = smoothing ?? this.smoothing;\r\n    this.backgroundColor = backgroundColor ?? this.backgroundColor;\r\n    this._init();\r\n  }\r\n\r\n  private _init() {\r\n    const gl = this.__gl;\r\n    // Setup viewport and view matrix\r\n    this._ortho = Matrix.ortho(0, gl.canvas.width, gl.canvas.height, 0, 400, -400);\r\n    gl.viewport(0, 0, gl.canvas.width, gl.canvas.height);\r\n\r\n    // Clear background\r\n    gl.clearColor(this.backgroundColor.r / 255, this.backgroundColor.g / 255, this.backgroundColor.b / 255, this.backgroundColor.a);\r\n    gl.clear(gl.COLOR_BUFFER_BIT);\r\n\r\n    // Enable alpha blending\r\n    gl.enable(gl.BLEND);\r\n    gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);\r\n\r\n    this.__pointRenderer = new PointRenderer(gl, { matrix: this._ortho, transform: this._transform, state: this._state });\r\n    this.__lineRenderer = new LineRenderer(gl, { matrix: this._ortho, transform: this._transform, state: this._state });\r\n    this.__imageRenderer = new ImageRenderer(gl, { matrix: this._ortho, transform: this._transform, state: this._state });\r\n\r\n    // 2D ctx shim\r\n    this._canvas = new Canvas({\r\n      width: gl.canvas.width,\r\n      height: gl.canvas.height\r\n    });\r\n    this.__ctx = this._canvas.ctx;\r\n  }\r\n\r\n  public resetTransform(): void {\r\n    this._transform.current = Matrix.identity();\r\n  }\r\n\r\n  public updateViewport(): void {\r\n    const gl = this.__gl;\r\n    this._ortho = this._ortho = Matrix.ortho(0, gl.canvas.width, gl.canvas.height, 0, 400, -400);\r\n    this.__pointRenderer.shader.addUniformMatrix('u_matrix', this._ortho.data);\r\n    this.__lineRenderer.shader.addUniformMatrix('u_matrix', this._ortho.data);\r\n    this.__imageRenderer.shader.addUniformMatrix('u_matrix', this._ortho.data);\r\n\r\n    // 2D ctx shim\r\n    this._canvas.width = gl.canvas.width;\r\n    this._canvas.height = gl.canvas.height;\r\n  }\r\n\r\n  drawImage(image: HTMLImageSource, x: number, y: number): void;\r\n  drawImage(image: HTMLImageSource, x: number, y: number, width: number, height: number): void;\r\n  drawImage(\r\n    image: HTMLImageSource,\r\n    sx: number,\r\n    sy: number,\r\n    swidth?: number,\r\n    sheight?: number,\r\n    dx?: number,\r\n    dy?: number,\r\n    dwidth?: number,\r\n    dheight?: number\r\n  ): void;\r\n  drawImage(\r\n    image: HTMLImageSource,\r\n    sx: number,\r\n    sy: number,\r\n    swidth?: number,\r\n    sheight?: number,\r\n    dx?: number,\r\n    dy?: number,\r\n    dwidth?: number,\r\n    dheight?: number\r\n  ): void {\r\n    if (swidth === 0 || sheight === 0) {\r\n      return; // zero dimension dest exit early\r\n    } else if (dwidth === 0 || dheight === 0) {\r\n      return; // zero dimension dest exit early\r\n    } else if (image.width === 0 || image.height === 0) {\r\n      return; // zero dimension source exit early\r\n    }\r\n\r\n    if (!image) {\r\n      Logger.getInstance().warn('Cannot draw a null or undefined image');\r\n      // tslint:disable-next-line: no-console\r\n      if (console.trace) {\r\n        // tslint:disable-next-line: no-console\r\n        console.trace();\r\n      }\r\n      return;\r\n    }\r\n    this.__imageRenderer.addImage(image, sx, sy, swidth, sheight, dx, dy, dwidth, dheight);\r\n  }\r\n\r\n  public drawLine(start: Vector, end: Vector, color: Color, thickness = 1) {\r\n    this.__imageRenderer.addLine(color, start, end, thickness);\r\n  }\r\n\r\n  public drawRectangle(pos: Vector, width: number, height: number, color: Color) {\r\n    this.__imageRenderer.addRectangle(color, pos, width, height);\r\n  }\r\n\r\n  public drawCircle(pos: Vector, radius: number, color: Color) {\r\n    this.__imageRenderer.addCircle(pos, radius, color);\r\n  }\r\n\r\n  debug = new ExcaliburGraphicsContextWebGLDebug(this);\r\n\r\n  public save(): void {\r\n    this._transform.save();\r\n    this._state.save();\r\n  }\r\n\r\n  public restore(): void {\r\n    this._transform.restore();\r\n    this._state.restore();\r\n  }\r\n\r\n  public translate(x: number, y: number): void {\r\n    this._transform.translate(this.snapToPixel ? ~~x : x, this.snapToPixel ? ~~y : y);\r\n  }\r\n\r\n  public rotate(angle: number): void {\r\n    this._transform.rotate(angle);\r\n  }\r\n\r\n  public scale(x: number, y: number): void {\r\n    this._transform.scale(x, y);\r\n  }\r\n\r\n  public transform(matrix: Matrix) {\r\n    this._transform.current = matrix;\r\n  }\r\n\r\n  clear() {\r\n    const gl = this.__gl;\r\n    gl.clearColor(this.backgroundColor.r / 255, this.backgroundColor.g / 255, this.backgroundColor.b / 255, this.backgroundColor.a);\r\n    // Clear the context with the newly set color. This is\r\n    // the function call that actually does the drawing.\r\n    gl.clear(gl.COLOR_BUFFER_BIT);\r\n    GraphicsDiagnostics.clear();\r\n  }\r\n\r\n  /**\r\n   * Flushes all batched rendering to the screen\r\n   */\r\n  flush() {\r\n    const gl = this.__gl;\r\n    gl.viewport(0, 0, gl.canvas.width, gl.canvas.height);\r\n\r\n    this.__imageRenderer.render();\r\n    this.__lineRenderer.render();\r\n    this.__pointRenderer.render();\r\n  }\r\n}\r\n","import { EX_VERSION } from './';\r\nimport { Flags, Legacy } from './Flags';\r\nimport { polyfill } from './Polyfill';\r\npolyfill();\r\nimport { CanUpdate, CanDraw, CanInitialize } from './Interfaces/LifecycleEvents';\r\nimport { Loadable } from './Interfaces/Loadable';\r\nimport { Vector } from './Math/vector';\r\nimport { Screen, DisplayMode, AbsolutePosition, ScreenDimension, Resolution } from './Screen';\r\nimport { ScreenElement } from './ScreenElement';\r\nimport { Actor } from './Actor';\r\nimport { Timer } from './Timer';\r\nimport { TileMap } from './TileMap';\r\nimport { Animation } from './Drawing/Animation';\r\nimport { Loader } from './Loader';\r\nimport { Detector } from './Util/Detector';\r\nimport {\r\n  VisibleEvent,\r\n  HiddenEvent,\r\n  GameStartEvent,\r\n  GameStopEvent,\r\n  PreUpdateEvent,\r\n  PostUpdateEvent,\r\n  PreFrameEvent,\r\n  PostFrameEvent,\r\n  GameEvent,\r\n  DeactivateEvent,\r\n  ActivateEvent,\r\n  PreDrawEvent,\r\n  PostDrawEvent,\r\n  InitializeEvent\r\n} from './Events';\r\nimport { Logger, LogLevel } from './Util/Log';\r\nimport { Color } from './Color';\r\nimport { Scene } from './Scene';\r\nimport { Entity } from './EntityComponentSystem/Entity';\r\nimport { PostProcessor } from './PostProcessing/PostProcessor';\r\nimport { Debug, DebugStats } from './Debug/Debug';\r\nimport { Class } from './Class';\r\nimport * as Input from './Input/Index';\r\nimport * as Events from './Events';\r\nimport { BrowserEvents } from './Util/Browser';\r\nimport { obsolete } from './Util/Decorators';\r\nimport { ExcaliburGraphicsContext, ExcaliburGraphicsContext2DCanvas, ExcaliburGraphicsContextWebGL } from './Graphics';\r\n\r\n/**\r\n * Enum representing the different mousewheel event bubble prevention\r\n */\r\nexport enum ScrollPreventionMode {\r\n  /**\r\n   * Do not prevent any page scrolling\r\n   */\r\n  None,\r\n  /**\r\n   * Prevent page scroll if mouse is over the game canvas\r\n   */\r\n  Canvas,\r\n  /**\r\n   * Prevent all page scrolling via mouse wheel\r\n   */\r\n  All\r\n}\r\n\r\n/**\r\n * Defines the available options to configure the Excalibur engine at constructor time.\r\n */\r\nexport interface EngineOptions {\r\n  /**\r\n   * Optionally configure the width of the viewport in css pixels\r\n   */\r\n  width?: number;\r\n\r\n  /**\r\n   * Optionally configure the height of the viewport in css pixels\r\n   */\r\n  height?: number;\r\n\r\n  /**\r\n   * Optionally configure the width & height of the viewport in css pixels.\r\n   * Use `viewport` instead of [[EngineOptions.width]] and [[EngineOptions.height]], or vice versa.\r\n   */\r\n  viewport?: ScreenDimension;\r\n\r\n  /**\r\n   * Optionally specify the size the logical pixel resolution, if not specified it will be width x height.\r\n   * See [[Resolution]] for common presets.\r\n   */\r\n  resolution?: ScreenDimension;\r\n\r\n  /**\r\n   * Optionally specify antialiasing (smoothing), by default true (smooth pixels)\r\n   */\r\n  antialiasing?: boolean;\r\n\r\n  /**\r\n   * Optionally configure the native canvas transparent backdrop\r\n   */\r\n  enableCanvasTransparency?: boolean;\r\n\r\n  /**\r\n   * Optionally specify the target canvas DOM element to render the game in\r\n   */\r\n  canvasElementId?: string;\r\n\r\n  /**\r\n   * Optionally specify the target canvas DOM element directly\r\n   */\r\n  canvasElement?: HTMLCanvasElement;\r\n\r\n  /**\r\n   * Optionally snap drawings to nearest pixel\r\n   */\r\n  snapToPixel?: boolean;\r\n\r\n  /**\r\n   * The [[DisplayMode]] of the game, by default [[DisplayMode.FitScreen]] with aspect ratio 4:3 (800x600).\r\n   * Depending on this value, [[width]] and [[height]] may be ignored.\r\n   */\r\n  displayMode?: DisplayMode;\r\n\r\n  /**\r\n   * Configures the pointer scope. Pointers scoped to the 'Canvas' can only fire events within the canvas viewport; whereas, 'Document'\r\n   * (default) scoped will fire anywhere on the page.\r\n   */\r\n  pointerScope?: Input.PointerScope;\r\n\r\n  /**\r\n   * Suppress boot up console message, which contains the \"powered by Excalibur message\"\r\n   */\r\n  suppressConsoleBootMessage?: boolean;\r\n\r\n  /**\r\n   * Suppress minimum browser feature detection, it is not recommended users of excalibur switch this off. This feature ensures that\r\n   * the currently running browser meets the minimum requirements for running excalibur. This can be useful if running on non-standard\r\n   * browsers or if there is a bug in excalibur preventing execution.\r\n   */\r\n  suppressMinimumBrowserFeatureDetection?: boolean;\r\n\r\n  /**\r\n   * Suppress HiDPI auto detection and scaling, it is not recommended users of excalibur switch off this feature. This feature detects\r\n   * and scales the drawing canvas appropriately to accommodate HiDPI screens.\r\n   */\r\n  suppressHiDPIScaling?: boolean;\r\n\r\n  /**\r\n   * Suppress play button, it is not recommended users of excalibur switch this feature. Some browsers require a user gesture (like a click)\r\n   * for certain browser features to work like web audio.\r\n   */\r\n  suppressPlayButton?: boolean;\r\n\r\n  /**\r\n   * Specify how the game window is to be positioned when the [[DisplayMode.Position]] is chosen. This option MUST be specified\r\n   * if the DisplayMode is set as [[DisplayMode.Position]]. The position can be either a string or an [[AbsolutePosition]].\r\n   * String must be in the format of css style background-position. The vertical position must precede the horizontal position in strings.\r\n   *\r\n   * Valid String examples: \"top left\", \"top\", \"bottom\", \"middle\", \"middle center\", \"bottom right\"\r\n   * Valid [[AbsolutePosition]] examples: `{top: 5, right: 10%}`, `{bottom: 49em, left: 10px}`, `{left: 10, bottom: 40}`\r\n   */\r\n  position?: string | AbsolutePosition;\r\n\r\n  /**\r\n   * Scroll prevention method.\r\n   */\r\n  scrollPreventionMode?: ScrollPreventionMode;\r\n\r\n  /**\r\n   * Optionally set the background color\r\n   */\r\n  backgroundColor?: Color;\r\n}\r\n\r\n/**\r\n * The Excalibur Engine\r\n *\r\n * The [[Engine]] is the main driver for a game. It is responsible for\r\n * starting/stopping the game, maintaining state, transmitting events,\r\n * loading resources, and managing the scene.\r\n */\r\nexport class Engine extends Class implements CanInitialize, CanUpdate, CanDraw {\r\n  /**\r\n   *\r\n   */\r\n  public browser: BrowserEvents;\r\n\r\n  /**\r\n   * Screen abstraction\r\n   */\r\n  public screen: Screen;\r\n\r\n  /**\r\n   * Direct access to the engine's canvas element\r\n   */\r\n  public canvas: HTMLCanvasElement;\r\n\r\n  /**\r\n   * Direct access to the engine's 2D rendering context\r\n   */\r\n  public ctx: CanvasRenderingContext2D;\r\n\r\n  public graphicsContext: ExcaliburGraphicsContext;\r\n\r\n  /**\r\n   * Direct access to the canvas element ID, if an ID exists\r\n   */\r\n  public canvasElementId: string;\r\n\r\n  /**\r\n   * The width of the game canvas in pixels (physical width component of the\r\n   * resolution of the canvas element)\r\n   */\r\n  public get canvasWidth(): number {\r\n    return this.screen.canvasWidth;\r\n  }\r\n\r\n  /**\r\n   * Returns half width of the game canvas in pixels (half physical width component)\r\n   */\r\n  public get halfCanvasWidth(): number {\r\n    return this.screen.halfCanvasWidth;\r\n  }\r\n\r\n  /**\r\n   * The height of the game canvas in pixels, (physical height component of\r\n   * the resolution of the canvas element)\r\n   */\r\n  public get canvasHeight(): number {\r\n    return this.screen.canvasHeight;\r\n  }\r\n\r\n  /**\r\n   * Returns half height of the game canvas in pixels (half physical height component)\r\n   */\r\n  public get halfCanvasHeight(): number {\r\n    return this.screen.halfCanvasHeight;\r\n  }\r\n\r\n  /**\r\n   * Returns the width of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\r\n   */\r\n  public get drawWidth(): number {\r\n    return this.screen.drawWidth;\r\n  }\r\n\r\n  /**\r\n   * Returns half the width of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\r\n   */\r\n  public get halfDrawWidth(): number {\r\n    return this.screen.halfDrawWidth;\r\n  }\r\n\r\n  /**\r\n   * Returns the height of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\r\n   */\r\n  public get drawHeight(): number {\r\n    return this.screen.drawHeight;\r\n  }\r\n\r\n  /**\r\n   * Returns half the height of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\r\n   */\r\n  public get halfDrawHeight(): number {\r\n    return this.screen.halfDrawHeight;\r\n  }\r\n\r\n  /**\r\n   * Returns whether excalibur detects the current screen to be HiDPI\r\n   */\r\n  public get isHiDpi(): boolean {\r\n    return this.screen.isHiDpi;\r\n  }\r\n\r\n  /**\r\n   * Access engine input like pointer, keyboard, or gamepad\r\n   */\r\n  public input: Input.EngineInput;\r\n\r\n  private _hasStarted: boolean = false;\r\n\r\n  /**\r\n   * Access Excalibur debugging functionality.\r\n   */\r\n  public debug: Debug;\r\n\r\n  /**\r\n   * Access [[stats]] that holds frame statistics.\r\n   */\r\n  public get stats(): DebugStats {\r\n    return this.debug.stats;\r\n  }\r\n\r\n  /**\r\n   * Gets or sets the list of post processors to apply at the end of drawing a frame (such as [[ColorBlindCorrector]])\r\n   */\r\n  public postProcessors: PostProcessor[] = [];\r\n\r\n  /**\r\n   * The current [[Scene]] being drawn and updated on screen\r\n   */\r\n  public currentScene: Scene;\r\n\r\n  /**\r\n   * The default [[Scene]] of the game, use [[Engine.goToScene]] to transition to different scenes.\r\n   */\r\n  public readonly rootScene: Scene;\r\n\r\n  /**\r\n   * Contains all the scenes currently registered with Excalibur\r\n   */\r\n  public readonly scenes: { [key: string]: Scene } = {};\r\n\r\n  /**\r\n   * @hidden\r\n   * @deprecated\r\n   */\r\n  private _animations: AnimationNode[] = [];\r\n\r\n  /**\r\n   * Indicates whether the engine is set to fullscreen or not\r\n   */\r\n  public get isFullscreen(): boolean {\r\n    return this.screen.isFullScreen;\r\n  }\r\n\r\n  /**\r\n   * Indicates the current [[DisplayMode]] of the engine.\r\n   */\r\n  public get displayMode(): DisplayMode {\r\n    return this.screen.displayMode;\r\n  }\r\n\r\n  private _suppressPlayButton: boolean = false;\r\n  /**\r\n   * Returns the calculated pixel ration for use in rendering\r\n   */\r\n  public get pixelRatio(): number {\r\n    return this.screen.pixelRatio;\r\n  }\r\n\r\n  /**\r\n   * Indicates the current position of the engine. Valid only when DisplayMode is DisplayMode.Position\r\n   */\r\n  public position: string | AbsolutePosition;\r\n  /**\r\n   * Indicates whether audio should be paused when the game is no longer visible.\r\n   */\r\n  public pauseAudioWhenHidden: boolean = true;\r\n\r\n  /**\r\n   * Indicates whether the engine should draw with debug information\r\n   */\r\n  private _isDebug: boolean = false;\r\n  public get isDebug(): boolean {\r\n    return this._isDebug;\r\n  }\r\n  public debugColor: Color = new Color(255, 255, 255);\r\n  /**\r\n   * Sets the background color for the engine.\r\n   */\r\n  public backgroundColor: Color;\r\n\r\n  /**\r\n   * Sets the Transparency for the engine.\r\n   */\r\n  public enableCanvasTransparency: boolean = true;\r\n\r\n  /**\r\n   * The action to take when a fatal exception is thrown\r\n   */\r\n  public onFatalException = (e: any) => {\r\n    Logger.getInstance().fatal(e);\r\n  };\r\n\r\n  /**\r\n   * The mouse wheel scroll prevention mode\r\n   */\r\n  public pageScrollPreventionMode: ScrollPreventionMode;\r\n\r\n  private _logger: Logger;\r\n\r\n  // this is a reference to the current requestAnimationFrame return value\r\n  private _requestId: number;\r\n\r\n  // this determines whether excalibur is compatible with your browser\r\n  private _compatible: boolean;\r\n\r\n  private _timescale: number = 1.0;\r\n\r\n  // loading\r\n  private _loader: Loader;\r\n  private _isLoading: boolean = false;\r\n\r\n  private _isInitialized: boolean = false;\r\n\r\n  private _deferredGoTo: string = null;\r\n\r\n  public on(eventName: Events.initialize, handler: (event: Events.InitializeEvent<Engine>) => void): void;\r\n  public on(eventName: Events.visible, handler: (event: VisibleEvent) => void): void;\r\n  public on(eventName: Events.hidden, handler: (event: HiddenEvent) => void): void;\r\n  public on(eventName: Events.start, handler: (event: GameStartEvent) => void): void;\r\n  public on(eventName: Events.stop, handler: (event: GameStopEvent) => void): void;\r\n  public on(eventName: Events.preupdate, handler: (event: PreUpdateEvent<Engine>) => void): void;\r\n  public on(eventName: Events.postupdate, handler: (event: PostUpdateEvent<Engine>) => void): void;\r\n  public on(eventName: Events.preframe, handler: (event: PreFrameEvent) => void): void;\r\n  public on(eventName: Events.postframe, handler: (event: PostFrameEvent) => void): void;\r\n  public on(eventName: Events.predraw, handler: (event: PreDrawEvent) => void): void;\r\n  public on(eventName: Events.postdraw, handler: (event: PostDrawEvent) => void): void;\r\n  public on(eventName: string, handler: (event: GameEvent<any>) => void): void;\r\n  public on(eventName: string, handler: (event: any) => void): void {\r\n    super.on(eventName, handler);\r\n  }\r\n\r\n  public once(eventName: Events.initialize, handler: (event: Events.InitializeEvent<Engine>) => void): void;\r\n  public once(eventName: Events.visible, handler: (event: VisibleEvent) => void): void;\r\n  public once(eventName: Events.hidden, handler: (event: HiddenEvent) => void): void;\r\n  public once(eventName: Events.start, handler: (event: GameStartEvent) => void): void;\r\n  public once(eventName: Events.stop, handler: (event: GameStopEvent) => void): void;\r\n  public once(eventName: Events.preupdate, handler: (event: PreUpdateEvent<Engine>) => void): void;\r\n  public once(eventName: Events.postupdate, handler: (event: PostUpdateEvent<Engine>) => void): void;\r\n  public once(eventName: Events.preframe, handler: (event: PreFrameEvent) => void): void;\r\n  public once(eventName: Events.postframe, handler: (event: PostFrameEvent) => void): void;\r\n  public once(eventName: Events.predraw, handler: (event: PreDrawEvent) => void): void;\r\n  public once(eventName: Events.postdraw, handler: (event: PostDrawEvent) => void): void;\r\n  public once(eventName: string, handler: (event: GameEvent<any>) => void): void;\r\n  public once(eventName: string, handler: (event: any) => void): void {\r\n    super.once(eventName, handler);\r\n  }\r\n\r\n  public off(eventName: Events.initialize, handler?: (event: Events.InitializeEvent<Engine>) => void): void;\r\n  public off(eventName: Events.visible, handler?: (event: VisibleEvent) => void): void;\r\n  public off(eventName: Events.hidden, handler?: (event: HiddenEvent) => void): void;\r\n  public off(eventName: Events.start, handler?: (event: GameStartEvent) => void): void;\r\n  public off(eventName: Events.stop, handler?: (event: GameStopEvent) => void): void;\r\n  public off(eventName: Events.preupdate, handler?: (event: PreUpdateEvent<Engine>) => void): void;\r\n  public off(eventName: Events.postupdate, handler?: (event: PostUpdateEvent<Engine>) => void): void;\r\n  public off(eventName: Events.preframe, handler?: (event: PreFrameEvent) => void): void;\r\n  public off(eventName: Events.postframe, handler?: (event: PostFrameEvent) => void): void;\r\n  public off(eventName: Events.predraw, handler?: (event: PreDrawEvent) => void): void;\r\n  public off(eventName: Events.postdraw, handler?: (event: PostDrawEvent) => void): void;\r\n  public off(eventName: string, handler?: (event: GameEvent<any>) => void): void;\r\n  public off(eventName: string, handler?: (event: any) => void): void {\r\n    super.off(eventName, handler);\r\n  }\r\n\r\n  /**\r\n   * Default [[EngineOptions]]\r\n   */\r\n  private static _DEFAULT_ENGINE_OPTIONS: EngineOptions = {\r\n    width: 0,\r\n    height: 0,\r\n    enableCanvasTransparency: true,\r\n    canvasElementId: '',\r\n    canvasElement: undefined,\r\n    snapToPixel: false,\r\n    pointerScope: Input.PointerScope.Canvas,\r\n    suppressConsoleBootMessage: null,\r\n    suppressMinimumBrowserFeatureDetection: null,\r\n    suppressHiDPIScaling: null,\r\n    suppressPlayButton: null,\r\n    scrollPreventionMode: ScrollPreventionMode.Canvas,\r\n    backgroundColor: Color.fromHex('#2185d0') // Excalibur blue\r\n  };\r\n\r\n  /**\r\n   * Creates a new game using the given [[EngineOptions]]. By default, if no options are provided,\r\n   * the game will be rendered full screen (taking up all available browser window space).\r\n   * You can customize the game rendering through [[EngineOptions]].\r\n   *\r\n   * Example:\r\n   *\r\n   * ```js\r\n   * var game = new ex.Engine({\r\n   *   width: 0, // the width of the canvas\r\n   *   height: 0, // the height of the canvas\r\n   *   enableCanvasTransparency: true, // the transparencySection of the canvas\r\n   *   canvasElementId: '', // the DOM canvas element ID, if you are providing your own\r\n   *   displayMode: ex.DisplayMode.FullScreen, // the display mode\r\n   *   pointerScope: ex.Input.PointerScope.Document, // the scope of capturing pointer (mouse/touch) events\r\n   *   backgroundColor: ex.Color.fromHex('#2185d0') // background color of the engine\r\n   * });\r\n   *\r\n   * // call game.start, which is a Promise\r\n   * game.start().then(function () {\r\n   *   // ready, set, go!\r\n   * });\r\n   * ```\r\n   */\r\n  constructor(options?: EngineOptions) {\r\n    super();\r\n\r\n    options = { ...Engine._DEFAULT_ENGINE_OPTIONS, ...options };\r\n\r\n    Flags.freeze();\r\n\r\n    // Initialize browser events facade\r\n    this.browser = new BrowserEvents(window, document);\r\n\r\n    // Check compatibility\r\n    const detector = new Detector();\r\n    if (!options.suppressMinimumBrowserFeatureDetection && !(this._compatible = detector.test())) {\r\n      const message = document.createElement('div');\r\n      message.innerText = 'Sorry, your browser does not support all the features needed for Excalibur';\r\n      document.body.appendChild(message);\r\n\r\n      detector.failedTests.forEach(function (test) {\r\n        const testMessage = document.createElement('div');\r\n        testMessage.innerText = 'Browser feature missing ' + test;\r\n        document.body.appendChild(testMessage);\r\n      });\r\n\r\n      if (options.canvasElementId) {\r\n        const canvas = document.getElementById(options.canvasElementId);\r\n        if (canvas) {\r\n          canvas.parentElement.removeChild(canvas);\r\n        }\r\n      }\r\n\r\n      return;\r\n    } else {\r\n      this._compatible = true;\r\n    }\r\n\r\n    // Use native console API for color fun\r\n    // eslint-disable-next-line no-console\r\n    if (console.log && !options.suppressConsoleBootMessage) {\r\n      // eslint-disable-next-line no-console\r\n      console.log(\r\n        `%cPowered by Excalibur.js (v${EX_VERSION})`,\r\n        'background: #176BAA; color: white; border-radius: 5px; padding: 15px; font-size: 1.5em; line-height: 80px;'\r\n      );\r\n      // eslint-disable-next-line no-console\r\n      console.log('\\n\\\r\n      /| ________________\\n\\\r\nO|===|* >________________>\\n\\\r\n      \\\\|');\r\n      // eslint-disable-next-line no-console\r\n      console.log('Visit', 'http://excaliburjs.com', 'for more information');\r\n    }\r\n\r\n    // Suppress play button\r\n    if (options.suppressPlayButton) {\r\n      this._suppressPlayButton = true;\r\n    }\r\n\r\n    this._logger = Logger.getInstance();\r\n\r\n    // If debug is enabled, let's log browser features to the console.\r\n    if (this._logger.defaultLevel === LogLevel.Debug) {\r\n      detector.logBrowserFeatures();\r\n    }\r\n\r\n    this._logger.debug('Building engine...');\r\n\r\n    this.canvasElementId = options.canvasElementId;\r\n\r\n    if (options.canvasElementId) {\r\n      this._logger.debug('Using Canvas element specified: ' + options.canvasElementId);\r\n      this.canvas = <HTMLCanvasElement>document.getElementById(options.canvasElementId);\r\n    } else if (options.canvasElement) {\r\n      this._logger.debug('Using Canvas element specified:', options.canvasElement);\r\n      this.canvas = options.canvasElement;\r\n    } else {\r\n      this._logger.debug('Using generated canvas element');\r\n      this.canvas = <HTMLCanvasElement>document.createElement('canvas');\r\n    }\r\n\r\n    let displayMode = options.displayMode ?? DisplayMode.Fixed;\r\n    if ((options.width && options.height) || options.viewport) {\r\n      if (options.displayMode === undefined) {\r\n        displayMode = DisplayMode.Fixed;\r\n      }\r\n      this._logger.debug('Engine viewport is size ' + options.width + ' x ' + options.height);\r\n    } else if (!options.displayMode) {\r\n      this._logger.debug('Engine viewport is fit');\r\n      displayMode = DisplayMode.FitScreen;\r\n    }\r\n\r\n    if (Flags.isEnabled(Legacy.Canvas)) {\r\n      const ex2dCtx = new ExcaliburGraphicsContext2DCanvas({\r\n        canvasElement: this.canvas,\r\n        enableTransparency: this.enableCanvasTransparency,\r\n        smoothing: options.antialiasing,\r\n        backgroundColor: options.backgroundColor,\r\n        snapToPixel: options.snapToPixel\r\n      });\r\n      this.graphicsContext = ex2dCtx;\r\n      this.ctx = ex2dCtx.__ctx;\r\n    } else {\r\n      const exWebglCtx = new ExcaliburGraphicsContextWebGL({\r\n        canvasElement: this.canvas,\r\n        enableTransparency: this.enableCanvasTransparency,\r\n        smoothing: options.antialiasing,\r\n        backgroundColor: options.backgroundColor,\r\n        snapToPixel: options.snapToPixel\r\n      });\r\n      this.graphicsContext = exWebglCtx;\r\n      this.ctx = exWebglCtx.__ctx;\r\n    }\r\n\r\n    this.screen = new Screen({\r\n      canvas: this.canvas,\r\n      context: this.graphicsContext,\r\n      antialiasing: options.antialiasing ?? true,\r\n      browser: this.browser,\r\n      viewport: options.viewport ?? (options.width && options.height ? { width: options.width, height: options.height } : Resolution.SVGA),\r\n      resolution: options.resolution,\r\n      displayMode,\r\n      position: options.position,\r\n      pixelRatio: options.suppressHiDPIScaling ? 1 : null\r\n    });\r\n\r\n    this.screen.applyResolutionAndViewport();\r\n\r\n    if (options.backgroundColor) {\r\n      this.backgroundColor = options.backgroundColor.clone();\r\n    }\r\n\r\n    this.enableCanvasTransparency = options.enableCanvasTransparency;\r\n\r\n    this._loader = new Loader();\r\n    this.debug = new Debug(this);\r\n\r\n    this._initialize(options);\r\n\r\n    this.rootScene = this.currentScene = new Scene();\r\n\r\n    this.addScene('root', this.rootScene);\r\n  }\r\n\r\n  /**\r\n   * Returns a BoundingBox of the top left corner of the screen\r\n   * and the bottom right corner of the screen.\r\n   */\r\n  public getWorldBounds() {\r\n    return this.screen.getWorldBounds();\r\n  }\r\n\r\n  /**\r\n   * Gets the current engine timescale factor (default is 1.0 which is 1:1 time)\r\n   */\r\n  public get timescale() {\r\n    return this._timescale;\r\n  }\r\n\r\n  /**\r\n   * Sets the current engine timescale factor. Useful for creating slow-motion effects or fast-forward effects\r\n   * when using time-based movement.\r\n   */\r\n  public set timescale(value: number) {\r\n    if (value <= 0) {\r\n      Logger.getInstance().error('Cannot set engine.timescale to a value of 0 or less than 0.');\r\n      return;\r\n    }\r\n\r\n    this._timescale = value;\r\n  }\r\n\r\n  /**\r\n   * Plays a sprite animation on the screen at the specified `x` and `y`\r\n   * (in game coordinates, not screen pixels). These animations play\r\n   * independent of actors, and will be cleaned up internally as soon\r\n   * as they are complete. Note animations that loop will never be\r\n   * cleaned up.\r\n   *\r\n   * @param animation  Animation to play\r\n   * @param x          x game coordinate to play the animation\r\n   * @param y          y game coordinate to play the animation\r\n   * @deprecated\r\n   */\r\n  @obsolete({ message: 'Will be removed in excalibur v0.26.0', alternateMethod: 'Use Actor.graphics' })\r\n  public playAnimation(animation: Animation, x: number, y: number) {\r\n    this._animations.push(new AnimationNode(animation, x, y));\r\n  }\r\n\r\n  /**\r\n   * Adds a [[TileMap]] to the [[currentScene]], once this is done the TileMap\r\n   * will be drawn and updated.\r\n   */\r\n  public addTileMap(tileMap: TileMap) {\r\n    this.currentScene.addTileMap(tileMap);\r\n  }\r\n\r\n  /**\r\n   * Removes a [[TileMap]] from the [[currentScene]], it will no longer be drawn or updated.\r\n   */\r\n  public removeTileMap(tileMap: TileMap) {\r\n    this.currentScene.removeTileMap(tileMap);\r\n  }\r\n\r\n  /**\r\n   * Adds a [[Timer]] to the [[currentScene]].\r\n   * @param timer  The timer to add to the [[currentScene]].\r\n   */\r\n  public addTimer(timer: Timer): Timer {\r\n    return this.currentScene.addTimer(timer);\r\n  }\r\n\r\n  /**\r\n   * Removes a [[Timer]] from the [[currentScene]].\r\n   * @param timer  The timer to remove to the [[currentScene]].\r\n   */\r\n  public removeTimer(timer: Timer): Timer {\r\n    return this.currentScene.removeTimer(timer);\r\n  }\r\n\r\n  /**\r\n   * Adds a [[Scene]] to the engine, think of scenes in Excalibur as you\r\n   * would levels or menus.\r\n   *\r\n   * @param key  The name of the scene, must be unique\r\n   * @param scene The scene to add to the engine\r\n   */\r\n  public addScene(key: string, scene: Scene) {\r\n    if (this.scenes[key]) {\r\n      this._logger.warn('Scene', key, 'already exists overwriting');\r\n    }\r\n    this.scenes[key] = scene;\r\n  }\r\n\r\n  /**\r\n   * Removes a [[Scene]] instance from the engine\r\n   * @param scene  The scene to remove\r\n   */\r\n  public removeScene(scene: Scene): void;\r\n  /**\r\n   * Removes a scene from the engine by key\r\n   * @param key  The scene key to remove\r\n   */\r\n  public removeScene(key: string): void;\r\n  /**\r\n   * @internal\r\n   */\r\n  public removeScene(entity: any): void {\r\n    if (entity instanceof Scene) {\r\n      // remove scene\r\n      for (const key in this.scenes) {\r\n        if (this.scenes.hasOwnProperty(key)) {\r\n          if (this.scenes[key] === entity) {\r\n            delete this.scenes[key];\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    if (typeof entity === 'string') {\r\n      // remove scene\r\n      delete this.scenes[entity];\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Adds a [[Scene]] to the engine, think of scenes in Excalibur as you\r\n   * would levels or menus.\r\n   * @param sceneKey  The key of the scene, must be unique\r\n   * @param scene     The scene to add to the engine\r\n   */\r\n  public add(sceneKey: string, scene: Scene): void;\r\n  /**\r\n   * Adds a [[Timer]] to the [[currentScene]].\r\n   * @param timer  The timer to add to the [[currentScene]].\r\n   */\r\n  public add(timer: Timer): void;\r\n  /**\r\n   * Adds a [[TileMap]] to the [[currentScene]], once this is done the TileMap\r\n   * will be drawn and updated.\r\n   */\r\n  public add(tileMap: TileMap): void;\r\n  /**\r\n   * Adds an actor to the [[currentScene]] of the game. This is synonymous\r\n   * to calling `engine.currentScene.add(actor)`.\r\n   *\r\n   * Actors can only be drawn if they are a member of a scene, and only\r\n   * the [[currentScene]] may be drawn or updated.\r\n   *\r\n   * @param actor  The actor to add to the [[currentScene]]\r\n   */\r\n  public add(actor: Actor): void;\r\n\r\n  /**\r\n   * Adds a [[ScreenElement]] to the [[currentScene]] of the game,\r\n   * ScreenElements do not participate in collisions, instead the\r\n   * remain in the same place on the screen.\r\n   * @param screenElement  The ScreenElement to add to the [[currentScene]]\r\n   */\r\n  public add(screenElement: ScreenElement): void;\r\n  public add(entity: any): void {\r\n    if (arguments.length === 2) {\r\n      this.addScene(<string>arguments[0], <Scene>arguments[1]);\r\n      return;\r\n    }\r\n    if (this._deferredGoTo && this.scenes[this._deferredGoTo]) {\r\n      this.scenes[this._deferredGoTo].add(entity);\r\n    } else {\r\n      this.currentScene.add(entity);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Removes a scene instance from the engine\r\n   * @param scene  The scene to remove\r\n   */\r\n  public remove(scene: Scene): void;\r\n  /**\r\n   * Removes a scene from the engine by key\r\n   * @param sceneKey  The scene to remove\r\n   */\r\n  public remove(sceneKey: string): void;\r\n  /**\r\n   * Removes a [[Timer]] from the [[currentScene]].\r\n   * @param timer  The timer to remove to the [[currentScene]].\r\n   */\r\n  public remove(timer: Timer): void;\r\n  /**\r\n   * Removes a [[TileMap]] from the [[currentScene]], it will no longer be drawn or updated.\r\n   */\r\n  public remove(tileMap: TileMap): void;\r\n  /**\r\n   * Removes an actor from the [[currentScene]] of the game. This is synonymous\r\n   * to calling `engine.currentScene.removeChild(actor)`.\r\n   * Actors that are removed from a scene will no longer be drawn or updated.\r\n   *\r\n   * @param actor  The actor to remove from the [[currentScene]].\r\n   */\r\n  public remove(actor: Actor): void;\r\n  /**\r\n   * Removes a [[ScreenElement]] to the scene, it will no longer be drawn or updated\r\n   * @param screenElement  The ScreenElement to remove from the [[currentScene]]\r\n   */\r\n  public remove(screenElement: ScreenElement): void;\r\n  public remove(entity: any): void {\r\n    if (entity instanceof Entity) {\r\n      this.currentScene.remove(entity);\r\n    }\r\n\r\n    if (entity instanceof Scene) {\r\n      this.removeScene(entity);\r\n    }\r\n\r\n    if (typeof entity === 'string') {\r\n      this.removeScene(entity);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Changes the currently updating and drawing scene to a different,\r\n   * named scene. Calls the [[Scene]] lifecycle events.\r\n   * @param key  The key of the scene to transition to.\r\n   */\r\n  public goToScene(key: string) {\r\n    // if not yet initialized defer goToScene\r\n    if (!this.isInitialized) {\r\n      this._deferredGoTo = key;\r\n      return;\r\n    }\r\n\r\n    if (this.scenes[key]) {\r\n      const oldScene = this.currentScene;\r\n      const newScene = this.scenes[key];\r\n\r\n      this._logger.debug('Going to scene:', key);\r\n\r\n      // only deactivate when initialized\r\n      if (this.currentScene.isInitialized) {\r\n        this.currentScene._deactivate.apply(this.currentScene, [oldScene, newScene]);\r\n        this.currentScene.eventDispatcher.emit('deactivate', new DeactivateEvent(newScene, this.currentScene));\r\n      }\r\n\r\n      // set current scene to new one\r\n      this.currentScene = newScene;\r\n      this.screen.setCurrentCamera(newScene.camera);\r\n\r\n      // initialize the current scene if has not been already\r\n      this.currentScene._initialize(this);\r\n\r\n      this.currentScene._activate.apply(this.currentScene, [oldScene, newScene]);\r\n      this.currentScene.eventDispatcher.emit('activate', new ActivateEvent(oldScene, this.currentScene));\r\n    } else {\r\n      this._logger.error('Scene', key, 'does not exist!');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Transforms the current x, y from screen coordinates to world coordinates\r\n   * @param point  Screen coordinate to convert\r\n   */\r\n  public screenToWorldCoordinates(point: Vector): Vector {\r\n    return this.screen.screenToWorldCoordinates(point);\r\n  }\r\n\r\n  /**\r\n   * Transforms a world coordinate, to a screen coordinate\r\n   * @param point  World coordinate to convert\r\n   */\r\n  public worldToScreenCoordinates(point: Vector): Vector {\r\n    return this.screen.worldToScreenCoordinates(point);\r\n  }\r\n\r\n  /**\r\n   * Initializes the internal canvas, rendering context, display mode, and native event listeners\r\n   */\r\n  private _initialize(options?: EngineOptions) {\r\n    this.pageScrollPreventionMode = options.scrollPreventionMode;\r\n\r\n    // initialize inputs\r\n    this.input = {\r\n      keyboard: new Input.Keyboard(),\r\n      pointers: new Input.Pointers(this),\r\n      gamepads: new Input.Gamepads()\r\n    };\r\n    this.input.keyboard.init();\r\n    this.input.pointers.init(options && options.pointerScope === Input.PointerScope.Document ? document : this.canvas);\r\n    this.input.gamepads.init();\r\n\r\n    // Issue #385 make use of the visibility api\r\n    // https://developer.mozilla.org/en-US/docs/Web/Guide/User_experience/Using_the_Page_Visibility_API\r\n\r\n    let hidden: keyof HTMLDocument, visibilityChange: string;\r\n    if (typeof document.hidden !== 'undefined') {\r\n      // Opera 12.10 and Firefox 18 and later support\r\n      hidden = 'hidden';\r\n      visibilityChange = 'visibilitychange';\r\n    } else if ('msHidden' in document) {\r\n      hidden = <keyof HTMLDocument>'msHidden';\r\n      visibilityChange = 'msvisibilitychange';\r\n    } else if ('webkitHidden' in document) {\r\n      hidden = <keyof HTMLDocument>'webkitHidden';\r\n      visibilityChange = 'webkitvisibilitychange';\r\n    }\r\n\r\n    this.browser.document.on(visibilityChange, () => {\r\n      if (document[hidden]) {\r\n        this.eventDispatcher.emit('hidden', new HiddenEvent(this));\r\n        this._logger.debug('Window hidden');\r\n      } else {\r\n        this.eventDispatcher.emit('visible', new VisibleEvent(this));\r\n        this._logger.debug('Window visible');\r\n      }\r\n    });\r\n\r\n    if (!this.canvasElementId && !options.canvasElement) {\r\n      document.body.appendChild(this.canvas);\r\n    }\r\n  }\r\n\r\n  public onInitialize(_engine: Engine) {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * If supported by the browser, this will set the antialiasing flag on the\r\n   * canvas. Set this to `false` if you want a 'jagged' pixel art look to your\r\n   * image resources.\r\n   * @param isSmooth  Set smoothing to true or false\r\n   */\r\n  public setAntialiasing(isSmooth: boolean) {\r\n    this.screen.antialiasing = isSmooth;\r\n  }\r\n\r\n  /**\r\n   * Return the current smoothing status of the canvas\r\n   */\r\n  public getAntialiasing(): boolean {\r\n    return this.screen.antialiasing;\r\n  }\r\n\r\n  /**\r\n   * Gets whether the actor is Initialized\r\n   */\r\n  public get isInitialized(): boolean {\r\n    return this._isInitialized;\r\n  }\r\n\r\n  private _overrideInitialize(engine: Engine) {\r\n    if (!this.isInitialized) {\r\n      this.onInitialize(engine);\r\n      super.emit('initialize', new InitializeEvent(engine, this));\r\n      this._isInitialized = true;\r\n      if (this._deferredGoTo) {\r\n        this.goToScene(this._deferredGoTo);\r\n      } else {\r\n        this.goToScene('root');\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Updates the entire state of the game\r\n   * @param delta  Number of milliseconds elapsed since the last update.\r\n   */\r\n  private _update(delta: number) {\r\n    if (this._isLoading) {\r\n      // suspend updates until loading is finished\r\n      this._loader.update(this, delta);\r\n      // Update input listeners\r\n      this.input.keyboard.update();\r\n      this.input.pointers.update();\r\n      this.input.gamepads.update();\r\n      return;\r\n    }\r\n    this._overrideInitialize(this);\r\n    // Publish preupdate events\r\n    this._preupdate(delta);\r\n\r\n    // process engine level events\r\n    this.currentScene.update(this, delta);\r\n\r\n    // update animations\r\n    // TODO remove\r\n    this._animations = this._animations.filter(function (a) {\r\n      return !a.animation.isDone();\r\n    });\r\n\r\n    // Update input listeners\r\n    this.input.keyboard.update();\r\n    this.input.pointers.update();\r\n    this.input.gamepads.update();\r\n\r\n    // Publish update event\r\n    this._postupdate(delta);\r\n  }\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  public _preupdate(delta: number) {\r\n    this.emit('preupdate', new PreUpdateEvent(this, delta, this));\r\n    this.onPreUpdate(this, delta);\r\n  }\r\n\r\n  public onPreUpdate(_engine: Engine, _delta: number) {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  public _postupdate(delta: number) {\r\n    this.emit('postupdate', new PostUpdateEvent(this, delta, this));\r\n    this.onPostUpdate(this, delta);\r\n  }\r\n\r\n  public onPostUpdate(_engine: Engine, _delta: number) {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * Draws the entire game\r\n   * @param delta  Number of milliseconds elapsed since the last draw.\r\n   */\r\n  private _draw(delta: number) {\r\n    const ctx = this.ctx;\r\n    this._predraw(ctx, delta);\r\n\r\n    if (this._isLoading) {\r\n      this._loader.canvas.draw(this.graphicsContext, 0, 0);\r\n      this.graphicsContext.flush();\r\n      // Drawing nothing else while loading\r\n      return;\r\n    }\r\n\r\n    // TODO move to graphics systems?\r\n    this.graphicsContext.backgroundColor = this.backgroundColor;\r\n\r\n    this.currentScene.draw(this.ctx, delta);\r\n\r\n    // todo needs to be a better way of doing this\r\n    let a = 0;\r\n    const len = this._animations.length;\r\n    for (a; a < len; a++) {\r\n      this._animations[a].animation.draw(ctx, this._animations[a].x, this._animations[a].y);\r\n    }\r\n\r\n    // Draw debug information\r\n    // TODO don't access ctx directly\r\n    if (this.isDebug) {\r\n      this.ctx.font = 'Consolas';\r\n      this.ctx.fillStyle = this.debugColor.toString();\r\n      const keys = this.input.keyboard.getKeys();\r\n      for (let j = 0; j < keys.length; j++) {\r\n        this.ctx.fillText(keys[j].toString() + ' : ' + (Input.Keys[keys[j]] ? Input.Keys[keys[j]] : 'Not Mapped'), 100, 10 * j + 10);\r\n      }\r\n\r\n      this.ctx.fillText('FPS:' + this.stats.currFrame.fps.toFixed(2).toString(), 10, 10);\r\n    }\r\n\r\n    // Post processing\r\n    for (let i = 0; i < this.postProcessors.length; i++) {\r\n      this.postProcessors[i].process(this.ctx.getImageData(0, 0, this.canvasWidth, this.canvasHeight), this.ctx);\r\n    }\r\n\r\n    this._postdraw(ctx, delta);\r\n  }\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  public _predraw(_ctx: CanvasRenderingContext2D, delta: number) {\r\n    this.emit('predraw', new PreDrawEvent(_ctx, delta, this));\r\n    this.onPreDraw(_ctx, delta);\r\n  }\r\n\r\n  public onPreDraw(_ctx: CanvasRenderingContext2D, _delta: number) {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  public _postdraw(_ctx: CanvasRenderingContext2D, delta: number) {\r\n    this.emit('postdraw', new PostDrawEvent(_ctx, delta, this));\r\n    this.onPostDraw(_ctx, delta);\r\n  }\r\n\r\n  public onPostDraw(_ctx: CanvasRenderingContext2D, _delta: number) {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * Enable or disable Excalibur debugging functionality.\r\n   * @param toggle a value that debug drawing will be changed to\r\n   */\r\n  public showDebug(toggle: boolean): void {\r\n    this._isDebug = toggle;\r\n  }\r\n\r\n  /**\r\n   * Toggle Excalibur debugging functionality.\r\n   */\r\n  public toggleDebug(): boolean {\r\n    this._isDebug = !this._isDebug;\r\n    return this._isDebug;\r\n  }\r\n\r\n  /**\r\n   * Starts the internal game loop for Excalibur after loading\r\n   * any provided assets.\r\n   * @param loader  Optional [[Loader]] to use to load resources. The default loader is [[Loader]], override to provide your own\r\n   * custom loader.\r\n   */\r\n  public start(loader?: Loader): Promise<any> {\r\n    if (!this._compatible) {\r\n      return Promise.reject('Excalibur is incompatible with your browser');\r\n    }\r\n    this.screen.pushResolutionAndViewport();\r\n    this.screen.resolution = this.screen.viewport;\r\n    this.screen.applyResolutionAndViewport();\r\n    this.graphicsContext.updateViewport();\r\n    let loadingComplete: Promise<any>;\r\n    if (loader) {\r\n      this._loader = loader;\r\n      this._loader.suppressPlayButton = this._suppressPlayButton || this._loader.suppressPlayButton;\r\n      this._loader.wireEngine(this);\r\n      loadingComplete = this.load(this._loader);\r\n    } else {\r\n      loadingComplete = Promise.resolve();\r\n    }\r\n\r\n    loadingComplete.then(() => {\r\n      this.screen.popResolutionAndViewport();\r\n      this.screen.applyResolutionAndViewport();\r\n      this.graphicsContext.updateViewport();\r\n      this.emit('start', new GameStartEvent(this));\r\n    });\r\n\r\n    if (!this._hasStarted) {\r\n      this._hasStarted = true;\r\n      this._logger.debug('Starting game...');\r\n      this.browser.resume();\r\n      Engine.createMainLoop(this, window.requestAnimationFrame, Date.now)();\r\n\r\n      this._logger.debug('Game started');\r\n    } else {\r\n      // Game already started;\r\n    }\r\n    return loadingComplete;\r\n  }\r\n\r\n  public static createMainLoop(game: Engine, raf: (func: Function) => number, nowFn: () => number) {\r\n    let lastTime = nowFn();\r\n\r\n    return function mainloop() {\r\n      if (!game._hasStarted) {\r\n        return;\r\n      }\r\n      try {\r\n        game._requestId = raf(mainloop);\r\n        game.emit('preframe', new PreFrameEvent(game, game.stats.prevFrame));\r\n\r\n        // Get the time to calculate time-elapsed\r\n        const now = nowFn();\r\n        let elapsed = Math.floor(now - lastTime) || 1;\r\n        // Resolves issue #138 if the game has been paused, or blurred for\r\n        // more than a 200 milliseconds, reset elapsed time to 1. This improves reliability\r\n        // and provides more expected behavior when the engine comes back\r\n        // into focus\r\n        if (elapsed > 200) {\r\n          elapsed = 1;\r\n        }\r\n        const delta = elapsed * game.timescale;\r\n\r\n        // reset frame stats (reuse existing instances)\r\n        const frameId = game.stats.prevFrame.id + 1;\r\n        game.stats.currFrame.reset();\r\n        game.stats.currFrame.id = frameId;\r\n        game.stats.currFrame.delta = delta;\r\n        game.stats.currFrame.fps = 1.0 / (delta / 1000);\r\n\r\n        const beforeUpdate = nowFn();\r\n        game._update(delta);\r\n        const afterUpdate = nowFn();\r\n        game._draw(delta);\r\n        const afterDraw = nowFn();\r\n\r\n        game.stats.currFrame.duration.update = afterUpdate - beforeUpdate;\r\n        game.stats.currFrame.duration.draw = afterDraw - afterUpdate;\r\n\r\n        lastTime = now;\r\n\r\n        game.emit('postframe', new PostFrameEvent(game, game.stats.currFrame));\r\n        game.stats.prevFrame.reset(game.stats.currFrame);\r\n      } catch (e) {\r\n        window.cancelAnimationFrame(game._requestId);\r\n        game.stop();\r\n        game.onFatalException(e);\r\n      }\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Stops Excalibur's main loop, useful for pausing the game.\r\n   */\r\n  public stop() {\r\n    if (this._hasStarted) {\r\n      this.emit('stop', new GameStopEvent(this));\r\n      this.browser.pause();\r\n      this._hasStarted = false;\r\n      this._logger.debug('Game stopped');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns the Engine's Running status, Useful for checking whether engine is running or paused.\r\n   */\r\n  public isPaused(): boolean {\r\n    return !this._hasStarted;\r\n  }\r\n\r\n  /**\r\n   * Takes a screen shot of the current viewport and returns it as an\r\n   * HTML Image Element.\r\n   */\r\n  public screenshot(): HTMLImageElement {\r\n    const result = new Image();\r\n    const raw = this.canvas.toDataURL('image/png');\r\n    result.src = raw;\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Another option available to you to load resources into the game.\r\n   * Immediately after calling this the game will pause and the loading screen\r\n   * will appear.\r\n   * @param loader  Some [[Loadable]] such as a [[Loader]] collection, [[Sound]], or [[Texture]].\r\n   */\r\n  public load(loader: Loadable<any>): Promise<void> {\r\n    const complete = new Promise<void>((resolve) => {\r\n      this._isLoading = true;\r\n\r\n      loader.load().then(() => {\r\n        if (this._suppressPlayButton) {\r\n          setTimeout(() => {\r\n            this._isLoading = false;\r\n            resolve();\r\n            // Delay is to give the logo a chance to show, otherwise don't delay\r\n          }, 500);\r\n        } else {\r\n          this._isLoading = false;\r\n          resolve();\r\n        }\r\n      });\r\n    });\r\n\r\n    return complete;\r\n  }\r\n}\r\n\r\n/**\r\n * @internal\r\n * @deprecated\r\n */\r\n@obsolete({ message: 'Will be removed in excalibur v0.26.0' })\r\nclass AnimationNode {\r\n  constructor(public animation: Animation, public x: number, public y: number) {}\r\n}\r\n","import { GameEvent } from '../Events';\r\nimport { Sound } from '../Resources/Sound/Sound';\r\nimport { Actor } from '../Actor';\r\nimport { WebAudioInstance } from '../Resources/Sound/WebAudioInstance';\r\n\r\nexport class MediaEvent extends GameEvent<Sound> {\r\n  /**\r\n   * Media event cannot bubble\r\n   */\r\n  public set bubbles(_value: boolean) {\r\n    // stubbed\r\n  }\r\n  /**\r\n   * Media event cannot bubble\r\n   */\r\n  public get bubbles(): boolean {\r\n    return false;\r\n  }\r\n  /**\r\n   * Media event cannot bubble, so they have no path\r\n   */\r\n  protected get _path(): Actor[] {\r\n    return null;\r\n  }\r\n  /**\r\n   * Media event cannot bubble, so they have no path\r\n   */\r\n  protected set _path(_val: Actor[]) {\r\n    // stubbed\r\n  }\r\n\r\n  constructor(public target: Sound, protected _name: string = 'MediaEvent') {\r\n    super();\r\n  }\r\n\r\n  /**\r\n   * Prevents event from bubbling\r\n   */\r\n  public stopPropagation(): void {\r\n    /**\r\n     * Stub\r\n     */\r\n  }\r\n  /**\r\n   * Action, that calls when event happens\r\n   */\r\n  public action(): void {\r\n    /**\r\n     * Stub\r\n     */\r\n  }\r\n  /**\r\n   * Propagate event further through event path\r\n   */\r\n  public propagate(): void {\r\n    /**\r\n     * Stub\r\n     */\r\n  }\r\n\r\n  public layPath(_actor: Actor): void {\r\n    /**\r\n     * Stub\r\n     */\r\n  }\r\n}\r\n\r\nexport class NativeSoundEvent extends MediaEvent {\r\n  constructor(target: Sound, public track?: WebAudioInstance) {\r\n    super(target, 'NativeSoundEvent');\r\n  }\r\n}\r\n\r\nexport class NativeSoundProcessedEvent extends MediaEvent {\r\n  public data: string | AudioBuffer;\r\n\r\n  constructor(target: Sound, private _processedData: string | AudioBuffer) {\r\n    super(target, 'NativeSoundProcessedEvent');\r\n\r\n    this.data = this._processedData;\r\n  }\r\n}\r\n","import { Vector } from '../Math/vector';\nimport { BoundingBox } from '../Collision/Index';\nimport { Color } from '../Color';\nimport { line } from '../Util/DrawUtil';\nimport { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\nimport { BaseAlign, Direction, FontOptions, FontStyle, FontUnit, TextAlign, FontRenderer } from './FontCommon';\nimport { Raster, RasterOptions } from './Raster';\n\nexport class Font extends Raster implements FontRenderer {\n  constructor(options: FontOptions & RasterOptions = {}) {\n    super(options);\n    this.family = options?.family ?? this.family;\n    this.style = options?.style ?? this.style;\n    this.bold = options?.bold ?? this.bold;\n    this.size = options?.size ?? this.size;\n    this.unit = options?.unit ?? this.unit;\n    this.textAlign = options?.textAlign ?? this.textAlign;\n    this.baseAlign = options?.baseAlign ?? this.baseAlign;\n    this.direction = options?.direction ?? this.direction;\n    this.quality = options?.quality ?? this.quality;\n    if (options?.shadow) {\n      this.shadow = {};\n      this.shadow.blur = options.shadow.blur ?? this.shadow.blur;\n      this.shadow.offset = options.shadow.offset ?? this.shadow.offset;\n      this.shadow.color = options.shadow.color ?? this.shadow.color;\n    }\n    this.flagDirty();\n  }\n\n  public clone() {\n    return new Font({\n      ...this.cloneGraphicOptions(),\n      ...this.cloneRasterOptions(),\n      size: this.size,\n      unit: this.unit,\n      family: this.family,\n      style: this.style,\n      bold: this.bold,\n      textAlign: this.textAlign,\n      baseAlign: this.baseAlign,\n      direction: this.direction,\n      shadow: this.shadow\n        ? {\n          blur: this.shadow.blur,\n          offset: this.shadow.offset,\n          color: this.shadow.color\n        }\n        : null\n    });\n  }\n\n  /**\n   * Font quality determines the size of the underlying rastered text, higher quality means less jagged edges.\n   * If quality is set to 1, then just enough raster bitmap is generated to render the text.\n   *\n   * You can think of quality as how zoomed in to the text you can get before seeing jagged edges.\n   *\n   * (Default 4)\n   */\n  public quality = 2;\n\n  public family: string = 'sans-serif';\n  public style: FontStyle = FontStyle.Normal;\n  public bold: boolean = false;\n  public unit: FontUnit = FontUnit.Px;\n  public textAlign: TextAlign = TextAlign.Left;\n  public baseAlign: BaseAlign = BaseAlign.Alphabetic;\n  public direction: Direction = Direction.LeftToRight;\n  public size: number = 10;\n  public shadow: { blur?: number; offset?: Vector; color?: Color } = null;\n\n  public get fontString() {\n    return `${this.style} ${this.bold ? 'bold' : ''} ${this.size}${this.unit} ${this.family}`;\n  }\n\n  private _text: string;\n  private _lines: string[];\n  private _textBounds: BoundingBox = new BoundingBox();\n  private _textWidth: number = 0;\n  private _textHeight: number = 0;\n\n  public get width() {\n    return this._textWidth;\n  }\n\n  public set width(value: number) {\n    this._textWidth = value;\n  }\n\n  public get height() {\n    const numLines = this._lines?.length ?? 1;\n    return this._textHeight * numLines;\n  }\n\n  public set height(value: number) {\n    const numLines = this._lines?.length ?? 1;\n    this._textHeight = value / numLines;\n  }\n\n  private get _rasterWidth() {\n    return this._bitmap.width;\n  }\n\n  private get _rasterHeight() {\n    return this._bitmap.height;\n  }\n\n  private get _halfRasterWidth() {\n    return Math.floor(this._bitmap.width / 2);\n  }\n\n  private get _halfRasterHeight() {\n    return Math.floor(this._bitmap.height / 2);\n  }\n\n  public get localBounds(): BoundingBox {\n    return this._textBounds;\n  }\n\n  protected _drawImage(ex: ExcaliburGraphicsContext, x: number, y: number) {\n    if (this.dirty) {\n      this.rasterize();\n    }\n\n    ex.drawImage(\n      this._bitmap,\n      0,\n      0,\n      this._rasterWidth,\n      this._rasterHeight,\n      x - this._rasterWidth / this.quality / 2,\n      y - this._rasterHeight / this.quality / 2,\n      this._rasterWidth / this.quality,\n      this._rasterHeight / this.quality\n    );\n  }\n\n  protected _rotate(ex: ExcaliburGraphicsContext) {\n    // TODO this needs to change depending on the bounding box...\n    const origin = this.origin ?? this._textBounds.center;\n    ex.translate(origin.x, origin.y);\n    ex.rotate(this.rotation);\n    ex.translate(-origin.x, -origin.y);\n  }\n\n  protected _flip(ex: ExcaliburGraphicsContext) {\n    if (this.flipHorizontal) {\n      ex.translate(this._textBounds.width / this.scale.x, 0);\n      ex.scale(-1, 1);\n    }\n\n    if (this.flipVertical) {\n      ex.translate(0, -this._textBounds.height / 2 / this.scale.y);\n      ex.scale(1, -1);\n    }\n  }\n\n  public updateText(text: string) {\n    if (this._text !== text) {\n      this._text = text;\n      this._lines = this._text.split('\\n');\n      this._updateDimensions();\n      this.flagDirty();\n    }\n  }\n\n  private _updateDimensions() {\n    if (this._text) {\n      this._applyFont(this._ctx);\n      const maxWidthLine = this._lines.reduce((a, b) => {\n        return a.length > b.length ? a : b;\n      });\n      const metrics = this._ctx.measureText(maxWidthLine);\n      this._textWidth = Math.abs(metrics.actualBoundingBoxLeft) + Math.abs(metrics.actualBoundingBoxRight);\n      this._textHeight = Math.abs(metrics.actualBoundingBoxAscent) + Math.abs(metrics.actualBoundingBoxDescent);\n\n      // TODO lineheight makes the text bounds wonky\n      const lineAdjustedHeight = this._textHeight * this._lines.length;\n      // this._textHeight = lineAdjustedHeight;\n      // Changing the width and height clears the context properties\n      // We double the bitmap width to account for alignment\n      // We scale by \"quality\" so we render text without jaggies\n      this._bitmap.width = (this._textWidth + this.padding * 2) * 2 * this.quality;\n      this._bitmap.height = (lineAdjustedHeight + this.padding * 2) * 2 * this.quality;\n\n      // These bounds exist in raster bitmap space where the top left corner is the corder of the bitmap\n      const x = 0;\n      const y = 0;\n      const bottomBounds = lineAdjustedHeight - Math.abs(metrics.actualBoundingBoxAscent);\n      this._textBounds = new BoundingBox({\n        left: x - Math.abs(metrics.actualBoundingBoxLeft) - this.padding,\n        top: y - Math.abs(metrics.actualBoundingBoxAscent) - this.padding,\n        bottom: y + bottomBounds + this.padding,\n        right: x + Math.abs(metrics.actualBoundingBoxRight) + this.padding\n      });\n    }\n  }\n\n  protected _preDraw(ex: ExcaliburGraphicsContext, x: number, y: number): void {\n    if (this.dirty) {\n      this._updateDimensions();\n    }\n    super._preDraw(ex, x, y);\n  }\n\n  protected _postDraw(ex: ExcaliburGraphicsContext): void {\n    if (this.showDebug) {\n      /* istanbul ignore next */\n      ex.debug.drawRect(-this._halfRasterWidth, -this._halfRasterHeight, this._rasterWidth, this._rasterHeight);\n    }\n    ex.restore();\n  }\n\n  private _applyFont(ctx: CanvasRenderingContext2D) {\n    ctx.translate(this.padding + this._halfRasterWidth, this.padding + this._halfRasterHeight);\n    ctx.scale(this.quality, this.quality);\n    ctx.textAlign = this.textAlign;\n    ctx.textBaseline = this.baseAlign;\n    ctx.font = this.fontString;\n    ctx.direction = this.direction;\n\n    if (this.shadow) {\n      ctx.shadowColor = this.shadow.color.toString();\n      ctx.shadowBlur = this.shadow.blur;\n      ctx.shadowOffsetX = this.shadow.offset.x;\n      ctx.shadowOffsetY = this.shadow.offset.y;\n    }\n  }\n\n  execute(ctx: CanvasRenderingContext2D): void {\n    if (this._text) {\n      // The reason we need to re-apply the font is setting raster properties (like width/height) can reset the context props\n      this._applyRasterProperites(ctx);\n      this._applyFont(ctx);\n\n      const lineHeight = this._textHeight; // TODO user specified line height\n      for (let i = 0; i < this._lines.length; i++) {\n        const line = this._lines[i];\n        if (this.color) {\n          ctx.fillText(line, 0, i * lineHeight);\n        }\n\n        if (this.strokeColor) {\n          ctx.strokeText(line, 0, i * lineHeight);\n        }\n      }\n\n      if (this.showDebug) {\n        // Horizontal line\n        /* istanbul ignore next */\n        line(ctx, Color.Red, -this._halfRasterWidth, 0, this._halfRasterWidth, 0, 2);\n        // Vertical line\n        /* istanbul ignore next */\n        line(ctx, Color.Red, 0, -this._halfRasterHeight, 0, this._halfRasterHeight, 2);\n      }\n    }\n  }\n\n  public render(ex: ExcaliburGraphicsContext, text: string, x: number, y: number) {\n    this.updateText(text);\n    this.draw(ex, x, y);\n  }\n}\n","import { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\r\nimport { BoundingBox } from '../Collision/BoundingBox';\r\nimport { SpriteFont } from './SpriteFont';\r\nimport { Graphic, GraphicOptions } from './Graphic';\r\nimport { Color } from '../Color';\r\nimport { Font } from './Font';\r\nimport { watch } from '../Util/Watch';\r\n\r\nexport interface TextOptions {\r\n  text: string;\r\n  color?: Color;\r\n  font?: Font | SpriteFont;\r\n}\r\n\r\nexport class Text extends Graphic {\r\n  constructor(options: TextOptions & GraphicOptions) {\r\n    super(options);\r\n    // This order is important font, color, then text\r\n    this.font = options.font ?? new Font();\r\n    this.color = options.color ?? this.color;\r\n    this.text = options.text;\r\n  }\r\n\r\n  public clone(): Text {\r\n    return new Text({\r\n      text: this.text.slice(),\r\n      color: this.color.clone(),\r\n      font: this.font.clone()\r\n    });\r\n  }\r\n\r\n  private _text: string = '';\r\n  public get text() {\r\n    return this._text;\r\n  }\r\n\r\n  public set text(value: string) {\r\n    this._text = value;\r\n    this.font.updateText(value);\r\n  }\r\n\r\n  // TODO SpriteFont doesn't support a color yet :(\r\n  public get color() {\r\n    if (this.font instanceof Font) {\r\n      return this.font.color;\r\n    }\r\n    return Color.Black;\r\n  }\r\n\r\n  public set color(color: Color) {\r\n    if (this.font instanceof Font) {\r\n      this.font.color = color;\r\n    }\r\n  }\r\n\r\n  private _font: Font | SpriteFont;\r\n  public get font(): Font | SpriteFont {\r\n    return this._font;\r\n  }\r\n  public set font(font: Font | SpriteFont) {\r\n    if (font instanceof Font) {\r\n      this._font = watch(font, (font) => font.flagDirty());\r\n    } else {\r\n      this._font = font;\r\n    }\r\n  }\r\n\r\n  public get width() {\r\n    return this.font.width;\r\n  }\r\n\r\n  public get height() {\r\n    return this.font.height;\r\n  }\r\n\r\n  public get localBounds(): BoundingBox {\r\n    return this.font.localBounds;\r\n  }\r\n\r\n  protected _rotate(_ex: ExcaliburGraphicsContext) {\r\n    // None this is delegated to font\r\n    // This override erases the default behavior\r\n  }\r\n\r\n  protected _flip(_ex: ExcaliburGraphicsContext) {\r\n    // None this is delegated to font\r\n    // This override erases the default behavior\r\n  }\r\n\r\n  protected _drawImage(ex: ExcaliburGraphicsContext, x: number, y: number) {\r\n    if (this.font instanceof Font) {\r\n      this.font.color = this.color;\r\n    }\r\n    this.font.flipHorizontal = this.flipHorizontal;\r\n    this.font.flipVertical = this.flipVertical;\r\n    this.font.scale = this.scale;\r\n    this.font.rotation = this.rotation;\r\n    this.font.origin = this.origin;\r\n    this.font.opacity = this.opacity;\r\n    this.font.render(ex, this._text, x, y);\r\n  }\r\n}\r\n","import { Engine } from './Engine';\r\nimport { Color } from './Color';\r\nimport { vec, Vector } from './Math/vector';\r\nimport { Text } from './Graphics/Text';\r\nimport { BaseAlign, FontStyle, FontUnit, TextAlign } from './Graphics/FontCommon';\r\nimport { obsolete } from './Util/Decorators';\r\nimport { SpriteFont as LegacySpriteFont } from './Drawing/SpriteSheet';\r\nimport { ExcaliburGraphicsContext, GraphicsComponent, SpriteFont } from './Graphics';\r\nimport { Font } from './Graphics/Font';\r\nimport { Actor } from './Actor';\r\nimport { ActorArgs } from '.';\r\n\r\n/**\r\n * Option for creating a label\r\n */\r\nexport interface LabelOptions {\r\n  /**\r\n   * Specify the label text\r\n   */\r\n  text?: string;\r\n  /**\r\n   * Specify the color of the text (does not apply to SpriteFonts)\r\n   */\r\n  color?: Color;\r\n  x?: number;\r\n  y?: number;\r\n  pos?: Vector;\r\n  /**\r\n   * Optionally specify a sprite font, will take precedence over any other [[Font]]\r\n   */\r\n  spriteFont?: SpriteFont | LegacySpriteFont;\r\n  /**\r\n   * Specify a custom font\r\n   */\r\n  font?: Font\r\n}\r\n\r\n/**\r\n * Labels are the way to draw small amounts of text to the screen. They are\r\n * actors and inherit all of the benefits and capabilities.\r\n */\r\nexport class Label extends Actor {\r\n  public font: Font = new Font();\r\n  private _text: Text = new Text({ text: '', font: this.font });\r\n\r\n  /**\r\n   * The text to draw.\r\n   */\r\n  public get text(): string {\r\n    return this._text.text;\r\n  }\r\n\r\n  public set text(text: string) {\r\n    this._text.text = text;\r\n  }\r\n\r\n  public get color(): Color {\r\n    return this._text.color;\r\n  }\r\n\r\n  public set color(color: Color) {\r\n    this._text.color = color;\r\n  }\r\n\r\n  public get opacity(): number {\r\n    return this._text.opacity;\r\n  }\r\n\r\n  public set opacity(opacity: number) {\r\n    this._text.opacity = opacity;\r\n  }\r\n\r\n  /**\r\n   * Sets or gets the bold property of the label's text, by default it's false\r\n   * @deprecated Use [[Font.bold|Label.font.bold]]\r\n   */\r\n  @obsolete({\r\n    message: 'Label.bold will be removed in v0.26.0',\r\n    alternateMethod: 'Use Label.font.bold'\r\n  })\r\n  public get bold(): boolean {\r\n    return this.font.bold;\r\n  }\r\n\r\n  public set bold(isBold: boolean) {\r\n    this.font.bold = isBold;\r\n  }\r\n\r\n  /**\r\n   * The CSS font family string (e.g. `sans-serif`, `Droid Sans Pro`). Web fonts\r\n   * are supported, same as in CSS.\r\n   * @deprecated Use [[Font.family|Label.font.family]]\r\n   */\r\n  @obsolete({\r\n    message: 'Label.fontFamily will be removed in v0.26.0',\r\n    alternateMethod: 'Use Label.font.family'\r\n  })\r\n  public get fontFamily(): string {\r\n    return this.font.family;\r\n  }\r\n\r\n  public set fontFamily(family: string) {\r\n    this.font.family = family;\r\n  }\r\n\r\n  /**\r\n   * The font size in the selected units, default is 10 (default units is pixel)\r\n   * @deprecated Use [[Font.size|Label.font.size]]\r\n   */\r\n  @obsolete({\r\n    message: 'Label.fontSize will be removed in v0.26.0',\r\n    alternateMethod: 'Use Label.font.size'\r\n  })\r\n  public get fontSize(): number {\r\n    return this.font.size;\r\n  }\r\n\r\n  public set fontSize(sizeInUnit: number) {\r\n    this.font.size = sizeInUnit;\r\n  }\r\n\r\n  /**\r\n   * The font style for this label, the default is [[FontStyle.Normal]]\r\n   * @deprecated Use [[Font.style|Label.font.style]]\r\n   */\r\n  @obsolete({\r\n    message: 'Label.fontStyle will be removed in v0.26.0',\r\n    alternateMethod: 'Use Lable.font.style'\r\n  })\r\n  public get fontStyle(): FontStyle {\r\n    return this.font.style;\r\n  }\r\n\r\n  public set fontStyle(style: FontStyle) {\r\n    this.font.style = style;\r\n  }\r\n\r\n  /**\r\n   * The css units for a font size such as px, pt, em (SpriteFont only support px), by default is 'px';\r\n   * @deprecated Use [[Font.unit|Label.font.unit]]\r\n   */\r\n  @obsolete({\r\n    message: 'Label.fontUnit will be removed in v0.26.0',\r\n    alternateMethod: 'Use Label.font.unit'\r\n  })\r\n  public get fontUnit(): FontUnit {\r\n    return this.font.unit;\r\n  }\r\n\r\n  public set fontUnit(unit: FontUnit) {\r\n    this.font.unit = unit;\r\n  }\r\n\r\n  /**\r\n   * Gets or sets the horizontal text alignment property for the label.\r\n   * @deprecated Use [[Font.textAlign|Label.font.textAlign]]\r\n   */\r\n  @obsolete({\r\n    message: 'Label.textAlign will be removed in v0.26.0',\r\n    alternateMethod: 'Use Label.font.textAlign'\r\n  })\r\n  public get textAlign(): TextAlign {\r\n    return this.font.textAlign;\r\n  }\r\n\r\n  public set textAlign(align: TextAlign) {\r\n    this.font.textAlign = align;\r\n  }\r\n\r\n  /**\r\n   * Gets or sets the baseline alignment property for the label.\r\n   * @deprecated Use [[Font.baseAlign|Label.font.baseAlign]]\r\n   */\r\n  @obsolete({\r\n    message: 'Label.baseAlign will be removed in v0.26.0',\r\n    alternateMethod: 'Use Label.font.baseAlign'\r\n  })\r\n  public get baseAlign(): BaseAlign {\r\n    return this.font.baseAlign;\r\n  }\r\n\r\n  public set baseAlign(align: BaseAlign) {\r\n    this.font.baseAlign = align;\r\n  }\r\n\r\n  /**\r\n   * Gets or sets the maximum width (in pixels) that the label should occupy\r\n   * @deprecated The maxWidth constraint is gone\r\n   */\r\n  public maxWidth: number;\r\n\r\n  private _legacySpriteFont: LegacySpriteFont;\r\n  private _spriteFont: SpriteFont;\r\n  /**\r\n   * The [[LegacyDrawing.SpriteFont]] to use, if any. Overrides [[fontFamily]] if present.\r\n   * @deprecated Use [[SpriteFont]]\r\n   */\r\n  @obsolete()\r\n  public get spriteFont(): LegacySpriteFont {\r\n    return this._legacySpriteFont;\r\n  }\r\n\r\n  public set spriteFont(sf: LegacySpriteFont | SpriteFont) {\r\n    if (sf) {\r\n      if (sf instanceof LegacySpriteFont) {\r\n        this._legacySpriteFont = sf;\r\n        this._spriteFont = SpriteFont.fromLegacySpriteFont(sf);\r\n        this._text.font = this._spriteFont;\r\n        return;\r\n      }\r\n      this._spriteFont = sf;\r\n      this._text.font = this._spriteFont;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Gets or sets the letter spacing on a Label. Only supported with Sprite Fonts.\r\n   * @deprecated Use [[SpriteFont.spacing]]\r\n   */\r\n  public letterSpacing: number = 0; //px\r\n\r\n  /**\r\n   * Whether or not the [[SpriteFont]] will be case-sensitive when matching characters.\r\n   * @deprecated Use Graphics.SpriteFont.caseInsensitve\r\n   */\r\n  public caseInsensitive: boolean = true;\r\n\r\n  private _graphicsContext: ExcaliburGraphicsContext;\r\n\r\n  /**\r\n   * Build a new label\r\n   * @param options\r\n   */\r\n  constructor(options?: LabelOptions & ActorArgs) {\r\n    super(options);\r\n    const {text, pos, x, y, spriteFont, font, color} = options;\r\n\r\n    this.pos = pos ?? (x && y ? vec(x, y) : this.pos);\r\n    this.text = text ?? this.text;\r\n    this.spriteFont = spriteFont ?? this.spriteFont;\r\n    this.font = font ?? this.font;\r\n    this.color = color ?? this.color;\r\n    const gfx = this.get(GraphicsComponent);\r\n    gfx.anchor = Vector.Zero;\r\n    gfx.use(this._text);\r\n  }\r\n\r\n  public _initialize(engine: Engine) {\r\n    super._initialize(engine);\r\n    this._graphicsContext = engine.graphicsContext;\r\n  }\r\n\r\n  /**\r\n   * Returns the width of the text in the label (in pixels);\r\n   */\r\n  public getTextWidth(): number {\r\n    return this._text.width;\r\n  }\r\n\r\n  /**\r\n   * Sets the text shadow for sprite fonts\r\n   * @param offsetX      The x offset in pixels to place the shadow\r\n   * @param offsetY      The y offset in pixels to place the shadow\r\n   * @param shadowColor  The color of the text shadow\r\n   * @deprecated Use [[Font.shadow|Label.font.shadow]]\r\n   */\r\n  @obsolete({\r\n    message: 'Label.setTextShadow will be removed in v0.26.0',\r\n    alternateMethod: 'Use Label.font.shadow'\r\n  })\r\n  public setTextShadow(offsetX: number, offsetY: number, shadowColor: Color) {\r\n    this.font.shadow = { offset: vec(offsetX, offsetY), blur: 2, color: shadowColor };\r\n  }\r\n\r\n  /**\r\n   * Toggles text shadows on or off, only applies when using sprite fonts\r\n   * @deprecated Use [[Font.shadow|Label.font.shadow]]\r\n   */\r\n  @obsolete({\r\n    message: 'Label.useTextShadow will be removed in v0.26.0',\r\n    alternateMethod: 'Use Label.font.shadow'\r\n  })\r\n  public useTextShadow(on: boolean) {\r\n    if (this.spriteFont) {\r\n      this.spriteFont.useTextShadow(on);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clears the current text shadow\r\n   * @deprecated Use [[Font.shadow|Label.font.shadow]]\r\n   */\r\n  @obsolete({\r\n    message: 'Label.clearTextShadow will be removed in v0.26.0',\r\n    alternateMethod: 'Use Label.font.shadow'\r\n  })\r\n  public clearTextShadow() {\r\n    this.font.shadow = null;\r\n  }\r\n\r\n  public draw(_ctx: CanvasRenderingContext2D, _delta: number) {\r\n    const exctx = this._graphicsContext;\r\n    this._text.draw(exctx, 0, 0);\r\n  }\r\n}\r\n","import { CollisionGroup } from './CollisionGroup';\r\n\r\n/**\r\n * Static class for managing collision groups in excalibur, there is a maximum of 32 collision groups possible in excalibur\r\n */\r\nexport class CollisionGroupManager {\r\n  // using bitmasking the maximum number of groups is 32, because that is the highest 32bit integer that JS can present.\r\n  private static _STARTING_BIT = 0b1 | 0;\r\n  private static _MAX_GROUPS = 32;\r\n  private static _CURRENT_GROUP = 1;\r\n  private static _CURRENT_BIT = CollisionGroupManager._STARTING_BIT;\r\n  private static _GROUPS: Map<string, CollisionGroup> = new Map<string, CollisionGroup>();\r\n\r\n  /**\r\n   * Create a new named collision group up to a max of 32.\r\n   * @param name Name for the collision group\r\n   * @param mask Optionally provide your own 32-bit mask, if none is provide the manager will generate one\r\n   */\r\n  public static create(name: string, mask?: number) {\r\n    if (this._CURRENT_GROUP > this._MAX_GROUPS) {\r\n      throw new Error(`Cannot have more than ${this._MAX_GROUPS} collision groups`);\r\n    }\r\n    if (this._GROUPS.get(name)) {\r\n      throw new Error(`Collision group ${name} already exists`);\r\n    }\r\n    const group = new CollisionGroup(name, this._CURRENT_BIT, mask !== undefined ? mask : ~this._CURRENT_BIT);\r\n    this._CURRENT_BIT = (this._CURRENT_BIT << 1) | 0;\r\n    this._CURRENT_GROUP++;\r\n    this._GROUPS.set(name, group);\r\n    return group;\r\n  }\r\n\r\n  /**\r\n   * Get all collision groups currently tracked by excalibur\r\n   */\r\n  public static get groups(): CollisionGroup[] {\r\n    return Array.from(this._GROUPS.values());\r\n  }\r\n\r\n  /**\r\n   * Get a collision group by it's name\r\n   * @param name\r\n   */\r\n  public static groupByName(name: string) {\r\n    return this._GROUPS.get(name);\r\n  }\r\n\r\n  /**\r\n   * Resets the managers internal group management state\r\n   */\r\n  public static reset() {\r\n    this._GROUPS = new Map<string, CollisionGroup>();\r\n    this._CURRENT_BIT = this._STARTING_BIT;\r\n    this._CURRENT_GROUP = 1;\r\n  }\r\n}\r\n","import { Color } from '../Color';\r\nimport * as Effects from './SpriteEffects';\r\n\r\nimport { Drawable, DrawOptions } from '../Interfaces/Drawable';\r\nimport { Vector } from '../Math/vector';\r\nimport { obsolete } from '../Util/Decorators';\r\n\r\n/**\r\n * Creates a closed polygon drawing given a list of [[Vector]]s.\r\n *\r\n * @deprecated Use [[Polygon]]\r\n * @warning Use sparingly as Polygons are performance intensive\r\n */\r\n@obsolete({\r\n  message: 'Polygon will be removed in v0.26.0',\r\n  alternateMethod: 'Use Graphics.Polygon'\r\n})\r\nexport class Polygon implements Drawable {\r\n  public flipVertical: boolean;\r\n  public flipHorizontal: boolean;\r\n  public drawWidth: number;\r\n  public drawHeight: number;\r\n\r\n  public width: number;\r\n  public height: number;\r\n\r\n  /**\r\n   * The color to use for the lines of the polygon\r\n   */\r\n  public lineColor: Color;\r\n  /**\r\n   * The color to use for the interior of the polygon\r\n   */\r\n  public fillColor: Color;\r\n  /**\r\n   * The width of the lines of the polygon\r\n   */\r\n  public lineWidth: number = 5;\r\n  /**\r\n   * Indicates whether the polygon is filled or not.\r\n   */\r\n  public filled: boolean = false;\r\n\r\n  private _points: Vector[] = [];\r\n  public anchor = Vector.Zero;\r\n  public offset = Vector.Zero;\r\n  public rotation: number = 0;\r\n  public scale = Vector.One;\r\n  public opacity: number = 1;\r\n\r\n  /**\r\n   * @param points  The vectors to use to build the polygon in order\r\n   */\r\n  constructor(points: Vector[]) {\r\n    this._points = points;\r\n\r\n    const minX = this._points.reduce((prev: number, curr: Vector) => {\r\n      return Math.min(prev, curr.x);\r\n    }, 0);\r\n    const maxX = this._points.reduce((prev: number, curr: Vector) => {\r\n      return Math.max(prev, curr.x);\r\n    }, 0);\r\n\r\n    this.drawWidth = maxX - minX;\r\n\r\n    const minY = this._points.reduce((prev: number, curr: Vector) => {\r\n      return Math.min(prev, curr.y);\r\n    }, 0);\r\n    const maxY = this._points.reduce((prev: number, curr: Vector) => {\r\n      return Math.max(prev, curr.y);\r\n    }, 0);\r\n\r\n    this.drawHeight = maxY - minY;\r\n\r\n    this.height = this.drawHeight;\r\n    this.width = this.drawWidth;\r\n  }\r\n\r\n  /**\r\n   * @notimplemented Effects are not supported on `Polygon`\r\n   */\r\n  public addEffect() {\r\n    // not supported on polygons\r\n  }\r\n  /**\r\n   * @notimplemented Effects are not supported on `Polygon`\r\n   */\r\n  public removeEffect(index: number): void;\r\n  /**\r\n   * @notimplemented Effects are not supported on `Polygon`\r\n   */\r\n  public removeEffect(effect: Effects.SpriteEffect): void;\r\n  /**\r\n   * @notimplemented Effects are not supported on `Polygon`\r\n   */\r\n  public removeEffect() {\r\n    // not supported on polygons\r\n  }\r\n\r\n  /**\r\n   * @notimplemented Effects are not supported on `Polygon`\r\n   */\r\n  public clearEffects() {\r\n    // not supported on polygons\r\n  }\r\n\r\n  public reset() {\r\n    //pass\r\n  }\r\n\r\n  /**\r\n   * Draws the sprite appropriately to the 2D rendering context, at an x and y coordinate.\r\n   * @param ctx  The 2D rendering context\r\n   * @param x    The x coordinate of where to draw\r\n   * @param y    The y coordinate of where to draw\r\n   */\r\n  public draw(ctx: CanvasRenderingContext2D, x: number, y: number): void;\r\n  /**\r\n   * Draws the sprite with custom options to override internals without mutating them.\r\n   * @param options\r\n   */\r\n  public draw(options: DrawOptions): void;\r\n  public draw(ctxOrOptions: CanvasRenderingContext2D | DrawOptions, x?: number, y?: number): void {\r\n    if (ctxOrOptions instanceof CanvasRenderingContext2D) {\r\n      this._drawWithOptions({ ctx: ctxOrOptions, x, y });\r\n    } else {\r\n      this._drawWithOptions(ctxOrOptions);\r\n    }\r\n  }\r\n\r\n  private _drawWithOptions(options: DrawOptions) {\r\n    const { ctx, x, y, rotation, drawWidth, drawHeight, anchor, offset, opacity, flipHorizontal, flipVertical } = {\r\n      ...options,\r\n      rotation: options.rotation ?? this.rotation,\r\n      drawWidth: options.drawWidth ?? this.drawWidth,\r\n      drawHeight: options.drawHeight ?? this.drawHeight,\r\n      flipHorizontal: options.flipHorizontal ?? this.flipHorizontal,\r\n      flipVertical: options.flipVertical ?? this.flipVertical,\r\n      anchor: options.anchor ?? this.anchor,\r\n      offset: options.offset ?? this.offset,\r\n      opacity: (options.opacity ?? 1) * (this.opacity ?? 1)\r\n    };\r\n\r\n    const xpoint = drawWidth * anchor.x + offset.x + x;\r\n    const ypoint = drawHeight * anchor.y + offset.y + y;\r\n\r\n    ctx.save();\r\n    ctx.translate(xpoint, ypoint);\r\n    ctx.scale(this.scale.x, this.scale.y);\r\n    ctx.rotate(rotation);\r\n    ctx.beginPath();\r\n    ctx.lineWidth = this.lineWidth;\r\n\r\n    // Iterate through the supplied points and construct a 'polygon'\r\n    const firstPoint = this._points[0];\r\n    ctx.moveTo(firstPoint.x, firstPoint.y);\r\n\r\n    let i = 0;\r\n    const len = this._points.length;\r\n\r\n    for (i; i < len; i++) {\r\n      ctx.lineTo(this._points[i].x, this._points[i].y);\r\n    }\r\n\r\n    ctx.lineTo(firstPoint.x, firstPoint.y);\r\n    ctx.closePath();\r\n\r\n    if (this.filled) {\r\n      ctx.fillStyle = this.fillColor.toString();\r\n      ctx.fill();\r\n    }\r\n\r\n    ctx.strokeStyle = this.lineColor.toString();\r\n\r\n    if (flipHorizontal) {\r\n      ctx.translate(drawWidth, 0);\r\n      ctx.scale(-1, 1);\r\n    }\r\n\r\n    if (flipVertical) {\r\n      ctx.translate(0, drawHeight);\r\n      ctx.scale(1, -1);\r\n    }\r\n\r\n    const oldAlpha = ctx.globalAlpha;\r\n    ctx.globalAlpha = opacity;\r\n    ctx.stroke();\r\n    ctx.globalAlpha = oldAlpha;\r\n\r\n    ctx.restore();\r\n  }\r\n}\r\n","import { Audio } from './Audio';\r\n\r\nexport type ExResponseType = '' | 'arraybuffer' | 'blob' | 'document' | 'json' | 'text';\r\n\r\nexport interface ExResponseTypesLookup {\r\n  [name: string]: ExResponseType;\r\n}\r\n\r\nexport class ExResponse {\r\n  public static type: ExResponseTypesLookup = {\r\n    any: '',\r\n    blob: 'blob',\r\n    json: 'json',\r\n    text: 'text',\r\n    document: 'document',\r\n    arraybuffer: 'arraybuffer'\r\n  };\r\n}\r\n\r\n/**\r\n * Represents an audio implementation like [[WebAudioInstance]]\r\n */\r\nexport interface AudioImplementation {\r\n  /**\r\n   * XHR response type\r\n   */\r\n  responseType: ExResponseType;\r\n\r\n  /**\r\n   * Processes raw data and transforms into sound data\r\n   */\r\n  processData(data: Blob | ArrayBuffer): Promise<string | AudioBuffer>;\r\n\r\n  /**\r\n   * Factory method that returns an instance of a played audio track\r\n   */\r\n  createInstance(data: string | AudioBuffer): Audio;\r\n}\r\n","import { Engine } from './../Engine';\r\nimport * as Events from './../Events';\r\nimport { Scene } from '../Scene';\r\n\r\n// eslint-disable-next-line @typescript-eslint/naming-convention\r\nexport interface _initialize {\r\n  _initialize(engine: Engine): void;\r\n}\r\n\r\n/**\r\n * Type guard checking for internal initialize method\r\n * @internal\r\n * @param a\r\n */\r\nexport function has_initialize(a: any): a is _initialize {\r\n  return !!a._initialize;\r\n}\r\n\r\nexport interface OnInitialize {\r\n  onInitialize(engine: Engine): void;\r\n}\r\n\r\n/**\r\n *\r\n */\r\nexport function hasOnInitialize(a: any): a is OnInitialize {\r\n  return !!a.onInitialize;\r\n}\r\n\r\n// eslint-disable-next-line @typescript-eslint/naming-convention\r\nexport interface _preupdate {\r\n  _preupdate(engine: Engine, delta: number): void;\r\n}\r\n\r\n/**\r\n *\r\n */\r\nexport function has_preupdate(a: any): a is _preupdate {\r\n  return !!a._preupdate;\r\n}\r\n\r\nexport interface OnPreUpdate {\r\n  onPreUpdate(engine: Engine, delta: number): void;\r\n}\r\n\r\n/**\r\n *\r\n */\r\nexport function hasOnPreUpdate(a: any): a is OnPreUpdate {\r\n  return !!a.onPreUpdate;\r\n}\r\n\r\n// eslint-disable-next-line @typescript-eslint/naming-convention\r\nexport interface _postupdate {\r\n  _postupdate(engine: Engine, delta: number): void;\r\n}\r\n\r\n/**\r\n *\r\n */\r\nexport function has_postupdate(a: any): a is _postupdate {\r\n  return !!a.onPostUpdate;\r\n}\r\n\r\nexport interface OnPostUpdate {\r\n  onPostUpdate(engine: Engine, delta: number): void;\r\n}\r\n\r\n/**\r\n *\r\n */\r\nexport function hasOnPostUpdate(a: any): a is OnPostUpdate {\r\n  return !!a.onPostUpdate;\r\n}\r\n\r\nexport interface CanInitialize {\r\n  /**\r\n   * Overridable implementation\r\n   */\r\n  onInitialize(_engine: Engine): void;\r\n\r\n  /**\r\n   * Event signatures\r\n   */\r\n  on(eventName: Events.initialize, handler: (event: Events.InitializeEvent<any>) => void): void;\r\n  once(eventName: Events.initialize, handler: (event: Events.InitializeEvent<any>) => void): void;\r\n  off(eventName: Events.initialize, handler?: (event: Events.InitializeEvent<any>) => void): void;\r\n}\r\n\r\nexport interface CanActivate {\r\n  /**\r\n   * Overridable implementation\r\n   */\r\n  onActivate(oldScene: Scene, newScene: Scene): void;\r\n\r\n  /**\r\n   * Event signatures\r\n   */\r\n  on(eventName: Events.activate, handler: (event: Events.ActivateEvent) => void): void;\r\n  once(eventName: Events.activate, handler: (event: Events.ActivateEvent) => void): void;\r\n  off(eventName: Events.activate, handler?: (event: Events.ActivateEvent) => void): void;\r\n}\r\n\r\nexport interface CanDeactivate {\r\n  /**\r\n   * Overridable implementation\r\n   */\r\n  onDeactivate(oldScene: Scene, newScene: Scene): void;\r\n\r\n  /**\r\n   * Event signature\r\n   */\r\n  on(eventName: Events.deactivate, handler: (event: Events.DeactivateEvent) => void): void;\r\n  once(eventName: Events.deactivate, handler: (event: Events.DeactivateEvent) => void): void;\r\n  off(eventName: Events.deactivate, handler?: (event: Events.DeactivateEvent) => void): void;\r\n}\r\n\r\nexport interface CanUpdate {\r\n  /**\r\n   * Overridable implementation\r\n   */\r\n  onPreUpdate(_engine: Engine, _delta: number): void;\r\n\r\n  /**\r\n   * Event signature\r\n   */\r\n  on(eventName: Events.preupdate, handler: (event: Events.PreUpdateEvent<any>) => void): void;\r\n  once(eventName: Events.preupdate, handler: (event: Events.PreUpdateEvent<any>) => void): void;\r\n  off(eventName: Events.preupdate, handler?: (event: Events.PreUpdateEvent<any>) => void): void;\r\n\r\n  /**\r\n   * Overridable implementation\r\n   */\r\n  onPostUpdate(_engine: Engine, _delta: number): void;\r\n\r\n  /**\r\n   * Event signatures\r\n   */\r\n  on(eventName: Events.postupdate, handler: (event: Events.PostUpdateEvent<any>) => void): void;\r\n  once(eventName: Events.postupdate, handler: (event: Events.PostUpdateEvent<any>) => void): void;\r\n  off(eventName: Events.postupdate, handler?: (event: Events.PostUpdateEvent<any>) => void): void;\r\n}\r\n\r\nexport interface OnPreDraw {\r\n  /**\r\n   * Overridable implementation\r\n   */\r\n  onPreDraw(_ctx: CanvasRenderingContext2D, _delta: number): void;\r\n\r\n  /**\r\n   * Event signatures\r\n   */\r\n  on(eventName: Events.predraw, handler: (event: Events.PreDrawEvent) => void): void;\r\n  once(eventName: Events.predraw, handler: (event: Events.PreDrawEvent) => void): void;\r\n  off(eventName: Events.predraw, handler?: (event: Events.PreDrawEvent) => void): void;\r\n}\r\n\r\nexport interface OnPostDraw {\r\n  /**\r\n   * Overridable implementation\r\n   */\r\n  onPostDraw(_ctx: CanvasRenderingContext2D, _delta: number): void;\r\n\r\n  /**\r\n   * Event signatures\r\n   */\r\n  on(eventName: Events.postdraw, handler: (event: Events.PostDrawEvent) => void): void;\r\n  once(eventName: Events.postdraw, handler: (event: Events.PostDrawEvent) => void): void;\r\n  off(eventName: Events.postdraw, handler?: (event: Events.PostDrawEvent) => void): void;\r\n}\r\n\r\nexport interface CanDraw extends OnPreDraw, OnPostDraw {\r\n  on(eventName: Events.predraw, handler: (event: Events.PreDrawEvent) => void): void;\r\n  on(eventName: Events.postdraw, handler: (event: Events.PostDrawEvent) => void): void;\r\n\r\n  once(eventName: Events.predraw, handler: (event: Events.PreDrawEvent) => void): void;\r\n  once(eventName: Events.postdraw, handler: (event: Events.PostDrawEvent) => void): void;\r\n\r\n  off(eventName: Events.predraw, handler?: (event: Events.PreDrawEvent) => void): void;\r\n  off(eventName: Events.postdraw, handler?: (event: Events.PostDrawEvent) => void): void;\r\n}\r\n\r\n/**\r\n *\r\n */\r\nexport function hasPreDraw(a: any): a is OnPreDraw {\r\n  return !!a.onPreDraw;\r\n}\r\n\r\n/**\r\n *\r\n */\r\nexport function hasPostDraw(a: any): a is OnPostDraw {\r\n  return !!a.onPostDraw;\r\n}\r\n\r\nexport interface CanBeKilled {\r\n  /**\r\n   * Overridable implementation\r\n   */\r\n  onPreKill(_scene: Scene): void;\r\n\r\n  /**\r\n   * Event signatures\r\n   */\r\n  on(eventName: Events.prekill, handler: (event: Events.PreKillEvent) => void): void;\r\n  once(eventName: Events.prekill, handler: (event: Events.PreKillEvent) => void): void;\r\n  off(eventName: Events.prekill, handler: (event: Events.PreKillEvent) => void): void;\r\n\r\n  /**\r\n   * Overridable implementation\r\n   */\r\n  onPostKill(_scene: Scene): void;\r\n\r\n  /**\r\n   * Event signatures\r\n   */\r\n  on(eventName: Events.postkill, handler: (event: Events.PostKillEvent) => void): void;\r\n  once(eventName: Events.postkill, handler: (event: Events.PostKillEvent) => void): void;\r\n  off(eventName: Events.postkill, handler: (event: Events.PostKillEvent) => void): void;\r\n}\r\n","import { Audio } from '../../Interfaces/Audio';\r\nimport * as Util from '../../Util/Util';\r\nimport { AudioContextFactory } from './AudioContext';\r\n\r\n/**\r\n * Internal class representing a Web Audio AudioBufferSourceNode instance\r\n * @see https://developer.mozilla.org/en-US/docs/Web/API/Web_Audio_API\r\n */\r\nexport class WebAudioInstance implements Audio {\r\n  private _volume = 1;\r\n  private _duration: number | undefined = undefined;\r\n\r\n  private _playingPromise: Promise<boolean>;\r\n  private _playingResolve: (value: boolean) => void;\r\n\r\n  private _loop = false;\r\n  public set loop(value: boolean) {\r\n    this._loop = value;\r\n\r\n    if (this._instance) {\r\n      this._instance.loop = value;\r\n      this._wireUpOnEnded();\r\n    }\r\n  }\r\n  public get loop(): boolean {\r\n    return this._loop;\r\n  }\r\n\r\n  public set volume(value: number) {\r\n    value = Util.clamp(value, 0, 1.0);\r\n\r\n    this._volume = value;\r\n\r\n    if (this._isPlaying && this._volumeNode.gain.setTargetAtTime) {\r\n      // https://developer.mozilla.org/en-US/docs/Web/API/AudioParam/setTargetAtTime\r\n      // After each .1 seconds timestep, the target value will ~63.2% closer to the target value.\r\n      // This exponential ramp provides a more pleasant transition in gain\r\n      this._volumeNode.gain.setTargetAtTime(value, this._audioContext.currentTime, 0.1);\r\n    } else {\r\n      this._volumeNode.gain.value = value;\r\n    }\r\n  }\r\n  public get volume(): number {\r\n    return this._volume;\r\n  }\r\n\r\n  public set duration(value: number | undefined) {\r\n    this._duration = value;\r\n  }\r\n\r\n  /**\r\n   * Duration of the sound, in seconds.\r\n   */\r\n  public get duration() {\r\n    return this._duration;\r\n  }\r\n\r\n  private get _playbackRate(): number {\r\n    return this._instance ? 1 / (this._instance.playbackRate.value || 1.0) : null;\r\n  }\r\n\r\n  private _isPlaying = false;\r\n  private _isPaused = false;\r\n  private _instance: AudioBufferSourceNode;\r\n  private _audioContext: AudioContext = AudioContextFactory.create();\r\n  private _volumeNode = this._audioContext.createGain();\r\n  private _startTime: number;\r\n\r\n  /**\r\n   * Current playback offset (in seconds)\r\n   */\r\n  private _currentOffset = 0;\r\n\r\n  constructor(private _src: AudioBuffer) {\r\n    this._createNewBufferSource();\r\n  }\r\n\r\n  public isPlaying() {\r\n    return this._isPlaying;\r\n  }\r\n\r\n  // eslint-disable-next-line @typescript-eslint/no-empty-function\r\n  public play(playStarted: () => any = () => {}) {\r\n    if (this._isPaused) {\r\n      this._resumePlayBack();\r\n      playStarted();\r\n    }\r\n\r\n    if (!this._isPlaying) {\r\n      this._startPlayBack();\r\n      playStarted();\r\n    }\r\n\r\n    return this._playingPromise;\r\n  }\r\n\r\n  public pause() {\r\n    if (!this._isPlaying) {\r\n      return;\r\n    }\r\n\r\n    this._isPaused = true;\r\n    this._isPlaying = false;\r\n\r\n    this._instance.stop(0);\r\n    // Playback rate will be a scale factor of how fast/slow the audio is being played\r\n    // default is 1.0\r\n    // we need to invert it to get the time scale\r\n\r\n    this._setPauseOffset();\r\n  }\r\n\r\n  public stop() {\r\n    if (!this._isPlaying) {\r\n      return;\r\n    }\r\n\r\n    this._isPlaying = false;\r\n    this._isPaused = false;\r\n\r\n    this._currentOffset = 0;\r\n    this._instance.stop(0);\r\n\r\n    // handler will not be wired up if we were looping\r\n    if (!this._instance.onended) {\r\n      this._handleOnEnded();\r\n    }\r\n  }\r\n\r\n  private _startPlayBack() {\r\n    this._isPlaying = true;\r\n    this._isPaused = false;\r\n    this._playingPromise = new Promise<boolean>((resolve) => {\r\n      this._playingResolve = resolve;\r\n    });\r\n\r\n    if (!this._instance) {\r\n      this._createNewBufferSource();\r\n    }\r\n\r\n    this._rememberStartTime();\r\n\r\n    this._volumeNode.connect(this._audioContext.destination);\r\n    this._instance.start(0, 0);\r\n    this._currentOffset = 0;\r\n\r\n    this._wireUpOnEnded();\r\n  }\r\n\r\n  private _resumePlayBack() {\r\n    if (!this._isPaused) {\r\n      return;\r\n    }\r\n\r\n    this._isPaused = false;\r\n    this._isPlaying = true;\r\n\r\n    // a buffer source can only be started once\r\n    // so we need to dispose of the previous instance before\r\n    // \"resuming\" the next one\r\n    this._instance.onended = null; // dispose of any previous event handler\r\n    this._createNewBufferSource();\r\n\r\n    const duration = this._playbackRate * this._src.duration;\r\n    const restartTime = this._currentOffset % duration;\r\n\r\n    this._rememberStartTime(restartTime * -1000);\r\n    this._instance.start(0, restartTime);\r\n    this._wireUpOnEnded();\r\n  }\r\n\r\n  private _wireUpOnEnded() {\r\n    if (!this.loop) {\r\n      this._instance.onended = () => this._handleOnEnded();\r\n    }\r\n  }\r\n\r\n  private _handleOnEnded() {\r\n    // pausing calls stop(0) which triggers onended event\r\n    // so we don't \"resolve\" yet (when we resume we'll try again)\r\n    if (!this._isPaused) {\r\n      this._isPlaying = false;\r\n      this._playingResolve(true);\r\n    }\r\n  }\r\n\r\n  private _rememberStartTime(amend?: number) {\r\n    this._startTime = new Date().getTime() + (amend | 0);\r\n  }\r\n\r\n  private _setPauseOffset() {\r\n    this._currentOffset = ((new Date().getTime() - this._startTime) * this._playbackRate) / 1000; // in seconds\r\n  }\r\n\r\n  private _createNewBufferSource() {\r\n    this._instance = this._audioContext.createBufferSource();\r\n    this._instance.buffer = this._src;\r\n    this._instance.loop = this.loop;\r\n    this._instance.playbackRate.setValueAtTime(1.0, 0);\r\n\r\n    this._instance.connect(this._volumeNode);\r\n  }\r\n}\r\n","import { Logger } from './Log';\r\n\r\n/**\r\n * Whether or not the browser can play this file as HTML5 Audio\r\n */\r\nexport function canPlayFile(file: string): boolean {\r\n  try {\r\n    const a = new Audio();\r\n    const filetype = /.*\\.([A-Za-z0-9]+)$/;\r\n    const type = file.match(filetype)[1];\r\n    if (a.canPlayType('audio/' + type)) {\r\n      return true;\r\n    } else {\r\n      return false;\r\n    }\r\n  } catch (e) {\r\n    Logger.getInstance().warn('Cannot determine audio support, assuming no support for the Audio Tag', e);\r\n    return false;\r\n  }\r\n}\r\n","import { ExResponse } from '../../Interfaces/AudioImplementation';\r\nimport { Audio } from '../../Interfaces/Audio';\r\nimport { Engine } from '../../Engine';\r\nimport { Resource } from '../Resource';\r\nimport { WebAudioInstance } from './WebAudioInstance';\r\nimport { AudioContextFactory } from './AudioContext';\r\nimport { NativeSoundEvent, NativeSoundProcessedEvent } from '../../Events/MediaEvents';\r\nimport { canPlayFile } from '../../Util/Sound';\r\nimport { Loadable } from '../../Interfaces/Index';\r\nimport { Logger } from '../../Util/Log';\r\nimport { Class } from '../../Class';\r\n\r\n/**\r\n * The [[Sound]] object allows games built in Excalibur to load audio\r\n * components, from soundtracks to sound effects. [[Sound]] is an [[Loadable]]\r\n * which means it can be passed to a [[Loader]] to pre-load before a game or level.\r\n */\r\nexport class Sound extends Class implements Audio, Loadable<AudioBuffer> {\r\n  public logger: Logger = Logger.getInstance();\r\n  public data: AudioBuffer;\r\n  private _resource: Resource<ArrayBuffer>;\r\n  /**\r\n   * Indicates whether the clip should loop when complete\r\n   * @param value  Set the looping flag\r\n   */\r\n  public set loop(value: boolean) {\r\n    this._loop = value;\r\n\r\n    for (const track of this._tracks) {\r\n      track.loop = this._loop;\r\n    }\r\n\r\n    this.logger.debug('Set loop for all instances of sound', this.path, 'to', this._loop);\r\n  }\r\n  public get loop(): boolean {\r\n    return this._loop;\r\n  }\r\n\r\n  public set volume(value: number) {\r\n    this._volume = value;\r\n\r\n    for (const track of this._tracks) {\r\n      track.volume = this._volume;\r\n    }\r\n\r\n    this.emit('volumechange', new NativeSoundEvent(this));\r\n\r\n    this.logger.debug('Set loop for all instances of sound', this.path, 'to', this._volume);\r\n  }\r\n  public get volume(): number {\r\n    return this._volume;\r\n  }\r\n\r\n  public get duration(): number | undefined {\r\n    return this._duration;\r\n  }\r\n\r\n  /**\r\n   * Return array of Current AudioInstances playing or being paused\r\n   */\r\n  public get instances(): Audio[] {\r\n    return this._tracks;\r\n  }\r\n\r\n  public get path() {\r\n    return this._resource.path;\r\n  }\r\n\r\n  public set path(val: string) {\r\n    this._resource.path = val;\r\n  }\r\n\r\n  private _loop = false;\r\n  private _volume = 1;\r\n  private _duration: number | undefined = undefined;\r\n  private _isStopped = false;\r\n  private _isPaused = false;\r\n  private _tracks: Audio[] = [];\r\n  private _engine: Engine;\r\n  private _wasPlayingOnHidden: boolean = false;\r\n  private _audioContext = AudioContextFactory.create();\r\n\r\n  /**\r\n   * @param paths A list of audio sources (clip.wav, clip.mp3, clip.ogg) for this audio clip. This is done for browser compatibility.\r\n   */\r\n  constructor(...paths: string[]) {\r\n    super();\r\n    this._resource = new Resource('', ExResponse.type.arraybuffer);\r\n    /**\r\n     * Chrome : MP3, WAV, Ogg\r\n     * Firefox : WAV, Ogg,\r\n     * IE : MP3, WAV coming soon\r\n     * Safari MP3, WAV, Ogg\r\n     */\r\n    for (const path of paths) {\r\n      if (canPlayFile(path)) {\r\n        this.path = path;\r\n        break;\r\n      }\r\n    }\r\n\r\n    if (!this.path) {\r\n      this.logger.warn('This browser does not support any of the audio files specified:', paths.join(', '));\r\n      this.logger.warn('Attempting to use', paths[0]);\r\n      this.path = paths[0]; // select the first specified\r\n    }\r\n  }\r\n\r\n  public isLoaded() {\r\n    return !!this.data;\r\n  }\r\n\r\n  public async load(): Promise<AudioBuffer> {\r\n    if (this.data) {\r\n      return this.data;\r\n    }\r\n    const arraybuffer = await this._resource.load();\r\n    const audiobuffer = await this.decodeAudio(arraybuffer.slice(0));\r\n    this._duration = typeof audiobuffer === 'object' ? audiobuffer.duration : undefined;\r\n    this.emit('processed', new NativeSoundProcessedEvent(this, audiobuffer));\r\n    return this.data = audiobuffer;\r\n  }\r\n\r\n  public async decodeAudio(data: ArrayBuffer): Promise<AudioBuffer> {\r\n    try {\r\n      return await this._audioContext.decodeAudioData(data.slice(0));\r\n    } catch (e) {\r\n      this.logger.error(\r\n        'Unable to decode ' +\r\n          ' this browser may not fully support this format, or the file may be corrupt, ' +\r\n          'if this is an mp3 try removing id3 tags and album art from the file.'\r\n      );\r\n      return await Promise.reject();\r\n    }\r\n  }\r\n\r\n  public wireEngine(engine: Engine) {\r\n    if (engine) {\r\n      this._engine = engine;\r\n\r\n      this._engine.on('hidden', () => {\r\n        if (engine.pauseAudioWhenHidden && this.isPlaying()) {\r\n          this._wasPlayingOnHidden = true;\r\n          this.pause();\r\n        }\r\n      });\r\n\r\n      this._engine.on('visible', () => {\r\n        if (engine.pauseAudioWhenHidden && this._wasPlayingOnHidden) {\r\n          this.play();\r\n          this._wasPlayingOnHidden = false;\r\n        }\r\n      });\r\n\r\n      this._engine.on('start', () => {\r\n        this._isStopped = false;\r\n      });\r\n\r\n      this._engine.on('stop', () => {\r\n        this.stop();\r\n        this._isStopped = true;\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns how many instances of the sound are currently playing\r\n   */\r\n  public instanceCount(): number {\r\n    return this._tracks.length;\r\n  }\r\n\r\n  /**\r\n   * Whether or not the sound is playing right now\r\n   */\r\n  public isPlaying(): boolean {\r\n    return this._tracks.some((t) => t.isPlaying());\r\n  }\r\n\r\n  /**\r\n   * Play the sound, returns a promise that resolves when the sound is done playing\r\n   * An optional volume argument can be passed in to play the sound. Max volume is 1.0\r\n   */\r\n  public play(volume?: number): Promise<boolean> {\r\n    if (!this.isLoaded()) {\r\n      this.logger.warn('Cannot start playing. Resource', this.path, 'is not loaded yet');\r\n\r\n      return Promise.resolve(true);\r\n    }\r\n\r\n    if (this._isStopped) {\r\n      this.logger.warn('Cannot start playing. Engine is in a stopped state.');\r\n      return Promise.resolve(false);\r\n    }\r\n\r\n    this.volume = volume || this.volume;\r\n\r\n    if (this._isPaused) {\r\n      return this._resumePlayback();\r\n    } else {\r\n      return this._startPlayback();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Stop the sound, and do not rewind\r\n   */\r\n  public pause() {\r\n    if (!this.isPlaying()) {\r\n      return;\r\n    }\r\n\r\n    for (const track of this._tracks) {\r\n      track.pause();\r\n    }\r\n\r\n    this._isPaused = true;\r\n\r\n    this.emit('pause', new NativeSoundEvent(this));\r\n\r\n    this.logger.debug('Paused all instances of sound', this.path);\r\n  }\r\n\r\n  /**\r\n   * Stop the sound if it is currently playing and rewind the track. If the sound is not playing, rewinds the track.\r\n   */\r\n  public stop() {\r\n    for (const track of this._tracks) {\r\n      track.stop();\r\n    }\r\n\r\n    this.emit('stop', new NativeSoundEvent(this));\r\n\r\n    this._isPaused = false;\r\n    this._tracks.length = 0;\r\n    this.logger.debug('Stopped all instances of sound', this.path);\r\n  }\r\n\r\n\r\n\r\n  /**\r\n   * Get Id of provided AudioInstance in current trackList\r\n   * @param track [[Audio]] which Id is to be given\r\n   */\r\n  public getTrackId(track: Audio): number {\r\n    return this._tracks.indexOf(track);\r\n  }\r\n\r\n  private async _resumePlayback(): Promise<boolean> {\r\n    if (this._isPaused) {\r\n      const resumed: Promise<boolean>[] = [];\r\n      // ensure we resume *current* tracks (if paused)\r\n      for (const track of this._tracks) {\r\n        resumed.push(track.play());\r\n      }\r\n\r\n      this._isPaused = false;\r\n\r\n      this.emit('resume', new NativeSoundEvent(this));\r\n\r\n      this.logger.debug('Resuming paused instances for sound', this.path, this._tracks);\r\n      // resolve when resumed tracks are done\r\n      await Promise.all(resumed);\r\n    }\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Starts playback, returns a promise that resolves when playback is complete\r\n   */\r\n  private async _startPlayback(): Promise<boolean> {\r\n    const track = await this._getTrackInstance(this.data);\r\n\r\n    const complete = await track.play(() => {\r\n      this.emit('playbackstart', new NativeSoundEvent(this, track));\r\n      this.logger.debug('Playing new instance for sound', this.path);\r\n    });\r\n\r\n    // when done, remove track\r\n    this.emit('playbackend', new NativeSoundEvent(this, track));\r\n    this._tracks.splice(this.getTrackId(track), 1);\r\n\r\n    return complete;\r\n  }\r\n\r\n  private _getTrackInstance(data: AudioBuffer): WebAudioInstance {\r\n    const newTrack = new WebAudioInstance(data);\r\n\r\n    newTrack.loop = this.loop;\r\n    newTrack.volume = this.volume;\r\n    newTrack.duration = this.duration;\r\n\r\n    this._tracks.push(newTrack);\r\n\r\n    return newTrack;\r\n  }\r\n}\r\n","import { Resource } from './Resource';\r\nimport { Sprite } from '../Graphics/Sprite';\r\nimport { Color } from '../Color';\r\nimport { SpriteSheet } from '../Graphics/SpriteSheet';\r\nimport { Animation } from '../Graphics/Animation';\r\nimport { Engine } from '../Engine';\r\nimport { Loadable } from '../Interfaces/Index';\r\nimport { ImageSource } from '../Graphics/ImageSource';\r\nimport { LegacyDrawing } from '..';\r\nimport { range } from '../Util/Util';\r\n/**\r\n * The [[Texture]] object allows games built in Excalibur to load image resources.\r\n * [[Texture]] is an [[Loadable]] which means it can be passed to a [[Loader]]\r\n * to pre-load before starting a level or game.\r\n */\r\nexport class Gif implements Loadable<ImageSource[]> {\r\n  private _resource: Resource<ArrayBuffer>;\r\n\r\n  /**\r\n   * The width of the texture in pixels\r\n   */\r\n  public width: number;\r\n\r\n  /**\r\n   * The height of the texture in pixels\r\n   */\r\n  public height: number;\r\n\r\n\r\n  private _stream: Stream = null;\r\n  private _gif: ParseGif = null;\r\n  private _textures: ImageSource[] = [];\r\n  private _animation: Animation = null;\r\n  private _transparentColor: Color = null;\r\n\r\n  public data: ImageSource[];\r\n\r\n  /**\r\n   * @param path       Path to the image resource\r\n   * @param color      Optionally set the color to treat as transparent the gif, by default [[Color.Magenta]]\r\n   * @param bustCache  Optionally load texture with cache busting\r\n   */\r\n  constructor(public path: string, public color: Color = Color.Magenta, public bustCache = true) {\r\n    this._resource = new Resource(path, 'arraybuffer', bustCache);\r\n    this._transparentColor = color;\r\n  }\r\n\r\n  /**\r\n   * Begins loading the texture and returns a promise to be resolved on completion\r\n   */\r\n  public async load(): Promise<ImageSource[]> {\r\n    const arraybuffer = await this._resource.load();\r\n    this._stream = new Stream(arraybuffer);\r\n    this._gif = new ParseGif(this._stream, this._transparentColor);\r\n    const images = this._gif.images.map(i => new ImageSource(i.src, false));\r\n\r\n    // Load all textures\r\n    await Promise.all(images.map(t => t.load()));\r\n    return this.data = this._textures = images;\r\n  }\r\n\r\n  public isLoaded() {\r\n    return !!this.data;\r\n  }\r\n\r\n  /**\r\n   * Return a frame of the gif as a legacy sprite by index\r\n   * @deprecated\r\n   */\r\n  public toLegacySprite(id: number = 0): LegacyDrawing.Sprite {\r\n    return Sprite.toLegacySprite(this.toSprite(id));\r\n  }\r\n\r\n  /**\r\n   * Return the gif as a legacy spritesheet\r\n   * @deprecated\r\n   * @returns\r\n   */\r\n  public toLegacySpriteSheet(): LegacyDrawing.SpriteSheet {\r\n    return SpriteSheet.toLegacySpriteSheet(this.toSpriteSheet());\r\n  }\r\n\r\n  /**\r\n   * Return the gif as a legacy animation\r\n   * @deprecated\r\n   * @param speed\r\n   */\r\n  public toLegacyAnimation(engine: Engine, speed: number): LegacyDrawing.Animation {\r\n    return Animation.toLegacyAnimation(engine, this.toAnimation(speed));\r\n  }\r\n\r\n  /**\r\n   * Return a frame of the gif as a sprite by id\r\n   * @param id\r\n   */\r\n  public toSprite(id: number = 0): Sprite {\r\n    const sprite = this._textures[id].toSprite();\r\n    return sprite;\r\n  }\r\n\r\n  /**\r\n   * Return the gif as a spritesheet\r\n   */\r\n  public toSpriteSheet(): SpriteSheet {\r\n    const sprites: Sprite[] = this._textures.map((image) => {\r\n      return image.toSprite();\r\n    });\r\n    return new SpriteSheet({ sprites });\r\n  }\r\n\r\n  /**\r\n   * Transform the GIF into an animation with duration per frame\r\n   */\r\n  public toAnimation(durationPerFrameMs: number): Animation {\r\n    const spriteSheet: SpriteSheet = this.toSpriteSheet();\r\n    const length = spriteSheet.sprites.length;\r\n    this._animation = Animation.fromSpriteSheet(spriteSheet, range(0, length), durationPerFrameMs);\r\n    return this._animation;\r\n  }\r\n\r\n  public get readCheckBytes(): number[] {\r\n    return this._gif.checkBytes;\r\n  }\r\n}\r\n\r\nexport interface GifFrame {\r\n  sentinel: number;\r\n  type: string;\r\n  leftPos: number;\r\n  topPos: number;\r\n  width: number;\r\n  height: number;\r\n  lctFlag: boolean;\r\n  interlaced: boolean;\r\n  sorted: boolean;\r\n  reserved: boolean[];\r\n  lctSize: number;\r\n  lzwMinCodeSize: number;\r\n  pixels: number[];\r\n}\r\n\r\nconst bitsToNum = (ba: any) => {\r\n  return ba.reduce(function (s: number, n: number) {\r\n    return s * 2 + n;\r\n  }, 0);\r\n};\r\n\r\nconst byteToBitArr = (bite: any) => {\r\n  const a = [];\r\n  for (let i = 7; i >= 0; i--) {\r\n    a.push(!!(bite & (1 << i)));\r\n  }\r\n  return a;\r\n};\r\n\r\nexport class Stream {\r\n  data: any = null;\r\n  len: number = 0;\r\n  position: number = 0;\r\n\r\n  constructor(dataArray: ArrayBuffer) {\r\n    this.data = new Uint8Array(dataArray);\r\n    this.len = this.data.byteLength;\r\n    if (this.len === 0) {\r\n      throw new Error('No data loaded from file');\r\n    }\r\n  }\r\n\r\n  public readByte = () => {\r\n    if (this.position >= this.data.byteLength) {\r\n      throw new Error('Attempted to read past end of stream.');\r\n    }\r\n    return this.data[this.position++];\r\n  };\r\n\r\n  public readBytes = (n: number) => {\r\n    const bytes = [];\r\n    for (let i = 0; i < n; i++) {\r\n      bytes.push(this.readByte());\r\n    }\r\n    return bytes;\r\n  };\r\n\r\n  public read = (n: number) => {\r\n    let s = '';\r\n    for (let i = 0; i < n; i++) {\r\n      s += String.fromCharCode(this.readByte());\r\n    }\r\n    return s;\r\n  };\r\n\r\n  public readUnsigned = () => {\r\n    // Little-endian.\r\n    const a = this.readBytes(2);\r\n    return (a[1] << 8) + a[0];\r\n  };\r\n}\r\n\r\nconst lzwDecode = function (minCodeSize: number, data: any) {\r\n  // TODO: Now that the GIF parser is a bit different, maybe this should get an array of bytes instead of a String?\r\n  let pos = 0; // Maybe this streaming thing should be merged with the Stream?\r\n\r\n  const readCode = function (size: number) {\r\n    let code = 0;\r\n    for (let i = 0; i < size; i++) {\r\n      if (data.charCodeAt(pos >> 3) & (1 << (pos & 7))) {\r\n        code |= 1 << i;\r\n      }\r\n      pos++;\r\n    }\r\n    return code;\r\n  };\r\n\r\n  const output: any[] = [];\r\n\r\n  const clearCode = 1 << minCodeSize;\r\n  const eoiCode = clearCode + 1;\r\n\r\n  let codeSize = minCodeSize + 1;\r\n\r\n  let dict: any[] = [];\r\n\r\n  const clear = function () {\r\n    dict = [];\r\n    codeSize = minCodeSize + 1;\r\n    for (let i = 0; i < clearCode; i++) {\r\n      dict[i] = [i];\r\n    }\r\n    dict[clearCode] = [];\r\n    dict[eoiCode] = null;\r\n  };\r\n\r\n  let code;\r\n  let last;\r\n\r\n  while (true) {\r\n    last = code;\r\n    code = readCode(codeSize);\r\n    if (code === clearCode) {\r\n      clear();\r\n      continue;\r\n    }\r\n    if (code === eoiCode) {\r\n      break;\r\n    }\r\n\r\n    if (code < dict.length) {\r\n      if (last !== clearCode) {\r\n        dict.push(dict[last].concat(dict[code][0]));\r\n      }\r\n    } else {\r\n      if (code !== dict.length) {\r\n        throw new Error('Invalid LZW code.');\r\n      }\r\n      dict.push(dict[last].concat(dict[last][0]));\r\n    }\r\n    output.push.apply(output, dict[code]);\r\n\r\n    if (dict.length === 1 << codeSize && codeSize < 12) {\r\n      // If we're at the last code and codeSize is 12, the next code will be a clearCode, and it'll be 12 bits long.\r\n      codeSize++;\r\n    }\r\n  }\r\n\r\n  // I don't know if this is technically an error, but some GIFs do it.\r\n  //if (Math.ceil(pos / 8) !== data.length) throw new Error('Extraneous LZW bytes.');\r\n  return output;\r\n};\r\n\r\n// The actual parsing; returns an object with properties.\r\nexport class ParseGif {\r\n  private _st: Stream = null;\r\n  private _handler: any = {};\r\n  private _transparentColor: Color = null;\r\n  public frames: GifFrame[] = [];\r\n  public images: HTMLImageElement[] = [];\r\n  public globalColorTable: any[] = [];\r\n  public checkBytes: number[] = [];\r\n\r\n  constructor(stream: Stream, color: Color = Color.Magenta) {\r\n    this._st = stream;\r\n    this._handler = {};\r\n    this._transparentColor = color;\r\n    this.parseHeader();\r\n    this.parseBlock();\r\n  }\r\n\r\n  // LZW (GIF-specific)\r\n  parseColorTable = (entries: any) => {\r\n    // Each entry is 3 bytes, for RGB.\r\n    const ct = [];\r\n    for (let i = 0; i < entries; i++) {\r\n      const rgb: number[] = this._st.readBytes(3);\r\n      const rgba =\r\n        '#' +\r\n        rgb\r\n          .map((x: any) => {\r\n            const hex = x.toString(16);\r\n            return hex.length === 1 ? '0' + hex : hex;\r\n          })\r\n          .join('');\r\n      ct.push(rgba);\r\n    }\r\n    return ct;\r\n  };\r\n\r\n  readSubBlocks = () => {\r\n    let size, data;\r\n    data = '';\r\n    do {\r\n      size = this._st.readByte();\r\n      data += this._st.read(size);\r\n    } while (size !== 0);\r\n    return data;\r\n  };\r\n\r\n  parseHeader = () => {\r\n    const hdr: any = {\r\n      sig: null,\r\n      ver: null,\r\n      width: null,\r\n      height: null,\r\n      colorRes: null,\r\n      globalColorTableSize: null,\r\n      gctFlag: null,\r\n      sorted: null,\r\n      globalColorTable: [],\r\n      bgColor: null,\r\n      pixelAspectRatio: null // if not 0, aspectRatio = (pixelAspectRatio + 15) / 64\r\n    };\r\n\r\n    hdr.sig = this._st.read(3);\r\n    hdr.ver = this._st.read(3);\r\n    if (hdr.sig !== 'GIF') {\r\n      throw new Error('Not a GIF file.'); // XXX: This should probably be handled more nicely.\r\n    }\r\n\r\n    hdr.width = this._st.readUnsigned();\r\n    hdr.height = this._st.readUnsigned();\r\n\r\n    const bits = byteToBitArr(this._st.readByte());\r\n    hdr.gctFlag = bits.shift();\r\n    hdr.colorRes = bitsToNum(bits.splice(0, 3));\r\n    hdr.sorted = bits.shift();\r\n    hdr.globalColorTableSize = bitsToNum(bits.splice(0, 3));\r\n\r\n    hdr.bgColor = this._st.readByte();\r\n    hdr.pixelAspectRatio = this._st.readByte(); // if not 0, aspectRatio = (pixelAspectRatio + 15) / 64\r\n\r\n    if (hdr.gctFlag) {\r\n      hdr.globalColorTable = this.parseColorTable(1 << (hdr.globalColorTableSize + 1));\r\n      this.globalColorTable = hdr.globalColorTable;\r\n    }\r\n    if (this._handler.hdr && this._handler.hdr(hdr)) {\r\n      this.checkBytes.push(this._handler.hdr);\r\n    }\r\n  };\r\n\r\n  parseExt = (block: any) => {\r\n    const parseGCExt = (block: any) => {\r\n      this.checkBytes.push(this._st.readByte()); // Always 4\r\n\r\n      const bits = byteToBitArr(this._st.readByte());\r\n      block.reserved = bits.splice(0, 3); // Reserved; should be 000.\r\n      block.disposalMethod = bitsToNum(bits.splice(0, 3));\r\n      block.userInput = bits.shift();\r\n      block.transparencyGiven = bits.shift();\r\n\r\n      block.delayTime = this._st.readUnsigned();\r\n\r\n      block.transparencyIndex = this._st.readByte();\r\n\r\n      block.terminator = this._st.readByte();\r\n\r\n      if (this._handler.gce && this._handler.gce(block)) {\r\n        this.checkBytes.push(this._handler.gce);\r\n      }\r\n    };\r\n\r\n    const parseComExt = (block: any) => {\r\n      block.comment = this.readSubBlocks();\r\n      if (this._handler.com && this._handler.com(block)) {\r\n        this.checkBytes.push(this._handler.com);\r\n      }\r\n    };\r\n\r\n    const parsePTExt = (block: any) => {\r\n      this.checkBytes.push(this._st.readByte()); // Always 12\r\n      block.ptHeader = this._st.readBytes(12);\r\n      block.ptData = this.readSubBlocks();\r\n      if (this._handler.pte && this._handler.pte(block)) {\r\n        this.checkBytes.push(this._handler.pte);\r\n      }\r\n    };\r\n\r\n    const parseAppExt = (block: any) => {\r\n      const parseNetscapeExt = (block: any) => {\r\n        this.checkBytes.push(this._st.readByte()); // Always 3\r\n        block.unknown = this._st.readByte(); // Q: Always 1? What is this?\r\n        block.iterations = this._st.readUnsigned();\r\n        block.terminator = this._st.readByte();\r\n        if (this._handler.app && this._handler.app.NETSCAPE && this._handler.app.NETSCAPE(block)) {\r\n          this.checkBytes.push(this._handler.app);\r\n        }\r\n      };\r\n\r\n      const parseUnknownAppExt = (block: any) => {\r\n        block.appData = this.readSubBlocks();\r\n        // FIXME: This won't work if a handler wants to match on any identifier.\r\n        if (this._handler.app && this._handler.app[block.identifier] && this._handler.app[block.identifier](block)) {\r\n          this.checkBytes.push(this._handler.app[block.identifier]);\r\n        }\r\n      };\r\n\r\n      this.checkBytes.push(this._st.readByte()); // Always 11\r\n      block.identifier = this._st.read(8);\r\n      block.authCode = this._st.read(3);\r\n      switch (block.identifier) {\r\n        case 'NETSCAPE':\r\n          parseNetscapeExt(block);\r\n          break;\r\n        default:\r\n          parseUnknownAppExt(block);\r\n          break;\r\n      }\r\n    };\r\n\r\n    const parseUnknownExt = (block: any) => {\r\n      block.data = this.readSubBlocks();\r\n      if (this._handler.unknown && this._handler.unknown(block)) {\r\n        this.checkBytes.push(this._handler.unknown);\r\n      }\r\n    };\r\n\r\n    block.label = this._st.readByte();\r\n    switch (block.label) {\r\n      case 0xf9:\r\n        block.extType = 'gce';\r\n        parseGCExt(block);\r\n        break;\r\n      case 0xfe:\r\n        block.extType = 'com';\r\n        parseComExt(block);\r\n        break;\r\n      case 0x01:\r\n        block.extType = 'pte';\r\n        parsePTExt(block);\r\n        break;\r\n      case 0xff:\r\n        block.extType = 'app';\r\n        parseAppExt(block);\r\n        break;\r\n      default:\r\n        block.extType = 'unknown';\r\n        parseUnknownExt(block);\r\n        break;\r\n    }\r\n  };\r\n\r\n  parseImg = (img: any) => {\r\n    const deinterlace = (pixels: any, width: any) => {\r\n      // Of course this defeats the purpose of interlacing. And it's *probably*\r\n      // the least efficient way it's ever been implemented. But nevertheless...\r\n\r\n      const newPixels = new Array(pixels.length);\r\n      const rows = pixels.length / width;\r\n      const cpRow = (toRow: any, fromRow: any) => {\r\n        const fromPixels = pixels.slice(fromRow * width, (fromRow + 1) * width);\r\n        newPixels.splice.apply(newPixels, [toRow * width, width].concat(fromPixels));\r\n      };\r\n\r\n      const offsets = [0, 4, 2, 1];\r\n      const steps = [8, 8, 4, 2];\r\n\r\n      let fromRow = 0;\r\n      for (let pass = 0; pass < 4; pass++) {\r\n        for (let toRow = offsets[pass]; toRow < rows; toRow += steps[pass]) {\r\n          cpRow(toRow, fromRow);\r\n          fromRow++;\r\n        }\r\n      }\r\n\r\n      return newPixels;\r\n    };\r\n\r\n    img.leftPos = this._st.readUnsigned();\r\n    img.topPos = this._st.readUnsigned();\r\n    img.width = this._st.readUnsigned();\r\n    img.height = this._st.readUnsigned();\r\n\r\n    const bits = byteToBitArr(this._st.readByte());\r\n    img.lctFlag = bits.shift();\r\n    img.interlaced = bits.shift();\r\n    img.sorted = bits.shift();\r\n    img.reserved = bits.splice(0, 2);\r\n    img.lctSize = bitsToNum(bits.splice(0, 3));\r\n\r\n    if (img.lctFlag) {\r\n      img.lct = this.parseColorTable(1 << (img.lctSize + 1));\r\n    }\r\n\r\n    img.lzwMinCodeSize = this._st.readByte();\r\n\r\n    const lzwData = this.readSubBlocks();\r\n\r\n    img.pixels = lzwDecode(img.lzwMinCodeSize, lzwData);\r\n\r\n    if (img.interlaced) {\r\n      // Move\r\n      img.pixels = deinterlace(img.pixels, img.width);\r\n    }\r\n\r\n    this.frames.push(img);\r\n    this.arrayToImage(img);\r\n    if (this._handler.img && this._handler.img(img)) {\r\n      this.checkBytes.push(this._handler);\r\n    }\r\n  };\r\n\r\n  public parseBlock = () => {\r\n    const block = {\r\n      sentinel: this._st.readByte(),\r\n      type: ''\r\n    };\r\n    const blockChar = String.fromCharCode(block.sentinel);\r\n    switch (blockChar) {\r\n      case '!':\r\n        block.type = 'ext';\r\n        this.parseExt(block);\r\n        break;\r\n      case ',':\r\n        block.type = 'img';\r\n        this.parseImg(block);\r\n        break;\r\n      case ';':\r\n        block.type = 'eof';\r\n        if (this._handler.eof && this._handler.eof(block)) {\r\n          this.checkBytes.push(this._handler.eof);\r\n        }\r\n        break;\r\n      default:\r\n        throw new Error('Unknown block: 0x' + block.sentinel.toString(16));\r\n    }\r\n\r\n    if (block.type !== 'eof') {\r\n      this.parseBlock();\r\n    }\r\n  };\r\n\r\n  arrayToImage = (frame: GifFrame) => {\r\n    let count = 0;\r\n    const c = document.createElement('canvas');\r\n    c.id = count.toString();\r\n    c.width = frame.width;\r\n    c.height = frame.height;\r\n    count++;\r\n    const context = c.getContext('2d');\r\n    const pixSize = 1;\r\n    let y = 0;\r\n    let x = 0;\r\n    for (let i = 0; i < frame.pixels.length; i++) {\r\n      if (x % frame.width === 0) {\r\n        y++;\r\n        x = 0;\r\n      }\r\n      if (this.globalColorTable[frame.pixels[i]] === this._transparentColor.toHex()) {\r\n        context.fillStyle = `rgba(0, 0, 0, 0)`;\r\n      } else {\r\n        context.fillStyle = this.globalColorTable[frame.pixels[i]];\r\n      }\r\n\r\n      context.fillRect(x, y, pixSize, pixSize);\r\n      x++;\r\n    }\r\n    const img = new Image();\r\n    img.src = c.toDataURL();\r\n    this.images.push(img);\r\n  };\r\n}\r\n","import { Vector, vec } from '../Math/vector';\nimport { Raster, RasterOptions } from './Raster';\n\nexport interface PolygonOptions {\n  points: Vector[];\n}\n\n/**\n * A polygon [[Graphic]] for drawing arbitrary polygons to the [[ExcaliburGraphicsContext]]\n */\nexport class Polygon extends Raster {\n  private _points: Vector[];\n  public get points(): Vector[] {\n    return this._points;\n  }\n  public set points(points: Vector[]) {\n    this._points = points;\n    const min = this.minPoint;\n    this.width = this._points.reduce((max, p) => Math.max(p.x, max), 0) - min.x;\n    this.height = this._points.reduce((max, p) => Math.max(p.y, max), 0) - min.y;\n    this.flagDirty();\n  }\n\n  public get minPoint() {\n    const minX = this._points.reduce((min, p) => Math.min(p.x, min), Infinity);\n    const minY = this._points.reduce((min, p) => Math.min(p.y, min), Infinity);\n    return vec(minX, minY);\n  }\n\n  constructor(options: RasterOptions & PolygonOptions) {\n    super(options);\n    this.points = options.points;\n    this.rasterize();\n  }\n\n  public clone(): Polygon {\n    return new Polygon({\n      points: this.points.map((p) => p.clone()),\n      ...this.cloneGraphicOptions(),\n      ...this.cloneRasterOptions()\n    });\n  }\n\n  execute(ctx: CanvasRenderingContext2D): void {\n    if (this.points && this.points.length) {\n      ctx.beginPath();\n      // Iterate through the supplied points and construct a 'polygon'\n      const min = this.minPoint.negate();\n      const firstPoint = this.points[0].add(min);\n      ctx.moveTo(firstPoint.x, firstPoint.y);\n      this.points.forEach((point) => {\n        ctx.lineTo(point.x + min.x, point.y + min.y);\n      });\n      ctx.lineTo(firstPoint.x, firstPoint.y);\n      ctx.closePath();\n      if (this.color) {\n        ctx.fill();\n      }\n      if (this.strokeColor) {\n        ctx.stroke();\n      }\n    }\n  }\n}\n","import { obsolete } from './Decorators';\r\n\r\n/**\r\n * A sorted list implementation. NOTE: this implementation is not self-balancing\r\n * @deprecated WIll be removed in v0.26.0 Use built in JS array.sort\r\n */\r\n@obsolete({message: 'Will be removed in excalibur v0.26.0', alternateMethod: 'Use built in JS array.sort'})\r\nexport class SortedList<T> {\r\n  private _getComparable: (item: T) => number;\r\n  private _root: BinaryTreeNode<T>;\r\n\r\n  constructor(getComparable: (item: T) => number) {\r\n    this._getComparable = getComparable;\r\n  }\r\n\r\n  public find(element: T): boolean {\r\n    return this._find(this._root, element);\r\n  }\r\n\r\n  private _find(node: BinaryTreeNode<T>, element: any): boolean {\r\n    if (node == null) {\r\n      return false;\r\n    } else if (this._getComparable(element) === node.getKey()) {\r\n      if (node.getData().indexOf(element) > -1) {\r\n        return true;\r\n      } else {\r\n        return false;\r\n      }\r\n    } else if (this._getComparable(element) < node.getKey()) {\r\n      return this._find(node.getLeft(), element);\r\n    } else {\r\n      return this._find(node.getRight(), element);\r\n    }\r\n  }\r\n\r\n  // returns the array of elements at a specific key value\r\n  public get(key: number): any[] {\r\n    return this._get(this._root, key);\r\n  }\r\n\r\n  private _get(node: BinaryTreeNode<T>, key: number): any[] {\r\n    if (node == null) {\r\n      return [];\r\n    } else if (key === node.getKey()) {\r\n      return node.getData();\r\n    } else if (key < node.getKey()) {\r\n      return this._get(node.getLeft(), key);\r\n    } else {\r\n      return this._get(node.getRight(), key);\r\n    }\r\n  }\r\n\r\n  public add(element: T): boolean {\r\n    if (this._root == null) {\r\n      this._root = new BinaryTreeNode(this._getComparable(element), [element], null, null);\r\n      return true;\r\n    } else {\r\n      return this._insert(this._root, element);\r\n    }\r\n  }\r\n\r\n  private _insert(node: BinaryTreeNode<T>, element: T): boolean {\r\n    if (node != null) {\r\n      if (this._getComparable(element) === node.getKey()) {\r\n        if (node.getData().indexOf(element) > -1) {\r\n          return false; // the element we're trying to insert already exists\r\n        } else {\r\n          node.getData().push(element);\r\n          return true;\r\n        }\r\n      } else if (this._getComparable(element) < node.getKey()) {\r\n        if (node.getLeft() == null) {\r\n          node.setLeft(new BinaryTreeNode(this._getComparable(element), [element], null, null));\r\n          return true;\r\n        } else {\r\n          return this._insert(node.getLeft(), element);\r\n        }\r\n      } else {\r\n        if (node.getRight() == null) {\r\n          node.setRight(new BinaryTreeNode(this._getComparable(element), [element], null, null));\r\n          return true;\r\n        } else {\r\n          return this._insert(node.getRight(), element);\r\n        }\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n\r\n  public removeByComparable(element: T): void {\r\n    this._root = this._remove(this._root, element);\r\n  }\r\n\r\n  private _remove(node: BinaryTreeNode<T>, element: T): BinaryTreeNode<T> {\r\n    if (node == null) {\r\n      return null;\r\n    } else if (this._getComparable(element) === node.getKey()) {\r\n      const elementIndex = node.getData().indexOf(element);\r\n      // if the node contains the element, remove the element\r\n      if (elementIndex > -1) {\r\n        node.getData().splice(elementIndex, 1);\r\n        // if we have removed the last element at this node, remove the node\r\n        if (node.getData().length === 0) {\r\n          // if the node is a leaf\r\n          if (node.getLeft() == null && node.getRight() == null) {\r\n            return null;\r\n          } else if (node.getLeft() == null) {\r\n            return node.getRight();\r\n          } else if (node.getRight() == null) {\r\n            return node.getLeft();\r\n          }\r\n          // if node has 2 children\r\n          const temp = this._findMinNode(node.getRight());\r\n          node.setKey(temp.getKey());\r\n          node.setData(temp.getData());\r\n          node.setRight(this._cleanup(node.getRight(), temp)); //\"cleanup nodes\" (move them up recursively)\r\n          return node;\r\n        } else {\r\n          // this prevents the node from being removed since it still contains elements\r\n          return node;\r\n        }\r\n      }\r\n    } else if (this._getComparable(element) < node.getKey()) {\r\n      node.setLeft(this._remove(node.getLeft(), element));\r\n      return node;\r\n    } else {\r\n      node.setRight(this._remove(node.getRight(), element));\r\n      return node;\r\n    }\r\n    return null;\r\n  }\r\n\r\n  // called once we have successfully removed the element we wanted, recursively corrects the part of the tree below the removed node\r\n  private _cleanup(node: BinaryTreeNode<T>, element: BinaryTreeNode<T>): BinaryTreeNode<T> {\r\n    const comparable = element.getKey();\r\n    if (node == null) {\r\n      return null;\r\n    } else if (comparable === node.getKey()) {\r\n      // if the node is a leaf\r\n      if (node.getLeft() == null && node.getRight() == null) {\r\n        return null;\r\n      } else if (node.getLeft() == null) {\r\n        return node.getRight();\r\n      } else if (node.getRight() == null) {\r\n        return node.getLeft();\r\n      }\r\n      // if node has 2 children\r\n      const temp = this._findMinNode(node.getRight());\r\n      node.setKey(temp.getKey());\r\n      node.setData(temp.getData());\r\n\r\n      node.setRight(this._cleanup(node.getRight(), temp));\r\n      return node;\r\n    } else if (element.getKey() < node.getKey()) {\r\n      node.setLeft(this._cleanup(node.getLeft(), element));\r\n      return node;\r\n    } else {\r\n      node.setRight(this._cleanup(node.getRight(), element));\r\n      return node;\r\n    }\r\n  }\r\n\r\n  private _findMinNode(node: BinaryTreeNode<T>): BinaryTreeNode<T> {\r\n    let current = node;\r\n    while (current.getLeft() != null) {\r\n      current = current.getLeft();\r\n    }\r\n    return current;\r\n  }\r\n\r\n  public list(): Array<T> {\r\n    const results = new Array<T>();\r\n    this._list(this._root, results);\r\n    return results;\r\n  }\r\n\r\n  private _list(treeNode: BinaryTreeNode<T>, results: Array<T>): void {\r\n    if (treeNode != null) {\r\n      this._list(treeNode.getLeft(), results);\r\n      treeNode.getData().forEach((element) => {\r\n        results.push(element);\r\n      });\r\n      this._list(treeNode.getRight(), results);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * A tree node part of [[SortedList]]\r\n * @deprecated Will be removed in v0.26.0\r\n */\r\n@obsolete({message: 'Will be removed in excalibur v0.26.0'})\r\nexport class BinaryTreeNode<T> {\r\n  private _key: number;\r\n  private _data: Array<T>;\r\n  private _left: BinaryTreeNode<T>;\r\n  private _right: BinaryTreeNode<T>;\r\n\r\n  constructor(key: number, data: Array<T>, left: BinaryTreeNode<T>, right: BinaryTreeNode<T>) {\r\n    this._key = key;\r\n    this._data = data;\r\n    this._left = left;\r\n    this._right = right;\r\n  }\r\n\r\n  public getKey(): number {\r\n    return this._key;\r\n  }\r\n\r\n  public setKey(key: number) {\r\n    this._key = key;\r\n  }\r\n\r\n  public getData(): T[] {\r\n    return this._data;\r\n  }\r\n\r\n  public setData(data: T[]) {\r\n    this._data = data;\r\n  }\r\n\r\n  public getLeft(): BinaryTreeNode<T> {\r\n    return this._left;\r\n  }\r\n\r\n  public setLeft(left: BinaryTreeNode<T>) {\r\n    this._left = left;\r\n  }\r\n\r\n  public getRight(): BinaryTreeNode<T> {\r\n    return this._right;\r\n  }\r\n\r\n  public setRight(right: BinaryTreeNode<T>) {\r\n    this._right = right;\r\n  }\r\n}\r\n\r\n/**\r\n * Mock element for testing\r\n *\r\n * @internal\r\n * @deprecated Will be removed in v0.26.0\r\n */\r\nexport class MockedElement {\r\n  private _key: number = 0;\r\n\r\n  constructor(key: number) {\r\n    this._key = key;\r\n  }\r\n\r\n  public getTheKey() {\r\n    return this._key;\r\n  }\r\n\r\n  public setKey(key: number) {\r\n    this._key = key;\r\n  }\r\n}\r\n","// Promises/A+ Spec http://promises-aplus.github.io/promises-spec/\r\n\r\nimport { obsolete } from './Util/Decorators';\r\n\r\n/**\r\n * Valid states for a promise to be in\r\n * @deprecated Will be removed in v0.26.0\r\n */\r\nexport enum PromiseState {\r\n  Resolved,\r\n  Rejected,\r\n  Pending\r\n}\r\n\r\n/**\r\n * @deprecated Will be removed in v0.26.0\r\n */\r\nexport interface PromiseLike<T> {\r\n  then(successCallback?: (value?: T) => any, rejectCallback?: (value?: T) => any): PromiseLike<T>;\r\n  error(rejectCallback?: (value?: any) => any): PromiseLike<T>;\r\n\r\n  //Cannot define static methods on interfaces\r\n  //wrap<T>(value?: T): IPromise<T>;\r\n\r\n  resolve(value?: T): PromiseLike<T>;\r\n  reject(value?: any): PromiseLike<T>;\r\n\r\n  state(): PromiseState;\r\n}\r\n\r\n/**\r\n * Promises are used to do asynchronous work and they are useful for\r\n * creating a chain of actions. In Excalibur they are used for loading,\r\n * sounds, animation, actions, and more.\r\n * @deprecated Will be removed in v0.26.0\r\n */\r\n@obsolete({\r\n  message: 'ex.Promises are being replaced by native browser promises in v0.26.0',\r\n  alternateMethod: 'Use browser native promises'\r\n})\r\nexport class Promise<T> implements PromiseLike<T> {\r\n  private _state: PromiseState = PromiseState.Pending;\r\n  private _value: T;\r\n  private _successCallbacks: { (value?: T): any }[] = [];\r\n  private _rejectCallback: (value?: any) => any = () => {\r\n    return;\r\n  };\r\n  private _errorCallback: (value?: any) => any;\r\n\r\n  /**\r\n   * Create and resolve a Promise with an optional value\r\n   * @param value  An optional value to wrap in a resolved promise\r\n   * @deprecated Use browser native promises\r\n   */\r\n  public static resolve<T>(value?: T): Promise<T> {\r\n    const promise = new Promise<T>().resolve(value);\r\n\r\n    return promise;\r\n  }\r\n\r\n  /**\r\n   * Create and reject a Promise with an optional value\r\n   * @param value  An optional value to wrap in a rejected promise\r\n   * @deprecated Use browser native promises\r\n   */\r\n  public static reject<T>(value?: T): Promise<T> {\r\n    const promise = new Promise<T>().reject(value);\r\n\r\n    return promise;\r\n  }\r\n\r\n  /**\r\n   * Returns a new promise that resolves when all the promises passed to it resolve, or rejects\r\n   * when at least 1 promise rejects.\r\n   * @deprecated Use browser native promises\r\n   */\r\n  public static join<T>(promises: Promise<T>[]): Promise<T>;\r\n\r\n  /**\r\n   * Returns a new promise that resolves when all the promises passed to it resolve, or rejects\r\n   * when at least 1 promise rejects.\r\n   * @deprecated Use browser native promises\r\n   */\r\n  public static join<T>(...promises: Promise<T>[]): Promise<T>;\r\n\r\n  public static join<T>() {\r\n    let promises: Promise<T>[] = [];\r\n\r\n    if (arguments.length > 0 && !Array.isArray(arguments[0])) {\r\n      for (let _i = 0; _i < arguments.length; _i++) {\r\n        promises[_i - 0] = arguments[_i];\r\n      }\r\n    } else if (arguments.length === 1 && Array.isArray(arguments[0])) {\r\n      promises = arguments[0];\r\n    }\r\n\r\n    const joinedPromise = new Promise<T>();\r\n    if (!promises || !promises.length) {\r\n      return joinedPromise.resolve();\r\n    }\r\n\r\n    const total = promises.length;\r\n    let successes = 0;\r\n    let rejects = 0;\r\n    const errors: any = [];\r\n\r\n    promises.forEach((p) => {\r\n      p.then(\r\n        () => {\r\n          successes += 1;\r\n          if (successes === total) {\r\n            joinedPromise.resolve();\r\n          } else if (successes + rejects + errors.length === total) {\r\n            joinedPromise.reject(errors);\r\n          }\r\n        },\r\n        () => {\r\n          rejects += 1;\r\n          if (successes + rejects + errors.length === total) {\r\n            joinedPromise.reject(errors);\r\n          }\r\n        }\r\n      ).error((e) => {\r\n        errors.push(e);\r\n        if (errors.length + successes + rejects === total) {\r\n          joinedPromise.reject(errors);\r\n        }\r\n      });\r\n    });\r\n\r\n    return joinedPromise;\r\n  }\r\n\r\n  /**\r\n   * Chain success and reject callbacks after the promise is resolved\r\n   * @param successCallback  Call on resolution of promise\r\n   * @param rejectCallback   Call on rejection of promise\r\n   * @deprecated Use browser native promises\r\n   */\r\n  public then(successCallback?: (value?: T) => any, rejectCallback?: (value?: any) => any) {\r\n    if (successCallback) {\r\n      this._successCallbacks.push(successCallback);\r\n\r\n      // If the promise is already resolved call immediately\r\n      if (this.state() === PromiseState.Resolved) {\r\n        try {\r\n          successCallback.call(this, this._value);\r\n        } catch (e) {\r\n          this._handleError(e);\r\n        }\r\n      }\r\n    }\r\n    if (rejectCallback) {\r\n      this._rejectCallback = rejectCallback;\r\n\r\n      // If the promise is already rejected call immediately\r\n      if (this.state() === PromiseState.Rejected) {\r\n        try {\r\n          rejectCallback.call(this, this._value);\r\n        } catch (e) {\r\n          this._handleError(e);\r\n        }\r\n      }\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Add an error callback to the promise\r\n   * @param errorCallback  Call if there was an error in a callback\r\n   * @deprecated Use browser native promises\r\n   */\r\n  public error(errorCallback?: (value?: any) => any) {\r\n    if (errorCallback) {\r\n      this._errorCallback = errorCallback;\r\n    }\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Resolve the promise and pass an option value to the success callbacks\r\n   * @param value  Value to pass to the success callbacks\r\n   * @deprecated Use browser native promises\r\n   */\r\n  public resolve(value?: T): Promise<T> {\r\n    if (this._state === PromiseState.Pending) {\r\n      this._value = value;\r\n      try {\r\n        this._state = PromiseState.Resolved;\r\n        this._successCallbacks.forEach((cb) => {\r\n          cb.call(this, this._value);\r\n        });\r\n      } catch (e) {\r\n        this._handleError(e);\r\n      }\r\n    } else {\r\n      throw new Error('Cannot resolve a promise that is not in a pending state!');\r\n    }\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Reject the promise and pass an option value to the reject callbacks\r\n   * @param value  Value to pass to the reject callbacks\r\n   * @deprecated Use browser native promises\r\n   */\r\n  public reject(value?: any) {\r\n    if (this._state === PromiseState.Pending) {\r\n      this._value = value;\r\n      try {\r\n        this._state = PromiseState.Rejected;\r\n        this._rejectCallback.call(this, this._value);\r\n      } catch (e) {\r\n        this._handleError(e);\r\n      }\r\n    } else {\r\n      throw new Error('Cannot reject a promise that is not in a pending state!');\r\n    }\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Inspect the current state of a promise\r\n   * @deprecated Use browser native promises\r\n   */\r\n  public state(): PromiseState {\r\n    return this._state;\r\n  }\r\n\r\n  private _handleError(e: any) {\r\n    if (this._errorCallback) {\r\n      this._errorCallback.call(this, e);\r\n    } else {\r\n      // rethrow error\r\n      throw e;\r\n    }\r\n  }\r\n}\r\n","/**\r\n * The current Excalibur version string\r\n * @description `process.env.__EX_VERSION` gets replaced by Webpack on build\r\n */\r\nexport const EX_VERSION = process.env.__EX_VERSION;\r\nimport { polyfill } from './Polyfill';\r\npolyfill();\r\n\r\n// This file is used as the bundle entry point and exports everything\r\n// that will be exposed as the `ex` global variable.\r\nexport * from './Flags';\r\nexport * from './Id';\r\nexport * from './Engine';\r\nexport * from './Screen';\r\nexport { Actor, ActorArgs } from './Actor';\r\nexport * from './Math/Index';\r\nexport * from './Camera';\r\nexport * from './Class';\r\nexport * from './Configurable';\r\nexport * from './Debug/index';\r\nexport * from './EventDispatcher';\r\nexport * from './Events/MediaEvents';\r\nexport * from './Events';\r\nexport * from './Label';\r\nexport { FontStyle, FontUnit, TextAlign, BaseAlign } from './Graphics/FontCommon';\r\nexport * from './Loader';\r\nexport { Particle, ParticleEmitter, ParticleArgs, ParticleEmitterArgs, EmitterType } from './Particles';\r\nexport * from './Collision/Physics';\r\nexport * from './Scene';\r\nexport { TileMap, Cell, TileMapArgs, CellArgs } from './TileMap';\r\nexport * from './Timer';\r\nexport * from './Trigger';\r\nexport * from './ScreenElement';\r\n\r\nexport * from './Actions/Index';\r\nexport * from './Collision/Index';\r\n\r\n// ex.LegacyDrawing namespace\r\nimport * as legacyDrawing from './Drawing/Index';\r\nexport { legacyDrawing as LegacyDrawing };\r\nexport * from './Interfaces/Index';\r\nexport * from './PostProcessing/Index';\r\nexport * from './Resources/Index';\r\n\r\nexport * from './EntityComponentSystem/index';\r\n\r\nexport * from './Color';\r\n\r\nexport * from './Graphics/index';\r\n\r\n// ex.Events namespace\r\nimport * as events from './Events';\r\nexport { events as Events };\r\n\r\n// ex.Input namespace\r\nimport * as input from './Input/Index';\r\nexport { input as Input };\r\n\r\n// ex.Traits namespace\r\nimport * as traits from './Traits/Index';\r\nexport { traits as Traits };\r\n\r\n// ex.Util namespaces\r\nimport * as util from './Util/Index';\r\nexport { util as Util };\r\nexport {\r\n  clamp,\r\n  range,\r\n  toDegrees,\r\n  toRadians,\r\n  randomInRange,\r\n  randomIntInRange,\r\n  canonicalizeAngle\r\n} from './Util/Index';\r\n\r\nexport * from './Util/Browser';\r\nexport * from './Util/Decorators';\r\nexport * from './Util/Detector';\r\nexport * from './Util/CullingBox';\r\nexport * from './Util/EasingFunctions';\r\nexport * from './Util/Observable';\r\nexport * from './Util/Log';\r\nexport * from './Util/SortedList';\r\nexport * from './Util/Pool';\r\n\r\n// ex.Deprecated\r\nexport * from './Promises';\r\n// import * as deprecated from './Deprecated';\r\n// export { deprecated as Deprecated };\r\n// export * from './Deprecated';\r\n"],"names":["root","factory","self","i","entryUnbind","module","exports","path","Object","keys","isCallable","tryToString","argument","TypeError","isObject","String","toIndexedObject","toLength","toAbsoluteIndex","createMethod","IS_INCLUDES","$this","el","fromIndex","value","O","length","index","includes","indexOf","fails","METHOD_NAME","method","call","floor","Math","mergeSort","array","comparefn","middle","insertionSort","merge","slice","element","j","left","right","llength","rlength","lindex","rindex","result","push","toString","it","TO_STRING_TAG_SUPPORT","classofRaw","TO_STRING_TAG","CORRECT_ARGUMENTS","arguments","tag","key","error","callee","has","ownKeys","getOwnPropertyDescriptorModule","definePropertyModule","target","source","defineProperty","f","getOwnPropertyDescriptor","DESCRIPTORS","createPropertyDescriptor","object","bitmap","enumerable","configurable","writable","get","global","document","EXISTS","createElement","firefox","match","UA","test","getBuiltIn","version","userAgent","process","Deno","versions","v8","split","webkit","bind","Function","CONSTRUCTOR","METHOD","prototype","createNonEnumerableProperty","redefine","setGlobal","copyConstructorProperties","isForced","options","targetProperty","sourceProperty","descriptor","TARGET","GLOBAL","STATIC","stat","noTargetGet","forced","sham","exec","aCallable","fn","that","a","b","c","apply","FunctionPrototype","getDescriptor","PROPER","name","CONFIGURABLE","aFunction","namespace","V","P","func","check","globalThis","window","g","this","toObject","hasOwnProperty","hasOwn","classof","propertyIsEnumerable","store","functionToString","inspectSource","set","NATIVE_WEAK_MAP","objectHas","shared","sharedKey","hiddenKeys","WeakMap","state","wmget","wmhas","wmset","metadata","facade","STATE","enforce","getterFor","TYPE","type","replacement","feature","detection","data","normalize","POLYFILL","NATIVE","string","replace","toLowerCase","USE_SYMBOL_AS_UID","$Symbol","V8_VERSION","getOwnPropertySymbols","symbol","Symbol","IE8_DOM_DEFINE","anObject","toPropertyKey","$defineProperty","Attributes","propertyIsEnumerableModule","$getOwnPropertyDescriptor","internalObjectKeys","concat","getOwnPropertyNames","names","enumBugKeys","$propertyIsEnumerable","NASHORN_BUG","1","input","pref","val","valueOf","getOwnPropertyNamesModule","getOwnPropertySymbolsModule","InternalStateModule","CONFIGURABLE_FUNCTION_NAME","getInternalState","enforceInternalState","TEMPLATE","unsafe","simple","join","undefined","uid","IS_PURE","mode","copyright","toInteger","max","min","integer","IndexedObject","requireObjectCoercible","ceil","isNaN","isSymbol","getMethod","ordinaryToPrimitive","TO_PRIMITIVE","exoticToPrim","toPrimitive","id","postfix","random","NATIVE_SYMBOL","iterator","WellKnownSymbolsStore","createWellKnownSymbol","withoutSetter","$","internalSort","arrayMethodIsStrict","FF","IE_OR_EDGE","V8","WEBKIT","nativeSort","sort","FAILS_ON_UNDEFINED","FAILS_ON_NULL","STRICT_METHOD","STABLE_SORT","code","chr","fromCharCode","k","v","charAt","proto","itemsLength","items","arrayLength","x","y","nativeKeys","___CSS_LOADER_EXPORT___","r","sources","mappings","sourcesContent","sourceRoot","o","cssWithMappingToString","list","map","item","content","needLayer","modules","media","dedupe","supports","layer","alreadyImportedModules","_i","_i2","cssMapping","btoa","base64","unescape","encodeURIComponent","JSON","stringify","sourceMapping","sourceURLs","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","__webpack_modules__","n","getter","__esModule","default","t","d","definition","e","obj","prop","toStringTag","Experiments","Legacy","LogLevel","Side","polyfill","audioContext","requestAnimationFrame","webkitRequestAnimationFrame","mozRequestAnimationFrame","callback","setInterval","cancelAnimationFrame","webkitCancelAnimationFrame","mozCancelAnimationFrame","AudioContext","webkitAudioContext","replaceMe","decodeAudioData","arrayBuffer","Promise","resolve","reject","mozAudioContext","msAudioContext","oAudioContext","devicePixelRatio","WebGL","Canvas","LegacyDrawing","Flags","_FROZEN","_FLAGS","enable","flagName","Error","createId","p","Debug","Info","Warn","Fatal","Logger","_appenders","defaultLevel","_INSTANCE","addAppender","ConsoleAppender","appender","clearAppenders","_log","level","args","len","log","debug","info","warn","fatal","_","console","consoleArgs","unshift","ScreenAppender","width","height","_messages","_canvas","innerWidth","innerHeight","style","position","_ctx","getContext","body","appendChild","message","clearRect","pos","opacity","fillStyle","toFixed","fillText","Random","seed","_lowerMask","_upperMask","_w","_n","_m","_a","_u","_s","_b","_t","_c","_l","_f","_mt","Array","Date","now","s","_index","_twist","mag01","nextInt","next","floating","bool","likelihood","pickOne","pickSet","numPicks","allowDuplicates","_pickSetWithDuplicates","_pickSetWithoutDuplicates","currentPick","tempArray","splice","shuffle","swap","randomIndex","range","d4","d6","d8","d10","d12","d20","None","Top","Bottom","Left","Right","getOpposite","side","fromDirection","direction","directions","Vector","Up","Down","directionEnum","Number","MAX_VALUE","maxIndex","dot","TwoPI","PI","extend","extended","deep","assignExists","assign","base64Encode","inputStr","b64","outputStr","byte1","charCodeAt","byte2","byte3","enc1","enc2","enc3","enc4","nullish","nullishVal","defaultVal","clamp","randomInRange","randomIntInRange","round","canonicalizeAngle","angle","tmpAngle","toDegrees","radians","toRadians","degrees","getPosition","oLeft","oTop","calcOffsetLeft","parent","offsetLeft","offsetParent","calcOffsetTop","offsetTop","addItemToArray","removeItemFromArray","contains","getOppositeSide","getSideFromDirection","Collection","initialSize","DefaultSize","_internalArray","_endPointer","_resize","newSize","newArray","count","pop","clear","internalSize","elementAt","insert","remove","removed","removeElement","toArray","forEach","fail","I","from","to","_x","delay","milliseconds","setTimeout","maxMessages","obsoleteMessage","resetObsoleteCounter","logMessage","suppressObsoleteMessages","isEnabled","getInstance","trace","showStackTrace","obsolete","alternateMethod","showStackTrack","property","SyntaxError","DecoratedClass","super","_y","Zero","One","Half","cos","sin","vec","Infinity","vec1","vec2","sqrt","pow","setTo","equals","vector","tolerance","abs","distance","squareDistance","magnitude","size","newLength","scale","average","add","sizeOrScale","sub","addEqual","subEqual","scaleEqual","cross","num","perpendicular","normal","negate","toAngle","atan2","rotate","anchor","sinAngle","cosAngle","clone","fixed","DisplayMode","EventTypes","Color","parseInt","parseFloat","hex","h","l","HSLColor","toRGBA","lighten","factor","temp","fromRGBA","darken","saturate","desaturate","multiply","color","newR","newG","newB","newA","mulitiply","screen","color1","invert","color2","equal","format","toHSLA","toHex","_componentToHex","Black","fromHex","White","Gray","LightGray","DarkGray","Yellow","Orange","Red","Vermilion","Vermillion","Rose","Magenta","Violet","Blue","Azure","Cyan","Viridian","Green","Chartreuse","Transparent","ExcaliburBlue","Y","q","hue2rgb","BoundingBox","leftOrOptions","top","bottom","intersection","points","minX","minY","maxX","maxY","hasZeroDimensions","center","translate","point","getPoints","fromPoints","shifted","transform","matrix","multv","getPerimeter","results","rayCast","ray","farClipDistance","tmin","tmax","xinv","dir","yinv","tx1","tx2","ty1","ty2","rayCastTime","combine","other","dimensions","intersect","totalBoundingBox","overlapX","overlapY","intersectWithSide","bb","getSideFromIntersection","debugDraw","ctx","strokeStyle","strokeRect","draw","ex","drawRect","Fixed","FitScreen","FillScreen","FitContainer","FillContainer","Position","Resolution","SVGA","Standard","Atari2600","GameBoy","GameBoyAdvance","NintendoDS","NES","SNES","Screen","_antialiasing","_resolutionStack","_viewportStack","_pixelRatioOverride","_isFullScreen","_isDisposed","_logger","_fullscreenChangeHandler","_pixelRatioChangeHandler","_devicePixelRatio","_calculateDevicePixelRatio","applyResolutionAndViewport","_resizeHandler","_setResolutionAndViewportByDisplayMode","viewport","resolution","_displayMode","displayMode","canvas","context","antialiasing","_browser","browser","_position","pixelRatio","_applyDisplayMode","_mediaQueryList","nativeComponent","matchMedia","addEventListener","dispose","off","_resizeObserver","disconnect","removeEventListener","isHiDpi","parentElement","_resolution","_viewport","aspectRatio","scaledWidth","scaledHeight","setCurrentCamera","camera","_camera","pushResolutionAndViewport","popResolutionAndViewport","imageRendering","updateViewport","resetTransform","smoothing","isSmooth","isFullScreen","goFullScreen","requestFullscreen","exitFullScreen","exitFullscreen","pageToScreenCoordinates","newX","newY","screenHeight","screenWidth","screenToPageCoordinates","screenMarginY","screenMarginX","screenToWorldCoordinates","drawWidth","drawHeight","halfDrawWidth","halfDrawHeight","worldToScreenCoordinates","screenX","screenY","pageToWorldCoordinates","worldToPageCoordinates","getWorldBounds","canvasWidth","halfCanvasWidth","canvasHeight","halfCanvasHeight","zoom","_computeFit","margin","overflow","aspect","adjustedWidth","adjustedHeight","_computeFitContainer","clientWidth","clientHeight","_initializeDisplayModePosition","Window","on","ResizeObserver","observe","display","specifiedPosition","offsetY","marginTop","offsetX","marginLeft","AudioContextFactory","WebAudio","_UNLOCKED","create","unlockTimeoutTimer","resume","then","buffer","createBuffer","createBufferSource","ended","connect","destination","onended","start","playbackState","currentTime","PLAYING_STATE","FINISHED_STATE","clearTimeout","st","Kill","PreKill","PostKill","PreDraw","PostDraw","PreDebugDraw","PostDebugDraw","PreUpdate","PostUpdate","PreFrame","PostFrame","PreCollision","CollisionStart","CollisionEnd","PostCollision","Initialize","Activate","Deactivate","ExitViewport","EnterViewport","ExitTrigger","EnterTrigger","Connect","Disconnect","Button","Axis","Subscribe","Unsubscribe","Visible","Hidden","Start","Stop","PointerUp","PointerDown","PointerMove","PointerEnter","PointerLeave","PointerCancel","PointerWheel","Move","Enter","Leave","Cancel","Wheel","Press","Release","Hold","PointerDragStart","PointerDragEnd","PointerDragEnter","PointerDragLeave","PointerDragMove","GameEvent","_bubbles","bubbles","stopPropagation","KillEvent","PreKillEvent","PostKillEvent","GameStartEvent","GameStopEvent","PreDrawEvent","delta","PostDrawEvent","PreDebugDrawEvent","PostDebugDrawEvent","PreUpdateEvent","engine","PostUpdateEvent","PreFrameEvent","prevStats","PostFrameEvent","stats","GamepadConnectEvent","gamepad","GamepadDisconnectEvent","GamepadButtonEvent","button","GamepadAxisEvent","axis","SubscribeEvent","topic","handler","UnsubscribeEvent","VisibleEvent","HiddenEvent","PreCollisionEvent","actor","PostCollisionEvent","ContactStartEvent","contact","ContactEndEvent","CollisionPreSolveEvent","CollisionPostSolveEvent","CollisionStartEvent","CollisionEndEvent","InitializeEvent","ActivateEvent","oldScene","DeactivateEvent","newScene","ExitViewPortEvent","EnterViewPortEvent","EnterTriggerEvent","ExitTriggerEvent","EventDispatcher","_handlers","_wiredEventDispatchers","_target","emit","eventName","event","t1","eventHandlers","once","ev","wire","eventDispatcher","unwire","Class","eventObject","line","x1","y1","x2","y2","thickness","cap","beginPath","lineWidth","lineCap","moveTo","lineTo","closePath","stroke","arc","origin","roundRect","radius","fill","br","tl","tr","bl","defaultRadius","quadraticCurveTo","circle","Graphic","_ID","showDebug","flipHorizontal","flipVertical","rotation","_width","_height","cloneGraphicOptions","localBounds","fromDimension","_preDraw","_drawImage","_postDraw","save","_rotate","_flip","scaleDirX","scaleDirY","restore","isPowerOfTwo","ensurePowerOfTwo","watch","change","__isProxy","Proxy","watchAny","Zt","TextureLoader","_GL","image","_TEXTURE_MAP","forceUpdate","gl","tex","bindTexture","TEXTURE_2D","toPowerOfTwoImage","texImage2D","RGBA","UNSIGNED_BYTE","createTexture","texParameteri","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","TEXTURE_MIN_FILTER","NEAREST","TEXTURE_MAG_FILTER","potCanvas","_POT_CANVAS","potCtx","_POT_CTX","imageSmoothingEnabled","drawImage","te","Map","Raster","_dirty","_smoothing","_color","flagDirty","_lineWidth","_lineDash","_padding","strokeColor","lineDash","padding","_bitmap","bitmapWidth","bitmapHeight","maybeCtx","cloneRasterOptions","dirty","_getTotalWidth","_originalWidth","_getTotalHeight","_originalHeight","_strokeColor","rasterize","_applyRasterProperites","execute","load","setLineDash","getLineDash","_options","cache","Loader","loadables","_resourceList","_playButtonShown","_resourceCount","_numLoaded","_progressCounts","_totalCounts","logo","logoWidth","logoHeight","loadingBarColor","backgroundColor","suppressPlayButton","_playButtonStyles","Kt","Z","playButtonText","startButtonFactory","buttonElement","getElementById","textContent","addResources","_image","_imageElement","Image","src","playButtonRootElement","_playButtonRootElement","playButtonElement","_playButtonElement","_playButton","existingRoot","_styleBlock","head","wireEngine","_engine","addResource","loadable","isLoaded","showPlayButton","evt","click","startButtonHandler","hidePlayButton","removeChild","update","_delta","all","finally","unlock","markResourceComplete","progress","buttonWidth","buttonHeight","playButtonPosition","fillRect","logoY","logoX","logoPosition","imageHeight","oldAntialias","getAntialiasing","setAntialiasing","loadingX","loadingY","loadingBarPosition","Xt","progressWidth","REPORTED_FEATURES","webgl","webaudio","gamepadapi","Detector","_features","failedTests","_criticalTests","canvasSupport","elem","arrayBufferSupport","xhr","XMLHttpRequest","open","responseType","dataUrlSupport","toDataURL","objectUrlSupport","URL","rgbaSupport","cssText","_warningTest","webAudioSupport","webglSupport","_loadBrowserFeatures","getBrowserFeatures","logBrowserFeatures","msg","supported","arraybuffer","dataurl","objecturl","rgba","navigator","getGamepads","failedCritical","warning","ae","bustCache","logger","events","_cacheBust","uri","status","response","request","send","le","updatePixel","imageData","pixel","firstPixel","avg","he","Grayscale","ce","Invert","de","Opacity","ue","Colorize","pe","fromRGB","Lighten","ge","Darken","_e","Saturate","fe","Desaturate","me","base","props","filter","Fill","xe","offset","drawAroundAnchor","effects","_spriteCanvas","_spriteCtx","_pixelData","_pixelsLoaded","_dirtyEffect","_opacity","imageOrConfig","Texture","texture","_initPixelsFromTexture","loaded","naturalWidth","naturalHeight","_loadPixels","_flushTexture","grayscale","addEffect","colorize","_applyEffects","removeEffect","indexToRemove","param","getImageData","putImageData","clearEffects","reset","ypoint","ctxOrOptions","CanvasRenderingContext2D","_drawWithOptions","u","m","w","anchorY","globalAlpha","be","SpriteImpl","ye","Ae","_sprite","_loadedResolve","_resource","blob","createObjectURL","url","decode","asSprite","Pe","sprites","speed","loop","currentFrame","_timeLeftInFrame","_idempotencyToken","freezeFrame","engineOrConfig","Engine","config","_setAnchor","_setRotation","_setScale","isDone","tick","idempotencyToken","_updateValues","current","skip","animOptions","currSprite","play","playAnimation","Ee","AnimationImpl","images","MatrixLocations","Se","Me","end","duration","easing","time","CreateReversibleEasingFunction","Linear","startValue","endValue","EaseInQuad","EaseOutQuad","EaseInOutQuad","EaseInCubic","EaseOutCubic","EaseInOutCubic","De","Be","_actions","_completedActions","_actor","clearActions","_currentAction","stop","getActions","hasNext","isComplete","shift","ke","repeatBuilder","repeat","_stopped","_repeatBuilder","_repeatContext","_actionQueue","getQueue","_repeat","_originalRepeat","Fe","Le","_started","_speed","_offset","_start","_end","_distance","_dir","vel","Ie","destx","desty","ShortestPath","LongestPath","Clockwise","CounterClockwise","RotationType","Te","Oe","angleRadians","rotationType","_rotationType","_currentNonCannonAngle","distance1","distance2","_shortDistance","_longDistance","_shortestPathIsPositive","_direction","angularVelocity","ze","angleRadiansOffset","Ue","owner","constructor","newComponent","TagComponent","MotionComponent","acc","scaleFactor","torque","inertia","X","Re","Ve","Float32Array","_scaleSignX","_scaleSignY","near","far","mat","Matrix","identity","sy","sx","multm","a11","a21","a31","a41","a12","a22","a32","a42","a13","a23","a33","b21","b31","b41","b12","b22","b32","b42","b13","b23","b33","b11","a14","dest","a24","a34","a43","a44","b43","b14","b24","b34","b44","getScale","sign","setPosition","sine","cosine","setRotation","currentScale","getRotation","getScaleY","getScaleX","setScaleX","xscale","setScaleY","yscale","setScale","getBasisDeterminant","getAffineInverse","inverseDet","ty","isIdentity","VectorView","_getX","getX","_getY","getY","_setX","setX","_setY","setY","CollisionType","BroadphaseStrategy","Integrator","World","CoordPlane","je","TransformComponent","Ge","_rotation","_scale","coordPlane","z","_recalculate","getGlobalMatrix","getGlobalTransform","globalPos","globalScale","globalRotation","parentTransform","globalScaleX","globalScaleY","applyInverse","Ke","scaleX","scaleY","speedX","speedY","_endX","_endY","_speedX","_speedY","_startX","_startY","_distanceX","_distanceY","motion","Ze","scaleOffsetX","scaleOffsetY","_startScale","_endScale","_directionX","_directionY","Ye","_method","_hasBeenCalled","Qe","easingFcn","_currentLerpTime","_lerpDuration","_lerpStart","_lerpEnd","_initialized","_initialize","$e","timeVisible","timeNotVisible","numBlinks","_timeVisible","_timeNotVisible","_elapsedTime","_totalTime","_duration","graphics","visible","Je","endOpacity","_multiplier","_endOpacity","ti","_delay","ei","actions","kill","ii","actorToFollow","followDistance","_actorToFollow","_current","_maximumDistance","_distanceBetween","actorToFollowSpeed","si","actorToMeet","_speedWasSpecified","_actorToMeet","ri","_queue","easeTo","EasingFunctions","yOrSpeed","speedOrUndefined","xOrPos","moveBy","yOffsetOrSpeed","yOffset","xOffsetOrVector","xOffset","rotateTo","rotateBy","scaleTo","sizeYOrSpeed","speedXOrUndefined","speedYOrUndefined","sizeY","sizeXOrVector","scaleBy","sizeOffsetYOrSpeed","sizeOffsetY","sizeOffsetXOrVector","blink","fade","die","callMethod","times","repeatForever","follow","meet","asPromise","PreventCollision","Passive","Active","Xe","Arcade","Realistic","CollisionResolutionStrategy","ni","DynamicAABBTree","oi","Euler","ai","li","gravity","Physics","collisionResolutionStrategy","dynamicTreeVelocityMultiplyer","dynamicTreeVelocityMultiplier","enabled","broadphaseStrategy","defaultMass","integrator","boundsPadding","positionIterations","velocityIterations","slop","steeringFactor","warmStart","bodiesCanSleepByDefault","surfaceEpsilon","sleepEpsilon","wakeThreshold","sleepBias","checkForFastBodies","disableMinimumSpeedForFastBody","hi","ci","category","mask","_name","_category","_mask","canCollide","collisionGroups","reduce","combinedName","combinedCategory","All","di","observers","subscriptions","register","subscribe","unregister","observer","unsubscribe","notifyAll","notify","cb","ui","colliderB","colliderA","Pair","calculatePairHash","BodyComponent","bodyA","bodyB","group","collisionType","active","collide","hasCollider","collider","idB","pi","overlaps","getOverlap","gi","bounds","isLeaf","worldBounds","nodes","_insert","leaf","currentRoot","combinedArea","inheritanceCost","area","leafAABB","oldArea","leftCombined","newArea","rightCombined","cost","leftCost","rightCost","oldParent","newParent","currentNode","_balance","_remove","sibling","grandParent","trackCollider","node","updateCollider","untrackCollider","multdy","balance","getHeight","query","rayCastQuery","getNodes","fi","begin","getSlope","numerator","getLength","intersectPoint","getPoint","mi","_dynamicCollisionTree","_collisions","Set","_collisionPairCache","_colliders","getColliders","track","yi","untrack","_shouldGenerateCollisionPair","hash","broadphase","targets","potentialColliders","physics","pairs","seconds","minDimension","fastBodies","oldPos","getFurthestPoint","furthestPoint","updateDistance","hitPoint","minCollider","isValid","pair","centerPoint","fastBodyCollisions","narrowphase","contacts","newContacts","collisions","updated","wi","touching","CompositeCollider","_collisionProcessor","_dynamicAABBTree","addCollider","clearColliders","removeCollider","worldPos","_transform","colliders","J","axes","furthestPoints","maxDistance","s1","getInertia","totalInertia","potentialCollider","getClosestLineBetween","maybeLine","lines","minLength","minLine","minDistance","minPoint","project","proj","projs","newProjection","vi","slope","intercept","getEdge","midpoint","flip","below","clip","sideVector","clipTime","distanceToPoint","signed","y0","x0","findVectorToPoint","findPoint","hasPoint","threshold","currPoint","dyc","dx1","dy1","dxc","p0","q0","denom","tDenom","tClosestParallel","tClosest","sClosest","sDenom","bi","PolygonPolygonClosestLine","polygonB","otherWorldPos","otherDirection","polygonA","rayTowardsThis","thisDirection","thisPoint","getClosestFace","otherFace","thisFace","face","PolygonEdgeClosestLine","edge","polygon","asLine","edgeLine","PolygonCircleClosestLine","circley","circlex","CircleCircleClosestLine","circleB","circleA","otherPoint","CircleEdgeClosestLine","circleWorlPos","EdgeEdgeClosestLine","edgeB","edgeA","edgeLineA","edgeLineB","CircleCollider","Ci","discriminant","toi","toi2","positiveToi","toi1","shape","Ti","Ei","CollideCircleCircle","CollideCirclePolygon","CollideCircleEdge","getFurthestLocalPoint","tx","bodyPos","dotProduct","scalars","newPos","drawCircle","Ai","mtv","tangent","localPoints","_canceled","matchAwake","sleeping","sleepMotion","setSleeping","isCanceled","cancel","Si","polyB","bestOtherPoint","polyA","getSides","getLocalSides","sides","bestSeparation","vertSeparation","bestSide","bestAxis","bestSideIndex","vertB","separation","localSide","sideId","localPoint","proj1","overlap","minOverlap","minAxis","minIndex","Pi","circleAPos","combinedRadius","circleBPos","local","mvt","SeparatingAxis","findCirclePolygonSeparation","samedir","findSide","findLocalSide","edgeWorld","cc","asLocalLine","dda","da","ddb","db","pointOnEdge","den","dd","CollideEdgeEdge","CollidePolygonEdge","CollidePolygonPolygon","linePoly","findPolygonPolygonSeparation","separationA","separationB","incident","reference","clipRight","refDir","clipLeft","xf","FindContactSeparation","shapeB","qe","shapeA","PolygonCollider","worldPoint","txA","txB","EdgeCollider","dist","_getBodyPos","_getTransformedBegin","_getTransformedEnd","transformedBegin","transformedEnd","_boundsFromBeginEnd","drawLine","_transformedPoints","_axes","_sides","_localSides","winding","clockwiseWinding","reverse","_calculateTransformation","getTransformedPoints","mostDirection","currentSide","accum","pts","POSITIVE_INFINITY","faceIndex","denominator","crossTerm","iplusone","contactTime","minContactTime","contactIndex","scalar","firstPoint","effectiveOffset","i1","Ri","Shape","Circle","Box","ColliderComponent","$colliderAdded","$colliderRemoved","_collider","flipped","onAdd","entity","precollision","postcollision","onRemove","useBoxCollider","usePolygonCollider","Polygon","useCircleCollider","useEdgeCollider","Edge","useCompositeCollider","DegreeOfFreedom","Rotation","Mi","dependencies","mass","canSleep","_sleeping","bounciness","friction","useGravity","limitDegreeOfFreedom","oldVel","oldAcc","oldRotation","oldScale","inverseMass","updateMotion","bias","currentMotion","inverseInertia","xFactor","yFactor","rx","applyImpulse","impulse","finalImpulse","applyLinearImpulse","applyAngularImpulse","captureOldTransform","ki","_topLeft","_topRight","_bottomLeft","_bottomRight","isSpriteOffScreen","currentDrawing","getGlobalPos","drawingWidth","drawingHeight","_xCoords","_yCoords","topRightScreen","bottomLeftScreen","bottomRightScreen","_xMin","_yMin","_xMax","_yMax","_xMinWorld","_yMinWorld","_xMaxWorld","_yMaxWorld","boundingPoints","rect","Fi","cullingBox","currentScene","isOffScreen","removeComponent","addComponent","He","Li","enableCapturePointer","isKilled","pointers","checkAndUpdateActorUnderPointer","Ii","zi","Entity","Wt","_componentsToRemove","_componentTypeToInstance","_componentStringToInstance","_tagsMemo","_typesMemo","componentAdded$","componentRemoved$","_parent","childrenAdded$","childrenRemoved$","_children","_isInitialized","_setName","components","component","e1","tags","hasTag","addTag","removeTag","force","types","_rebuildMemos","values","getComponents","_notifyAddComponent","_notifyRemoveComponent","children","unparent","addChild","getAncestors","removeAllChildren","getDescendants","queue","Hi","child","addTemplate","ctor","_removeComponentByType","componentOrType","Component","delete","processComponentRemoval","isInitialized","onInitialize","_preupdate","onPreUpdate","_postupdate","onPostUpdate","CanvasDrawComponent","graphic","Vi","_graphics","hide","nameOrGraphic","getGraphic","gfx","show","copyGraphics","getNames","use","order","Gi","_component","_layers","_layerMap","_maybeAddLayer","_getLayer","GraphicsComponent","_bounds","onPreDraw","onPostDraw","layers","graphicToSet","Rectangle","ee","Xi","_radius","qi","TextAlign","BaseAlign","FontStyle","Direction","Actor","_anchor","_handleAnchorChange","scene","frames","_draggable","_dragging","_pointerDragStartHandler","_pointerDragEndHandler","_pointerDragMoveHandler","pointer","lastWorldPos","_pointerDragLeaveHandler","traits","capturePointer","captureMoveEvents","captureDragEvents","_capturePointerEvents","_captureMoveEvents","_captureDragEvents","collisionGroup","defaults","Ni","thePos","theVel","theAcc","draggable","isDraggable","_checkForPointerOptIn","normalized","_prekill","onPreKill","_scene","_postkill","onPostKill","unkill","setDrawing","addDrawing","getZIndex","newZ","setZIndex","newIndex","getGlobalScale","getGlobalRotation","recurse","geom","containment","some","within","otherCollider","drawing","currFrame","trait","_predraw","_postdraw","Ki","Yi","Zi","useWorld","coords","$i","interval","repeats","numberOfRepeats","_totalTimeAlive","_running","_numberOfTicks","maxNumberOfRepeats","_complete","fcn","Timer","_MAX_ID","_callbacks","complete","newNumberOfRepeats","newInterval","timesRepeated","getTimeRunning","timeToNextAction","timeElapsedTowardNextAction","isRunning","pause","unpause","cancelTimer","Qi","ns","endsWith","ready","toSprite","unload","Sprite","sourceView","destSize","_updateSpriteDimensions","os","sprite","ImageSource","fromLegacyTexture","Em","Rem","Px","Pt","Percent","FontUnit","Ji","Center","End","ts","Hanging","Middle","Alphabetic","Ideographic","es","Normal","Italic","Oblique","is","LeftToRight","RightToLeft","ss","hs","columns","rows","spWidth","spHeight","spacing","_sprites","_columns","_rows","_spWidth","_spHeight","_spacing","imageOrConfigOrSprites","isWidthError","RangeError","isHeightError","loadFromImage","getSpacingDimensions","row","col","getAnimationByIndices","indices","getAnimationBetween","beginIndex","endIndex","getAnimationForAll","getSprite","getAnimationByCoords","spriteCoordinates","maxHeight","coord","anim","ls","alphabet","caseInsensitive","_currentColor","_currentOpacity","_spriteRecord","_textShadowOn","_textShadowDirty","_textShadowColor","_textShadowSprites","_shadowOffsetX","_shadowOffsetY","getTextSprites","char","setTextShadow","shadowColor","character","useTextShadow","text","_parseOptions","characterShadow","fontSize","letterSpacing","textAlign","baseAlign","currX","charSprite","currY","maxWidth","as","SpriteFont","cs","legacySpriteSheet","fromLegacySprite","oldSprite","spriteSheet","toLegacySprite","grid","spriteWidth","spriteHeight","originOffset","offsetDefaults","marginDefaults","cols","e3","TileMapImpl","cellWidth","cellHeight","_token","_onScreenXStart","_onScreenXEnd","_onScreenYStart","_onScreenYEnd","_spriteSheets","_legacySpriteMap","_cols","isOffscreen","xOrConfig","Bi","ji","_motion","_composite","cd","currentCol","registerSpriteSheet","fromLegacySpriteSheet","_updateColliders","solid","prev","getCellByIndex","getCell","getCellByPoint","cell","getRows","getColumns","graphicsIndex","graphicsLen","xEnd","yEnd","us","TileMap","CellImpl","_solid","pushSprite","addGraphic","removeGraphic","clearGraphics","Cell","ms","lockToActor","addStrategy","lockToActorAxis","elasticToActor","cameraElasticity","cameraFriction","radiusAroundActor","limitCameraBounds","box","ds","ws","action","_cam","_eng","ys","cam","getFocus","currentFocus","vs","cameraVel","focus","xs","bs","boundSizeChecked","focusY","focusX","Camera","_cameraStrategies","strategy","_z","dz","az","_posChanged","_pos","_cameraMoving","_isShaking","_shakeMagnitudeX","_shakeMagnitudeY","_shakeDuration","_elapsedShakeTime","_xShake","_yShake","_isZooming","_zoomStart","_zoomEnd","_currentZoomTime","_zoomDuration","_zoomEasing","_easing","_halfWidth","_halfHeight","_follow","dx","dy","ax","ay","move","easingFn","_lerpPromise","_lerpResolve","shake","magnitudeY","zoomOverTime","_zoomPromise","_zoomResolve","removeStrategy","cameraStrategy","clearAllStrategies","zoomEasing","CreateVectorEasingFunction","_isDoneShaking","newCanvasHeight","newCanvasWidth","Ss","Ps","opts","triggerDefaults","_dispatchAction","SystemType","Update","Draw","Es","Ts","priority","_entityAddedOrRemoved","Rs","Ms","ks","_world","entities","_entityIndex","_entitiesToRemove","updateEntities","elapsed","removeEntity","isAddedComponent","queryManager","addEntity","deferred","idOrEntity","actors","killed","processEntityRemovals","processComponentRemovals","getById","getByName","localeCompare","Query","_entities","T","_key","getEntities","matches","typesOrEntity","contain","Is","_queries","_addQuery","entityManager","maybeRemoveQuery","queryType","createQuery","getQuery","maybeExistingQuery","buildTypeKey","Os","systems","initialized","find","addSystem","initialize","removeSystem","system","updateSystems","systemType","preupdate","dr","postupdate","zs","systemManager","entityOrSystem","System","clearEntities","clearSystems","Us","totalAcc","elapsedMs","MotionSystem","optionalBody","integrate","Ns","solve","preSolve","solveVelocity","solvePosition","postSolve","ArcadeSolver","opposite","velAdj","Vs","normalImpulse","tangentImpulse","normalMass","tangentMass","aToContact","bToContact","bToContactNormal","aToContactNormal","bToContactTangent","aToContactTangent","getRelativeVelocity","RealisticSolver","lastFrameContacts","idToContactConstraint","getContactConstraints","finishedContactIds","contactPoints","pointIndex","CollisionJumpTable","steeringForce","maxFriction","impulseDelta","newImpulse","restitution","CollisionSystem","_realisticSolver","Gs","_arcadeSolver","Ws","_processor","_lastFrameContacts","_currentFrameContacts","_trackCollider","_untrackCollider","isAddedSystemEntity","colliderComponent","colliderComp","getSolver","runContactStartEnd","Xs","DrawCallCount","GraphicsDiagnostics","DrawnImagesCount","EmitterType","Ks","Loop","PingPong","Freeze","AnimationStrategy","qs","Animation","frameDuration","timeScale","_firstTick","_currentFrame","_done","_playing","goToFrame","Zs","frameIndices","durationPerFrameMs","invalidIndices","_LOGGER","animation","isPlaying","canFinish","done","maybeFrame","_nextFrame","_updateDimensions","GraphicsGroup","members","Ys","_isAnimationOrGroup","member","maybeAnimation","ParticleImpl","life","beginColor","endColor","velocity","acceleration","startSize","endSize","particleRotationalVelocity","currentRotation","focusAccel","fadeFlag","_rRate","_gRate","_bRate","_aRate","emitter","particleSize","particleSprite","sizeRate","elapsedMultiplier","emitterOrConfig","ParticleEmitter","drawPoint","removeParticle","accel","Particle","_particlesToEmit","numParticles","isEmitting","particles","deadParticles","minVel","maxVel","minAngle","maxAngle","emitRate","particleLife","minSize","maxSize","_og","emitterType","randomRotation","C","A","S","E","R","D","emitParticles","particleCount","_createParticle","world","clearParticles","ranY","ranX","GraphicsSystem","_graphicsContext","graphicsContext","_clearScreen","_isOffscreen","entityOffscreen","_pushCameraTransform","_applyTransform","_drawGraphicsComponent","_popCameraTransform","flush","drawnImages","drawCalls","graphicsComponent","isDebug","showBounds","boundsColor","ancestor","CanvasDrawingSystem","canvasdraw","offscreen","DebugSystem","_collisionSystem","$s","filterSettings","useFilter","ids","nameQuery","showAll","showPosition","positionColor","drawText","cursor","lineHeight","showId","showName","showRotation","fromAngle","rotationColor","showScale","scaleColor","showCollisionGroup","showCollisionType","showMass","showMotion","showSleeping","showVelocity","velocityColor","showAcceleration","accelerationColor","showGeometry","geometryColor","showOwner","showBroadphaseSpacePartitionDebug","showCollisionContacts","showCollisionNormals","physicsSettings","collisionContactColor","t4","collisionNormalColor","cameraSettings","showFocus","focusColor","showZoom","Keys","PointerType","PointerScope","NativePointerButton","PointerButton","WheelDeltaMode","Axes","DrawCommandType","Scene","Cs","_timers","_cancelQueue","triggers","tileMaps","screenElements","onActivate","_newScene","onDeactivate","_initializeChildren","_activate","_deactivate","removeTimer","timer","_collectActorStats","dispatchPointerEvents","addTimer","addScreenElement","removeScreenElement","addTileMap","removeTileMap","isTimerActive","isCurrentScene","_ui","alive","cr","Protanope","Deuteranope","Tritanope","ColorBlindness","sr","ur","simulate","colorMode","_vertexShader","_fragmentShader","_internalCanvas","_gl","preserveDrawingBuffer","_program","createProgram","_getShader","_getFragmentShaderByMode","attachShader","linkProgram","getProgramParameter","LINK_STATUS","useProgram","_setRectangle","bufferData","ARRAY_BUFFER","STATIC_DRAW","program","shader","createShader","FRAGMENT_SHADER","VERTEX_SHADER","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","out","getAttribLocation","bindBuffer","enableVertexAttribArray","vertexAttribPointer","FLOAT","pixelStorei","UNPACK_FLIP_Y_WEBGL","getUniformLocation","uniform2f","drawArrays","TRIANGLES","Uint8Array","readPixels","pr","correct","postProcessors","colorBlindness","gr","prevFrame","FrameStats","colorBlindMode","_r","_id","_fps","_actorStats","remaining","total","_durationStats","_physicsStats","fr","_graphicsStats","otherStats","fps","_pairs","_contacts","_fastBodies","_fastBodyCollisions","_broadphase","_narrowphase","Num0","Num1","Num2","Num3","Num4","Num5","Num6","Num7","Num8","Num9","NumAdd","NumSubtract","NumMultiply","NumDivide","NumDecimal","Numpad0","Numpad1","Numpad2","Numpad3","Numpad4","Numpad5","Numpad6","Numpad7","Numpad8","Numpad9","NumpadAdd","NumpadSubtract","NumpadMultiply","NumpadDivide","NumpadDecimal","NumLock","ShiftLeft","ShiftRight","AltLeft","AltRight","Key0","Key1","Key2","Key3","Key4","Key5","Key6","Key7","Key8","Key9","Digit0","Digit1","Digit2","Digit3","Digit4","Digit5","Digit6","Digit7","Digit8","Digit9","B","F","G","H","K","L","M","N","Q","U","W","KeyA","KeyB","KeyC","KeyD","KeyE","KeyF","KeyG","KeyH","KeyI","KeyJ","KeyK","KeyL","KeyM","KeyN","KeyO","KeyP","KeyQ","KeyR","KeyS","KeyT","KeyU","KeyV","KeyW","KeyX","KeyY","KeyZ","Semicolon","Quote","Comma","Minus","Period","Slash","Equal","BracketLeft","Backslash","BracketRight","Backquote","ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Space","Esc","Escape","rr","KeyEvent","rt","originalEvent","Keyboard","_keys","_keysUp","_keysDown","init","keyEvent","getKeys","wasPressed","isHeld","wasReleased","Touch","Mouse","Pen","Unknown","nr","Document","or","Pointer","_isDown","_wasDown","_actorsUnderPointer","_actors","_actorsLastFrame","_actorsNoLongerUnderPointer","_actorSortingFcn","lastPagePos","lastScreenPos","dragTarget","_onPointerMove","_onPointerDown","_onPointerUp","isDragging","isDragStart","isDragEnd","hasActorsUnderPointer","addActorUnderPointer","isActorAliveUnderPointer","removeActorUnderPointer","getActorsUnderPointer","getActorsUnderPointerLastFrame","getActorsForEvents","checkActorUnderPointer","wasActorUnderPointer","pagePos","screenPos","NoButton","ar","hr","Pixel","Line","Page","lr","PointerEvent","pointerType","coordinates","propagate","doAction","_onActionStart","_onActionEnd","xr","_pointerEventType","PointerDragEvent","PointerUpEvent","vr","PointerDownEvent","PointerMoveEvent","PointerEnterEvent","PointerLeaveEvent","PointerCancelEvent","WheelEvent","pageX","pageY","deltaX","deltaY","deltaZ","deltaMode","_isCanceled","Mr","yOrEngine","engineOrUndefined","Pointers","_pointerDown","_pointerUp","_pointerMove","_pointerCancel","_wheel","_pointers","_activePointers","primary","_handleTouchEvent","touchAction","_handlePointerEvent","MSPointerEvent","msTouchAction","_handleMouseEvent","passive","pageScrollPreventionMode","_handleWheelEvent","wheelOptions","onmousewheel","triggerEvent","GlobalCoordinates","pointerId","preventDefault","eventish","CapturePointer","_dispatchWithBubble","_dispatchPointerLeaveEvents","pointerLeave","createPointerEventByName","Dr","_dispatchPointerEnterEvents","pointerEnter","_propagateWheelPointerEvent","wheelEvent","eventArr","at","fromPagePosition","_nativeButtonToPointerButton","changedTouches","_getPointerIndex","identifier","_stringToPointerType","wheelDeltaX","wheelDeltaY","wheelDelta","detail","we","Gamepads","_gamePadTimeStamps","_oldPads","_pads","_initSuccess","_navigator","_minimumConfiguration","_clonePads","setMinimumGamepadConfiguration","_enableAndUpdate","_isGamepadValid","pad","buttons","connected","gamepads","timestamp","navigatorGamepad","Buttons","getButton","pressed","updateButton","getAxes","updateAxes","_clonePad","Gamepad","getValidGamepads","pads","Fr","MinAxisMoveThreshold","_buttons","isButtonPressed","Face1","Face2","Face3","Face4","LeftBumper","RightBumper","LeftTrigger","RightTrigger","Select","LeftStick","RightStick","DpadUp","DpadDown","DpadLeft","DpadRight","Lr","LeftStickX","LeftStickY","RightStickX","RightStickY","Ir","Or","_paused","_nativeHandlers","_decorate","zr","_documentGlobal","_windowGlobal","_windowComponent","_documentComponent","Ur","_states","_currentState","_getDefaultState","_cloneState","Hr","_text","shadow","spriteFont","_getCharacterSprites","textToRender","toLocaleLowerCase","letterIndex","letter","spriteIndex","letterSprite","updateText","render","Nr","fontSheet","_imageSource","_spriteSheet","fromImageSource","_spriteFont","write","Wr","_ex","_debugText","__ctx","snapToPixel","lineOptions","pointOptions","Vr","_state","canvasElement","enableTransparency","alpha","swidth","sheight","dwidth","dheight","drawRectangle","Gr","_transforms","_currentTransform","jr","_vertexSource","_fragmentSource","uniforms","attributes","layout","compile","_createProgram","vertexShader","fragmentShader","getProgramInfoLog","_compileShader","addUniformMatrix","location","addUniformIntegerArray","addAttribute","glType","vertexAttributeSize","vert","totalVertexSizeBytes","vertexSize","typeSize","getAttributeSize","uniformMatrix4fv","uniform1iv","Xr","_pool","commands","isFull","canAdd","qr","recycler","maxObjects","builder","totalAllocations","objects","using","borrow","Kr","_buffer","_maxCommandsPerBatch","_batches","command","_verticesPerCommand","verticesPerCommand","maxCommandsPerBatch","batchFactory","_batchPool","buildShader","_vertices","DYNAMIC_DRAW","addCommand","lastBatch","cmd","newBatch","drawnImagesCount","batch","buildBatchVertices","bufferSubData","renderBatch","vertexCount","drawCallCount","Zr","LineRenderer","_contextInfo","addLine","vertexBuffer","_batch","LINES","Qr","$r","view","_geom","initRect","initLine","startTop","startBottom","endTop","endBottom","initCircle","topLeft","topRight","bottomLeft","bottomRight","applyTransform","geometry","BatchImage","maxTextures","maxDraws","textures","_graphicMap","_isCommandFull","_isTextureFull","_wouldAddTexture","maybeAdd","bindTextures","activeTexture","TEXTURE0","getBatchTextureId","ImageRenderer","Jr","getParameter","MAX_TEXTURE_IMAGE_UNITS","registerContext","_transformFragmentSource","maxGPUTextures","newSource","addCircle","addRectangle","addImage","sw","sh","potWidth","potHeight","textureId","commandColor","uvy0","uvx1","uvy1","vertIndex","en","PointRenderer","getExtension","addPoint","POINTS","rn","_webglCtx","rectOptions","__lineRenderer","__pointRenderer","nn","__gl","antialias","premultipliedAlpha","depth","powerPreference","_init","_ortho","ortho","clearColor","COLOR_BUFFER_BIT","BLEND","blendFunc","SRC_ALPHA","ONE_MINUS_SRC_ALPHA","__imageRenderer","ie","ScrollPreventionMode","_hasStarted","scenes","_animations","_suppressPlayButton","pauseAudioWhenHidden","_isDebug","debugColor","enableCanvasTransparency","onFatalException","_timescale","_isLoading","_deferredGoTo","_DEFAULT_ENGINE_OPTIONS","freeze","oe","suppressMinimumBrowserFeatureDetection","_compatible","innerText","detector","testMessage","canvasElementId","suppressConsoleBootMessage","EX_VERSION","et","suppressHiDPIScaling","_loader","rootScene","addScene","isFullscreen","timescale","removeScene","goToScene","visibilityChange","scrollPreventionMode","keyboard","kr","pointerScope","hidden","_overrideInitialize","_update","_draw","font","toggleDebug","createMainLoop","raf","nowFn","mainloop","game","_requestId","lastTime","frameId","beforeUpdate","afterUpdate","isPaused","screenshot","an","ln","AnimationNode","MediaEvent","_value","_path","_val","layPath","NativeSoundEvent","cn","NativeSoundProcessedEvent","_processedData","Font","quality","family","bold","unit","_textBounds","_textWidth","_textHeight","blur","pn","fontString","_lines","numLines","_rasterWidth","_rasterHeight","_halfRasterWidth","_halfRasterHeight","_applyFont","metrics","measureText","actualBoundingBoxLeft","actualBoundingBoxRight","actualBoundingBoxAscent","actualBoundingBoxDescent","lineAdjustedHeight","bottomBounds","textBaseline","shadowBlur","shadowOffsetX","shadowOffsetY","strokeText","Text","gn","_font","fontFamily","fontStyle","fontUnit","_legacySpriteFont","sf","fromLegacySpriteFont","getTextWidth","clearTextShadow","mn","_CURRENT_GROUP","_MAX_GROUPS","_GROUPS","_CURRENT_BIT","groups","_STARTING_BIT","yn","filled","_points","curr","fillColor","lineColor","wn","ExResponse","any","json","Rn","_src","_volume","_loop","_isPlaying","_isPaused","_audioContext","_volumeNode","createGain","_currentOffset","_createNewBufferSource","_instance","_wireUpOnEnded","volume","gain","setTargetAtTime","_playbackRate","playbackRate","_resumePlayBack","playStarted","_startPlayBack","_playingPromise","_setPauseOffset","_handleOnEnded","_playingResolve","_rememberStartTime","restartTime","_startTime","getTime","amend","setValueAtTime","file","Audio","canPlayType","Sound","_isStopped","_tracks","_wasPlayingOnHidden","canPlayFile","instances","audiobuffer","decodeAudio","instanceCount","_resumePlayback","_startPlayback","getTrackId","_getTrackInstance","newTrack","Fn","_stream","_gif","_textures","_animation","_transparentColor","toLegacySpriteSheet","toSpriteSheet","toLegacyAnimation","toAnimation","fromSpriteSheet","readCheckBytes","checkBytes","ba","byteToBitArr","bite","On","readByte","byteLength","readBytes","read","readUnsigned","zn","_st","_handler","globalColorTable","parseColorTable","entries","readSubBlocks","parseHeader","sig","ver","colorRes","globalColorTableSize","gctFlag","sorted","bgColor","pixelAspectRatio","hdr","bits","parseExt","block","reserved","disposalMethod","userInput","transparencyGiven","delayTime","transparencyIndex","terminator","gce","comment","com","ptHeader","ptData","pte","unknown","iterations","app","NETSCAPE","appData","authCode","label","extType","parseImg","img","leftPos","topPos","lctFlag","interlaced","lctSize","lct","lzwMinCodeSize","pixels","output","clearCode","minCodeSize","eoiCode","dict","codeSize","last","readCode","cpRow","toRow","fromRow","newPixels","fromPixels","steps","pass","offsets","deinterlace","arrayToImage","parseBlock","sentinel","eof","frame","Un","Nn","_getComparable","_find","_root","getKey","getData","getLeft","getRight","_get","setLeft","setRight","removeByComparable","elementIndex","_findMinNode","setKey","setData","_cleanup","comparable","_list","treeNode","Hn","SortedList","Wn","_data","_left","_right","BinaryTreeNode","Vn","getTheKey","PromiseState","Resolved","Rejected","Pending","jn","qn","Gn","_successCallbacks","_rejectCallback","isArray","promises","rejects","successes","joinedPromise","errors","rejectCallback","successCallback","_handleError","errorCallback","_errorCallback","Xn","Kn","define","amd"],"version":3,"file":"index.4abf926a.js.map"}